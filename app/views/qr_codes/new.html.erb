
<h1 class="newcardtitle">QR Code Reader Demo</h1>

<h1 class="newcardtitle">QR Code Reader on Rails</h1>

<div class="newloco">
  <video id="video" width="500" height="400">
  <script>
  if ('mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices) {
  console.log("Let's get this party started")}
  navigator.mediaDevices.getUserMedia({video: true})
  </script>
  </video>
</div>

<script>
import { BrowserQRCodeReader } from '@zxing/library';
import Rails from '@rails/ujs'; // Use to make an ajax post request to Rails

const codeReader = new BrowserQRCodeReader();

codeReader
    .decodeOnceFromVideoDevice(undefined, 'video')
    .then((result) => {
        let qrDataFromReader = result.text;

        // Prepare a post request so it can be sent to the Rails controller
        let formData = new FormData();

        let qrCodeParams = {
            qr_data: qrDataFromReader
        };

        formData.append("qr_code_json_data", JSON.stringify(qrCodeParams));

        // Send QR code data as JSON to the 
        // qr_codes#create action using Rails ujs
        Rails.ajax({
            url: "/qr_codes",
            type: "post",
            data: formData
        });

    })
    .catch(error => {
        console.error(error);
    });
</script>

