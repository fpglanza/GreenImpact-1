/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/packs/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./app/javascript/packs/application.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./app/javascript/channels sync recursive _channel\\.js$":
/*!****************************************************!*\
  !*** ./app/javascript/channels sync _channel\.js$ ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

function webpackEmptyContext(req) {
	var e = new Error("Cannot find module '" + req + "'");
	e.code = 'MODULE_NOT_FOUND';
	throw e;
}
webpackEmptyContext.keys = function() { return []; };
webpackEmptyContext.resolve = webpackEmptyContext;
module.exports = webpackEmptyContext;
webpackEmptyContext.id = "./app/javascript/channels sync recursive _channel\\.js$";

/***/ }),

/***/ "./app/javascript/channels/index.js":
/*!******************************************!*\
  !*** ./app/javascript/channels/index.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// Load all the channels within this directory and all subdirectories.
// Channel files must be named *_channel.js.
var channels = __webpack_require__("./app/javascript/channels sync recursive _channel\\.js$");

channels.keys().forEach(channels);

/***/ }),

/***/ "./app/javascript/packs/application.js":
/*!*********************************************!*\
  !*** ./app/javascript/packs/application.js ***!
  \*********************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var bootstrap__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bootstrap */ "./node_modules/bootstrap/dist/js/bootstrap.js");
/* harmony import */ var bootstrap__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bootstrap__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _plugins_init_mapbox__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../plugins/init_mapbox */ "./app/javascript/plugins/init_mapbox.js");
// This file is automatically compiled by Webpack, along with any other files
// present in this directory. You're encouraged to place your actual application logic in
// a relevant structure within app/javascript and only use these pack files to reference
// that code so it'll be compiled.
__webpack_require__(/*! @rails/ujs */ "./node_modules/@rails/ujs/lib/assets/compiled/rails-ujs.js").start();

__webpack_require__(/*! turbolinks */ "./node_modules/turbolinks/dist/turbolinks.js").start();

__webpack_require__(!(function webpackMissingModule() { var e = new Error("Cannot find module '@rails/activestorage'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())).start();

__webpack_require__(/*! channels */ "./app/javascript/channels/index.js"); // Uncomment to copy all static images under ../images to the output folder and reference
// them with the image_pack_tag helper in views (e.g <%= image_pack_tag 'rails.png' %>)
// or the `imagePath` JavaScript helper below.
//
// const images = require.context('../images', true)
// const imagePath = (name) => images(name, true)
// ----------------------------------------------------
// Note(lewagon): ABOVE IS RAILS DEFAULT CONFIGURATION
// WRITE YOUR OWN JS STARTING FROM HERE ðŸ‘‡
// ----------------------------------------------------
// External imports



 // Internal imports, e.g:
// import { initSelect2 } from '../components/init_select2';

document.addEventListener('turbolinks:load', function () {
  Object(_plugins_init_mapbox__WEBPACK_IMPORTED_MODULE_1__["initMapbox"])(); // Call your functions here, e.g:
  // initSelect2();
});

/***/ }),

/***/ "./app/javascript/plugins/init_mapbox.js":
/*!***********************************************!*\
  !*** ./app/javascript/plugins/init_mapbox.js ***!
  \***********************************************/
/*! exports provided: initMapbox */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "initMapbox", function() { return initMapbox; });
/* harmony import */ var mapbox_gl__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mapbox-gl */ "./node_modules/mapbox-gl/dist/mapbox-gl.js");
/* harmony import */ var mapbox_gl__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mapbox_gl__WEBPACK_IMPORTED_MODULE_0__);


var initMapbox = function initMapbox() {
  var mapElement = document.getElementById('map');

  if (mapElement) {
    // only build a map if there's a div#map to inject into
    mapbox_gl__WEBPACK_IMPORTED_MODULE_0___default.a.accessToken = mapElement.dataset.mapboxApiKey;
    var map = new mapbox_gl__WEBPACK_IMPORTED_MODULE_0___default.a.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v10'
    });
    var markers = JSON.parse(mapElement.dataset.markers);
    markers.forEach(function (marker) {
      new mapbox_gl__WEBPACK_IMPORTED_MODULE_0___default.a.Marker().setLngLat([marker.lng, marker.lat]).addTo(map);
    });

    var fitMapToMarkers = function fitMapToMarkers(map, markers) {
      var bounds = new mapbox_gl__WEBPACK_IMPORTED_MODULE_0___default.a.LngLatBounds();
      markers.forEach(function (marker) {
        return bounds.extend([marker.lng, marker.lat]);
      });
      map.fitBounds(bounds, {
        padding: 70,
        maxZoom: 15,
        duration: 0
      });
    };

    fitMapToMarkers(map, markers);
  }
};



/***/ }),

/***/ "./node_modules/@rails/ujs/lib/assets/compiled/rails-ujs.js":
/*!******************************************************************!*\
  !*** ./node_modules/@rails/ujs/lib/assets/compiled/rails-ujs.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(module) {var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

/*
Unobtrusive JavaScript
https://github.com/rails/rails/blob/master/actionview/app/assets/javascripts
Released under the MIT license
 */
;
(function () {
  var context = this;
  (function () {
    (function () {
      this.Rails = {
        linkClickSelector: 'a[data-confirm], a[data-method], a[data-remote]:not([disabled]), a[data-disable-with], a[data-disable]',
        buttonClickSelector: {
          selector: 'button[data-remote]:not([form]), button[data-confirm]:not([form])',
          exclude: 'form button'
        },
        inputChangeSelector: 'select[data-remote], input[data-remote], textarea[data-remote]',
        formSubmitSelector: 'form',
        formInputClickSelector: 'form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])',
        formDisableSelector: 'input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled',
        formEnableSelector: 'input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled',
        fileInputSelector: 'input[name][type=file]:not([disabled])',
        linkDisableSelector: 'a[data-disable-with], a[data-disable]',
        buttonDisableSelector: 'button[data-remote][data-disable-with], button[data-remote][data-disable]'
      };
    }).call(this);
  }).call(context);
  var Rails = context.Rails;
  (function () {
    (function () {
      var nonce;
      nonce = null;

      Rails.loadCSPNonce = function () {
        var ref;
        return nonce = (ref = document.querySelector("meta[name=csp-nonce]")) != null ? ref.content : void 0;
      };

      Rails.cspNonce = function () {
        return nonce != null ? nonce : Rails.loadCSPNonce();
      };
    }).call(this);
    (function () {
      var expando, m;
      m = Element.prototype.matches || Element.prototype.matchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector || Element.prototype.webkitMatchesSelector;

      Rails.matches = function (element, selector) {
        if (selector.exclude != null) {
          return m.call(element, selector.selector) && !m.call(element, selector.exclude);
        } else {
          return m.call(element, selector);
        }
      };

      expando = '_ujsData';

      Rails.getData = function (element, key) {
        var ref;
        return (ref = element[expando]) != null ? ref[key] : void 0;
      };

      Rails.setData = function (element, key, value) {
        if (element[expando] == null) {
          element[expando] = {};
        }

        return element[expando][key] = value;
      };

      Rails.$ = function (selector) {
        return Array.prototype.slice.call(document.querySelectorAll(selector));
      };
    }).call(this);
    (function () {
      var $, csrfParam, csrfToken;
      $ = Rails.$;

      csrfToken = Rails.csrfToken = function () {
        var meta;
        meta = document.querySelector('meta[name=csrf-token]');
        return meta && meta.content;
      };

      csrfParam = Rails.csrfParam = function () {
        var meta;
        meta = document.querySelector('meta[name=csrf-param]');
        return meta && meta.content;
      };

      Rails.CSRFProtection = function (xhr) {
        var token;
        token = csrfToken();

        if (token != null) {
          return xhr.setRequestHeader('X-CSRF-Token', token);
        }
      };

      Rails.refreshCSRFTokens = function () {
        var param, token;
        token = csrfToken();
        param = csrfParam();

        if (token != null && param != null) {
          return $('form input[name="' + param + '"]').forEach(function (input) {
            return input.value = token;
          });
        }
      };
    }).call(this);
    (function () {
      var CustomEvent, fire, matches, preventDefault;
      matches = Rails.matches;
      CustomEvent = window.CustomEvent;

      if (typeof CustomEvent !== 'function') {
        CustomEvent = function CustomEvent(event, params) {
          var evt;
          evt = document.createEvent('CustomEvent');
          evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
          return evt;
        };

        CustomEvent.prototype = window.Event.prototype;
        preventDefault = CustomEvent.prototype.preventDefault;

        CustomEvent.prototype.preventDefault = function () {
          var result;
          result = preventDefault.call(this);

          if (this.cancelable && !this.defaultPrevented) {
            Object.defineProperty(this, 'defaultPrevented', {
              get: function get() {
                return true;
              }
            });
          }

          return result;
        };
      }

      fire = Rails.fire = function (obj, name, data) {
        var event;
        event = new CustomEvent(name, {
          bubbles: true,
          cancelable: true,
          detail: data
        });
        obj.dispatchEvent(event);
        return !event.defaultPrevented;
      };

      Rails.stopEverything = function (e) {
        fire(e.target, 'ujs:everythingStopped');
        e.preventDefault();
        e.stopPropagation();
        return e.stopImmediatePropagation();
      };

      Rails.delegate = function (element, selector, eventType, handler) {
        return element.addEventListener(eventType, function (e) {
          var target;
          target = e.target;

          while (!(!(target instanceof Element) || matches(target, selector))) {
            target = target.parentNode;
          }

          if (target instanceof Element && handler.call(target, e) === false) {
            e.preventDefault();
            return e.stopPropagation();
          }
        });
      };
    }).call(this);
    (function () {
      var AcceptHeaders, CSRFProtection, createXHR, cspNonce, fire, prepareOptions, processResponse;
      cspNonce = Rails.cspNonce, CSRFProtection = Rails.CSRFProtection, fire = Rails.fire;
      AcceptHeaders = {
        '*': '*/*',
        text: 'text/plain',
        html: 'text/html',
        xml: 'application/xml, text/xml',
        json: 'application/json, text/javascript',
        script: 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript'
      };

      Rails.ajax = function (options) {
        var xhr;
        options = prepareOptions(options);
        xhr = createXHR(options, function () {
          var ref, response;
          response = processResponse((ref = xhr.response) != null ? ref : xhr.responseText, xhr.getResponseHeader('Content-Type'));

          if (Math.floor(xhr.status / 100) === 2) {
            if (typeof options.success === "function") {
              options.success(response, xhr.statusText, xhr);
            }
          } else {
            if (typeof options.error === "function") {
              options.error(response, xhr.statusText, xhr);
            }
          }

          return typeof options.complete === "function" ? options.complete(xhr, xhr.statusText) : void 0;
        });

        if (options.beforeSend != null && !options.beforeSend(xhr, options)) {
          return false;
        }

        if (xhr.readyState === XMLHttpRequest.OPENED) {
          return xhr.send(options.data);
        }
      };

      prepareOptions = function prepareOptions(options) {
        options.url = options.url || location.href;
        options.type = options.type.toUpperCase();

        if (options.type === 'GET' && options.data) {
          if (options.url.indexOf('?') < 0) {
            options.url += '?' + options.data;
          } else {
            options.url += '&' + options.data;
          }
        }

        if (AcceptHeaders[options.dataType] == null) {
          options.dataType = '*';
        }

        options.accept = AcceptHeaders[options.dataType];

        if (options.dataType !== '*') {
          options.accept += ', */*; q=0.01';
        }

        return options;
      };

      createXHR = function createXHR(options, done) {
        var xhr;
        xhr = new XMLHttpRequest();
        xhr.open(options.type, options.url, true);
        xhr.setRequestHeader('Accept', options.accept);

        if (typeof options.data === 'string') {
          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
        }

        if (!options.crossDomain) {
          xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
          CSRFProtection(xhr);
        }

        xhr.withCredentials = !!options.withCredentials;

        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE) {
            return done(xhr);
          }
        };

        return xhr;
      };

      processResponse = function processResponse(response, type) {
        var parser, script;

        if (typeof response === 'string' && typeof type === 'string') {
          if (type.match(/\bjson\b/)) {
            try {
              response = JSON.parse(response);
            } catch (error) {}
          } else if (type.match(/\b(?:java|ecma)script\b/)) {
            script = document.createElement('script');
            script.setAttribute('nonce', cspNonce());
            script.text = response;
            document.head.appendChild(script).parentNode.removeChild(script);
          } else if (type.match(/\b(xml|html|svg)\b/)) {
            parser = new DOMParser();
            type = type.replace(/;.+/, '');

            try {
              response = parser.parseFromString(response, type);
            } catch (error) {}
          }
        }

        return response;
      };

      Rails.href = function (element) {
        return element.href;
      };

      Rails.isCrossDomain = function (url) {
        var e, originAnchor, urlAnchor;
        originAnchor = document.createElement('a');
        originAnchor.href = location.href;
        urlAnchor = document.createElement('a');

        try {
          urlAnchor.href = url;
          return !((!urlAnchor.protocol || urlAnchor.protocol === ':') && !urlAnchor.host || originAnchor.protocol + '//' + originAnchor.host === urlAnchor.protocol + '//' + urlAnchor.host);
        } catch (error) {
          e = error;
          return true;
        }
      };
    }).call(this);
    (function () {
      var matches, toArray;
      matches = Rails.matches;

      toArray = function toArray(e) {
        return Array.prototype.slice.call(e);
      };

      Rails.serializeElement = function (element, additionalParam) {
        var inputs, params;
        inputs = [element];

        if (matches(element, 'form')) {
          inputs = toArray(element.elements);
        }

        params = [];
        inputs.forEach(function (input) {
          if (!input.name || input.disabled) {
            return;
          }

          if (matches(input, 'fieldset[disabled] *')) {
            return;
          }

          if (matches(input, 'select')) {
            return toArray(input.options).forEach(function (option) {
              if (option.selected) {
                return params.push({
                  name: input.name,
                  value: option.value
                });
              }
            });
          } else if (input.checked || ['radio', 'checkbox', 'submit'].indexOf(input.type) === -1) {
            return params.push({
              name: input.name,
              value: input.value
            });
          }
        });

        if (additionalParam) {
          params.push(additionalParam);
        }

        return params.map(function (param) {
          if (param.name != null) {
            return encodeURIComponent(param.name) + "=" + encodeURIComponent(param.value);
          } else {
            return param;
          }
        }).join('&');
      };

      Rails.formElements = function (form, selector) {
        if (matches(form, 'form')) {
          return toArray(form.elements).filter(function (el) {
            return matches(el, selector);
          });
        } else {
          return toArray(form.querySelectorAll(selector));
        }
      };
    }).call(this);
    (function () {
      var allowAction, fire, stopEverything;
      fire = Rails.fire, stopEverything = Rails.stopEverything;

      Rails.handleConfirm = function (e) {
        if (!allowAction(this)) {
          return stopEverything(e);
        }
      };

      Rails.confirm = function (message, element) {
        return confirm(message);
      };

      allowAction = function allowAction(element) {
        var answer, callback, message;
        message = element.getAttribute('data-confirm');

        if (!message) {
          return true;
        }

        answer = false;

        if (fire(element, 'confirm')) {
          try {
            answer = Rails.confirm(message, element);
          } catch (error) {}

          callback = fire(element, 'confirm:complete', [answer]);
        }

        return answer && callback;
      };
    }).call(this);
    (function () {
      var disableFormElement, disableFormElements, disableLinkElement, enableFormElement, enableFormElements, enableLinkElement, formElements, getData, isXhrRedirect, matches, setData, stopEverything;
      matches = Rails.matches, getData = Rails.getData, setData = Rails.setData, stopEverything = Rails.stopEverything, formElements = Rails.formElements;

      Rails.handleDisabledElement = function (e) {
        var element;
        element = this;

        if (element.disabled) {
          return stopEverything(e);
        }
      };

      Rails.enableElement = function (e) {
        var element;

        if (e instanceof Event) {
          if (isXhrRedirect(e)) {
            return;
          }

          element = e.target;
        } else {
          element = e;
        }

        if (matches(element, Rails.linkDisableSelector)) {
          return enableLinkElement(element);
        } else if (matches(element, Rails.buttonDisableSelector) || matches(element, Rails.formEnableSelector)) {
          return enableFormElement(element);
        } else if (matches(element, Rails.formSubmitSelector)) {
          return enableFormElements(element);
        }
      };

      Rails.disableElement = function (e) {
        var element;
        element = e instanceof Event ? e.target : e;

        if (matches(element, Rails.linkDisableSelector)) {
          return disableLinkElement(element);
        } else if (matches(element, Rails.buttonDisableSelector) || matches(element, Rails.formDisableSelector)) {
          return disableFormElement(element);
        } else if (matches(element, Rails.formSubmitSelector)) {
          return disableFormElements(element);
        }
      };

      disableLinkElement = function disableLinkElement(element) {
        var replacement;

        if (getData(element, 'ujs:disabled')) {
          return;
        }

        replacement = element.getAttribute('data-disable-with');

        if (replacement != null) {
          setData(element, 'ujs:enable-with', element.innerHTML);
          element.innerHTML = replacement;
        }

        element.addEventListener('click', stopEverything);
        return setData(element, 'ujs:disabled', true);
      };

      enableLinkElement = function enableLinkElement(element) {
        var originalText;
        originalText = getData(element, 'ujs:enable-with');

        if (originalText != null) {
          element.innerHTML = originalText;
          setData(element, 'ujs:enable-with', null);
        }

        element.removeEventListener('click', stopEverything);
        return setData(element, 'ujs:disabled', null);
      };

      disableFormElements = function disableFormElements(form) {
        return formElements(form, Rails.formDisableSelector).forEach(disableFormElement);
      };

      disableFormElement = function disableFormElement(element) {
        var replacement;

        if (getData(element, 'ujs:disabled')) {
          return;
        }

        replacement = element.getAttribute('data-disable-with');

        if (replacement != null) {
          if (matches(element, 'button')) {
            setData(element, 'ujs:enable-with', element.innerHTML);
            element.innerHTML = replacement;
          } else {
            setData(element, 'ujs:enable-with', element.value);
            element.value = replacement;
          }
        }

        element.disabled = true;
        return setData(element, 'ujs:disabled', true);
      };

      enableFormElements = function enableFormElements(form) {
        return formElements(form, Rails.formEnableSelector).forEach(enableFormElement);
      };

      enableFormElement = function enableFormElement(element) {
        var originalText;
        originalText = getData(element, 'ujs:enable-with');

        if (originalText != null) {
          if (matches(element, 'button')) {
            element.innerHTML = originalText;
          } else {
            element.value = originalText;
          }

          setData(element, 'ujs:enable-with', null);
        }

        element.disabled = false;
        return setData(element, 'ujs:disabled', null);
      };

      isXhrRedirect = function isXhrRedirect(event) {
        var ref, xhr;
        xhr = (ref = event.detail) != null ? ref[0] : void 0;
        return (xhr != null ? xhr.getResponseHeader("X-Xhr-Redirect") : void 0) != null;
      };
    }).call(this);
    (function () {
      var stopEverything;
      stopEverything = Rails.stopEverything;

      Rails.handleMethod = function (e) {
        var csrfParam, csrfToken, form, formContent, href, link, method;
        link = this;
        method = link.getAttribute('data-method');

        if (!method) {
          return;
        }

        href = Rails.href(link);
        csrfToken = Rails.csrfToken();
        csrfParam = Rails.csrfParam();
        form = document.createElement('form');
        formContent = "<input name='_method' value='" + method + "' type='hidden' />";

        if (csrfParam != null && csrfToken != null && !Rails.isCrossDomain(href)) {
          formContent += "<input name='" + csrfParam + "' value='" + csrfToken + "' type='hidden' />";
        }

        formContent += '<input type="submit" />';
        form.method = 'post';
        form.action = href;
        form.target = link.target;
        form.innerHTML = formContent;
        form.style.display = 'none';
        document.body.appendChild(form);
        form.querySelector('[type="submit"]').click();
        return stopEverything(e);
      };
    }).call(this);
    (function () {
      var ajax,
          fire,
          getData,
          isCrossDomain,
          isRemote,
          matches,
          serializeElement,
          setData,
          stopEverything,
          slice = [].slice;
      matches = Rails.matches, getData = Rails.getData, setData = Rails.setData, fire = Rails.fire, stopEverything = Rails.stopEverything, ajax = Rails.ajax, isCrossDomain = Rails.isCrossDomain, serializeElement = Rails.serializeElement;

      isRemote = function isRemote(element) {
        var value;
        value = element.getAttribute('data-remote');
        return value != null && value !== 'false';
      };

      Rails.handleRemote = function (e) {
        var button, data, dataType, element, method, url, withCredentials;
        element = this;

        if (!isRemote(element)) {
          return true;
        }

        if (!fire(element, 'ajax:before')) {
          fire(element, 'ajax:stopped');
          return false;
        }

        withCredentials = element.getAttribute('data-with-credentials');
        dataType = element.getAttribute('data-type') || 'script';

        if (matches(element, Rails.formSubmitSelector)) {
          button = getData(element, 'ujs:submit-button');
          method = getData(element, 'ujs:submit-button-formmethod') || element.method;
          url = getData(element, 'ujs:submit-button-formaction') || element.getAttribute('action') || location.href;

          if (method.toUpperCase() === 'GET') {
            url = url.replace(/\?.*$/, '');
          }

          if (element.enctype === 'multipart/form-data') {
            data = new FormData(element);

            if (button != null) {
              data.append(button.name, button.value);
            }
          } else {
            data = serializeElement(element, button);
          }

          setData(element, 'ujs:submit-button', null);
          setData(element, 'ujs:submit-button-formmethod', null);
          setData(element, 'ujs:submit-button-formaction', null);
        } else if (matches(element, Rails.buttonClickSelector) || matches(element, Rails.inputChangeSelector)) {
          method = element.getAttribute('data-method');
          url = element.getAttribute('data-url');
          data = serializeElement(element, element.getAttribute('data-params'));
        } else {
          method = element.getAttribute('data-method');
          url = Rails.href(element);
          data = element.getAttribute('data-params');
        }

        ajax({
          type: method || 'GET',
          url: url,
          data: data,
          dataType: dataType,
          beforeSend: function beforeSend(xhr, options) {
            if (fire(element, 'ajax:beforeSend', [xhr, options])) {
              return fire(element, 'ajax:send', [xhr]);
            } else {
              fire(element, 'ajax:stopped');
              return false;
            }
          },
          success: function success() {
            var args;
            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
            return fire(element, 'ajax:success', args);
          },
          error: function error() {
            var args;
            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
            return fire(element, 'ajax:error', args);
          },
          complete: function complete() {
            var args;
            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
            return fire(element, 'ajax:complete', args);
          },
          crossDomain: isCrossDomain(url),
          withCredentials: withCredentials != null && withCredentials !== 'false'
        });
        return stopEverything(e);
      };

      Rails.formSubmitButtonClick = function (e) {
        var button, form;
        button = this;
        form = button.form;

        if (!form) {
          return;
        }

        if (button.name) {
          setData(form, 'ujs:submit-button', {
            name: button.name,
            value: button.value
          });
        }

        setData(form, 'ujs:formnovalidate-button', button.formNoValidate);
        setData(form, 'ujs:submit-button-formaction', button.getAttribute('formaction'));
        return setData(form, 'ujs:submit-button-formmethod', button.getAttribute('formmethod'));
      };

      Rails.preventInsignificantClick = function (e) {
        var data, insignificantMetaClick, link, metaClick, method, nonPrimaryMouseClick;
        link = this;
        method = (link.getAttribute('data-method') || 'GET').toUpperCase();
        data = link.getAttribute('data-params');
        metaClick = e.metaKey || e.ctrlKey;
        insignificantMetaClick = metaClick && method === 'GET' && !data;
        nonPrimaryMouseClick = e.button != null && e.button !== 0;

        if (nonPrimaryMouseClick || insignificantMetaClick) {
          return e.stopImmediatePropagation();
        }
      };
    }).call(this);
    (function () {
      var $, CSRFProtection, delegate, disableElement, enableElement, fire, formSubmitButtonClick, getData, handleConfirm, handleDisabledElement, handleMethod, handleRemote, loadCSPNonce, preventInsignificantClick, refreshCSRFTokens;
      fire = Rails.fire, delegate = Rails.delegate, getData = Rails.getData, $ = Rails.$, refreshCSRFTokens = Rails.refreshCSRFTokens, CSRFProtection = Rails.CSRFProtection, loadCSPNonce = Rails.loadCSPNonce, enableElement = Rails.enableElement, disableElement = Rails.disableElement, handleDisabledElement = Rails.handleDisabledElement, handleConfirm = Rails.handleConfirm, preventInsignificantClick = Rails.preventInsignificantClick, handleRemote = Rails.handleRemote, formSubmitButtonClick = Rails.formSubmitButtonClick, handleMethod = Rails.handleMethod;

      if (typeof jQuery !== "undefined" && jQuery !== null && jQuery.ajax != null) {
        if (jQuery.rails) {
          throw new Error('If you load both jquery_ujs and rails-ujs, use rails-ujs only.');
        }

        jQuery.rails = Rails;
        jQuery.ajaxPrefilter(function (options, originalOptions, xhr) {
          if (!options.crossDomain) {
            return CSRFProtection(xhr);
          }
        });
      }

      Rails.start = function () {
        if (window._rails_loaded) {
          throw new Error('rails-ujs has already been loaded!');
        }

        window.addEventListener('pageshow', function () {
          $(Rails.formEnableSelector).forEach(function (el) {
            if (getData(el, 'ujs:disabled')) {
              return enableElement(el);
            }
          });
          return $(Rails.linkDisableSelector).forEach(function (el) {
            if (getData(el, 'ujs:disabled')) {
              return enableElement(el);
            }
          });
        });
        delegate(document, Rails.linkDisableSelector, 'ajax:complete', enableElement);
        delegate(document, Rails.linkDisableSelector, 'ajax:stopped', enableElement);
        delegate(document, Rails.buttonDisableSelector, 'ajax:complete', enableElement);
        delegate(document, Rails.buttonDisableSelector, 'ajax:stopped', enableElement);
        delegate(document, Rails.linkClickSelector, 'click', preventInsignificantClick);
        delegate(document, Rails.linkClickSelector, 'click', handleDisabledElement);
        delegate(document, Rails.linkClickSelector, 'click', handleConfirm);
        delegate(document, Rails.linkClickSelector, 'click', disableElement);
        delegate(document, Rails.linkClickSelector, 'click', handleRemote);
        delegate(document, Rails.linkClickSelector, 'click', handleMethod);
        delegate(document, Rails.buttonClickSelector, 'click', preventInsignificantClick);
        delegate(document, Rails.buttonClickSelector, 'click', handleDisabledElement);
        delegate(document, Rails.buttonClickSelector, 'click', handleConfirm);
        delegate(document, Rails.buttonClickSelector, 'click', disableElement);
        delegate(document, Rails.buttonClickSelector, 'click', handleRemote);
        delegate(document, Rails.inputChangeSelector, 'change', handleDisabledElement);
        delegate(document, Rails.inputChangeSelector, 'change', handleConfirm);
        delegate(document, Rails.inputChangeSelector, 'change', handleRemote);
        delegate(document, Rails.formSubmitSelector, 'submit', handleDisabledElement);
        delegate(document, Rails.formSubmitSelector, 'submit', handleConfirm);
        delegate(document, Rails.formSubmitSelector, 'submit', handleRemote);
        delegate(document, Rails.formSubmitSelector, 'submit', function (e) {
          return setTimeout(function () {
            return disableElement(e);
          }, 13);
        });
        delegate(document, Rails.formSubmitSelector, 'ajax:send', disableElement);
        delegate(document, Rails.formSubmitSelector, 'ajax:complete', enableElement);
        delegate(document, Rails.formInputClickSelector, 'click', preventInsignificantClick);
        delegate(document, Rails.formInputClickSelector, 'click', handleDisabledElement);
        delegate(document, Rails.formInputClickSelector, 'click', handleConfirm);
        delegate(document, Rails.formInputClickSelector, 'click', formSubmitButtonClick);
        document.addEventListener('DOMContentLoaded', refreshCSRFTokens);
        document.addEventListener('DOMContentLoaded', loadCSPNonce);
        return window._rails_loaded = true;
      };

      if (window.Rails === Rails && fire(document, 'rails:attachBindings')) {
        Rails.start();
      }
    }).call(this);
  }).call(this);

  if (( false ? undefined : _typeof(module)) === "object" && module.exports) {
    module.exports = Rails;
  } else if (true) {
    !(__WEBPACK_AMD_DEFINE_FACTORY__ = (Rails),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
  }
}).call(this);
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../../../../webpack/buildin/module.js */ "./node_modules/webpack/buildin/module.js")(module)))

/***/ }),

/***/ "./node_modules/bootstrap/dist/js/bootstrap.js":
/*!*****************************************************!*\
  !*** ./node_modules/bootstrap/dist/js/bootstrap.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

/*!
  * Bootstrap v4.5.3 (https://getbootstrap.com/)
  * Copyright 2011-2020 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */
(function (global, factory) {
  ( false ? undefined : _typeof(exports)) === 'object' && typeof module !== 'undefined' ? factory(exports, __webpack_require__(!(function webpackMissingModule() { var e = new Error("Cannot find module 'jquery'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())), __webpack_require__(!(function webpackMissingModule() { var e = new Error("Cannot find module 'popper.js'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()))) :  true ? !(__WEBPACK_AMD_DEFINE_ARRAY__ = [exports, !(function webpackMissingModule() { var e = new Error("Cannot find module 'jquery'"); e.code = 'MODULE_NOT_FOUND'; throw e; }()), !(function webpackMissingModule() { var e = new Error("Cannot find module 'popper.js'"); e.code = 'MODULE_NOT_FOUND'; throw e; }())], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : (undefined);
})(this, function (exports, $, Popper) {
  'use strict';

  function _interopDefaultLegacy(e) {
    return e && _typeof(e) === 'object' && 'default' in e ? e : {
      'default': e
    };
  }

  var $__default = /*#__PURE__*/_interopDefaultLegacy($);

  var Popper__default = /*#__PURE__*/_interopDefaultLegacy(Popper);

  function _defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    return Constructor;
  }

  function _extends() {
    _extends = Object.assign || function (target) {
      for (var i = 1; i < arguments.length; i++) {
        var source = arguments[i];

        for (var key in source) {
          if (Object.prototype.hasOwnProperty.call(source, key)) {
            target[key] = source[key];
          }
        }
      }

      return target;
    };

    return _extends.apply(this, arguments);
  }

  function _inheritsLoose(subClass, superClass) {
    subClass.prototype = Object.create(superClass.prototype);
    subClass.prototype.constructor = subClass;
    subClass.__proto__ = superClass;
  }
  /**
   * --------------------------------------------------------------------------
   * Bootstrap (v4.5.3): util.js
   * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
   * --------------------------------------------------------------------------
   */

  /**
   * ------------------------------------------------------------------------
   * Private TransitionEnd Helpers
   * ------------------------------------------------------------------------
   */


  var TRANSITION_END = 'transitionend';
  var MAX_UID = 1000000;
  var MILLISECONDS_MULTIPLIER = 1000; // Shoutout AngusCroll (https://goo.gl/pxwQGp)

  function toType(obj) {
    if (obj === null || typeof obj === 'undefined') {
      return "" + obj;
    }

    return {}.toString.call(obj).match(/\s([a-z]+)/i)[1].toLowerCase();
  }

  function getSpecialTransitionEndEvent() {
    return {
      bindType: TRANSITION_END,
      delegateType: TRANSITION_END,
      handle: function handle(event) {
        if ($__default['default'](event.target).is(this)) {
          return event.handleObj.handler.apply(this, arguments); // eslint-disable-line prefer-rest-params
        }

        return undefined;
      }
    };
  }

  function transitionEndEmulator(duration) {
    var _this = this;

    var called = false;
    $__default['default'](this).one(Util.TRANSITION_END, function () {
      called = true;
    });
    setTimeout(function () {
      if (!called) {
        Util.triggerTransitionEnd(_this);
      }
    }, duration);
    return this;
  }

  function setTransitionEndSupport() {
    $__default['default'].fn.emulateTransitionEnd = transitionEndEmulator;
    $__default['default'].event.special[Util.TRANSITION_END] = getSpecialTransitionEndEvent();
  }
  /**
   * --------------------------------------------------------------------------
   * Public Util Api
   * --------------------------------------------------------------------------
   */


  var Util = {
    TRANSITION_END: 'bsTransitionEnd',
    getUID: function getUID(prefix) {
      do {
        prefix += ~~(Math.random() * MAX_UID); // "~~" acts like a faster Math.floor() here
      } while (document.getElementById(prefix));

      return prefix;
    },
    getSelectorFromElement: function getSelectorFromElement(element) {
      var selector = element.getAttribute('data-target');

      if (!selector || selector === '#') {
        var hrefAttr = element.getAttribute('href');
        selector = hrefAttr && hrefAttr !== '#' ? hrefAttr.trim() : '';
      }

      try {
        return document.querySelector(selector) ? selector : null;
      } catch (_) {
        return null;
      }
    },
    getTransitionDurationFromElement: function getTransitionDurationFromElement(element) {
      if (!element) {
        return 0;
      } // Get transition-duration of the element


      var transitionDuration = $__default['default'](element).css('transition-duration');
      var transitionDelay = $__default['default'](element).css('transition-delay');
      var floatTransitionDuration = parseFloat(transitionDuration);
      var floatTransitionDelay = parseFloat(transitionDelay); // Return 0 if element or transition duration is not found

      if (!floatTransitionDuration && !floatTransitionDelay) {
        return 0;
      } // If multiple durations are defined, take the first


      transitionDuration = transitionDuration.split(',')[0];
      transitionDelay = transitionDelay.split(',')[0];
      return (parseFloat(transitionDuration) + parseFloat(transitionDelay)) * MILLISECONDS_MULTIPLIER;
    },
    reflow: function reflow(element) {
      return element.offsetHeight;
    },
    triggerTransitionEnd: function triggerTransitionEnd(element) {
      $__default['default'](element).trigger(TRANSITION_END);
    },
    supportsTransitionEnd: function supportsTransitionEnd() {
      return Boolean(TRANSITION_END);
    },
    isElement: function isElement(obj) {
      return (obj[0] || obj).nodeType;
    },
    typeCheckConfig: function typeCheckConfig(componentName, config, configTypes) {
      for (var property in configTypes) {
        if (Object.prototype.hasOwnProperty.call(configTypes, property)) {
          var expectedTypes = configTypes[property];
          var value = config[property];
          var valueType = value && Util.isElement(value) ? 'element' : toType(value);

          if (!new RegExp(expectedTypes).test(valueType)) {
            throw new Error(componentName.toUpperCase() + ": " + ("Option \"" + property + "\" provided type \"" + valueType + "\" ") + ("but expected type \"" + expectedTypes + "\"."));
          }
        }
      }
    },
    findShadowRoot: function findShadowRoot(element) {
      if (!document.documentElement.attachShadow) {
        return null;
      } // Can find the shadow root otherwise it'll return the document


      if (typeof element.getRootNode === 'function') {
        var root = element.getRootNode();
        return root instanceof ShadowRoot ? root : null;
      }

      if (element instanceof ShadowRoot) {
        return element;
      } // when we don't find a shadow root


      if (!element.parentNode) {
        return null;
      }

      return Util.findShadowRoot(element.parentNode);
    },
    jQueryDetection: function jQueryDetection() {
      if (typeof $__default['default'] === 'undefined') {
        throw new TypeError('Bootstrap\'s JavaScript requires jQuery. jQuery must be included before Bootstrap\'s JavaScript.');
      }

      var version = $__default['default'].fn.jquery.split(' ')[0].split('.');
      var minMajor = 1;
      var ltMajor = 2;
      var minMinor = 9;
      var minPatch = 1;
      var maxMajor = 4;

      if (version[0] < ltMajor && version[1] < minMinor || version[0] === minMajor && version[1] === minMinor && version[2] < minPatch || version[0] >= maxMajor) {
        throw new Error('Bootstrap\'s JavaScript requires at least jQuery v1.9.1 but less than v4.0.0');
      }
    }
  };
  Util.jQueryDetection();
  setTransitionEndSupport();
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */

  var NAME = 'alert';
  var VERSION = '4.5.3';
  var DATA_KEY = 'bs.alert';
  var EVENT_KEY = "." + DATA_KEY;
  var DATA_API_KEY = '.data-api';
  var JQUERY_NO_CONFLICT = $__default['default'].fn[NAME];
  var SELECTOR_DISMISS = '[data-dismiss="alert"]';
  var EVENT_CLOSE = "close" + EVENT_KEY;
  var EVENT_CLOSED = "closed" + EVENT_KEY;
  var EVENT_CLICK_DATA_API = "click" + EVENT_KEY + DATA_API_KEY;
  var CLASS_NAME_ALERT = 'alert';
  var CLASS_NAME_FADE = 'fade';
  var CLASS_NAME_SHOW = 'show';
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Alert = /*#__PURE__*/function () {
    function Alert(element) {
      this._element = element;
    } // Getters


    var _proto = Alert.prototype; // Public

    _proto.close = function close(element) {
      var rootElement = this._element;

      if (element) {
        rootElement = this._getRootElement(element);
      }

      var customEvent = this._triggerCloseEvent(rootElement);

      if (customEvent.isDefaultPrevented()) {
        return;
      }

      this._removeElement(rootElement);
    };

    _proto.dispose = function dispose() {
      $__default['default'].removeData(this._element, DATA_KEY);
      this._element = null;
    } // Private
    ;

    _proto._getRootElement = function _getRootElement(element) {
      var selector = Util.getSelectorFromElement(element);
      var parent = false;

      if (selector) {
        parent = document.querySelector(selector);
      }

      if (!parent) {
        parent = $__default['default'](element).closest("." + CLASS_NAME_ALERT)[0];
      }

      return parent;
    };

    _proto._triggerCloseEvent = function _triggerCloseEvent(element) {
      var closeEvent = $__default['default'].Event(EVENT_CLOSE);
      $__default['default'](element).trigger(closeEvent);
      return closeEvent;
    };

    _proto._removeElement = function _removeElement(element) {
      var _this = this;

      $__default['default'](element).removeClass(CLASS_NAME_SHOW);

      if (!$__default['default'](element).hasClass(CLASS_NAME_FADE)) {
        this._destroyElement(element);

        return;
      }

      var transitionDuration = Util.getTransitionDurationFromElement(element);
      $__default['default'](element).one(Util.TRANSITION_END, function (event) {
        return _this._destroyElement(element, event);
      }).emulateTransitionEnd(transitionDuration);
    };

    _proto._destroyElement = function _destroyElement(element) {
      $__default['default'](element).detach().trigger(EVENT_CLOSED).remove();
    } // Static
    ;

    Alert._jQueryInterface = function _jQueryInterface(config) {
      return this.each(function () {
        var $element = $__default['default'](this);
        var data = $element.data(DATA_KEY);

        if (!data) {
          data = new Alert(this);
          $element.data(DATA_KEY, data);
        }

        if (config === 'close') {
          data[config](this);
        }
      });
    };

    Alert._handleDismiss = function _handleDismiss(alertInstance) {
      return function (event) {
        if (event) {
          event.preventDefault();
        }

        alertInstance.close(this);
      };
    };

    _createClass(Alert, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION;
      }
    }]);

    return Alert;
  }();
  /**
   * ------------------------------------------------------------------------
   * Data Api implementation
   * ------------------------------------------------------------------------
   */


  $__default['default'](document).on(EVENT_CLICK_DATA_API, SELECTOR_DISMISS, Alert._handleDismiss(new Alert()));
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */

  $__default['default'].fn[NAME] = Alert._jQueryInterface;
  $__default['default'].fn[NAME].Constructor = Alert;

  $__default['default'].fn[NAME].noConflict = function () {
    $__default['default'].fn[NAME] = JQUERY_NO_CONFLICT;
    return Alert._jQueryInterface;
  };
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$1 = 'button';
  var VERSION$1 = '4.5.3';
  var DATA_KEY$1 = 'bs.button';
  var EVENT_KEY$1 = "." + DATA_KEY$1;
  var DATA_API_KEY$1 = '.data-api';
  var JQUERY_NO_CONFLICT$1 = $__default['default'].fn[NAME$1];
  var CLASS_NAME_ACTIVE = 'active';
  var CLASS_NAME_BUTTON = 'btn';
  var CLASS_NAME_FOCUS = 'focus';
  var SELECTOR_DATA_TOGGLE_CARROT = '[data-toggle^="button"]';
  var SELECTOR_DATA_TOGGLES = '[data-toggle="buttons"]';
  var SELECTOR_DATA_TOGGLE = '[data-toggle="button"]';
  var SELECTOR_DATA_TOGGLES_BUTTONS = '[data-toggle="buttons"] .btn';
  var SELECTOR_INPUT = 'input:not([type="hidden"])';
  var SELECTOR_ACTIVE = '.active';
  var SELECTOR_BUTTON = '.btn';
  var EVENT_CLICK_DATA_API$1 = "click" + EVENT_KEY$1 + DATA_API_KEY$1;
  var EVENT_FOCUS_BLUR_DATA_API = "focus" + EVENT_KEY$1 + DATA_API_KEY$1 + " " + ("blur" + EVENT_KEY$1 + DATA_API_KEY$1);
  var EVENT_LOAD_DATA_API = "load" + EVENT_KEY$1 + DATA_API_KEY$1;
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Button = /*#__PURE__*/function () {
    function Button(element) {
      this._element = element;
      this.shouldAvoidTriggerChange = false;
    } // Getters


    var _proto = Button.prototype; // Public

    _proto.toggle = function toggle() {
      var triggerChangeEvent = true;
      var addAriaPressed = true;
      var rootElement = $__default['default'](this._element).closest(SELECTOR_DATA_TOGGLES)[0];

      if (rootElement) {
        var input = this._element.querySelector(SELECTOR_INPUT);

        if (input) {
          if (input.type === 'radio') {
            if (input.checked && this._element.classList.contains(CLASS_NAME_ACTIVE)) {
              triggerChangeEvent = false;
            } else {
              var activeElement = rootElement.querySelector(SELECTOR_ACTIVE);

              if (activeElement) {
                $__default['default'](activeElement).removeClass(CLASS_NAME_ACTIVE);
              }
            }
          }

          if (triggerChangeEvent) {
            // if it's not a radio button or checkbox don't add a pointless/invalid checked property to the input
            if (input.type === 'checkbox' || input.type === 'radio') {
              input.checked = !this._element.classList.contains(CLASS_NAME_ACTIVE);
            }

            if (!this.shouldAvoidTriggerChange) {
              $__default['default'](input).trigger('change');
            }
          }

          input.focus();
          addAriaPressed = false;
        }
      }

      if (!(this._element.hasAttribute('disabled') || this._element.classList.contains('disabled'))) {
        if (addAriaPressed) {
          this._element.setAttribute('aria-pressed', !this._element.classList.contains(CLASS_NAME_ACTIVE));
        }

        if (triggerChangeEvent) {
          $__default['default'](this._element).toggleClass(CLASS_NAME_ACTIVE);
        }
      }
    };

    _proto.dispose = function dispose() {
      $__default['default'].removeData(this._element, DATA_KEY$1);
      this._element = null;
    } // Static
    ;

    Button._jQueryInterface = function _jQueryInterface(config, avoidTriggerChange) {
      return this.each(function () {
        var $element = $__default['default'](this);
        var data = $element.data(DATA_KEY$1);

        if (!data) {
          data = new Button(this);
          $element.data(DATA_KEY$1, data);
        }

        data.shouldAvoidTriggerChange = avoidTriggerChange;

        if (config === 'toggle') {
          data[config]();
        }
      });
    };

    _createClass(Button, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION$1;
      }
    }]);

    return Button;
  }();
  /**
   * ------------------------------------------------------------------------
   * Data Api implementation
   * ------------------------------------------------------------------------
   */


  $__default['default'](document).on(EVENT_CLICK_DATA_API$1, SELECTOR_DATA_TOGGLE_CARROT, function (event) {
    var button = event.target;
    var initialButton = button;

    if (!$__default['default'](button).hasClass(CLASS_NAME_BUTTON)) {
      button = $__default['default'](button).closest(SELECTOR_BUTTON)[0];
    }

    if (!button || button.hasAttribute('disabled') || button.classList.contains('disabled')) {
      event.preventDefault(); // work around Firefox bug #1540995
    } else {
      var inputBtn = button.querySelector(SELECTOR_INPUT);

      if (inputBtn && (inputBtn.hasAttribute('disabled') || inputBtn.classList.contains('disabled'))) {
        event.preventDefault(); // work around Firefox bug #1540995

        return;
      }

      if (initialButton.tagName === 'INPUT' || button.tagName !== 'LABEL') {
        Button._jQueryInterface.call($__default['default'](button), 'toggle', initialButton.tagName === 'INPUT');
      }
    }
  }).on(EVENT_FOCUS_BLUR_DATA_API, SELECTOR_DATA_TOGGLE_CARROT, function (event) {
    var button = $__default['default'](event.target).closest(SELECTOR_BUTTON)[0];
    $__default['default'](button).toggleClass(CLASS_NAME_FOCUS, /^focus(in)?$/.test(event.type));
  });
  $__default['default'](window).on(EVENT_LOAD_DATA_API, function () {
    // ensure correct active class is set to match the controls' actual values/states
    // find all checkboxes/readio buttons inside data-toggle groups
    var buttons = [].slice.call(document.querySelectorAll(SELECTOR_DATA_TOGGLES_BUTTONS));

    for (var i = 0, len = buttons.length; i < len; i++) {
      var button = buttons[i];
      var input = button.querySelector(SELECTOR_INPUT);

      if (input.checked || input.hasAttribute('checked')) {
        button.classList.add(CLASS_NAME_ACTIVE);
      } else {
        button.classList.remove(CLASS_NAME_ACTIVE);
      }
    } // find all button toggles


    buttons = [].slice.call(document.querySelectorAll(SELECTOR_DATA_TOGGLE));

    for (var _i = 0, _len = buttons.length; _i < _len; _i++) {
      var _button = buttons[_i];

      if (_button.getAttribute('aria-pressed') === 'true') {
        _button.classList.add(CLASS_NAME_ACTIVE);
      } else {
        _button.classList.remove(CLASS_NAME_ACTIVE);
      }
    }
  });
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */

  $__default['default'].fn[NAME$1] = Button._jQueryInterface;
  $__default['default'].fn[NAME$1].Constructor = Button;

  $__default['default'].fn[NAME$1].noConflict = function () {
    $__default['default'].fn[NAME$1] = JQUERY_NO_CONFLICT$1;
    return Button._jQueryInterface;
  };
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$2 = 'carousel';
  var VERSION$2 = '4.5.3';
  var DATA_KEY$2 = 'bs.carousel';
  var EVENT_KEY$2 = "." + DATA_KEY$2;
  var DATA_API_KEY$2 = '.data-api';
  var JQUERY_NO_CONFLICT$2 = $__default['default'].fn[NAME$2];
  var ARROW_LEFT_KEYCODE = 37; // KeyboardEvent.which value for left arrow key

  var ARROW_RIGHT_KEYCODE = 39; // KeyboardEvent.which value for right arrow key

  var TOUCHEVENT_COMPAT_WAIT = 500; // Time for mouse compat events to fire after touch

  var SWIPE_THRESHOLD = 40;
  var Default = {
    interval: 5000,
    keyboard: true,
    slide: false,
    pause: 'hover',
    wrap: true,
    touch: true
  };
  var DefaultType = {
    interval: '(number|boolean)',
    keyboard: 'boolean',
    slide: '(boolean|string)',
    pause: '(string|boolean)',
    wrap: 'boolean',
    touch: 'boolean'
  };
  var DIRECTION_NEXT = 'next';
  var DIRECTION_PREV = 'prev';
  var DIRECTION_LEFT = 'left';
  var DIRECTION_RIGHT = 'right';
  var EVENT_SLIDE = "slide" + EVENT_KEY$2;
  var EVENT_SLID = "slid" + EVENT_KEY$2;
  var EVENT_KEYDOWN = "keydown" + EVENT_KEY$2;
  var EVENT_MOUSEENTER = "mouseenter" + EVENT_KEY$2;
  var EVENT_MOUSELEAVE = "mouseleave" + EVENT_KEY$2;
  var EVENT_TOUCHSTART = "touchstart" + EVENT_KEY$2;
  var EVENT_TOUCHMOVE = "touchmove" + EVENT_KEY$2;
  var EVENT_TOUCHEND = "touchend" + EVENT_KEY$2;
  var EVENT_POINTERDOWN = "pointerdown" + EVENT_KEY$2;
  var EVENT_POINTERUP = "pointerup" + EVENT_KEY$2;
  var EVENT_DRAG_START = "dragstart" + EVENT_KEY$2;
  var EVENT_LOAD_DATA_API$1 = "load" + EVENT_KEY$2 + DATA_API_KEY$2;
  var EVENT_CLICK_DATA_API$2 = "click" + EVENT_KEY$2 + DATA_API_KEY$2;
  var CLASS_NAME_CAROUSEL = 'carousel';
  var CLASS_NAME_ACTIVE$1 = 'active';
  var CLASS_NAME_SLIDE = 'slide';
  var CLASS_NAME_RIGHT = 'carousel-item-right';
  var CLASS_NAME_LEFT = 'carousel-item-left';
  var CLASS_NAME_NEXT = 'carousel-item-next';
  var CLASS_NAME_PREV = 'carousel-item-prev';
  var CLASS_NAME_POINTER_EVENT = 'pointer-event';
  var SELECTOR_ACTIVE$1 = '.active';
  var SELECTOR_ACTIVE_ITEM = '.active.carousel-item';
  var SELECTOR_ITEM = '.carousel-item';
  var SELECTOR_ITEM_IMG = '.carousel-item img';
  var SELECTOR_NEXT_PREV = '.carousel-item-next, .carousel-item-prev';
  var SELECTOR_INDICATORS = '.carousel-indicators';
  var SELECTOR_DATA_SLIDE = '[data-slide], [data-slide-to]';
  var SELECTOR_DATA_RIDE = '[data-ride="carousel"]';
  var PointerType = {
    TOUCH: 'touch',
    PEN: 'pen'
  };
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Carousel = /*#__PURE__*/function () {
    function Carousel(element, config) {
      this._items = null;
      this._interval = null;
      this._activeElement = null;
      this._isPaused = false;
      this._isSliding = false;
      this.touchTimeout = null;
      this.touchStartX = 0;
      this.touchDeltaX = 0;
      this._config = this._getConfig(config);
      this._element = element;
      this._indicatorsElement = this._element.querySelector(SELECTOR_INDICATORS);
      this._touchSupported = 'ontouchstart' in document.documentElement || navigator.maxTouchPoints > 0;
      this._pointerEvent = Boolean(window.PointerEvent || window.MSPointerEvent);

      this._addEventListeners();
    } // Getters


    var _proto = Carousel.prototype; // Public

    _proto.next = function next() {
      if (!this._isSliding) {
        this._slide(DIRECTION_NEXT);
      }
    };

    _proto.nextWhenVisible = function nextWhenVisible() {
      var $element = $__default['default'](this._element); // Don't call next when the page isn't visible
      // or the carousel or its parent isn't visible

      if (!document.hidden && $element.is(':visible') && $element.css('visibility') !== 'hidden') {
        this.next();
      }
    };

    _proto.prev = function prev() {
      if (!this._isSliding) {
        this._slide(DIRECTION_PREV);
      }
    };

    _proto.pause = function pause(event) {
      if (!event) {
        this._isPaused = true;
      }

      if (this._element.querySelector(SELECTOR_NEXT_PREV)) {
        Util.triggerTransitionEnd(this._element);
        this.cycle(true);
      }

      clearInterval(this._interval);
      this._interval = null;
    };

    _proto.cycle = function cycle(event) {
      if (!event) {
        this._isPaused = false;
      }

      if (this._interval) {
        clearInterval(this._interval);
        this._interval = null;
      }

      if (this._config.interval && !this._isPaused) {
        this._interval = setInterval((document.visibilityState ? this.nextWhenVisible : this.next).bind(this), this._config.interval);
      }
    };

    _proto.to = function to(index) {
      var _this = this;

      this._activeElement = this._element.querySelector(SELECTOR_ACTIVE_ITEM);

      var activeIndex = this._getItemIndex(this._activeElement);

      if (index > this._items.length - 1 || index < 0) {
        return;
      }

      if (this._isSliding) {
        $__default['default'](this._element).one(EVENT_SLID, function () {
          return _this.to(index);
        });
        return;
      }

      if (activeIndex === index) {
        this.pause();
        this.cycle();
        return;
      }

      var direction = index > activeIndex ? DIRECTION_NEXT : DIRECTION_PREV;

      this._slide(direction, this._items[index]);
    };

    _proto.dispose = function dispose() {
      $__default['default'](this._element).off(EVENT_KEY$2);
      $__default['default'].removeData(this._element, DATA_KEY$2);
      this._items = null;
      this._config = null;
      this._element = null;
      this._interval = null;
      this._isPaused = null;
      this._isSliding = null;
      this._activeElement = null;
      this._indicatorsElement = null;
    } // Private
    ;

    _proto._getConfig = function _getConfig(config) {
      config = _extends({}, Default, config);
      Util.typeCheckConfig(NAME$2, config, DefaultType);
      return config;
    };

    _proto._handleSwipe = function _handleSwipe() {
      var absDeltax = Math.abs(this.touchDeltaX);

      if (absDeltax <= SWIPE_THRESHOLD) {
        return;
      }

      var direction = absDeltax / this.touchDeltaX;
      this.touchDeltaX = 0; // swipe left

      if (direction > 0) {
        this.prev();
      } // swipe right


      if (direction < 0) {
        this.next();
      }
    };

    _proto._addEventListeners = function _addEventListeners() {
      var _this2 = this;

      if (this._config.keyboard) {
        $__default['default'](this._element).on(EVENT_KEYDOWN, function (event) {
          return _this2._keydown(event);
        });
      }

      if (this._config.pause === 'hover') {
        $__default['default'](this._element).on(EVENT_MOUSEENTER, function (event) {
          return _this2.pause(event);
        }).on(EVENT_MOUSELEAVE, function (event) {
          return _this2.cycle(event);
        });
      }

      if (this._config.touch) {
        this._addTouchEventListeners();
      }
    };

    _proto._addTouchEventListeners = function _addTouchEventListeners() {
      var _this3 = this;

      if (!this._touchSupported) {
        return;
      }

      var start = function start(event) {
        if (_this3._pointerEvent && PointerType[event.originalEvent.pointerType.toUpperCase()]) {
          _this3.touchStartX = event.originalEvent.clientX;
        } else if (!_this3._pointerEvent) {
          _this3.touchStartX = event.originalEvent.touches[0].clientX;
        }
      };

      var move = function move(event) {
        // ensure swiping with one touch and not pinching
        if (event.originalEvent.touches && event.originalEvent.touches.length > 1) {
          _this3.touchDeltaX = 0;
        } else {
          _this3.touchDeltaX = event.originalEvent.touches[0].clientX - _this3.touchStartX;
        }
      };

      var end = function end(event) {
        if (_this3._pointerEvent && PointerType[event.originalEvent.pointerType.toUpperCase()]) {
          _this3.touchDeltaX = event.originalEvent.clientX - _this3.touchStartX;
        }

        _this3._handleSwipe();

        if (_this3._config.pause === 'hover') {
          // If it's a touch-enabled device, mouseenter/leave are fired as
          // part of the mouse compatibility events on first tap - the carousel
          // would stop cycling until user tapped out of it;
          // here, we listen for touchend, explicitly pause the carousel
          // (as if it's the second time we tap on it, mouseenter compat event
          // is NOT fired) and after a timeout (to allow for mouse compatibility
          // events to fire) we explicitly restart cycling
          _this3.pause();

          if (_this3.touchTimeout) {
            clearTimeout(_this3.touchTimeout);
          }

          _this3.touchTimeout = setTimeout(function (event) {
            return _this3.cycle(event);
          }, TOUCHEVENT_COMPAT_WAIT + _this3._config.interval);
        }
      };

      $__default['default'](this._element.querySelectorAll(SELECTOR_ITEM_IMG)).on(EVENT_DRAG_START, function (e) {
        return e.preventDefault();
      });

      if (this._pointerEvent) {
        $__default['default'](this._element).on(EVENT_POINTERDOWN, function (event) {
          return start(event);
        });
        $__default['default'](this._element).on(EVENT_POINTERUP, function (event) {
          return end(event);
        });

        this._element.classList.add(CLASS_NAME_POINTER_EVENT);
      } else {
        $__default['default'](this._element).on(EVENT_TOUCHSTART, function (event) {
          return start(event);
        });
        $__default['default'](this._element).on(EVENT_TOUCHMOVE, function (event) {
          return move(event);
        });
        $__default['default'](this._element).on(EVENT_TOUCHEND, function (event) {
          return end(event);
        });
      }
    };

    _proto._keydown = function _keydown(event) {
      if (/input|textarea/i.test(event.target.tagName)) {
        return;
      }

      switch (event.which) {
        case ARROW_LEFT_KEYCODE:
          event.preventDefault();
          this.prev();
          break;

        case ARROW_RIGHT_KEYCODE:
          event.preventDefault();
          this.next();
          break;
      }
    };

    _proto._getItemIndex = function _getItemIndex(element) {
      this._items = element && element.parentNode ? [].slice.call(element.parentNode.querySelectorAll(SELECTOR_ITEM)) : [];
      return this._items.indexOf(element);
    };

    _proto._getItemByDirection = function _getItemByDirection(direction, activeElement) {
      var isNextDirection = direction === DIRECTION_NEXT;
      var isPrevDirection = direction === DIRECTION_PREV;

      var activeIndex = this._getItemIndex(activeElement);

      var lastItemIndex = this._items.length - 1;
      var isGoingToWrap = isPrevDirection && activeIndex === 0 || isNextDirection && activeIndex === lastItemIndex;

      if (isGoingToWrap && !this._config.wrap) {
        return activeElement;
      }

      var delta = direction === DIRECTION_PREV ? -1 : 1;
      var itemIndex = (activeIndex + delta) % this._items.length;
      return itemIndex === -1 ? this._items[this._items.length - 1] : this._items[itemIndex];
    };

    _proto._triggerSlideEvent = function _triggerSlideEvent(relatedTarget, eventDirectionName) {
      var targetIndex = this._getItemIndex(relatedTarget);

      var fromIndex = this._getItemIndex(this._element.querySelector(SELECTOR_ACTIVE_ITEM));

      var slideEvent = $__default['default'].Event(EVENT_SLIDE, {
        relatedTarget: relatedTarget,
        direction: eventDirectionName,
        from: fromIndex,
        to: targetIndex
      });
      $__default['default'](this._element).trigger(slideEvent);
      return slideEvent;
    };

    _proto._setActiveIndicatorElement = function _setActiveIndicatorElement(element) {
      if (this._indicatorsElement) {
        var indicators = [].slice.call(this._indicatorsElement.querySelectorAll(SELECTOR_ACTIVE$1));
        $__default['default'](indicators).removeClass(CLASS_NAME_ACTIVE$1);

        var nextIndicator = this._indicatorsElement.children[this._getItemIndex(element)];

        if (nextIndicator) {
          $__default['default'](nextIndicator).addClass(CLASS_NAME_ACTIVE$1);
        }
      }
    };

    _proto._slide = function _slide(direction, element) {
      var _this4 = this;

      var activeElement = this._element.querySelector(SELECTOR_ACTIVE_ITEM);

      var activeElementIndex = this._getItemIndex(activeElement);

      var nextElement = element || activeElement && this._getItemByDirection(direction, activeElement);

      var nextElementIndex = this._getItemIndex(nextElement);

      var isCycling = Boolean(this._interval);
      var directionalClassName;
      var orderClassName;
      var eventDirectionName;

      if (direction === DIRECTION_NEXT) {
        directionalClassName = CLASS_NAME_LEFT;
        orderClassName = CLASS_NAME_NEXT;
        eventDirectionName = DIRECTION_LEFT;
      } else {
        directionalClassName = CLASS_NAME_RIGHT;
        orderClassName = CLASS_NAME_PREV;
        eventDirectionName = DIRECTION_RIGHT;
      }

      if (nextElement && $__default['default'](nextElement).hasClass(CLASS_NAME_ACTIVE$1)) {
        this._isSliding = false;
        return;
      }

      var slideEvent = this._triggerSlideEvent(nextElement, eventDirectionName);

      if (slideEvent.isDefaultPrevented()) {
        return;
      }

      if (!activeElement || !nextElement) {
        // Some weirdness is happening, so we bail
        return;
      }

      this._isSliding = true;

      if (isCycling) {
        this.pause();
      }

      this._setActiveIndicatorElement(nextElement);

      var slidEvent = $__default['default'].Event(EVENT_SLID, {
        relatedTarget: nextElement,
        direction: eventDirectionName,
        from: activeElementIndex,
        to: nextElementIndex
      });

      if ($__default['default'](this._element).hasClass(CLASS_NAME_SLIDE)) {
        $__default['default'](nextElement).addClass(orderClassName);
        Util.reflow(nextElement);
        $__default['default'](activeElement).addClass(directionalClassName);
        $__default['default'](nextElement).addClass(directionalClassName);
        var nextElementInterval = parseInt(nextElement.getAttribute('data-interval'), 10);

        if (nextElementInterval) {
          this._config.defaultInterval = this._config.defaultInterval || this._config.interval;
          this._config.interval = nextElementInterval;
        } else {
          this._config.interval = this._config.defaultInterval || this._config.interval;
        }

        var transitionDuration = Util.getTransitionDurationFromElement(activeElement);
        $__default['default'](activeElement).one(Util.TRANSITION_END, function () {
          $__default['default'](nextElement).removeClass(directionalClassName + " " + orderClassName).addClass(CLASS_NAME_ACTIVE$1);
          $__default['default'](activeElement).removeClass(CLASS_NAME_ACTIVE$1 + " " + orderClassName + " " + directionalClassName);
          _this4._isSliding = false;
          setTimeout(function () {
            return $__default['default'](_this4._element).trigger(slidEvent);
          }, 0);
        }).emulateTransitionEnd(transitionDuration);
      } else {
        $__default['default'](activeElement).removeClass(CLASS_NAME_ACTIVE$1);
        $__default['default'](nextElement).addClass(CLASS_NAME_ACTIVE$1);
        this._isSliding = false;
        $__default['default'](this._element).trigger(slidEvent);
      }

      if (isCycling) {
        this.cycle();
      }
    } // Static
    ;

    Carousel._jQueryInterface = function _jQueryInterface(config) {
      return this.each(function () {
        var data = $__default['default'](this).data(DATA_KEY$2);

        var _config = _extends({}, Default, $__default['default'](this).data());

        if (_typeof(config) === 'object') {
          _config = _extends({}, _config, config);
        }

        var action = typeof config === 'string' ? config : _config.slide;

        if (!data) {
          data = new Carousel(this, _config);
          $__default['default'](this).data(DATA_KEY$2, data);
        }

        if (typeof config === 'number') {
          data.to(config);
        } else if (typeof action === 'string') {
          if (typeof data[action] === 'undefined') {
            throw new TypeError("No method named \"" + action + "\"");
          }

          data[action]();
        } else if (_config.interval && _config.ride) {
          data.pause();
          data.cycle();
        }
      });
    };

    Carousel._dataApiClickHandler = function _dataApiClickHandler(event) {
      var selector = Util.getSelectorFromElement(this);

      if (!selector) {
        return;
      }

      var target = $__default['default'](selector)[0];

      if (!target || !$__default['default'](target).hasClass(CLASS_NAME_CAROUSEL)) {
        return;
      }

      var config = _extends({}, $__default['default'](target).data(), $__default['default'](this).data());

      var slideIndex = this.getAttribute('data-slide-to');

      if (slideIndex) {
        config.interval = false;
      }

      Carousel._jQueryInterface.call($__default['default'](target), config);

      if (slideIndex) {
        $__default['default'](target).data(DATA_KEY$2).to(slideIndex);
      }

      event.preventDefault();
    };

    _createClass(Carousel, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION$2;
      }
    }, {
      key: "Default",
      get: function get() {
        return Default;
      }
    }]);

    return Carousel;
  }();
  /**
   * ------------------------------------------------------------------------
   * Data Api implementation
   * ------------------------------------------------------------------------
   */


  $__default['default'](document).on(EVENT_CLICK_DATA_API$2, SELECTOR_DATA_SLIDE, Carousel._dataApiClickHandler);
  $__default['default'](window).on(EVENT_LOAD_DATA_API$1, function () {
    var carousels = [].slice.call(document.querySelectorAll(SELECTOR_DATA_RIDE));

    for (var i = 0, len = carousels.length; i < len; i++) {
      var $carousel = $__default['default'](carousels[i]);

      Carousel._jQueryInterface.call($carousel, $carousel.data());
    }
  });
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */

  $__default['default'].fn[NAME$2] = Carousel._jQueryInterface;
  $__default['default'].fn[NAME$2].Constructor = Carousel;

  $__default['default'].fn[NAME$2].noConflict = function () {
    $__default['default'].fn[NAME$2] = JQUERY_NO_CONFLICT$2;
    return Carousel._jQueryInterface;
  };
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$3 = 'collapse';
  var VERSION$3 = '4.5.3';
  var DATA_KEY$3 = 'bs.collapse';
  var EVENT_KEY$3 = "." + DATA_KEY$3;
  var DATA_API_KEY$3 = '.data-api';
  var JQUERY_NO_CONFLICT$3 = $__default['default'].fn[NAME$3];
  var Default$1 = {
    toggle: true,
    parent: ''
  };
  var DefaultType$1 = {
    toggle: 'boolean',
    parent: '(string|element)'
  };
  var EVENT_SHOW = "show" + EVENT_KEY$3;
  var EVENT_SHOWN = "shown" + EVENT_KEY$3;
  var EVENT_HIDE = "hide" + EVENT_KEY$3;
  var EVENT_HIDDEN = "hidden" + EVENT_KEY$3;
  var EVENT_CLICK_DATA_API$3 = "click" + EVENT_KEY$3 + DATA_API_KEY$3;
  var CLASS_NAME_SHOW$1 = 'show';
  var CLASS_NAME_COLLAPSE = 'collapse';
  var CLASS_NAME_COLLAPSING = 'collapsing';
  var CLASS_NAME_COLLAPSED = 'collapsed';
  var DIMENSION_WIDTH = 'width';
  var DIMENSION_HEIGHT = 'height';
  var SELECTOR_ACTIVES = '.show, .collapsing';
  var SELECTOR_DATA_TOGGLE$1 = '[data-toggle="collapse"]';
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Collapse = /*#__PURE__*/function () {
    function Collapse(element, config) {
      this._isTransitioning = false;
      this._element = element;
      this._config = this._getConfig(config);
      this._triggerArray = [].slice.call(document.querySelectorAll("[data-toggle=\"collapse\"][href=\"#" + element.id + "\"]," + ("[data-toggle=\"collapse\"][data-target=\"#" + element.id + "\"]")));
      var toggleList = [].slice.call(document.querySelectorAll(SELECTOR_DATA_TOGGLE$1));

      for (var i = 0, len = toggleList.length; i < len; i++) {
        var elem = toggleList[i];
        var selector = Util.getSelectorFromElement(elem);
        var filterElement = [].slice.call(document.querySelectorAll(selector)).filter(function (foundElem) {
          return foundElem === element;
        });

        if (selector !== null && filterElement.length > 0) {
          this._selector = selector;

          this._triggerArray.push(elem);
        }
      }

      this._parent = this._config.parent ? this._getParent() : null;

      if (!this._config.parent) {
        this._addAriaAndCollapsedClass(this._element, this._triggerArray);
      }

      if (this._config.toggle) {
        this.toggle();
      }
    } // Getters


    var _proto = Collapse.prototype; // Public

    _proto.toggle = function toggle() {
      if ($__default['default'](this._element).hasClass(CLASS_NAME_SHOW$1)) {
        this.hide();
      } else {
        this.show();
      }
    };

    _proto.show = function show() {
      var _this = this;

      if (this._isTransitioning || $__default['default'](this._element).hasClass(CLASS_NAME_SHOW$1)) {
        return;
      }

      var actives;
      var activesData;

      if (this._parent) {
        actives = [].slice.call(this._parent.querySelectorAll(SELECTOR_ACTIVES)).filter(function (elem) {
          if (typeof _this._config.parent === 'string') {
            return elem.getAttribute('data-parent') === _this._config.parent;
          }

          return elem.classList.contains(CLASS_NAME_COLLAPSE);
        });

        if (actives.length === 0) {
          actives = null;
        }
      }

      if (actives) {
        activesData = $__default['default'](actives).not(this._selector).data(DATA_KEY$3);

        if (activesData && activesData._isTransitioning) {
          return;
        }
      }

      var startEvent = $__default['default'].Event(EVENT_SHOW);
      $__default['default'](this._element).trigger(startEvent);

      if (startEvent.isDefaultPrevented()) {
        return;
      }

      if (actives) {
        Collapse._jQueryInterface.call($__default['default'](actives).not(this._selector), 'hide');

        if (!activesData) {
          $__default['default'](actives).data(DATA_KEY$3, null);
        }
      }

      var dimension = this._getDimension();

      $__default['default'](this._element).removeClass(CLASS_NAME_COLLAPSE).addClass(CLASS_NAME_COLLAPSING);
      this._element.style[dimension] = 0;

      if (this._triggerArray.length) {
        $__default['default'](this._triggerArray).removeClass(CLASS_NAME_COLLAPSED).attr('aria-expanded', true);
      }

      this.setTransitioning(true);

      var complete = function complete() {
        $__default['default'](_this._element).removeClass(CLASS_NAME_COLLAPSING).addClass(CLASS_NAME_COLLAPSE + " " + CLASS_NAME_SHOW$1);
        _this._element.style[dimension] = '';

        _this.setTransitioning(false);

        $__default['default'](_this._element).trigger(EVENT_SHOWN);
      };

      var capitalizedDimension = dimension[0].toUpperCase() + dimension.slice(1);
      var scrollSize = "scroll" + capitalizedDimension;
      var transitionDuration = Util.getTransitionDurationFromElement(this._element);
      $__default['default'](this._element).one(Util.TRANSITION_END, complete).emulateTransitionEnd(transitionDuration);
      this._element.style[dimension] = this._element[scrollSize] + "px";
    };

    _proto.hide = function hide() {
      var _this2 = this;

      if (this._isTransitioning || !$__default['default'](this._element).hasClass(CLASS_NAME_SHOW$1)) {
        return;
      }

      var startEvent = $__default['default'].Event(EVENT_HIDE);
      $__default['default'](this._element).trigger(startEvent);

      if (startEvent.isDefaultPrevented()) {
        return;
      }

      var dimension = this._getDimension();

      this._element.style[dimension] = this._element.getBoundingClientRect()[dimension] + "px";
      Util.reflow(this._element);
      $__default['default'](this._element).addClass(CLASS_NAME_COLLAPSING).removeClass(CLASS_NAME_COLLAPSE + " " + CLASS_NAME_SHOW$1);
      var triggerArrayLength = this._triggerArray.length;

      if (triggerArrayLength > 0) {
        for (var i = 0; i < triggerArrayLength; i++) {
          var trigger = this._triggerArray[i];
          var selector = Util.getSelectorFromElement(trigger);

          if (selector !== null) {
            var $elem = $__default['default']([].slice.call(document.querySelectorAll(selector)));

            if (!$elem.hasClass(CLASS_NAME_SHOW$1)) {
              $__default['default'](trigger).addClass(CLASS_NAME_COLLAPSED).attr('aria-expanded', false);
            }
          }
        }
      }

      this.setTransitioning(true);

      var complete = function complete() {
        _this2.setTransitioning(false);

        $__default['default'](_this2._element).removeClass(CLASS_NAME_COLLAPSING).addClass(CLASS_NAME_COLLAPSE).trigger(EVENT_HIDDEN);
      };

      this._element.style[dimension] = '';
      var transitionDuration = Util.getTransitionDurationFromElement(this._element);
      $__default['default'](this._element).one(Util.TRANSITION_END, complete).emulateTransitionEnd(transitionDuration);
    };

    _proto.setTransitioning = function setTransitioning(isTransitioning) {
      this._isTransitioning = isTransitioning;
    };

    _proto.dispose = function dispose() {
      $__default['default'].removeData(this._element, DATA_KEY$3);
      this._config = null;
      this._parent = null;
      this._element = null;
      this._triggerArray = null;
      this._isTransitioning = null;
    } // Private
    ;

    _proto._getConfig = function _getConfig(config) {
      config = _extends({}, Default$1, config);
      config.toggle = Boolean(config.toggle); // Coerce string values

      Util.typeCheckConfig(NAME$3, config, DefaultType$1);
      return config;
    };

    _proto._getDimension = function _getDimension() {
      var hasWidth = $__default['default'](this._element).hasClass(DIMENSION_WIDTH);
      return hasWidth ? DIMENSION_WIDTH : DIMENSION_HEIGHT;
    };

    _proto._getParent = function _getParent() {
      var _this3 = this;

      var parent;

      if (Util.isElement(this._config.parent)) {
        parent = this._config.parent; // It's a jQuery object

        if (typeof this._config.parent.jquery !== 'undefined') {
          parent = this._config.parent[0];
        }
      } else {
        parent = document.querySelector(this._config.parent);
      }

      var selector = "[data-toggle=\"collapse\"][data-parent=\"" + this._config.parent + "\"]";
      var children = [].slice.call(parent.querySelectorAll(selector));
      $__default['default'](children).each(function (i, element) {
        _this3._addAriaAndCollapsedClass(Collapse._getTargetFromElement(element), [element]);
      });
      return parent;
    };

    _proto._addAriaAndCollapsedClass = function _addAriaAndCollapsedClass(element, triggerArray) {
      var isOpen = $__default['default'](element).hasClass(CLASS_NAME_SHOW$1);

      if (triggerArray.length) {
        $__default['default'](triggerArray).toggleClass(CLASS_NAME_COLLAPSED, !isOpen).attr('aria-expanded', isOpen);
      }
    } // Static
    ;

    Collapse._getTargetFromElement = function _getTargetFromElement(element) {
      var selector = Util.getSelectorFromElement(element);
      return selector ? document.querySelector(selector) : null;
    };

    Collapse._jQueryInterface = function _jQueryInterface(config) {
      return this.each(function () {
        var $element = $__default['default'](this);
        var data = $element.data(DATA_KEY$3);

        var _config = _extends({}, Default$1, $element.data(), _typeof(config) === 'object' && config ? config : {});

        if (!data && _config.toggle && typeof config === 'string' && /show|hide/.test(config)) {
          _config.toggle = false;
        }

        if (!data) {
          data = new Collapse(this, _config);
          $element.data(DATA_KEY$3, data);
        }

        if (typeof config === 'string') {
          if (typeof data[config] === 'undefined') {
            throw new TypeError("No method named \"" + config + "\"");
          }

          data[config]();
        }
      });
    };

    _createClass(Collapse, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION$3;
      }
    }, {
      key: "Default",
      get: function get() {
        return Default$1;
      }
    }]);

    return Collapse;
  }();
  /**
   * ------------------------------------------------------------------------
   * Data Api implementation
   * ------------------------------------------------------------------------
   */


  $__default['default'](document).on(EVENT_CLICK_DATA_API$3, SELECTOR_DATA_TOGGLE$1, function (event) {
    // preventDefault only for <a> elements (which change the URL) not inside the collapsible element
    if (event.currentTarget.tagName === 'A') {
      event.preventDefault();
    }

    var $trigger = $__default['default'](this);
    var selector = Util.getSelectorFromElement(this);
    var selectors = [].slice.call(document.querySelectorAll(selector));
    $__default['default'](selectors).each(function () {
      var $target = $__default['default'](this);
      var data = $target.data(DATA_KEY$3);
      var config = data ? 'toggle' : $trigger.data();

      Collapse._jQueryInterface.call($target, config);
    });
  });
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */

  $__default['default'].fn[NAME$3] = Collapse._jQueryInterface;
  $__default['default'].fn[NAME$3].Constructor = Collapse;

  $__default['default'].fn[NAME$3].noConflict = function () {
    $__default['default'].fn[NAME$3] = JQUERY_NO_CONFLICT$3;
    return Collapse._jQueryInterface;
  };
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$4 = 'dropdown';
  var VERSION$4 = '4.5.3';
  var DATA_KEY$4 = 'bs.dropdown';
  var EVENT_KEY$4 = "." + DATA_KEY$4;
  var DATA_API_KEY$4 = '.data-api';
  var JQUERY_NO_CONFLICT$4 = $__default['default'].fn[NAME$4];
  var ESCAPE_KEYCODE = 27; // KeyboardEvent.which value for Escape (Esc) key

  var SPACE_KEYCODE = 32; // KeyboardEvent.which value for space key

  var TAB_KEYCODE = 9; // KeyboardEvent.which value for tab key

  var ARROW_UP_KEYCODE = 38; // KeyboardEvent.which value for up arrow key

  var ARROW_DOWN_KEYCODE = 40; // KeyboardEvent.which value for down arrow key

  var RIGHT_MOUSE_BUTTON_WHICH = 3; // MouseEvent.which value for the right button (assuming a right-handed mouse)

  var REGEXP_KEYDOWN = new RegExp(ARROW_UP_KEYCODE + "|" + ARROW_DOWN_KEYCODE + "|" + ESCAPE_KEYCODE);
  var EVENT_HIDE$1 = "hide" + EVENT_KEY$4;
  var EVENT_HIDDEN$1 = "hidden" + EVENT_KEY$4;
  var EVENT_SHOW$1 = "show" + EVENT_KEY$4;
  var EVENT_SHOWN$1 = "shown" + EVENT_KEY$4;
  var EVENT_CLICK = "click" + EVENT_KEY$4;
  var EVENT_CLICK_DATA_API$4 = "click" + EVENT_KEY$4 + DATA_API_KEY$4;
  var EVENT_KEYDOWN_DATA_API = "keydown" + EVENT_KEY$4 + DATA_API_KEY$4;
  var EVENT_KEYUP_DATA_API = "keyup" + EVENT_KEY$4 + DATA_API_KEY$4;
  var CLASS_NAME_DISABLED = 'disabled';
  var CLASS_NAME_SHOW$2 = 'show';
  var CLASS_NAME_DROPUP = 'dropup';
  var CLASS_NAME_DROPRIGHT = 'dropright';
  var CLASS_NAME_DROPLEFT = 'dropleft';
  var CLASS_NAME_MENURIGHT = 'dropdown-menu-right';
  var CLASS_NAME_POSITION_STATIC = 'position-static';
  var SELECTOR_DATA_TOGGLE$2 = '[data-toggle="dropdown"]';
  var SELECTOR_FORM_CHILD = '.dropdown form';
  var SELECTOR_MENU = '.dropdown-menu';
  var SELECTOR_NAVBAR_NAV = '.navbar-nav';
  var SELECTOR_VISIBLE_ITEMS = '.dropdown-menu .dropdown-item:not(.disabled):not(:disabled)';
  var PLACEMENT_TOP = 'top-start';
  var PLACEMENT_TOPEND = 'top-end';
  var PLACEMENT_BOTTOM = 'bottom-start';
  var PLACEMENT_BOTTOMEND = 'bottom-end';
  var PLACEMENT_RIGHT = 'right-start';
  var PLACEMENT_LEFT = 'left-start';
  var Default$2 = {
    offset: 0,
    flip: true,
    boundary: 'scrollParent',
    reference: 'toggle',
    display: 'dynamic',
    popperConfig: null
  };
  var DefaultType$2 = {
    offset: '(number|string|function)',
    flip: 'boolean',
    boundary: '(string|element)',
    reference: '(string|element)',
    display: 'string',
    popperConfig: '(null|object)'
  };
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Dropdown = /*#__PURE__*/function () {
    function Dropdown(element, config) {
      this._element = element;
      this._popper = null;
      this._config = this._getConfig(config);
      this._menu = this._getMenuElement();
      this._inNavbar = this._detectNavbar();

      this._addEventListeners();
    } // Getters


    var _proto = Dropdown.prototype; // Public

    _proto.toggle = function toggle() {
      if (this._element.disabled || $__default['default'](this._element).hasClass(CLASS_NAME_DISABLED)) {
        return;
      }

      var isActive = $__default['default'](this._menu).hasClass(CLASS_NAME_SHOW$2);

      Dropdown._clearMenus();

      if (isActive) {
        return;
      }

      this.show(true);
    };

    _proto.show = function show(usePopper) {
      if (usePopper === void 0) {
        usePopper = false;
      }

      if (this._element.disabled || $__default['default'](this._element).hasClass(CLASS_NAME_DISABLED) || $__default['default'](this._menu).hasClass(CLASS_NAME_SHOW$2)) {
        return;
      }

      var relatedTarget = {
        relatedTarget: this._element
      };
      var showEvent = $__default['default'].Event(EVENT_SHOW$1, relatedTarget);

      var parent = Dropdown._getParentFromElement(this._element);

      $__default['default'](parent).trigger(showEvent);

      if (showEvent.isDefaultPrevented()) {
        return;
      } // Disable totally Popper.js for Dropdown in Navbar


      if (!this._inNavbar && usePopper) {
        /**
         * Check for Popper dependency
         * Popper - https://popper.js.org
         */
        if (typeof Popper__default['default'] === 'undefined') {
          throw new TypeError('Bootstrap\'s dropdowns require Popper.js (https://popper.js.org/)');
        }

        var referenceElement = this._element;

        if (this._config.reference === 'parent') {
          referenceElement = parent;
        } else if (Util.isElement(this._config.reference)) {
          referenceElement = this._config.reference; // Check if it's jQuery element

          if (typeof this._config.reference.jquery !== 'undefined') {
            referenceElement = this._config.reference[0];
          }
        } // If boundary is not `scrollParent`, then set position to `static`
        // to allow the menu to "escape" the scroll parent's boundaries
        // https://github.com/twbs/bootstrap/issues/24251


        if (this._config.boundary !== 'scrollParent') {
          $__default['default'](parent).addClass(CLASS_NAME_POSITION_STATIC);
        }

        this._popper = new Popper__default['default'](referenceElement, this._menu, this._getPopperConfig());
      } // If this is a touch-enabled device we add extra
      // empty mouseover listeners to the body's immediate children;
      // only needed because of broken event delegation on iOS
      // https://www.quirksmode.org/blog/archives/2014/02/mouse_event_bub.html


      if ('ontouchstart' in document.documentElement && $__default['default'](parent).closest(SELECTOR_NAVBAR_NAV).length === 0) {
        $__default['default'](document.body).children().on('mouseover', null, $__default['default'].noop);
      }

      this._element.focus();

      this._element.setAttribute('aria-expanded', true);

      $__default['default'](this._menu).toggleClass(CLASS_NAME_SHOW$2);
      $__default['default'](parent).toggleClass(CLASS_NAME_SHOW$2).trigger($__default['default'].Event(EVENT_SHOWN$1, relatedTarget));
    };

    _proto.hide = function hide() {
      if (this._element.disabled || $__default['default'](this._element).hasClass(CLASS_NAME_DISABLED) || !$__default['default'](this._menu).hasClass(CLASS_NAME_SHOW$2)) {
        return;
      }

      var relatedTarget = {
        relatedTarget: this._element
      };
      var hideEvent = $__default['default'].Event(EVENT_HIDE$1, relatedTarget);

      var parent = Dropdown._getParentFromElement(this._element);

      $__default['default'](parent).trigger(hideEvent);

      if (hideEvent.isDefaultPrevented()) {
        return;
      }

      if (this._popper) {
        this._popper.destroy();
      }

      $__default['default'](this._menu).toggleClass(CLASS_NAME_SHOW$2);
      $__default['default'](parent).toggleClass(CLASS_NAME_SHOW$2).trigger($__default['default'].Event(EVENT_HIDDEN$1, relatedTarget));
    };

    _proto.dispose = function dispose() {
      $__default['default'].removeData(this._element, DATA_KEY$4);
      $__default['default'](this._element).off(EVENT_KEY$4);
      this._element = null;
      this._menu = null;

      if (this._popper !== null) {
        this._popper.destroy();

        this._popper = null;
      }
    };

    _proto.update = function update() {
      this._inNavbar = this._detectNavbar();

      if (this._popper !== null) {
        this._popper.scheduleUpdate();
      }
    } // Private
    ;

    _proto._addEventListeners = function _addEventListeners() {
      var _this = this;

      $__default['default'](this._element).on(EVENT_CLICK, function (event) {
        event.preventDefault();
        event.stopPropagation();

        _this.toggle();
      });
    };

    _proto._getConfig = function _getConfig(config) {
      config = _extends({}, this.constructor.Default, $__default['default'](this._element).data(), config);
      Util.typeCheckConfig(NAME$4, config, this.constructor.DefaultType);
      return config;
    };

    _proto._getMenuElement = function _getMenuElement() {
      if (!this._menu) {
        var parent = Dropdown._getParentFromElement(this._element);

        if (parent) {
          this._menu = parent.querySelector(SELECTOR_MENU);
        }
      }

      return this._menu;
    };

    _proto._getPlacement = function _getPlacement() {
      var $parentDropdown = $__default['default'](this._element.parentNode);
      var placement = PLACEMENT_BOTTOM; // Handle dropup

      if ($parentDropdown.hasClass(CLASS_NAME_DROPUP)) {
        placement = $__default['default'](this._menu).hasClass(CLASS_NAME_MENURIGHT) ? PLACEMENT_TOPEND : PLACEMENT_TOP;
      } else if ($parentDropdown.hasClass(CLASS_NAME_DROPRIGHT)) {
        placement = PLACEMENT_RIGHT;
      } else if ($parentDropdown.hasClass(CLASS_NAME_DROPLEFT)) {
        placement = PLACEMENT_LEFT;
      } else if ($__default['default'](this._menu).hasClass(CLASS_NAME_MENURIGHT)) {
        placement = PLACEMENT_BOTTOMEND;
      }

      return placement;
    };

    _proto._detectNavbar = function _detectNavbar() {
      return $__default['default'](this._element).closest('.navbar').length > 0;
    };

    _proto._getOffset = function _getOffset() {
      var _this2 = this;

      var offset = {};

      if (typeof this._config.offset === 'function') {
        offset.fn = function (data) {
          data.offsets = _extends({}, data.offsets, _this2._config.offset(data.offsets, _this2._element) || {});
          return data;
        };
      } else {
        offset.offset = this._config.offset;
      }

      return offset;
    };

    _proto._getPopperConfig = function _getPopperConfig() {
      var popperConfig = {
        placement: this._getPlacement(),
        modifiers: {
          offset: this._getOffset(),
          flip: {
            enabled: this._config.flip
          },
          preventOverflow: {
            boundariesElement: this._config.boundary
          }
        }
      }; // Disable Popper.js if we have a static display

      if (this._config.display === 'static') {
        popperConfig.modifiers.applyStyle = {
          enabled: false
        };
      }

      return _extends({}, popperConfig, this._config.popperConfig);
    } // Static
    ;

    Dropdown._jQueryInterface = function _jQueryInterface(config) {
      return this.each(function () {
        var data = $__default['default'](this).data(DATA_KEY$4);

        var _config = _typeof(config) === 'object' ? config : null;

        if (!data) {
          data = new Dropdown(this, _config);
          $__default['default'](this).data(DATA_KEY$4, data);
        }

        if (typeof config === 'string') {
          if (typeof data[config] === 'undefined') {
            throw new TypeError("No method named \"" + config + "\"");
          }

          data[config]();
        }
      });
    };

    Dropdown._clearMenus = function _clearMenus(event) {
      if (event && (event.which === RIGHT_MOUSE_BUTTON_WHICH || event.type === 'keyup' && event.which !== TAB_KEYCODE)) {
        return;
      }

      var toggles = [].slice.call(document.querySelectorAll(SELECTOR_DATA_TOGGLE$2));

      for (var i = 0, len = toggles.length; i < len; i++) {
        var parent = Dropdown._getParentFromElement(toggles[i]);

        var context = $__default['default'](toggles[i]).data(DATA_KEY$4);
        var relatedTarget = {
          relatedTarget: toggles[i]
        };

        if (event && event.type === 'click') {
          relatedTarget.clickEvent = event;
        }

        if (!context) {
          continue;
        }

        var dropdownMenu = context._menu;

        if (!$__default['default'](parent).hasClass(CLASS_NAME_SHOW$2)) {
          continue;
        }

        if (event && (event.type === 'click' && /input|textarea/i.test(event.target.tagName) || event.type === 'keyup' && event.which === TAB_KEYCODE) && $__default['default'].contains(parent, event.target)) {
          continue;
        }

        var hideEvent = $__default['default'].Event(EVENT_HIDE$1, relatedTarget);
        $__default['default'](parent).trigger(hideEvent);

        if (hideEvent.isDefaultPrevented()) {
          continue;
        } // If this is a touch-enabled device we remove the extra
        // empty mouseover listeners we added for iOS support


        if ('ontouchstart' in document.documentElement) {
          $__default['default'](document.body).children().off('mouseover', null, $__default['default'].noop);
        }

        toggles[i].setAttribute('aria-expanded', 'false');

        if (context._popper) {
          context._popper.destroy();
        }

        $__default['default'](dropdownMenu).removeClass(CLASS_NAME_SHOW$2);
        $__default['default'](parent).removeClass(CLASS_NAME_SHOW$2).trigger($__default['default'].Event(EVENT_HIDDEN$1, relatedTarget));
      }
    };

    Dropdown._getParentFromElement = function _getParentFromElement(element) {
      var parent;
      var selector = Util.getSelectorFromElement(element);

      if (selector) {
        parent = document.querySelector(selector);
      }

      return parent || element.parentNode;
    } // eslint-disable-next-line complexity
    ;

    Dropdown._dataApiKeydownHandler = function _dataApiKeydownHandler(event) {
      // If not input/textarea:
      //  - And not a key in REGEXP_KEYDOWN => not a dropdown command
      // If input/textarea:
      //  - If space key => not a dropdown command
      //  - If key is other than escape
      //    - If key is not up or down => not a dropdown command
      //    - If trigger inside the menu => not a dropdown command
      if (/input|textarea/i.test(event.target.tagName) ? event.which === SPACE_KEYCODE || event.which !== ESCAPE_KEYCODE && (event.which !== ARROW_DOWN_KEYCODE && event.which !== ARROW_UP_KEYCODE || $__default['default'](event.target).closest(SELECTOR_MENU).length) : !REGEXP_KEYDOWN.test(event.which)) {
        return;
      }

      if (this.disabled || $__default['default'](this).hasClass(CLASS_NAME_DISABLED)) {
        return;
      }

      var parent = Dropdown._getParentFromElement(this);

      var isActive = $__default['default'](parent).hasClass(CLASS_NAME_SHOW$2);

      if (!isActive && event.which === ESCAPE_KEYCODE) {
        return;
      }

      event.preventDefault();
      event.stopPropagation();

      if (!isActive || event.which === ESCAPE_KEYCODE || event.which === SPACE_KEYCODE) {
        if (event.which === ESCAPE_KEYCODE) {
          $__default['default'](parent.querySelector(SELECTOR_DATA_TOGGLE$2)).trigger('focus');
        }

        $__default['default'](this).trigger('click');
        return;
      }

      var items = [].slice.call(parent.querySelectorAll(SELECTOR_VISIBLE_ITEMS)).filter(function (item) {
        return $__default['default'](item).is(':visible');
      });

      if (items.length === 0) {
        return;
      }

      var index = items.indexOf(event.target);

      if (event.which === ARROW_UP_KEYCODE && index > 0) {
        // Up
        index--;
      }

      if (event.which === ARROW_DOWN_KEYCODE && index < items.length - 1) {
        // Down
        index++;
      }

      if (index < 0) {
        index = 0;
      }

      items[index].focus();
    };

    _createClass(Dropdown, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION$4;
      }
    }, {
      key: "Default",
      get: function get() {
        return Default$2;
      }
    }, {
      key: "DefaultType",
      get: function get() {
        return DefaultType$2;
      }
    }]);

    return Dropdown;
  }();
  /**
   * ------------------------------------------------------------------------
   * Data Api implementation
   * ------------------------------------------------------------------------
   */


  $__default['default'](document).on(EVENT_KEYDOWN_DATA_API, SELECTOR_DATA_TOGGLE$2, Dropdown._dataApiKeydownHandler).on(EVENT_KEYDOWN_DATA_API, SELECTOR_MENU, Dropdown._dataApiKeydownHandler).on(EVENT_CLICK_DATA_API$4 + " " + EVENT_KEYUP_DATA_API, Dropdown._clearMenus).on(EVENT_CLICK_DATA_API$4, SELECTOR_DATA_TOGGLE$2, function (event) {
    event.preventDefault();
    event.stopPropagation();

    Dropdown._jQueryInterface.call($__default['default'](this), 'toggle');
  }).on(EVENT_CLICK_DATA_API$4, SELECTOR_FORM_CHILD, function (e) {
    e.stopPropagation();
  });
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */

  $__default['default'].fn[NAME$4] = Dropdown._jQueryInterface;
  $__default['default'].fn[NAME$4].Constructor = Dropdown;

  $__default['default'].fn[NAME$4].noConflict = function () {
    $__default['default'].fn[NAME$4] = JQUERY_NO_CONFLICT$4;
    return Dropdown._jQueryInterface;
  };
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$5 = 'modal';
  var VERSION$5 = '4.5.3';
  var DATA_KEY$5 = 'bs.modal';
  var EVENT_KEY$5 = "." + DATA_KEY$5;
  var DATA_API_KEY$5 = '.data-api';
  var JQUERY_NO_CONFLICT$5 = $__default['default'].fn[NAME$5];
  var ESCAPE_KEYCODE$1 = 27; // KeyboardEvent.which value for Escape (Esc) key

  var Default$3 = {
    backdrop: true,
    keyboard: true,
    focus: true,
    show: true
  };
  var DefaultType$3 = {
    backdrop: '(boolean|string)',
    keyboard: 'boolean',
    focus: 'boolean',
    show: 'boolean'
  };
  var EVENT_HIDE$2 = "hide" + EVENT_KEY$5;
  var EVENT_HIDE_PREVENTED = "hidePrevented" + EVENT_KEY$5;
  var EVENT_HIDDEN$2 = "hidden" + EVENT_KEY$5;
  var EVENT_SHOW$2 = "show" + EVENT_KEY$5;
  var EVENT_SHOWN$2 = "shown" + EVENT_KEY$5;
  var EVENT_FOCUSIN = "focusin" + EVENT_KEY$5;
  var EVENT_RESIZE = "resize" + EVENT_KEY$5;
  var EVENT_CLICK_DISMISS = "click.dismiss" + EVENT_KEY$5;
  var EVENT_KEYDOWN_DISMISS = "keydown.dismiss" + EVENT_KEY$5;
  var EVENT_MOUSEUP_DISMISS = "mouseup.dismiss" + EVENT_KEY$5;
  var EVENT_MOUSEDOWN_DISMISS = "mousedown.dismiss" + EVENT_KEY$5;
  var EVENT_CLICK_DATA_API$5 = "click" + EVENT_KEY$5 + DATA_API_KEY$5;
  var CLASS_NAME_SCROLLABLE = 'modal-dialog-scrollable';
  var CLASS_NAME_SCROLLBAR_MEASURER = 'modal-scrollbar-measure';
  var CLASS_NAME_BACKDROP = 'modal-backdrop';
  var CLASS_NAME_OPEN = 'modal-open';
  var CLASS_NAME_FADE$1 = 'fade';
  var CLASS_NAME_SHOW$3 = 'show';
  var CLASS_NAME_STATIC = 'modal-static';
  var SELECTOR_DIALOG = '.modal-dialog';
  var SELECTOR_MODAL_BODY = '.modal-body';
  var SELECTOR_DATA_TOGGLE$3 = '[data-toggle="modal"]';
  var SELECTOR_DATA_DISMISS = '[data-dismiss="modal"]';
  var SELECTOR_FIXED_CONTENT = '.fixed-top, .fixed-bottom, .is-fixed, .sticky-top';
  var SELECTOR_STICKY_CONTENT = '.sticky-top';
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Modal = /*#__PURE__*/function () {
    function Modal(element, config) {
      this._config = this._getConfig(config);
      this._element = element;
      this._dialog = element.querySelector(SELECTOR_DIALOG);
      this._backdrop = null;
      this._isShown = false;
      this._isBodyOverflowing = false;
      this._ignoreBackdropClick = false;
      this._isTransitioning = false;
      this._scrollbarWidth = 0;
    } // Getters


    var _proto = Modal.prototype; // Public

    _proto.toggle = function toggle(relatedTarget) {
      return this._isShown ? this.hide() : this.show(relatedTarget);
    };

    _proto.show = function show(relatedTarget) {
      var _this = this;

      if (this._isShown || this._isTransitioning) {
        return;
      }

      if ($__default['default'](this._element).hasClass(CLASS_NAME_FADE$1)) {
        this._isTransitioning = true;
      }

      var showEvent = $__default['default'].Event(EVENT_SHOW$2, {
        relatedTarget: relatedTarget
      });
      $__default['default'](this._element).trigger(showEvent);

      if (this._isShown || showEvent.isDefaultPrevented()) {
        return;
      }

      this._isShown = true;

      this._checkScrollbar();

      this._setScrollbar();

      this._adjustDialog();

      this._setEscapeEvent();

      this._setResizeEvent();

      $__default['default'](this._element).on(EVENT_CLICK_DISMISS, SELECTOR_DATA_DISMISS, function (event) {
        return _this.hide(event);
      });
      $__default['default'](this._dialog).on(EVENT_MOUSEDOWN_DISMISS, function () {
        $__default['default'](_this._element).one(EVENT_MOUSEUP_DISMISS, function (event) {
          if ($__default['default'](event.target).is(_this._element)) {
            _this._ignoreBackdropClick = true;
          }
        });
      });

      this._showBackdrop(function () {
        return _this._showElement(relatedTarget);
      });
    };

    _proto.hide = function hide(event) {
      var _this2 = this;

      if (event) {
        event.preventDefault();
      }

      if (!this._isShown || this._isTransitioning) {
        return;
      }

      var hideEvent = $__default['default'].Event(EVENT_HIDE$2);
      $__default['default'](this._element).trigger(hideEvent);

      if (!this._isShown || hideEvent.isDefaultPrevented()) {
        return;
      }

      this._isShown = false;
      var transition = $__default['default'](this._element).hasClass(CLASS_NAME_FADE$1);

      if (transition) {
        this._isTransitioning = true;
      }

      this._setEscapeEvent();

      this._setResizeEvent();

      $__default['default'](document).off(EVENT_FOCUSIN);
      $__default['default'](this._element).removeClass(CLASS_NAME_SHOW$3);
      $__default['default'](this._element).off(EVENT_CLICK_DISMISS);
      $__default['default'](this._dialog).off(EVENT_MOUSEDOWN_DISMISS);

      if (transition) {
        var transitionDuration = Util.getTransitionDurationFromElement(this._element);
        $__default['default'](this._element).one(Util.TRANSITION_END, function (event) {
          return _this2._hideModal(event);
        }).emulateTransitionEnd(transitionDuration);
      } else {
        this._hideModal();
      }
    };

    _proto.dispose = function dispose() {
      [window, this._element, this._dialog].forEach(function (htmlElement) {
        return $__default['default'](htmlElement).off(EVENT_KEY$5);
      });
      /**
       * `document` has 2 events `EVENT_FOCUSIN` and `EVENT_CLICK_DATA_API`
       * Do not move `document` in `htmlElements` array
       * It will remove `EVENT_CLICK_DATA_API` event that should remain
       */

      $__default['default'](document).off(EVENT_FOCUSIN);
      $__default['default'].removeData(this._element, DATA_KEY$5);
      this._config = null;
      this._element = null;
      this._dialog = null;
      this._backdrop = null;
      this._isShown = null;
      this._isBodyOverflowing = null;
      this._ignoreBackdropClick = null;
      this._isTransitioning = null;
      this._scrollbarWidth = null;
    };

    _proto.handleUpdate = function handleUpdate() {
      this._adjustDialog();
    } // Private
    ;

    _proto._getConfig = function _getConfig(config) {
      config = _extends({}, Default$3, config);
      Util.typeCheckConfig(NAME$5, config, DefaultType$3);
      return config;
    };

    _proto._triggerBackdropTransition = function _triggerBackdropTransition() {
      var _this3 = this;

      if (this._config.backdrop === 'static') {
        var hideEventPrevented = $__default['default'].Event(EVENT_HIDE_PREVENTED);
        $__default['default'](this._element).trigger(hideEventPrevented);

        if (hideEventPrevented.isDefaultPrevented()) {
          return;
        }

        var isModalOverflowing = this._element.scrollHeight > document.documentElement.clientHeight;

        if (!isModalOverflowing) {
          this._element.style.overflowY = 'hidden';
        }

        this._element.classList.add(CLASS_NAME_STATIC);

        var modalTransitionDuration = Util.getTransitionDurationFromElement(this._dialog);
        $__default['default'](this._element).off(Util.TRANSITION_END);
        $__default['default'](this._element).one(Util.TRANSITION_END, function () {
          _this3._element.classList.remove(CLASS_NAME_STATIC);

          if (!isModalOverflowing) {
            $__default['default'](_this3._element).one(Util.TRANSITION_END, function () {
              _this3._element.style.overflowY = '';
            }).emulateTransitionEnd(_this3._element, modalTransitionDuration);
          }
        }).emulateTransitionEnd(modalTransitionDuration);

        this._element.focus();
      } else {
        this.hide();
      }
    };

    _proto._showElement = function _showElement(relatedTarget) {
      var _this4 = this;

      var transition = $__default['default'](this._element).hasClass(CLASS_NAME_FADE$1);
      var modalBody = this._dialog ? this._dialog.querySelector(SELECTOR_MODAL_BODY) : null;

      if (!this._element.parentNode || this._element.parentNode.nodeType !== Node.ELEMENT_NODE) {
        // Don't move modal's DOM position
        document.body.appendChild(this._element);
      }

      this._element.style.display = 'block';

      this._element.removeAttribute('aria-hidden');

      this._element.setAttribute('aria-modal', true);

      this._element.setAttribute('role', 'dialog');

      if ($__default['default'](this._dialog).hasClass(CLASS_NAME_SCROLLABLE) && modalBody) {
        modalBody.scrollTop = 0;
      } else {
        this._element.scrollTop = 0;
      }

      if (transition) {
        Util.reflow(this._element);
      }

      $__default['default'](this._element).addClass(CLASS_NAME_SHOW$3);

      if (this._config.focus) {
        this._enforceFocus();
      }

      var shownEvent = $__default['default'].Event(EVENT_SHOWN$2, {
        relatedTarget: relatedTarget
      });

      var transitionComplete = function transitionComplete() {
        if (_this4._config.focus) {
          _this4._element.focus();
        }

        _this4._isTransitioning = false;
        $__default['default'](_this4._element).trigger(shownEvent);
      };

      if (transition) {
        var transitionDuration = Util.getTransitionDurationFromElement(this._dialog);
        $__default['default'](this._dialog).one(Util.TRANSITION_END, transitionComplete).emulateTransitionEnd(transitionDuration);
      } else {
        transitionComplete();
      }
    };

    _proto._enforceFocus = function _enforceFocus() {
      var _this5 = this;

      $__default['default'](document).off(EVENT_FOCUSIN) // Guard against infinite focus loop
      .on(EVENT_FOCUSIN, function (event) {
        if (document !== event.target && _this5._element !== event.target && $__default['default'](_this5._element).has(event.target).length === 0) {
          _this5._element.focus();
        }
      });
    };

    _proto._setEscapeEvent = function _setEscapeEvent() {
      var _this6 = this;

      if (this._isShown) {
        $__default['default'](this._element).on(EVENT_KEYDOWN_DISMISS, function (event) {
          if (_this6._config.keyboard && event.which === ESCAPE_KEYCODE$1) {
            event.preventDefault();

            _this6.hide();
          } else if (!_this6._config.keyboard && event.which === ESCAPE_KEYCODE$1) {
            _this6._triggerBackdropTransition();
          }
        });
      } else if (!this._isShown) {
        $__default['default'](this._element).off(EVENT_KEYDOWN_DISMISS);
      }
    };

    _proto._setResizeEvent = function _setResizeEvent() {
      var _this7 = this;

      if (this._isShown) {
        $__default['default'](window).on(EVENT_RESIZE, function (event) {
          return _this7.handleUpdate(event);
        });
      } else {
        $__default['default'](window).off(EVENT_RESIZE);
      }
    };

    _proto._hideModal = function _hideModal() {
      var _this8 = this;

      this._element.style.display = 'none';

      this._element.setAttribute('aria-hidden', true);

      this._element.removeAttribute('aria-modal');

      this._element.removeAttribute('role');

      this._isTransitioning = false;

      this._showBackdrop(function () {
        $__default['default'](document.body).removeClass(CLASS_NAME_OPEN);

        _this8._resetAdjustments();

        _this8._resetScrollbar();

        $__default['default'](_this8._element).trigger(EVENT_HIDDEN$2);
      });
    };

    _proto._removeBackdrop = function _removeBackdrop() {
      if (this._backdrop) {
        $__default['default'](this._backdrop).remove();
        this._backdrop = null;
      }
    };

    _proto._showBackdrop = function _showBackdrop(callback) {
      var _this9 = this;

      var animate = $__default['default'](this._element).hasClass(CLASS_NAME_FADE$1) ? CLASS_NAME_FADE$1 : '';

      if (this._isShown && this._config.backdrop) {
        this._backdrop = document.createElement('div');
        this._backdrop.className = CLASS_NAME_BACKDROP;

        if (animate) {
          this._backdrop.classList.add(animate);
        }

        $__default['default'](this._backdrop).appendTo(document.body);
        $__default['default'](this._element).on(EVENT_CLICK_DISMISS, function (event) {
          if (_this9._ignoreBackdropClick) {
            _this9._ignoreBackdropClick = false;
            return;
          }

          if (event.target !== event.currentTarget) {
            return;
          }

          _this9._triggerBackdropTransition();
        });

        if (animate) {
          Util.reflow(this._backdrop);
        }

        $__default['default'](this._backdrop).addClass(CLASS_NAME_SHOW$3);

        if (!callback) {
          return;
        }

        if (!animate) {
          callback();
          return;
        }

        var backdropTransitionDuration = Util.getTransitionDurationFromElement(this._backdrop);
        $__default['default'](this._backdrop).one(Util.TRANSITION_END, callback).emulateTransitionEnd(backdropTransitionDuration);
      } else if (!this._isShown && this._backdrop) {
        $__default['default'](this._backdrop).removeClass(CLASS_NAME_SHOW$3);

        var callbackRemove = function callbackRemove() {
          _this9._removeBackdrop();

          if (callback) {
            callback();
          }
        };

        if ($__default['default'](this._element).hasClass(CLASS_NAME_FADE$1)) {
          var _backdropTransitionDuration = Util.getTransitionDurationFromElement(this._backdrop);

          $__default['default'](this._backdrop).one(Util.TRANSITION_END, callbackRemove).emulateTransitionEnd(_backdropTransitionDuration);
        } else {
          callbackRemove();
        }
      } else if (callback) {
        callback();
      }
    } // ----------------------------------------------------------------------
    // the following methods are used to handle overflowing modals
    // todo (fat): these should probably be refactored out of modal.js
    // ----------------------------------------------------------------------
    ;

    _proto._adjustDialog = function _adjustDialog() {
      var isModalOverflowing = this._element.scrollHeight > document.documentElement.clientHeight;

      if (!this._isBodyOverflowing && isModalOverflowing) {
        this._element.style.paddingLeft = this._scrollbarWidth + "px";
      }

      if (this._isBodyOverflowing && !isModalOverflowing) {
        this._element.style.paddingRight = this._scrollbarWidth + "px";
      }
    };

    _proto._resetAdjustments = function _resetAdjustments() {
      this._element.style.paddingLeft = '';
      this._element.style.paddingRight = '';
    };

    _proto._checkScrollbar = function _checkScrollbar() {
      var rect = document.body.getBoundingClientRect();
      this._isBodyOverflowing = Math.round(rect.left + rect.right) < window.innerWidth;
      this._scrollbarWidth = this._getScrollbarWidth();
    };

    _proto._setScrollbar = function _setScrollbar() {
      var _this10 = this;

      if (this._isBodyOverflowing) {
        // Note: DOMNode.style.paddingRight returns the actual value or '' if not set
        //   while $(DOMNode).css('padding-right') returns the calculated value or 0 if not set
        var fixedContent = [].slice.call(document.querySelectorAll(SELECTOR_FIXED_CONTENT));
        var stickyContent = [].slice.call(document.querySelectorAll(SELECTOR_STICKY_CONTENT)); // Adjust fixed content padding

        $__default['default'](fixedContent).each(function (index, element) {
          var actualPadding = element.style.paddingRight;
          var calculatedPadding = $__default['default'](element).css('padding-right');
          $__default['default'](element).data('padding-right', actualPadding).css('padding-right', parseFloat(calculatedPadding) + _this10._scrollbarWidth + "px");
        }); // Adjust sticky content margin

        $__default['default'](stickyContent).each(function (index, element) {
          var actualMargin = element.style.marginRight;
          var calculatedMargin = $__default['default'](element).css('margin-right');
          $__default['default'](element).data('margin-right', actualMargin).css('margin-right', parseFloat(calculatedMargin) - _this10._scrollbarWidth + "px");
        }); // Adjust body padding

        var actualPadding = document.body.style.paddingRight;
        var calculatedPadding = $__default['default'](document.body).css('padding-right');
        $__default['default'](document.body).data('padding-right', actualPadding).css('padding-right', parseFloat(calculatedPadding) + this._scrollbarWidth + "px");
      }

      $__default['default'](document.body).addClass(CLASS_NAME_OPEN);
    };

    _proto._resetScrollbar = function _resetScrollbar() {
      // Restore fixed content padding
      var fixedContent = [].slice.call(document.querySelectorAll(SELECTOR_FIXED_CONTENT));
      $__default['default'](fixedContent).each(function (index, element) {
        var padding = $__default['default'](element).data('padding-right');
        $__default['default'](element).removeData('padding-right');
        element.style.paddingRight = padding ? padding : '';
      }); // Restore sticky content

      var elements = [].slice.call(document.querySelectorAll("" + SELECTOR_STICKY_CONTENT));
      $__default['default'](elements).each(function (index, element) {
        var margin = $__default['default'](element).data('margin-right');

        if (typeof margin !== 'undefined') {
          $__default['default'](element).css('margin-right', margin).removeData('margin-right');
        }
      }); // Restore body padding

      var padding = $__default['default'](document.body).data('padding-right');
      $__default['default'](document.body).removeData('padding-right');
      document.body.style.paddingRight = padding ? padding : '';
    };

    _proto._getScrollbarWidth = function _getScrollbarWidth() {
      // thx d.walsh
      var scrollDiv = document.createElement('div');
      scrollDiv.className = CLASS_NAME_SCROLLBAR_MEASURER;
      document.body.appendChild(scrollDiv);
      var scrollbarWidth = scrollDiv.getBoundingClientRect().width - scrollDiv.clientWidth;
      document.body.removeChild(scrollDiv);
      return scrollbarWidth;
    } // Static
    ;

    Modal._jQueryInterface = function _jQueryInterface(config, relatedTarget) {
      return this.each(function () {
        var data = $__default['default'](this).data(DATA_KEY$5);

        var _config = _extends({}, Default$3, $__default['default'](this).data(), _typeof(config) === 'object' && config ? config : {});

        if (!data) {
          data = new Modal(this, _config);
          $__default['default'](this).data(DATA_KEY$5, data);
        }

        if (typeof config === 'string') {
          if (typeof data[config] === 'undefined') {
            throw new TypeError("No method named \"" + config + "\"");
          }

          data[config](relatedTarget);
        } else if (_config.show) {
          data.show(relatedTarget);
        }
      });
    };

    _createClass(Modal, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION$5;
      }
    }, {
      key: "Default",
      get: function get() {
        return Default$3;
      }
    }]);

    return Modal;
  }();
  /**
   * ------------------------------------------------------------------------
   * Data Api implementation
   * ------------------------------------------------------------------------
   */


  $__default['default'](document).on(EVENT_CLICK_DATA_API$5, SELECTOR_DATA_TOGGLE$3, function (event) {
    var _this11 = this;

    var target;
    var selector = Util.getSelectorFromElement(this);

    if (selector) {
      target = document.querySelector(selector);
    }

    var config = $__default['default'](target).data(DATA_KEY$5) ? 'toggle' : _extends({}, $__default['default'](target).data(), $__default['default'](this).data());

    if (this.tagName === 'A' || this.tagName === 'AREA') {
      event.preventDefault();
    }

    var $target = $__default['default'](target).one(EVENT_SHOW$2, function (showEvent) {
      if (showEvent.isDefaultPrevented()) {
        // Only register focus restorer if modal will actually get shown
        return;
      }

      $target.one(EVENT_HIDDEN$2, function () {
        if ($__default['default'](_this11).is(':visible')) {
          _this11.focus();
        }
      });
    });

    Modal._jQueryInterface.call($__default['default'](target), config, this);
  });
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */

  $__default['default'].fn[NAME$5] = Modal._jQueryInterface;
  $__default['default'].fn[NAME$5].Constructor = Modal;

  $__default['default'].fn[NAME$5].noConflict = function () {
    $__default['default'].fn[NAME$5] = JQUERY_NO_CONFLICT$5;
    return Modal._jQueryInterface;
  };
  /**
   * --------------------------------------------------------------------------
   * Bootstrap (v4.5.3): tools/sanitizer.js
   * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
   * --------------------------------------------------------------------------
   */


  var uriAttrs = ['background', 'cite', 'href', 'itemtype', 'longdesc', 'poster', 'src', 'xlink:href'];
  var ARIA_ATTRIBUTE_PATTERN = /^aria-[\w-]*$/i;
  var DefaultWhitelist = {
    // Global attributes allowed on any supplied element below.
    '*': ['class', 'dir', 'id', 'lang', 'role', ARIA_ATTRIBUTE_PATTERN],
    a: ['target', 'href', 'title', 'rel'],
    area: [],
    b: [],
    br: [],
    col: [],
    code: [],
    div: [],
    em: [],
    hr: [],
    h1: [],
    h2: [],
    h3: [],
    h4: [],
    h5: [],
    h6: [],
    i: [],
    img: ['src', 'srcset', 'alt', 'title', 'width', 'height'],
    li: [],
    ol: [],
    p: [],
    pre: [],
    s: [],
    small: [],
    span: [],
    sub: [],
    sup: [],
    strong: [],
    u: [],
    ul: []
  };
  /**
   * A pattern that recognizes a commonly useful subset of URLs that are safe.
   *
   * Shoutout to Angular 7 https://github.com/angular/angular/blob/7.2.4/packages/core/src/sanitization/url_sanitizer.ts
   */

  var SAFE_URL_PATTERN = /^(?:(?:https?|mailto|ftp|tel|file):|[^#&/:?]*(?:[#/?]|$))/gi;
  /**
   * A pattern that matches safe data URLs. Only matches image, video and audio types.
   *
   * Shoutout to Angular 7 https://github.com/angular/angular/blob/7.2.4/packages/core/src/sanitization/url_sanitizer.ts
   */

  var DATA_URL_PATTERN = /^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i;

  function allowedAttribute(attr, allowedAttributeList) {
    var attrName = attr.nodeName.toLowerCase();

    if (allowedAttributeList.indexOf(attrName) !== -1) {
      if (uriAttrs.indexOf(attrName) !== -1) {
        return Boolean(attr.nodeValue.match(SAFE_URL_PATTERN) || attr.nodeValue.match(DATA_URL_PATTERN));
      }

      return true;
    }

    var regExp = allowedAttributeList.filter(function (attrRegex) {
      return attrRegex instanceof RegExp;
    }); // Check if a regular expression validates the attribute.

    for (var i = 0, len = regExp.length; i < len; i++) {
      if (attrName.match(regExp[i])) {
        return true;
      }
    }

    return false;
  }

  function sanitizeHtml(unsafeHtml, whiteList, sanitizeFn) {
    if (unsafeHtml.length === 0) {
      return unsafeHtml;
    }

    if (sanitizeFn && typeof sanitizeFn === 'function') {
      return sanitizeFn(unsafeHtml);
    }

    var domParser = new window.DOMParser();
    var createdDocument = domParser.parseFromString(unsafeHtml, 'text/html');
    var whitelistKeys = Object.keys(whiteList);
    var elements = [].slice.call(createdDocument.body.querySelectorAll('*'));

    var _loop = function _loop(i, len) {
      var el = elements[i];
      var elName = el.nodeName.toLowerCase();

      if (whitelistKeys.indexOf(el.nodeName.toLowerCase()) === -1) {
        el.parentNode.removeChild(el);
        return "continue";
      }

      var attributeList = [].slice.call(el.attributes);
      var whitelistedAttributes = [].concat(whiteList['*'] || [], whiteList[elName] || []);
      attributeList.forEach(function (attr) {
        if (!allowedAttribute(attr, whitelistedAttributes)) {
          el.removeAttribute(attr.nodeName);
        }
      });
    };

    for (var i = 0, len = elements.length; i < len; i++) {
      var _ret = _loop(i);

      if (_ret === "continue") continue;
    }

    return createdDocument.body.innerHTML;
  }
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$6 = 'tooltip';
  var VERSION$6 = '4.5.3';
  var DATA_KEY$6 = 'bs.tooltip';
  var EVENT_KEY$6 = "." + DATA_KEY$6;
  var JQUERY_NO_CONFLICT$6 = $__default['default'].fn[NAME$6];
  var CLASS_PREFIX = 'bs-tooltip';
  var BSCLS_PREFIX_REGEX = new RegExp("(^|\\s)" + CLASS_PREFIX + "\\S+", 'g');
  var DISALLOWED_ATTRIBUTES = ['sanitize', 'whiteList', 'sanitizeFn'];
  var DefaultType$4 = {
    animation: 'boolean',
    template: 'string',
    title: '(string|element|function)',
    trigger: 'string',
    delay: '(number|object)',
    html: 'boolean',
    selector: '(string|boolean)',
    placement: '(string|function)',
    offset: '(number|string|function)',
    container: '(string|element|boolean)',
    fallbackPlacement: '(string|array)',
    boundary: '(string|element)',
    sanitize: 'boolean',
    sanitizeFn: '(null|function)',
    whiteList: 'object',
    popperConfig: '(null|object)'
  };
  var AttachmentMap = {
    AUTO: 'auto',
    TOP: 'top',
    RIGHT: 'right',
    BOTTOM: 'bottom',
    LEFT: 'left'
  };
  var Default$4 = {
    animation: true,
    template: '<div class="tooltip" role="tooltip">' + '<div class="arrow"></div>' + '<div class="tooltip-inner"></div></div>',
    trigger: 'hover focus',
    title: '',
    delay: 0,
    html: false,
    selector: false,
    placement: 'top',
    offset: 0,
    container: false,
    fallbackPlacement: 'flip',
    boundary: 'scrollParent',
    sanitize: true,
    sanitizeFn: null,
    whiteList: DefaultWhitelist,
    popperConfig: null
  };
  var HOVER_STATE_SHOW = 'show';
  var HOVER_STATE_OUT = 'out';
  var Event = {
    HIDE: "hide" + EVENT_KEY$6,
    HIDDEN: "hidden" + EVENT_KEY$6,
    SHOW: "show" + EVENT_KEY$6,
    SHOWN: "shown" + EVENT_KEY$6,
    INSERTED: "inserted" + EVENT_KEY$6,
    CLICK: "click" + EVENT_KEY$6,
    FOCUSIN: "focusin" + EVENT_KEY$6,
    FOCUSOUT: "focusout" + EVENT_KEY$6,
    MOUSEENTER: "mouseenter" + EVENT_KEY$6,
    MOUSELEAVE: "mouseleave" + EVENT_KEY$6
  };
  var CLASS_NAME_FADE$2 = 'fade';
  var CLASS_NAME_SHOW$4 = 'show';
  var SELECTOR_TOOLTIP_INNER = '.tooltip-inner';
  var SELECTOR_ARROW = '.arrow';
  var TRIGGER_HOVER = 'hover';
  var TRIGGER_FOCUS = 'focus';
  var TRIGGER_CLICK = 'click';
  var TRIGGER_MANUAL = 'manual';
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Tooltip = /*#__PURE__*/function () {
    function Tooltip(element, config) {
      if (typeof Popper__default['default'] === 'undefined') {
        throw new TypeError('Bootstrap\'s tooltips require Popper.js (https://popper.js.org/)');
      } // private


      this._isEnabled = true;
      this._timeout = 0;
      this._hoverState = '';
      this._activeTrigger = {};
      this._popper = null; // Protected

      this.element = element;
      this.config = this._getConfig(config);
      this.tip = null;

      this._setListeners();
    } // Getters


    var _proto = Tooltip.prototype; // Public

    _proto.enable = function enable() {
      this._isEnabled = true;
    };

    _proto.disable = function disable() {
      this._isEnabled = false;
    };

    _proto.toggleEnabled = function toggleEnabled() {
      this._isEnabled = !this._isEnabled;
    };

    _proto.toggle = function toggle(event) {
      if (!this._isEnabled) {
        return;
      }

      if (event) {
        var dataKey = this.constructor.DATA_KEY;
        var context = $__default['default'](event.currentTarget).data(dataKey);

        if (!context) {
          context = new this.constructor(event.currentTarget, this._getDelegateConfig());
          $__default['default'](event.currentTarget).data(dataKey, context);
        }

        context._activeTrigger.click = !context._activeTrigger.click;

        if (context._isWithActiveTrigger()) {
          context._enter(null, context);
        } else {
          context._leave(null, context);
        }
      } else {
        if ($__default['default'](this.getTipElement()).hasClass(CLASS_NAME_SHOW$4)) {
          this._leave(null, this);

          return;
        }

        this._enter(null, this);
      }
    };

    _proto.dispose = function dispose() {
      clearTimeout(this._timeout);
      $__default['default'].removeData(this.element, this.constructor.DATA_KEY);
      $__default['default'](this.element).off(this.constructor.EVENT_KEY);
      $__default['default'](this.element).closest('.modal').off('hide.bs.modal', this._hideModalHandler);

      if (this.tip) {
        $__default['default'](this.tip).remove();
      }

      this._isEnabled = null;
      this._timeout = null;
      this._hoverState = null;
      this._activeTrigger = null;

      if (this._popper) {
        this._popper.destroy();
      }

      this._popper = null;
      this.element = null;
      this.config = null;
      this.tip = null;
    };

    _proto.show = function show() {
      var _this = this;

      if ($__default['default'](this.element).css('display') === 'none') {
        throw new Error('Please use show on visible elements');
      }

      var showEvent = $__default['default'].Event(this.constructor.Event.SHOW);

      if (this.isWithContent() && this._isEnabled) {
        $__default['default'](this.element).trigger(showEvent);
        var shadowRoot = Util.findShadowRoot(this.element);
        var isInTheDom = $__default['default'].contains(shadowRoot !== null ? shadowRoot : this.element.ownerDocument.documentElement, this.element);

        if (showEvent.isDefaultPrevented() || !isInTheDom) {
          return;
        }

        var tip = this.getTipElement();
        var tipId = Util.getUID(this.constructor.NAME);
        tip.setAttribute('id', tipId);
        this.element.setAttribute('aria-describedby', tipId);
        this.setContent();

        if (this.config.animation) {
          $__default['default'](tip).addClass(CLASS_NAME_FADE$2);
        }

        var placement = typeof this.config.placement === 'function' ? this.config.placement.call(this, tip, this.element) : this.config.placement;

        var attachment = this._getAttachment(placement);

        this.addAttachmentClass(attachment);

        var container = this._getContainer();

        $__default['default'](tip).data(this.constructor.DATA_KEY, this);

        if (!$__default['default'].contains(this.element.ownerDocument.documentElement, this.tip)) {
          $__default['default'](tip).appendTo(container);
        }

        $__default['default'](this.element).trigger(this.constructor.Event.INSERTED);
        this._popper = new Popper__default['default'](this.element, tip, this._getPopperConfig(attachment));
        $__default['default'](tip).addClass(CLASS_NAME_SHOW$4); // If this is a touch-enabled device we add extra
        // empty mouseover listeners to the body's immediate children;
        // only needed because of broken event delegation on iOS
        // https://www.quirksmode.org/blog/archives/2014/02/mouse_event_bub.html

        if ('ontouchstart' in document.documentElement) {
          $__default['default'](document.body).children().on('mouseover', null, $__default['default'].noop);
        }

        var complete = function complete() {
          if (_this.config.animation) {
            _this._fixTransition();
          }

          var prevHoverState = _this._hoverState;
          _this._hoverState = null;
          $__default['default'](_this.element).trigger(_this.constructor.Event.SHOWN);

          if (prevHoverState === HOVER_STATE_OUT) {
            _this._leave(null, _this);
          }
        };

        if ($__default['default'](this.tip).hasClass(CLASS_NAME_FADE$2)) {
          var transitionDuration = Util.getTransitionDurationFromElement(this.tip);
          $__default['default'](this.tip).one(Util.TRANSITION_END, complete).emulateTransitionEnd(transitionDuration);
        } else {
          complete();
        }
      }
    };

    _proto.hide = function hide(callback) {
      var _this2 = this;

      var tip = this.getTipElement();
      var hideEvent = $__default['default'].Event(this.constructor.Event.HIDE);

      var complete = function complete() {
        if (_this2._hoverState !== HOVER_STATE_SHOW && tip.parentNode) {
          tip.parentNode.removeChild(tip);
        }

        _this2._cleanTipClass();

        _this2.element.removeAttribute('aria-describedby');

        $__default['default'](_this2.element).trigger(_this2.constructor.Event.HIDDEN);

        if (_this2._popper !== null) {
          _this2._popper.destroy();
        }

        if (callback) {
          callback();
        }
      };

      $__default['default'](this.element).trigger(hideEvent);

      if (hideEvent.isDefaultPrevented()) {
        return;
      }

      $__default['default'](tip).removeClass(CLASS_NAME_SHOW$4); // If this is a touch-enabled device we remove the extra
      // empty mouseover listeners we added for iOS support

      if ('ontouchstart' in document.documentElement) {
        $__default['default'](document.body).children().off('mouseover', null, $__default['default'].noop);
      }

      this._activeTrigger[TRIGGER_CLICK] = false;
      this._activeTrigger[TRIGGER_FOCUS] = false;
      this._activeTrigger[TRIGGER_HOVER] = false;

      if ($__default['default'](this.tip).hasClass(CLASS_NAME_FADE$2)) {
        var transitionDuration = Util.getTransitionDurationFromElement(tip);
        $__default['default'](tip).one(Util.TRANSITION_END, complete).emulateTransitionEnd(transitionDuration);
      } else {
        complete();
      }

      this._hoverState = '';
    };

    _proto.update = function update() {
      if (this._popper !== null) {
        this._popper.scheduleUpdate();
      }
    } // Protected
    ;

    _proto.isWithContent = function isWithContent() {
      return Boolean(this.getTitle());
    };

    _proto.addAttachmentClass = function addAttachmentClass(attachment) {
      $__default['default'](this.getTipElement()).addClass(CLASS_PREFIX + "-" + attachment);
    };

    _proto.getTipElement = function getTipElement() {
      this.tip = this.tip || $__default['default'](this.config.template)[0];
      return this.tip;
    };

    _proto.setContent = function setContent() {
      var tip = this.getTipElement();
      this.setElementContent($__default['default'](tip.querySelectorAll(SELECTOR_TOOLTIP_INNER)), this.getTitle());
      $__default['default'](tip).removeClass(CLASS_NAME_FADE$2 + " " + CLASS_NAME_SHOW$4);
    };

    _proto.setElementContent = function setElementContent($element, content) {
      if (_typeof(content) === 'object' && (content.nodeType || content.jquery)) {
        // Content is a DOM node or a jQuery
        if (this.config.html) {
          if (!$__default['default'](content).parent().is($element)) {
            $element.empty().append(content);
          }
        } else {
          $element.text($__default['default'](content).text());
        }

        return;
      }

      if (this.config.html) {
        if (this.config.sanitize) {
          content = sanitizeHtml(content, this.config.whiteList, this.config.sanitizeFn);
        }

        $element.html(content);
      } else {
        $element.text(content);
      }
    };

    _proto.getTitle = function getTitle() {
      var title = this.element.getAttribute('data-original-title');

      if (!title) {
        title = typeof this.config.title === 'function' ? this.config.title.call(this.element) : this.config.title;
      }

      return title;
    } // Private
    ;

    _proto._getPopperConfig = function _getPopperConfig(attachment) {
      var _this3 = this;

      var defaultBsConfig = {
        placement: attachment,
        modifiers: {
          offset: this._getOffset(),
          flip: {
            behavior: this.config.fallbackPlacement
          },
          arrow: {
            element: SELECTOR_ARROW
          },
          preventOverflow: {
            boundariesElement: this.config.boundary
          }
        },
        onCreate: function onCreate(data) {
          if (data.originalPlacement !== data.placement) {
            _this3._handlePopperPlacementChange(data);
          }
        },
        onUpdate: function onUpdate(data) {
          return _this3._handlePopperPlacementChange(data);
        }
      };
      return _extends({}, defaultBsConfig, this.config.popperConfig);
    };

    _proto._getOffset = function _getOffset() {
      var _this4 = this;

      var offset = {};

      if (typeof this.config.offset === 'function') {
        offset.fn = function (data) {
          data.offsets = _extends({}, data.offsets, _this4.config.offset(data.offsets, _this4.element) || {});
          return data;
        };
      } else {
        offset.offset = this.config.offset;
      }

      return offset;
    };

    _proto._getContainer = function _getContainer() {
      if (this.config.container === false) {
        return document.body;
      }

      if (Util.isElement(this.config.container)) {
        return $__default['default'](this.config.container);
      }

      return $__default['default'](document).find(this.config.container);
    };

    _proto._getAttachment = function _getAttachment(placement) {
      return AttachmentMap[placement.toUpperCase()];
    };

    _proto._setListeners = function _setListeners() {
      var _this5 = this;

      var triggers = this.config.trigger.split(' ');
      triggers.forEach(function (trigger) {
        if (trigger === 'click') {
          $__default['default'](_this5.element).on(_this5.constructor.Event.CLICK, _this5.config.selector, function (event) {
            return _this5.toggle(event);
          });
        } else if (trigger !== TRIGGER_MANUAL) {
          var eventIn = trigger === TRIGGER_HOVER ? _this5.constructor.Event.MOUSEENTER : _this5.constructor.Event.FOCUSIN;
          var eventOut = trigger === TRIGGER_HOVER ? _this5.constructor.Event.MOUSELEAVE : _this5.constructor.Event.FOCUSOUT;
          $__default['default'](_this5.element).on(eventIn, _this5.config.selector, function (event) {
            return _this5._enter(event);
          }).on(eventOut, _this5.config.selector, function (event) {
            return _this5._leave(event);
          });
        }
      });

      this._hideModalHandler = function () {
        if (_this5.element) {
          _this5.hide();
        }
      };

      $__default['default'](this.element).closest('.modal').on('hide.bs.modal', this._hideModalHandler);

      if (this.config.selector) {
        this.config = _extends({}, this.config, {
          trigger: 'manual',
          selector: ''
        });
      } else {
        this._fixTitle();
      }
    };

    _proto._fixTitle = function _fixTitle() {
      var titleType = _typeof(this.element.getAttribute('data-original-title'));

      if (this.element.getAttribute('title') || titleType !== 'string') {
        this.element.setAttribute('data-original-title', this.element.getAttribute('title') || '');
        this.element.setAttribute('title', '');
      }
    };

    _proto._enter = function _enter(event, context) {
      var dataKey = this.constructor.DATA_KEY;
      context = context || $__default['default'](event.currentTarget).data(dataKey);

      if (!context) {
        context = new this.constructor(event.currentTarget, this._getDelegateConfig());
        $__default['default'](event.currentTarget).data(dataKey, context);
      }

      if (event) {
        context._activeTrigger[event.type === 'focusin' ? TRIGGER_FOCUS : TRIGGER_HOVER] = true;
      }

      if ($__default['default'](context.getTipElement()).hasClass(CLASS_NAME_SHOW$4) || context._hoverState === HOVER_STATE_SHOW) {
        context._hoverState = HOVER_STATE_SHOW;
        return;
      }

      clearTimeout(context._timeout);
      context._hoverState = HOVER_STATE_SHOW;

      if (!context.config.delay || !context.config.delay.show) {
        context.show();
        return;
      }

      context._timeout = setTimeout(function () {
        if (context._hoverState === HOVER_STATE_SHOW) {
          context.show();
        }
      }, context.config.delay.show);
    };

    _proto._leave = function _leave(event, context) {
      var dataKey = this.constructor.DATA_KEY;
      context = context || $__default['default'](event.currentTarget).data(dataKey);

      if (!context) {
        context = new this.constructor(event.currentTarget, this._getDelegateConfig());
        $__default['default'](event.currentTarget).data(dataKey, context);
      }

      if (event) {
        context._activeTrigger[event.type === 'focusout' ? TRIGGER_FOCUS : TRIGGER_HOVER] = false;
      }

      if (context._isWithActiveTrigger()) {
        return;
      }

      clearTimeout(context._timeout);
      context._hoverState = HOVER_STATE_OUT;

      if (!context.config.delay || !context.config.delay.hide) {
        context.hide();
        return;
      }

      context._timeout = setTimeout(function () {
        if (context._hoverState === HOVER_STATE_OUT) {
          context.hide();
        }
      }, context.config.delay.hide);
    };

    _proto._isWithActiveTrigger = function _isWithActiveTrigger() {
      for (var trigger in this._activeTrigger) {
        if (this._activeTrigger[trigger]) {
          return true;
        }
      }

      return false;
    };

    _proto._getConfig = function _getConfig(config) {
      var dataAttributes = $__default['default'](this.element).data();
      Object.keys(dataAttributes).forEach(function (dataAttr) {
        if (DISALLOWED_ATTRIBUTES.indexOf(dataAttr) !== -1) {
          delete dataAttributes[dataAttr];
        }
      });
      config = _extends({}, this.constructor.Default, dataAttributes, _typeof(config) === 'object' && config ? config : {});

      if (typeof config.delay === 'number') {
        config.delay = {
          show: config.delay,
          hide: config.delay
        };
      }

      if (typeof config.title === 'number') {
        config.title = config.title.toString();
      }

      if (typeof config.content === 'number') {
        config.content = config.content.toString();
      }

      Util.typeCheckConfig(NAME$6, config, this.constructor.DefaultType);

      if (config.sanitize) {
        config.template = sanitizeHtml(config.template, config.whiteList, config.sanitizeFn);
      }

      return config;
    };

    _proto._getDelegateConfig = function _getDelegateConfig() {
      var config = {};

      if (this.config) {
        for (var key in this.config) {
          if (this.constructor.Default[key] !== this.config[key]) {
            config[key] = this.config[key];
          }
        }
      }

      return config;
    };

    _proto._cleanTipClass = function _cleanTipClass() {
      var $tip = $__default['default'](this.getTipElement());
      var tabClass = $tip.attr('class').match(BSCLS_PREFIX_REGEX);

      if (tabClass !== null && tabClass.length) {
        $tip.removeClass(tabClass.join(''));
      }
    };

    _proto._handlePopperPlacementChange = function _handlePopperPlacementChange(popperData) {
      this.tip = popperData.instance.popper;

      this._cleanTipClass();

      this.addAttachmentClass(this._getAttachment(popperData.placement));
    };

    _proto._fixTransition = function _fixTransition() {
      var tip = this.getTipElement();
      var initConfigAnimation = this.config.animation;

      if (tip.getAttribute('x-placement') !== null) {
        return;
      }

      $__default['default'](tip).removeClass(CLASS_NAME_FADE$2);
      this.config.animation = false;
      this.hide();
      this.show();
      this.config.animation = initConfigAnimation;
    } // Static
    ;

    Tooltip._jQueryInterface = function _jQueryInterface(config) {
      return this.each(function () {
        var $element = $__default['default'](this);
        var data = $element.data(DATA_KEY$6);

        var _config = _typeof(config) === 'object' && config;

        if (!data && /dispose|hide/.test(config)) {
          return;
        }

        if (!data) {
          data = new Tooltip(this, _config);
          $element.data(DATA_KEY$6, data);
        }

        if (typeof config === 'string') {
          if (typeof data[config] === 'undefined') {
            throw new TypeError("No method named \"" + config + "\"");
          }

          data[config]();
        }
      });
    };

    _createClass(Tooltip, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION$6;
      }
    }, {
      key: "Default",
      get: function get() {
        return Default$4;
      }
    }, {
      key: "NAME",
      get: function get() {
        return NAME$6;
      }
    }, {
      key: "DATA_KEY",
      get: function get() {
        return DATA_KEY$6;
      }
    }, {
      key: "Event",
      get: function get() {
        return Event;
      }
    }, {
      key: "EVENT_KEY",
      get: function get() {
        return EVENT_KEY$6;
      }
    }, {
      key: "DefaultType",
      get: function get() {
        return DefaultType$4;
      }
    }]);

    return Tooltip;
  }();
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */


  $__default['default'].fn[NAME$6] = Tooltip._jQueryInterface;
  $__default['default'].fn[NAME$6].Constructor = Tooltip;

  $__default['default'].fn[NAME$6].noConflict = function () {
    $__default['default'].fn[NAME$6] = JQUERY_NO_CONFLICT$6;
    return Tooltip._jQueryInterface;
  };
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$7 = 'popover';
  var VERSION$7 = '4.5.3';
  var DATA_KEY$7 = 'bs.popover';
  var EVENT_KEY$7 = "." + DATA_KEY$7;
  var JQUERY_NO_CONFLICT$7 = $__default['default'].fn[NAME$7];
  var CLASS_PREFIX$1 = 'bs-popover';
  var BSCLS_PREFIX_REGEX$1 = new RegExp("(^|\\s)" + CLASS_PREFIX$1 + "\\S+", 'g');

  var Default$5 = _extends({}, Tooltip.Default, {
    placement: 'right',
    trigger: 'click',
    content: '',
    template: '<div class="popover" role="tooltip">' + '<div class="arrow"></div>' + '<h3 class="popover-header"></h3>' + '<div class="popover-body"></div></div>'
  });

  var DefaultType$5 = _extends({}, Tooltip.DefaultType, {
    content: '(string|element|function)'
  });

  var CLASS_NAME_FADE$3 = 'fade';
  var CLASS_NAME_SHOW$5 = 'show';
  var SELECTOR_TITLE = '.popover-header';
  var SELECTOR_CONTENT = '.popover-body';
  var Event$1 = {
    HIDE: "hide" + EVENT_KEY$7,
    HIDDEN: "hidden" + EVENT_KEY$7,
    SHOW: "show" + EVENT_KEY$7,
    SHOWN: "shown" + EVENT_KEY$7,
    INSERTED: "inserted" + EVENT_KEY$7,
    CLICK: "click" + EVENT_KEY$7,
    FOCUSIN: "focusin" + EVENT_KEY$7,
    FOCUSOUT: "focusout" + EVENT_KEY$7,
    MOUSEENTER: "mouseenter" + EVENT_KEY$7,
    MOUSELEAVE: "mouseleave" + EVENT_KEY$7
  };
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Popover = /*#__PURE__*/function (_Tooltip) {
    _inheritsLoose(Popover, _Tooltip);

    function Popover() {
      return _Tooltip.apply(this, arguments) || this;
    }

    var _proto = Popover.prototype; // Overrides

    _proto.isWithContent = function isWithContent() {
      return this.getTitle() || this._getContent();
    };

    _proto.addAttachmentClass = function addAttachmentClass(attachment) {
      $__default['default'](this.getTipElement()).addClass(CLASS_PREFIX$1 + "-" + attachment);
    };

    _proto.getTipElement = function getTipElement() {
      this.tip = this.tip || $__default['default'](this.config.template)[0];
      return this.tip;
    };

    _proto.setContent = function setContent() {
      var $tip = $__default['default'](this.getTipElement()); // We use append for html objects to maintain js events

      this.setElementContent($tip.find(SELECTOR_TITLE), this.getTitle());

      var content = this._getContent();

      if (typeof content === 'function') {
        content = content.call(this.element);
      }

      this.setElementContent($tip.find(SELECTOR_CONTENT), content);
      $tip.removeClass(CLASS_NAME_FADE$3 + " " + CLASS_NAME_SHOW$5);
    } // Private
    ;

    _proto._getContent = function _getContent() {
      return this.element.getAttribute('data-content') || this.config.content;
    };

    _proto._cleanTipClass = function _cleanTipClass() {
      var $tip = $__default['default'](this.getTipElement());
      var tabClass = $tip.attr('class').match(BSCLS_PREFIX_REGEX$1);

      if (tabClass !== null && tabClass.length > 0) {
        $tip.removeClass(tabClass.join(''));
      }
    } // Static
    ;

    Popover._jQueryInterface = function _jQueryInterface(config) {
      return this.each(function () {
        var data = $__default['default'](this).data(DATA_KEY$7);

        var _config = _typeof(config) === 'object' ? config : null;

        if (!data && /dispose|hide/.test(config)) {
          return;
        }

        if (!data) {
          data = new Popover(this, _config);
          $__default['default'](this).data(DATA_KEY$7, data);
        }

        if (typeof config === 'string') {
          if (typeof data[config] === 'undefined') {
            throw new TypeError("No method named \"" + config + "\"");
          }

          data[config]();
        }
      });
    };

    _createClass(Popover, null, [{
      key: "VERSION",
      // Getters
      get: function get() {
        return VERSION$7;
      }
    }, {
      key: "Default",
      get: function get() {
        return Default$5;
      }
    }, {
      key: "NAME",
      get: function get() {
        return NAME$7;
      }
    }, {
      key: "DATA_KEY",
      get: function get() {
        return DATA_KEY$7;
      }
    }, {
      key: "Event",
      get: function get() {
        return Event$1;
      }
    }, {
      key: "EVENT_KEY",
      get: function get() {
        return EVENT_KEY$7;
      }
    }, {
      key: "DefaultType",
      get: function get() {
        return DefaultType$5;
      }
    }]);

    return Popover;
  }(Tooltip);
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */


  $__default['default'].fn[NAME$7] = Popover._jQueryInterface;
  $__default['default'].fn[NAME$7].Constructor = Popover;

  $__default['default'].fn[NAME$7].noConflict = function () {
    $__default['default'].fn[NAME$7] = JQUERY_NO_CONFLICT$7;
    return Popover._jQueryInterface;
  };
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$8 = 'scrollspy';
  var VERSION$8 = '4.5.3';
  var DATA_KEY$8 = 'bs.scrollspy';
  var EVENT_KEY$8 = "." + DATA_KEY$8;
  var DATA_API_KEY$6 = '.data-api';
  var JQUERY_NO_CONFLICT$8 = $__default['default'].fn[NAME$8];
  var Default$6 = {
    offset: 10,
    method: 'auto',
    target: ''
  };
  var DefaultType$6 = {
    offset: 'number',
    method: 'string',
    target: '(string|element)'
  };
  var EVENT_ACTIVATE = "activate" + EVENT_KEY$8;
  var EVENT_SCROLL = "scroll" + EVENT_KEY$8;
  var EVENT_LOAD_DATA_API$2 = "load" + EVENT_KEY$8 + DATA_API_KEY$6;
  var CLASS_NAME_DROPDOWN_ITEM = 'dropdown-item';
  var CLASS_NAME_ACTIVE$2 = 'active';
  var SELECTOR_DATA_SPY = '[data-spy="scroll"]';
  var SELECTOR_NAV_LIST_GROUP = '.nav, .list-group';
  var SELECTOR_NAV_LINKS = '.nav-link';
  var SELECTOR_NAV_ITEMS = '.nav-item';
  var SELECTOR_LIST_ITEMS = '.list-group-item';
  var SELECTOR_DROPDOWN = '.dropdown';
  var SELECTOR_DROPDOWN_ITEMS = '.dropdown-item';
  var SELECTOR_DROPDOWN_TOGGLE = '.dropdown-toggle';
  var METHOD_OFFSET = 'offset';
  var METHOD_POSITION = 'position';
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var ScrollSpy = /*#__PURE__*/function () {
    function ScrollSpy(element, config) {
      var _this = this;

      this._element = element;
      this._scrollElement = element.tagName === 'BODY' ? window : element;
      this._config = this._getConfig(config);
      this._selector = this._config.target + " " + SELECTOR_NAV_LINKS + "," + (this._config.target + " " + SELECTOR_LIST_ITEMS + ",") + (this._config.target + " " + SELECTOR_DROPDOWN_ITEMS);
      this._offsets = [];
      this._targets = [];
      this._activeTarget = null;
      this._scrollHeight = 0;
      $__default['default'](this._scrollElement).on(EVENT_SCROLL, function (event) {
        return _this._process(event);
      });
      this.refresh();

      this._process();
    } // Getters


    var _proto = ScrollSpy.prototype; // Public

    _proto.refresh = function refresh() {
      var _this2 = this;

      var autoMethod = this._scrollElement === this._scrollElement.window ? METHOD_OFFSET : METHOD_POSITION;
      var offsetMethod = this._config.method === 'auto' ? autoMethod : this._config.method;
      var offsetBase = offsetMethod === METHOD_POSITION ? this._getScrollTop() : 0;
      this._offsets = [];
      this._targets = [];
      this._scrollHeight = this._getScrollHeight();
      var targets = [].slice.call(document.querySelectorAll(this._selector));
      targets.map(function (element) {
        var target;
        var targetSelector = Util.getSelectorFromElement(element);

        if (targetSelector) {
          target = document.querySelector(targetSelector);
        }

        if (target) {
          var targetBCR = target.getBoundingClientRect();

          if (targetBCR.width || targetBCR.height) {
            // TODO (fat): remove sketch reliance on jQuery position/offset
            return [$__default['default'](target)[offsetMethod]().top + offsetBase, targetSelector];
          }
        }

        return null;
      }).filter(function (item) {
        return item;
      }).sort(function (a, b) {
        return a[0] - b[0];
      }).forEach(function (item) {
        _this2._offsets.push(item[0]);

        _this2._targets.push(item[1]);
      });
    };

    _proto.dispose = function dispose() {
      $__default['default'].removeData(this._element, DATA_KEY$8);
      $__default['default'](this._scrollElement).off(EVENT_KEY$8);
      this._element = null;
      this._scrollElement = null;
      this._config = null;
      this._selector = null;
      this._offsets = null;
      this._targets = null;
      this._activeTarget = null;
      this._scrollHeight = null;
    } // Private
    ;

    _proto._getConfig = function _getConfig(config) {
      config = _extends({}, Default$6, _typeof(config) === 'object' && config ? config : {});

      if (typeof config.target !== 'string' && Util.isElement(config.target)) {
        var id = $__default['default'](config.target).attr('id');

        if (!id) {
          id = Util.getUID(NAME$8);
          $__default['default'](config.target).attr('id', id);
        }

        config.target = "#" + id;
      }

      Util.typeCheckConfig(NAME$8, config, DefaultType$6);
      return config;
    };

    _proto._getScrollTop = function _getScrollTop() {
      return this._scrollElement === window ? this._scrollElement.pageYOffset : this._scrollElement.scrollTop;
    };

    _proto._getScrollHeight = function _getScrollHeight() {
      return this._scrollElement.scrollHeight || Math.max(document.body.scrollHeight, document.documentElement.scrollHeight);
    };

    _proto._getOffsetHeight = function _getOffsetHeight() {
      return this._scrollElement === window ? window.innerHeight : this._scrollElement.getBoundingClientRect().height;
    };

    _proto._process = function _process() {
      var scrollTop = this._getScrollTop() + this._config.offset;

      var scrollHeight = this._getScrollHeight();

      var maxScroll = this._config.offset + scrollHeight - this._getOffsetHeight();

      if (this._scrollHeight !== scrollHeight) {
        this.refresh();
      }

      if (scrollTop >= maxScroll) {
        var target = this._targets[this._targets.length - 1];

        if (this._activeTarget !== target) {
          this._activate(target);
        }

        return;
      }

      if (this._activeTarget && scrollTop < this._offsets[0] && this._offsets[0] > 0) {
        this._activeTarget = null;

        this._clear();

        return;
      }

      for (var i = this._offsets.length; i--;) {
        var isActiveTarget = this._activeTarget !== this._targets[i] && scrollTop >= this._offsets[i] && (typeof this._offsets[i + 1] === 'undefined' || scrollTop < this._offsets[i + 1]);

        if (isActiveTarget) {
          this._activate(this._targets[i]);
        }
      }
    };

    _proto._activate = function _activate(target) {
      this._activeTarget = target;

      this._clear();

      var queries = this._selector.split(',').map(function (selector) {
        return selector + "[data-target=\"" + target + "\"]," + selector + "[href=\"" + target + "\"]";
      });

      var $link = $__default['default']([].slice.call(document.querySelectorAll(queries.join(','))));

      if ($link.hasClass(CLASS_NAME_DROPDOWN_ITEM)) {
        $link.closest(SELECTOR_DROPDOWN).find(SELECTOR_DROPDOWN_TOGGLE).addClass(CLASS_NAME_ACTIVE$2);
        $link.addClass(CLASS_NAME_ACTIVE$2);
      } else {
        // Set triggered link as active
        $link.addClass(CLASS_NAME_ACTIVE$2); // Set triggered links parents as active
        // With both <ul> and <nav> markup a parent is the previous sibling of any nav ancestor

        $link.parents(SELECTOR_NAV_LIST_GROUP).prev(SELECTOR_NAV_LINKS + ", " + SELECTOR_LIST_ITEMS).addClass(CLASS_NAME_ACTIVE$2); // Handle special case when .nav-link is inside .nav-item

        $link.parents(SELECTOR_NAV_LIST_GROUP).prev(SELECTOR_NAV_ITEMS).children(SELECTOR_NAV_LINKS).addClass(CLASS_NAME_ACTIVE$2);
      }

      $__default['default'](this._scrollElement).trigger(EVENT_ACTIVATE, {
        relatedTarget: target
      });
    };

    _proto._clear = function _clear() {
      [].slice.call(document.querySelectorAll(this._selector)).filter(function (node) {
        return node.classList.contains(CLASS_NAME_ACTIVE$2);
      }).forEach(function (node) {
        return node.classList.remove(CLASS_NAME_ACTIVE$2);
      });
    } // Static
    ;

    ScrollSpy._jQueryInterface = function _jQueryInterface(config) {
      return this.each(function () {
        var data = $__default['default'](this).data(DATA_KEY$8);

        var _config = _typeof(config) === 'object' && config;

        if (!data) {
          data = new ScrollSpy(this, _config);
          $__default['default'](this).data(DATA_KEY$8, data);
        }

        if (typeof config === 'string') {
          if (typeof data[config] === 'undefined') {
            throw new TypeError("No method named \"" + config + "\"");
          }

          data[config]();
        }
      });
    };

    _createClass(ScrollSpy, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION$8;
      }
    }, {
      key: "Default",
      get: function get() {
        return Default$6;
      }
    }]);

    return ScrollSpy;
  }();
  /**
   * ------------------------------------------------------------------------
   * Data Api implementation
   * ------------------------------------------------------------------------
   */


  $__default['default'](window).on(EVENT_LOAD_DATA_API$2, function () {
    var scrollSpys = [].slice.call(document.querySelectorAll(SELECTOR_DATA_SPY));
    var scrollSpysLength = scrollSpys.length;

    for (var i = scrollSpysLength; i--;) {
      var $spy = $__default['default'](scrollSpys[i]);

      ScrollSpy._jQueryInterface.call($spy, $spy.data());
    }
  });
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */

  $__default['default'].fn[NAME$8] = ScrollSpy._jQueryInterface;
  $__default['default'].fn[NAME$8].Constructor = ScrollSpy;

  $__default['default'].fn[NAME$8].noConflict = function () {
    $__default['default'].fn[NAME$8] = JQUERY_NO_CONFLICT$8;
    return ScrollSpy._jQueryInterface;
  };
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$9 = 'tab';
  var VERSION$9 = '4.5.3';
  var DATA_KEY$9 = 'bs.tab';
  var EVENT_KEY$9 = "." + DATA_KEY$9;
  var DATA_API_KEY$7 = '.data-api';
  var JQUERY_NO_CONFLICT$9 = $__default['default'].fn[NAME$9];
  var EVENT_HIDE$3 = "hide" + EVENT_KEY$9;
  var EVENT_HIDDEN$3 = "hidden" + EVENT_KEY$9;
  var EVENT_SHOW$3 = "show" + EVENT_KEY$9;
  var EVENT_SHOWN$3 = "shown" + EVENT_KEY$9;
  var EVENT_CLICK_DATA_API$6 = "click" + EVENT_KEY$9 + DATA_API_KEY$7;
  var CLASS_NAME_DROPDOWN_MENU = 'dropdown-menu';
  var CLASS_NAME_ACTIVE$3 = 'active';
  var CLASS_NAME_DISABLED$1 = 'disabled';
  var CLASS_NAME_FADE$4 = 'fade';
  var CLASS_NAME_SHOW$6 = 'show';
  var SELECTOR_DROPDOWN$1 = '.dropdown';
  var SELECTOR_NAV_LIST_GROUP$1 = '.nav, .list-group';
  var SELECTOR_ACTIVE$2 = '.active';
  var SELECTOR_ACTIVE_UL = '> li > .active';
  var SELECTOR_DATA_TOGGLE$4 = '[data-toggle="tab"], [data-toggle="pill"], [data-toggle="list"]';
  var SELECTOR_DROPDOWN_TOGGLE$1 = '.dropdown-toggle';
  var SELECTOR_DROPDOWN_ACTIVE_CHILD = '> .dropdown-menu .active';
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Tab = /*#__PURE__*/function () {
    function Tab(element) {
      this._element = element;
    } // Getters


    var _proto = Tab.prototype; // Public

    _proto.show = function show() {
      var _this = this;

      if (this._element.parentNode && this._element.parentNode.nodeType === Node.ELEMENT_NODE && $__default['default'](this._element).hasClass(CLASS_NAME_ACTIVE$3) || $__default['default'](this._element).hasClass(CLASS_NAME_DISABLED$1)) {
        return;
      }

      var target;
      var previous;
      var listElement = $__default['default'](this._element).closest(SELECTOR_NAV_LIST_GROUP$1)[0];
      var selector = Util.getSelectorFromElement(this._element);

      if (listElement) {
        var itemSelector = listElement.nodeName === 'UL' || listElement.nodeName === 'OL' ? SELECTOR_ACTIVE_UL : SELECTOR_ACTIVE$2;
        previous = $__default['default'].makeArray($__default['default'](listElement).find(itemSelector));
        previous = previous[previous.length - 1];
      }

      var hideEvent = $__default['default'].Event(EVENT_HIDE$3, {
        relatedTarget: this._element
      });
      var showEvent = $__default['default'].Event(EVENT_SHOW$3, {
        relatedTarget: previous
      });

      if (previous) {
        $__default['default'](previous).trigger(hideEvent);
      }

      $__default['default'](this._element).trigger(showEvent);

      if (showEvent.isDefaultPrevented() || hideEvent.isDefaultPrevented()) {
        return;
      }

      if (selector) {
        target = document.querySelector(selector);
      }

      this._activate(this._element, listElement);

      var complete = function complete() {
        var hiddenEvent = $__default['default'].Event(EVENT_HIDDEN$3, {
          relatedTarget: _this._element
        });
        var shownEvent = $__default['default'].Event(EVENT_SHOWN$3, {
          relatedTarget: previous
        });
        $__default['default'](previous).trigger(hiddenEvent);
        $__default['default'](_this._element).trigger(shownEvent);
      };

      if (target) {
        this._activate(target, target.parentNode, complete);
      } else {
        complete();
      }
    };

    _proto.dispose = function dispose() {
      $__default['default'].removeData(this._element, DATA_KEY$9);
      this._element = null;
    } // Private
    ;

    _proto._activate = function _activate(element, container, callback) {
      var _this2 = this;

      var activeElements = container && (container.nodeName === 'UL' || container.nodeName === 'OL') ? $__default['default'](container).find(SELECTOR_ACTIVE_UL) : $__default['default'](container).children(SELECTOR_ACTIVE$2);
      var active = activeElements[0];
      var isTransitioning = callback && active && $__default['default'](active).hasClass(CLASS_NAME_FADE$4);

      var complete = function complete() {
        return _this2._transitionComplete(element, active, callback);
      };

      if (active && isTransitioning) {
        var transitionDuration = Util.getTransitionDurationFromElement(active);
        $__default['default'](active).removeClass(CLASS_NAME_SHOW$6).one(Util.TRANSITION_END, complete).emulateTransitionEnd(transitionDuration);
      } else {
        complete();
      }
    };

    _proto._transitionComplete = function _transitionComplete(element, active, callback) {
      if (active) {
        $__default['default'](active).removeClass(CLASS_NAME_ACTIVE$3);
        var dropdownChild = $__default['default'](active.parentNode).find(SELECTOR_DROPDOWN_ACTIVE_CHILD)[0];

        if (dropdownChild) {
          $__default['default'](dropdownChild).removeClass(CLASS_NAME_ACTIVE$3);
        }

        if (active.getAttribute('role') === 'tab') {
          active.setAttribute('aria-selected', false);
        }
      }

      $__default['default'](element).addClass(CLASS_NAME_ACTIVE$3);

      if (element.getAttribute('role') === 'tab') {
        element.setAttribute('aria-selected', true);
      }

      Util.reflow(element);

      if (element.classList.contains(CLASS_NAME_FADE$4)) {
        element.classList.add(CLASS_NAME_SHOW$6);
      }

      if (element.parentNode && $__default['default'](element.parentNode).hasClass(CLASS_NAME_DROPDOWN_MENU)) {
        var dropdownElement = $__default['default'](element).closest(SELECTOR_DROPDOWN$1)[0];

        if (dropdownElement) {
          var dropdownToggleList = [].slice.call(dropdownElement.querySelectorAll(SELECTOR_DROPDOWN_TOGGLE$1));
          $__default['default'](dropdownToggleList).addClass(CLASS_NAME_ACTIVE$3);
        }

        element.setAttribute('aria-expanded', true);
      }

      if (callback) {
        callback();
      }
    } // Static
    ;

    Tab._jQueryInterface = function _jQueryInterface(config) {
      return this.each(function () {
        var $this = $__default['default'](this);
        var data = $this.data(DATA_KEY$9);

        if (!data) {
          data = new Tab(this);
          $this.data(DATA_KEY$9, data);
        }

        if (typeof config === 'string') {
          if (typeof data[config] === 'undefined') {
            throw new TypeError("No method named \"" + config + "\"");
          }

          data[config]();
        }
      });
    };

    _createClass(Tab, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION$9;
      }
    }]);

    return Tab;
  }();
  /**
   * ------------------------------------------------------------------------
   * Data Api implementation
   * ------------------------------------------------------------------------
   */


  $__default['default'](document).on(EVENT_CLICK_DATA_API$6, SELECTOR_DATA_TOGGLE$4, function (event) {
    event.preventDefault();

    Tab._jQueryInterface.call($__default['default'](this), 'show');
  });
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */

  $__default['default'].fn[NAME$9] = Tab._jQueryInterface;
  $__default['default'].fn[NAME$9].Constructor = Tab;

  $__default['default'].fn[NAME$9].noConflict = function () {
    $__default['default'].fn[NAME$9] = JQUERY_NO_CONFLICT$9;
    return Tab._jQueryInterface;
  };
  /**
   * ------------------------------------------------------------------------
   * Constants
   * ------------------------------------------------------------------------
   */


  var NAME$a = 'toast';
  var VERSION$a = '4.5.3';
  var DATA_KEY$a = 'bs.toast';
  var EVENT_KEY$a = "." + DATA_KEY$a;
  var JQUERY_NO_CONFLICT$a = $__default['default'].fn[NAME$a];
  var EVENT_CLICK_DISMISS$1 = "click.dismiss" + EVENT_KEY$a;
  var EVENT_HIDE$4 = "hide" + EVENT_KEY$a;
  var EVENT_HIDDEN$4 = "hidden" + EVENT_KEY$a;
  var EVENT_SHOW$4 = "show" + EVENT_KEY$a;
  var EVENT_SHOWN$4 = "shown" + EVENT_KEY$a;
  var CLASS_NAME_FADE$5 = 'fade';
  var CLASS_NAME_HIDE = 'hide';
  var CLASS_NAME_SHOW$7 = 'show';
  var CLASS_NAME_SHOWING = 'showing';
  var DefaultType$7 = {
    animation: 'boolean',
    autohide: 'boolean',
    delay: 'number'
  };
  var Default$7 = {
    animation: true,
    autohide: true,
    delay: 500
  };
  var SELECTOR_DATA_DISMISS$1 = '[data-dismiss="toast"]';
  /**
   * ------------------------------------------------------------------------
   * Class Definition
   * ------------------------------------------------------------------------
   */

  var Toast = /*#__PURE__*/function () {
    function Toast(element, config) {
      this._element = element;
      this._config = this._getConfig(config);
      this._timeout = null;

      this._setListeners();
    } // Getters


    var _proto = Toast.prototype; // Public

    _proto.show = function show() {
      var _this = this;

      var showEvent = $__default['default'].Event(EVENT_SHOW$4);
      $__default['default'](this._element).trigger(showEvent);

      if (showEvent.isDefaultPrevented()) {
        return;
      }

      this._clearTimeout();

      if (this._config.animation) {
        this._element.classList.add(CLASS_NAME_FADE$5);
      }

      var complete = function complete() {
        _this._element.classList.remove(CLASS_NAME_SHOWING);

        _this._element.classList.add(CLASS_NAME_SHOW$7);

        $__default['default'](_this._element).trigger(EVENT_SHOWN$4);

        if (_this._config.autohide) {
          _this._timeout = setTimeout(function () {
            _this.hide();
          }, _this._config.delay);
        }
      };

      this._element.classList.remove(CLASS_NAME_HIDE);

      Util.reflow(this._element);

      this._element.classList.add(CLASS_NAME_SHOWING);

      if (this._config.animation) {
        var transitionDuration = Util.getTransitionDurationFromElement(this._element);
        $__default['default'](this._element).one(Util.TRANSITION_END, complete).emulateTransitionEnd(transitionDuration);
      } else {
        complete();
      }
    };

    _proto.hide = function hide() {
      if (!this._element.classList.contains(CLASS_NAME_SHOW$7)) {
        return;
      }

      var hideEvent = $__default['default'].Event(EVENT_HIDE$4);
      $__default['default'](this._element).trigger(hideEvent);

      if (hideEvent.isDefaultPrevented()) {
        return;
      }

      this._close();
    };

    _proto.dispose = function dispose() {
      this._clearTimeout();

      if (this._element.classList.contains(CLASS_NAME_SHOW$7)) {
        this._element.classList.remove(CLASS_NAME_SHOW$7);
      }

      $__default['default'](this._element).off(EVENT_CLICK_DISMISS$1);
      $__default['default'].removeData(this._element, DATA_KEY$a);
      this._element = null;
      this._config = null;
    } // Private
    ;

    _proto._getConfig = function _getConfig(config) {
      config = _extends({}, Default$7, $__default['default'](this._element).data(), _typeof(config) === 'object' && config ? config : {});
      Util.typeCheckConfig(NAME$a, config, this.constructor.DefaultType);
      return config;
    };

    _proto._setListeners = function _setListeners() {
      var _this2 = this;

      $__default['default'](this._element).on(EVENT_CLICK_DISMISS$1, SELECTOR_DATA_DISMISS$1, function () {
        return _this2.hide();
      });
    };

    _proto._close = function _close() {
      var _this3 = this;

      var complete = function complete() {
        _this3._element.classList.add(CLASS_NAME_HIDE);

        $__default['default'](_this3._element).trigger(EVENT_HIDDEN$4);
      };

      this._element.classList.remove(CLASS_NAME_SHOW$7);

      if (this._config.animation) {
        var transitionDuration = Util.getTransitionDurationFromElement(this._element);
        $__default['default'](this._element).one(Util.TRANSITION_END, complete).emulateTransitionEnd(transitionDuration);
      } else {
        complete();
      }
    };

    _proto._clearTimeout = function _clearTimeout() {
      clearTimeout(this._timeout);
      this._timeout = null;
    } // Static
    ;

    Toast._jQueryInterface = function _jQueryInterface(config) {
      return this.each(function () {
        var $element = $__default['default'](this);
        var data = $element.data(DATA_KEY$a);

        var _config = _typeof(config) === 'object' && config;

        if (!data) {
          data = new Toast(this, _config);
          $element.data(DATA_KEY$a, data);
        }

        if (typeof config === 'string') {
          if (typeof data[config] === 'undefined') {
            throw new TypeError("No method named \"" + config + "\"");
          }

          data[config](this);
        }
      });
    };

    _createClass(Toast, null, [{
      key: "VERSION",
      get: function get() {
        return VERSION$a;
      }
    }, {
      key: "DefaultType",
      get: function get() {
        return DefaultType$7;
      }
    }, {
      key: "Default",
      get: function get() {
        return Default$7;
      }
    }]);

    return Toast;
  }();
  /**
   * ------------------------------------------------------------------------
   * jQuery
   * ------------------------------------------------------------------------
   */


  $__default['default'].fn[NAME$a] = Toast._jQueryInterface;
  $__default['default'].fn[NAME$a].Constructor = Toast;

  $__default['default'].fn[NAME$a].noConflict = function () {
    $__default['default'].fn[NAME$a] = JQUERY_NO_CONFLICT$a;
    return Toast._jQueryInterface;
  };

  exports.Alert = Alert;
  exports.Button = Button;
  exports.Carousel = Carousel;
  exports.Collapse = Collapse;
  exports.Dropdown = Dropdown;
  exports.Modal = Modal;
  exports.Popover = Popover;
  exports.Scrollspy = ScrollSpy;
  exports.Tab = Tab;
  exports.Toast = Toast;
  exports.Tooltip = Tooltip;
  exports.Util = Util;
  Object.defineProperty(exports, '__esModule', {
    value: true
  });
});

/***/ }),

/***/ "./node_modules/mapbox-gl/dist/mapbox-gl.js":
/*!**************************************************!*\
  !*** ./node_modules/mapbox-gl/dist/mapbox-gl.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(process) {var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _get(target, property, receiver) { if (typeof Reflect !== "undefined" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }

function _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }

function _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest(); }

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && Symbol.iterator in Object(iter)) return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _iterableToArrayLimit(arr, i) { if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === "undefined" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e366) { throw _e366; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e367) { didErr = true; err = _e367; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }

function _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }

function _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

/* Mapbox GL JS is Copyright Â© 2020 Mapbox and subject to the Mapbox Terms of Service ((https://www.mapbox.com/legal/tos/). */
(function (global, factory) {
  ( false ? undefined : _typeof(exports)) === 'object' && typeof module !== 'undefined' ? module.exports = factory() :  true ? !(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : (undefined);
})(this, function () {
  'use strict';
  /* eslint-disable */

  var shared, worker, mapboxgl; // define gets called three times: one for each chunk. we rely on the order
  // they're imported to know which is which

  function define(_, chunk) {
    if (!shared) {
      shared = chunk;
    } else if (!worker) {
      worker = chunk;
    } else {
      var workerBundleString = 'var sharedChunk = {}; (' + shared + ')(sharedChunk); (' + worker + ')(sharedChunk);';
      var sharedChunk = {};
      shared(sharedChunk);
      mapboxgl = chunk(sharedChunk);

      if (typeof window !== 'undefined') {
        mapboxgl.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], {
          type: 'text/javascript'
        }));
      }
    }
  }

  define(["exports"], function (t) {
    "use strict";

    var e = r;

    function r(t, e, r, i) {
      this.cx = 3 * t, this.bx = 3 * (r - t) - this.cx, this.ax = 1 - this.cx - this.bx, this.cy = 3 * e, this.by = 3 * (i - e) - this.cy, this.ay = 1 - this.cy - this.by, this.p1x = t, this.p1y = i, this.p2x = r, this.p2y = i;
    }

    r.prototype.sampleCurveX = function (t) {
      return ((this.ax * t + this.bx) * t + this.cx) * t;
    }, r.prototype.sampleCurveY = function (t) {
      return ((this.ay * t + this.by) * t + this.cy) * t;
    }, r.prototype.sampleCurveDerivativeX = function (t) {
      return (3 * this.ax * t + 2 * this.bx) * t + this.cx;
    }, r.prototype.solveCurveX = function (t, e) {
      var r, i, n, s, a;

      for (void 0 === e && (e = 1e-6), n = t, a = 0; a < 8; a++) {
        if (s = this.sampleCurveX(n) - t, Math.abs(s) < e) return n;
        var o = this.sampleCurveDerivativeX(n);
        if (Math.abs(o) < 1e-6) break;
        n -= s / o;
      }

      if ((n = t) < (r = 0)) return r;
      if (n > (i = 1)) return i;

      for (; r < i;) {
        if (s = this.sampleCurveX(n), Math.abs(s - t) < e) return n;
        t > s ? r = n : i = n, n = .5 * (i - r) + r;
      }

      return n;
    }, r.prototype.solve = function (t, e) {
      return this.sampleCurveY(this.solveCurveX(t, e));
    };
    var i = n;

    function n(t, e) {
      this.x = t, this.y = e;
    }

    n.prototype = {
      clone: function clone() {
        return new n(this.x, this.y);
      },
      add: function add(t) {
        return this.clone()._add(t);
      },
      sub: function sub(t) {
        return this.clone()._sub(t);
      },
      multByPoint: function multByPoint(t) {
        return this.clone()._multByPoint(t);
      },
      divByPoint: function divByPoint(t) {
        return this.clone()._divByPoint(t);
      },
      mult: function mult(t) {
        return this.clone()._mult(t);
      },
      div: function div(t) {
        return this.clone()._div(t);
      },
      rotate: function rotate(t) {
        return this.clone()._rotate(t);
      },
      rotateAround: function rotateAround(t, e) {
        return this.clone()._rotateAround(t, e);
      },
      matMult: function matMult(t) {
        return this.clone()._matMult(t);
      },
      unit: function unit() {
        return this.clone()._unit();
      },
      perp: function perp() {
        return this.clone()._perp();
      },
      round: function round() {
        return this.clone()._round();
      },
      mag: function mag() {
        return Math.sqrt(this.x * this.x + this.y * this.y);
      },
      equals: function equals(t) {
        return this.x === t.x && this.y === t.y;
      },
      dist: function dist(t) {
        return Math.sqrt(this.distSqr(t));
      },
      distSqr: function distSqr(t) {
        var e = t.x - this.x,
            r = t.y - this.y;
        return e * e + r * r;
      },
      angle: function angle() {
        return Math.atan2(this.y, this.x);
      },
      angleTo: function angleTo(t) {
        return Math.atan2(this.y - t.y, this.x - t.x);
      },
      angleWith: function angleWith(t) {
        return this.angleWithSep(t.x, t.y);
      },
      angleWithSep: function angleWithSep(t, e) {
        return Math.atan2(this.x * e - this.y * t, this.x * t + this.y * e);
      },
      _matMult: function _matMult(t) {
        var e = t[2] * this.x + t[3] * this.y;
        return this.x = t[0] * this.x + t[1] * this.y, this.y = e, this;
      },
      _add: function _add(t) {
        return this.x += t.x, this.y += t.y, this;
      },
      _sub: function _sub(t) {
        return this.x -= t.x, this.y -= t.y, this;
      },
      _mult: function _mult(t) {
        return this.x *= t, this.y *= t, this;
      },
      _div: function _div(t) {
        return this.x /= t, this.y /= t, this;
      },
      _multByPoint: function _multByPoint(t) {
        return this.x *= t.x, this.y *= t.y, this;
      },
      _divByPoint: function _divByPoint(t) {
        return this.x /= t.x, this.y /= t.y, this;
      },
      _unit: function _unit() {
        return this._div(this.mag()), this;
      },
      _perp: function _perp() {
        var t = this.y;
        return this.y = this.x, this.x = -t, this;
      },
      _rotate: function _rotate(t) {
        var e = Math.cos(t),
            r = Math.sin(t),
            i = r * this.x + e * this.y;
        return this.x = e * this.x - r * this.y, this.y = i, this;
      },
      _rotateAround: function _rotateAround(t, e) {
        var r = Math.cos(t),
            i = Math.sin(t),
            n = e.y + i * (this.x - e.x) + r * (this.y - e.y);
        return this.x = e.x + r * (this.x - e.x) - i * (this.y - e.y), this.y = n, this;
      },
      _round: function _round() {
        return this.x = Math.round(this.x), this.y = Math.round(this.y), this;
      }
    }, n.convert = function (t) {
      return t instanceof n ? t : Array.isArray(t) ? new n(t[0], t[1]) : t;
    };
    var s = "undefined" != typeof self ? self : {};

    function a(t, e) {
      if (Array.isArray(t)) {
        if (!Array.isArray(e) || t.length !== e.length) return !1;

        for (var _r2 = 0; _r2 < t.length; _r2++) {
          if (!a(t[_r2], e[_r2])) return !1;
        }

        return !0;
      }

      if ("object" == _typeof(t) && null !== t && null !== e) {
        if ("object" != _typeof(e)) return !1;
        if (Object.keys(t).length !== Object.keys(e).length) return !1;

        for (var _r3 in t) {
          if (!a(t[_r3], e[_r3])) return !1;
        }

        return !0;
      }

      return t === e;
    }

    var o = Math.pow(2, 53) - 1,
        l = Math.PI / 180,
        u = 180 / Math.PI;

    function c(t) {
      return t * l;
    }

    function h(t) {
      if (t <= 0) return 0;
      if (t >= 1) return 1;
      var e = t * t,
          r = e * t;
      return 4 * (t < .5 ? r : 3 * (t - e) + r - .75);
    }

    function p(t, r, i, n) {
      var s = new e(t, r, i, n);
      return function (t) {
        return s.solve(t);
      };
    }

    var d = p(.25, .1, .25, 1);

    function f(t, e, r) {
      return Math.min(r, Math.max(e, t));
    }

    function y(t, e, r) {
      var i = r - e,
          n = ((t - e) % i + i) % i + e;
      return n === e ? r : n;
    }

    function m(t) {
      var e = [];

      for (var _r4 in t) {
        e.push(t[_r4]);
      }

      return e;
    }

    function g(t) {
      for (var _len = arguments.length, e = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        e[_key - 1] = arguments[_key];
      }

      for (var _i2 = 0, _e2 = e; _i2 < _e2.length; _i2++) {
        var _r5 = _e2[_i2];

        for (var _e3 in _r5) {
          t[_e3] = _r5[_e3];
        }
      }

      return t;
    }

    var x = 1;

    function v() {
      return x++;
    }

    function b() {
      return function t(e) {
        return e ? (e ^ 16 * Math.random() >> e / 4).toString(16) : ([1e7] + -[1e3] + -4e3 + -8e3 + -1e11).replace(/[018]/g, t);
      }();
    }

    function w(t) {
      return !!t && /^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t);
    }

    function _(t, e) {
      t.forEach(function (t) {
        e[t] && (e[t] = e[t].bind(e));
      });
    }

    function A(t, e) {
      return -1 !== t.indexOf(e, t.length - e.length);
    }

    function k(t, e, r) {
      var i = {};

      for (var _n2 in t) {
        i[_n2] = e.call(r || this, t[_n2], _n2, t);
      }

      return i;
    }

    function S(t, e, r) {
      var i = {};

      for (var _n3 in t) {
        e.call(r || this, t[_n3], _n3, t) && (i[_n3] = t[_n3]);
      }

      return i;
    }

    function I(t) {
      return Array.isArray(t) ? t.map(I) : "object" == _typeof(t) && t ? k(t, I) : t;
    }

    var T = {};

    function z(t) {
      T[t] || ("undefined" != typeof console && console.warn(t), T[t] = !0);
    }

    function E(t, e, r) {
      return (r.y - t.y) * (e.x - t.x) > (e.y - t.y) * (r.x - t.x);
    }

    function C(t) {
      var e = 0;

      for (var _r6, _i3, _n4 = 0, _s2 = t.length, _a2 = _s2 - 1; _n4 < _s2; _a2 = _n4++) {
        _r6 = t[_n4], _i3 = t[_a2], e += (_i3.x - _r6.x) * (_r6.y + _i3.y);
      }

      return e;
    }

    function M() {
      return "undefined" != typeof WorkerGlobalScope && "undefined" != typeof self && self instanceof WorkerGlobalScope;
    }

    function B(t) {
      var e = {};

      if (t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g, function (t, r, i, n) {
        var s = i || n;
        return e[r] = !s || s.toLowerCase(), "";
      }), e["max-age"]) {
        var _t2 = parseInt(e["max-age"], 10);

        isNaN(_t2) ? delete e["max-age"] : e["max-age"] = _t2;
      }

      return e;
    }

    var D,
        P,
        V = null;

    function F(t) {
      if (null == V) {
        var _e4 = t.navigator ? t.navigator.userAgent : null;

        V = !!t.safari || !(!_e4 || !(/\b(iPad|iPhone|iPod)\b/.test(_e4) || _e4.match("Safari") && !_e4.match("Chrome")));
      }

      return V;
    }

    function R(t) {
      try {
        var _e5 = s[t];
        return _e5.setItem("_mapbox_test_", 1), _e5.removeItem("_mapbox_test_"), !0;
      } catch (t) {
        return !1;
      }
    }

    var L,
        U = !1;
    var O = {
      now: function now() {
        return void 0 !== L ? L : s.performance.now();
      },
      setErrorState: function setErrorState() {
        U = !0;
      },
      setNow: function setNow(t) {
        L = t;
      },
      restoreNow: function restoreNow() {
        L = void 0;
      },
      frame: function frame(t) {
        if (U) return {
          cancel: function cancel() {}
        };
        var e = s.requestAnimationFrame(t);
        return {
          cancel: function cancel() {
            return s.cancelAnimationFrame(e);
          }
        };
      },
      getImageData: function getImageData(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var r = s.document.createElement("canvas"),
            i = r.getContext("2d");
        if (!i) throw new Error("failed to create canvas 2d context");
        return r.width = t.width, r.height = t.height, i.drawImage(t, 0, 0, t.width, t.height), i.getImageData(-e, -e, t.width + 2 * e, t.height + 2 * e);
      },
      resolveURL: function resolveURL(t) {
        return D || (D = s.document.createElement("a")), D.href = t, D.href;
      },

      get devicePixelRatio() {
        return s.devicePixelRatio;
      },

      get prefersReducedMotion() {
        return !!s.matchMedia && (null == P && (P = s.matchMedia("(prefers-reduced-motion: reduce)")), P.matches);
      }

    };
    var $;
    var q = {
      API_URL: "https://api.mapbox.com",

      get API_URL_REGEX() {
        if (null == $) {
          var _t3 = /^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;

          try {
            $ = null != process.env.API_URL_REGEX ? new RegExp(process.env.API_URL_REGEX) : _t3;
          } catch (e) {
            $ = _t3;
          }
        }

        return $;
      },

      get EVENTS_URL() {
        return this.API_URL ? 0 === this.API_URL.indexOf("https://api.mapbox.cn") ? "https://events.mapbox.cn/events/v2" : 0 === this.API_URL.indexOf("https://api.mapbox.com") ? "https://events.mapbox.com/events/v2" : null : null;
      },

      SESSION_PATH: "/map-sessions/v1",
      FEEDBACK_URL: "https://apps.mapbox.com/feedback",
      TILE_URL_VERSION: "v4",
      RASTER_URL_PREFIX: "raster/v1",
      REQUIRE_ACCESS_TOKEN: !0,
      ACCESS_TOKEN: null,
      MAX_PARALLEL_IMAGE_REQUESTS: 16
    },
        N = {
      supported: !1,
      testSupport: function testSupport(t) {
        !Z && K && (X ? G(t) : j = t);
      }
    };
    var j,
        K,
        Z = !1,
        X = !1;

    function G(t) {
      var e = t.createTexture();
      t.bindTexture(t.TEXTURE_2D, e);

      try {
        if (t.texImage2D(t.TEXTURE_2D, 0, t.RGBA, t.RGBA, t.UNSIGNED_BYTE, K), t.isContextLost()) return;
        N.supported = !0;
      } catch (t) {}

      t.deleteTexture(e), Z = !0;
    }

    s.document && (K = s.document.createElement("img"), K.onload = function () {
      j && G(j), j = null, X = !0;
    }, K.onerror = function () {
      Z = !0, j = null;
    }, K.src = "data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");
    var H = "01";

    function J(t) {
      return 0 === t.indexOf("mapbox:");
    }

    function Y(t) {
      return q.API_URL_REGEX.test(t);
    }

    var W = /^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;

    function Q(t) {
      var e = t.match(W);
      if (!e) throw new Error("Unable to parse URL object");
      return {
        protocol: e[1],
        authority: e[2],
        path: e[3] || "/",
        params: e[4] ? e[4].split("&") : []
      };
    }

    function tt(t) {
      var e = t.params.length ? "?".concat(t.params.join("&")) : "";
      return "".concat(t.protocol, "://").concat(t.authority).concat(t.path).concat(e);
    }

    function et(t) {
      if (!t) return null;
      var e = t.split(".");
      if (!e || 3 !== e.length) return null;

      try {
        return JSON.parse(decodeURIComponent(s.atob(e[1]).split("").map(function (t) {
          return "%" + ("00" + t.charCodeAt(0).toString(16)).slice(-2);
        }).join("")));
      } catch (t) {
        return null;
      }
    }

    var rt = /*#__PURE__*/function () {
      function rt(t) {
        _classCallCheck(this, rt);

        this.type = t, this.anonId = null, this.eventData = {}, this.queue = [], this.pendingRequest = null;
      }

      _createClass(rt, [{
        key: "getStorageKey",
        value: function getStorageKey(t) {
          var e = et(q.ACCESS_TOKEN);
          var r = "";
          return r = e && e.u ? s.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g, function (t, e) {
            return String.fromCharCode(Number("0x" + e));
          })) : q.ACCESS_TOKEN || "", t ? "mapbox.eventData.".concat(t, ":").concat(r) : "mapbox.eventData:".concat(r);
        }
      }, {
        key: "fetchEventData",
        value: function fetchEventData() {
          var t = R("localStorage"),
              e = this.getStorageKey(),
              r = this.getStorageKey("uuid");
          if (t) try {
            var _t4 = s.localStorage.getItem(e);

            _t4 && (this.eventData = JSON.parse(_t4));

            var _i4 = s.localStorage.getItem(r);

            _i4 && (this.anonId = _i4);
          } catch (t) {
            z("Unable to read from LocalStorage");
          }
        }
      }, {
        key: "saveEventData",
        value: function saveEventData() {
          var t = R("localStorage"),
              e = this.getStorageKey(),
              r = this.getStorageKey("uuid");
          if (t) try {
            s.localStorage.setItem(r, this.anonId), Object.keys(this.eventData).length >= 1 && s.localStorage.setItem(e, JSON.stringify(this.eventData));
          } catch (t) {
            z("Unable to write to LocalStorage");
          }
        }
      }, {
        key: "processRequests",
        value: function processRequests(t) {}
      }, {
        key: "postEvent",
        value: function postEvent(t, e, r, i) {
          var _this = this;

          if (!q.EVENTS_URL) return;
          var n = Q(q.EVENTS_URL);
          n.params.push("access_token=".concat(i || q.ACCESS_TOKEN || ""));
          var s = {
            event: this.type,
            created: new Date(t).toISOString(),
            sdkIdentifier: "mapbox-gl-js",
            sdkVersion: "2.0.1",
            skuId: H,
            userId: this.anonId
          },
              a = e ? g(s, e) : s,
              o = {
            url: tt(n),
            headers: {
              "Content-Type": "text/plain"
            },
            body: JSON.stringify([a])
          };
          this.pendingRequest = At(o, function (t) {
            _this.pendingRequest = null, r(t), _this.saveEventData(), _this.processRequests(i);
          });
        }
      }, {
        key: "queueRequest",
        value: function queueRequest(t, e) {
          this.queue.push(t), this.processRequests(e);
        }
      }]);

      return rt;
    }();

    var it = new ( /*#__PURE__*/function (_rt) {
      _inherits(_class, _rt);

      var _super = _createSuper(_class);

      function _class(t) {
        var _this2;

        _classCallCheck(this, _class);

        _this2 = _super.call(this, "appUserTurnstile"), _this2._customAccessToken = t;
        return _this2;
      }

      _createClass(_class, [{
        key: "postTurnstileEvent",
        value: function postTurnstileEvent(t, e) {
          q.EVENTS_URL && q.ACCESS_TOKEN && Array.isArray(t) && t.some(function (t) {
            return J(t) || Y(t);
          }) && this.queueRequest(Date.now(), e);
        }
      }, {
        key: "processRequests",
        value: function processRequests(t) {
          var _this3 = this;

          if (this.pendingRequest || 0 === this.queue.length) return;
          this.anonId && this.eventData.lastSuccess && this.eventData.tokenU || this.fetchEventData();
          var e = et(q.ACCESS_TOKEN),
              r = e ? e.u : q.ACCESS_TOKEN;
          var i = r !== this.eventData.tokenU;
          w(this.anonId) || (this.anonId = b(), i = !0);
          var n = this.queue.shift();

          if (this.eventData.lastSuccess) {
            var _t5 = new Date(this.eventData.lastSuccess),
                _e6 = new Date(n),
                _r7 = (n - this.eventData.lastSuccess) / 864e5;

            i = i || _r7 >= 1 || _r7 < -1 || _t5.getDate() !== _e6.getDate();
          } else i = !0;

          if (!i) return this.processRequests();
          this.postEvent(n, {
            "enabled.telemetry": !1
          }, function (t) {
            t || (_this3.eventData.lastSuccess = n, _this3.eventData.tokenU = r);
          }, t);
        }
      }]);

      return _class;
    }(rt))(),
        nt = it.postTurnstileEvent.bind(it),
        st = new ( /*#__PURE__*/function (_rt2) {
      _inherits(_class2, _rt2);

      var _super2 = _createSuper(_class2);

      function _class2() {
        var _this4;

        _classCallCheck(this, _class2);

        _this4 = _super2.call(this, "map.load"), _this4.success = {}, _this4.skuToken = "";
        return _this4;
      }

      _createClass(_class2, [{
        key: "postMapLoadEvent",
        value: function postMapLoadEvent(t, e, r, i) {
          this.skuToken = e, this.errorCb = i, q.EVENTS_URL && (r || q.ACCESS_TOKEN ? this.queueRequest({
            id: t,
            timestamp: Date.now()
          }, r) : this.errorCb(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")));
        }
      }, {
        key: "processRequests",
        value: function processRequests(t) {
          var _this5 = this;

          if (this.pendingRequest || 0 === this.queue.length) return;

          var _this$queue$shift = this.queue.shift(),
              e = _this$queue$shift.id,
              r = _this$queue$shift.timestamp;

          e && this.success[e] || (this.anonId || this.fetchEventData(), w(this.anonId) || (this.anonId = b()), this.postEvent(r, {
            skuToken: this.skuToken
          }, function (t) {
            t ? _this5.errorCb(t) : e && (_this5.success[e] = !0);
          }, t));
        }
      }]);

      return _class2;
    }(rt))(),
        at = st.postMapLoadEvent.bind(st),
        ot = new ( /*#__PURE__*/function (_rt3) {
      _inherits(_class3, _rt3);

      var _super3 = _createSuper(_class3);

      function _class3() {
        var _this6;

        _classCallCheck(this, _class3);

        _this6 = _super3.call(this, "map.auth"), _this6.success = {}, _this6.skuToken = "";
        return _this6;
      }

      _createClass(_class3, [{
        key: "getSession",
        value: function getSession(t, e, r, i) {
          var _this7 = this;

          if (!q.API_URL || !q.SESSION_PATH) return;
          var n = Q(q.API_URL + q.SESSION_PATH);
          n.params.push("sku=".concat(e || "")), n.params.push("access_token=".concat(i || q.ACCESS_TOKEN || ""));
          var s = {
            url: tt(n),
            headers: {
              "Content-Type": "text/plain"
            }
          };
          this.pendingRequest = kt(s, function (t) {
            _this7.pendingRequest = null, r(t), _this7.saveEventData(), _this7.processRequests(i);
          });
        }
      }, {
        key: "getSessionAPI",
        value: function getSessionAPI(t, e, r, i) {
          this.skuToken = e, this.errorCb = i, q.SESSION_PATH && q.API_URL && (r || q.ACCESS_TOKEN ? this.queueRequest({
            id: t,
            timestamp: Date.now()
          }, r) : this.errorCb(new Error("NO_ACCESS_TOKEN")));
        }
      }, {
        key: "processRequests",
        value: function processRequests(t) {
          var _this8 = this;

          if (this.pendingRequest || 0 === this.queue.length) return;

          var _this$queue$shift2 = this.queue.shift(),
              e = _this$queue$shift2.id,
              r = _this$queue$shift2.timestamp;

          e && this.success[e] || this.getSession(r, this.skuToken, function (t) {
            t ? _this8.errorCb(t) : e && (_this8.success[e] = !0);
          }, t);
        }
      }]);

      return _class3;
    }(rt))(),
        lt = ot.getSessionAPI.bind(ot);
    var ut,
        ct,
        ht = 500,
        pt = 50;

    function dt() {
      s.caches && !ut && (ut = s.caches.open("mapbox-tiles"));
    }

    function ft(t) {
      var e = t.indexOf("?");
      return e < 0 ? t : t.slice(0, e);
    }

    var yt,
        mt = 1 / 0;

    function gt() {
      return null == yt && (yt = s.OffscreenCanvas && new s.OffscreenCanvas(1, 1).getContext("2d") && "function" == typeof s.createImageBitmap), yt;
    }

    var xt = {
      Unknown: "Unknown",
      Style: "Style",
      Source: "Source",
      Tile: "Tile",
      Glyphs: "Glyphs",
      SpriteImage: "SpriteImage",
      SpriteJSON: "SpriteJSON",
      Image: "Image"
    };
    "function" == typeof Object.freeze && Object.freeze(xt);

    var vt = /*#__PURE__*/function (_Error) {
      _inherits(vt, _Error);

      var _super4 = _createSuper(vt);

      function vt(t, e, r) {
        var _this9;

        _classCallCheck(this, vt);

        401 === e && Y(r) && (t += ": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"), _this9 = _super4.call(this, t), _this9.status = e, _this9.url = r;
        return _this9;
      }

      _createClass(vt, [{
        key: "toString",
        value: function toString() {
          return "".concat(this.name, ": ").concat(this.message, " (").concat(this.status, "): ").concat(this.url);
        }
      }]);

      return vt;
    }( /*#__PURE__*/_wrapNativeSuper(Error));

    var bt = M() ? function () {
      return self.worker && self.worker.referrer;
    } : function () {
      return ("blob:" === s.location.protocol ? s.parent : s).location.href;
    };

    var wt = function wt(t, e) {
      if (!(/^file:/.test(r = t.url) || /^file:/.test(bt()) && !/^\w+:/.test(r))) {
        if (s.fetch && s.Request && s.AbortController && s.Request.prototype.hasOwnProperty("signal")) return function (t, e) {
          var r = new s.AbortController(),
              i = new s.Request(t.url, {
            method: t.method || "GET",
            body: t.body,
            credentials: t.credentials,
            headers: t.headers,
            referrer: bt(),
            signal: r.signal
          });
          var n = !1,
              a = !1;
          var o = (l = i.url).indexOf("sku=") > 0 && Y(l);
          var l;
          "json" === t.type && i.headers.set("Accept", "application/json");

          var u = function u(r, n, l) {
            if (a) return;
            if (r && "SecurityError" !== r.message && z(r), n && l) return c(n);
            var u = Date.now();
            s.fetch(i).then(function (r) {
              if (r.ok) {
                var _t6 = o ? r.clone() : null;

                return c(r, _t6, u);
              }

              return e(new vt(r.statusText, r.status, t.url));
            })["catch"](function (t) {
              20 !== t.code && e(new Error(t.message));
            });
          },
              c = function c(r, o, l) {
            ("arrayBuffer" === t.type ? r.arrayBuffer() : "json" === t.type ? r.json() : r.text()).then(function (t) {
              a || (o && l && function (t, e, r) {
                if (dt(), !ut) return;
                var i = {
                  status: e.status,
                  statusText: e.statusText,
                  headers: new s.Headers()
                };
                e.headers.forEach(function (t, e) {
                  return i.headers.set(e, t);
                });
                var n = B(e.headers.get("Cache-Control") || "");
                n["no-store"] || (n["max-age"] && i.headers.set("Expires", new Date(r + 1e3 * n["max-age"]).toUTCString()), new Date(i.headers.get("Expires")).getTime() - r < 42e4 || function (t, e) {
                  if (void 0 === ct) try {
                    new Response(new ReadableStream()), ct = !0;
                  } catch (t) {
                    ct = !1;
                  }
                  ct ? e(t.body) : t.blob().then(e);
                }(e, function (e) {
                  var r = new s.Response(e, i);
                  dt(), ut && ut.then(function (e) {
                    return e.put(ft(t.url), r);
                  })["catch"](function (t) {
                    return z(t.message);
                  });
                }));
              }(i, o, l), n = !0, e(null, t, r.headers.get("Cache-Control"), r.headers.get("Expires")));
            })["catch"](function (t) {
              a || e(new Error(t.message));
            });
          };

          return o ? function (t, e) {
            if (dt(), !ut) return e(null);
            var r = ft(t.url);
            ut.then(function (t) {
              t.match(r).then(function (i) {
                var n = function (t) {
                  if (!t) return !1;
                  var e = new Date(t.headers.get("Expires") || 0),
                      r = B(t.headers.get("Cache-Control") || "");
                  return e > Date.now() && !r["no-cache"];
                }(i);

                t["delete"](r), n && t.put(r, i.clone()), e(null, i, n);
              })["catch"](e);
            })["catch"](e);
          }(i, u) : u(null, null), {
            cancel: function cancel() {
              a = !0, n || r.abort();
            }
          };
        }(t, e);
        if (M() && self.worker && self.worker.actor) return self.worker.actor.send("getResource", t, e, void 0, !0);
      }

      var r;
      return function (t, e) {
        var r = new s.XMLHttpRequest();
        r.open(t.method || "GET", t.url, !0), "arrayBuffer" === t.type && (r.responseType = "arraybuffer");

        for (var _e7 in t.headers) {
          r.setRequestHeader(_e7, t.headers[_e7]);
        }

        return "json" === t.type && (r.responseType = "text", r.setRequestHeader("Accept", "application/json")), r.withCredentials = "include" === t.credentials, r.onerror = function () {
          e(new Error(r.statusText));
        }, r.onload = function () {
          if ((r.status >= 200 && r.status < 300 || 0 === r.status) && null !== r.response) {
            var _i5 = r.response;
            if ("json" === t.type) try {
              _i5 = JSON.parse(r.response);
            } catch (t) {
              return e(t);
            }
            e(null, _i5, r.getResponseHeader("Cache-Control"), r.getResponseHeader("Expires"));
          } else e(new vt(r.statusText, r.status, t.url));
        }, r.send(t.body), {
          cancel: function cancel() {
            return r.abort();
          }
        };
      }(t, e);
    },
        _t = function _t(t, e) {
      return wt(g(t, {
        type: "arrayBuffer"
      }), e);
    },
        At = function At(t, e) {
      return wt(g(t, {
        method: "POST"
      }), e);
    },
        kt = function kt(t, e) {
      return wt(g(t, {
        method: "GET"
      }), e);
    };

    function St(t) {
      var e = s.document.createElement("a");
      return e.href = t, e.protocol === s.document.location.protocol && e.host === s.document.location.host;
    }

    var It = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";
    var Tt, zt;
    Tt = [], zt = 0;

    var Et = function Et(t, e) {
      if (N.supported && (t.headers || (t.headers = {}), t.headers.accept = "image/webp,*/*"), zt >= q.MAX_PARALLEL_IMAGE_REQUESTS) {
        var _r8 = {
          requestParameters: t,
          callback: e,
          cancelled: !1,
          cancel: function cancel() {
            this.cancelled = !0;
          }
        };
        return Tt.push(_r8), _r8;
      }

      zt++;
      var r = !1;

      var i = function i() {
        if (!r) for (r = !0, zt--; Tt.length && zt < q.MAX_PARALLEL_IMAGE_REQUESTS;) {
          var _t7 = Tt.shift(),
              _e8 = _t7.requestParameters,
              _r9 = _t7.callback,
              _i6 = _t7.cancelled;

          _i6 || (_t7.cancel = Et(_e8, _r9).cancel);
        }
      },
          n = _t(t, function (t, r, n, a) {
        i(), t ? e(t) : r && (gt() ? function (t, e) {
          var r = new s.Blob([new Uint8Array(t)], {
            type: "image/png"
          });
          s.createImageBitmap(r).then(function (t) {
            e(null, t);
          })["catch"](function (t) {
            e(new Error("Could not load image because of ".concat(t.message, ". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")));
          });
        }(r, e) : function (t, e, r, i) {
          var n = new s.Image(),
              a = s.URL;
          n.onload = function () {
            e(null, n), a.revokeObjectURL(n.src), n.onload = null, s.requestAnimationFrame(function () {
              n.src = It;
            });
          }, n.onerror = function () {
            return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));
          };
          var o = new s.Blob([new Uint8Array(t)], {
            type: "image/png"
          });
          n.cacheControl = r, n.expires = i, n.src = t.byteLength ? a.createObjectURL(o) : It;
        }(r, e, n, a));
      });

      return {
        cancel: function cancel() {
          n.cancel(), i();
        }
      };
    };

    function Ct(t, e, r) {
      r[t] && -1 !== r[t].indexOf(e) || (r[t] = r[t] || [], r[t].push(e));
    }

    function Mt(t, e, r) {
      if (r && r[t]) {
        var _i7 = r[t].indexOf(e);

        -1 !== _i7 && r[t].splice(_i7, 1);
      }
    }

    var Bt = function Bt(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

      _classCallCheck(this, Bt);

      g(this, e), this.type = t;
    };

    var Dt = /*#__PURE__*/function (_Bt) {
      _inherits(Dt, _Bt);

      var _super5 = _createSuper(Dt);

      function Dt(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

        _classCallCheck(this, Dt);

        return _super5.call(this, "error", g({
          error: t
        }, e));
      }

      return Dt;
    }(Bt);

    var Pt = /*#__PURE__*/function () {
      function Pt() {
        _classCallCheck(this, Pt);
      }

      _createClass(Pt, [{
        key: "on",
        value: function on(t, e) {
          return this._listeners = this._listeners || {}, Ct(t, e, this._listeners), this;
        }
      }, {
        key: "off",
        value: function off(t, e) {
          return Mt(t, e, this._listeners), Mt(t, e, this._oneTimeListeners), this;
        }
      }, {
        key: "once",
        value: function once(t, e) {
          return this._oneTimeListeners = this._oneTimeListeners || {}, Ct(t, e, this._oneTimeListeners), this;
        }
      }, {
        key: "fire",
        value: function fire(t, e) {
          "string" == typeof t && (t = new Bt(t, e || {}));
          var r = t.type;

          if (this.listens(r)) {
            t.target = this;

            var _e9 = this._listeners && this._listeners[r] ? this._listeners[r].slice() : [];

            var _iterator = _createForOfIteratorHelper(_e9),
                _step;

            try {
              for (_iterator.s(); !(_step = _iterator.n()).done;) {
                var _r10 = _step.value;

                _r10.call(this, t);
              }
            } catch (err) {
              _iterator.e(err);
            } finally {
              _iterator.f();
            }

            var _i8 = this._oneTimeListeners && this._oneTimeListeners[r] ? this._oneTimeListeners[r].slice() : [];

            var _iterator2 = _createForOfIteratorHelper(_i8),
                _step2;

            try {
              for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
                var _e10 = _step2.value;
                Mt(r, _e10, this._oneTimeListeners), _e10.call(this, t);
              }
            } catch (err) {
              _iterator2.e(err);
            } finally {
              _iterator2.f();
            }

            var _n5 = this._eventedParent;
            _n5 && (g(t, "function" == typeof this._eventedParentData ? this._eventedParentData() : this._eventedParentData), _n5.fire(t));
          } else t instanceof Dt && console.error(t.error);

          return this;
        }
      }, {
        key: "listens",
        value: function listens(t) {
          return this._listeners && this._listeners[t] && this._listeners[t].length > 0 || this._oneTimeListeners && this._oneTimeListeners[t] && this._oneTimeListeners[t].length > 0 || this._eventedParent && this._eventedParent.listens(t);
        }
      }, {
        key: "setEventedParent",
        value: function setEventedParent(t, e) {
          return this._eventedParent = t, this._eventedParentData = e, this;
        }
      }]);

      return Pt;
    }();

    var Vt = {
      $version: 8,
      $root: {
        version: {
          required: !0,
          type: "enum",
          values: [8]
        },
        name: {
          type: "string"
        },
        metadata: {
          type: "*"
        },
        center: {
          type: "array",
          value: "number"
        },
        zoom: {
          type: "number"
        },
        bearing: {
          type: "number",
          "default": 0,
          period: 360,
          units: "degrees"
        },
        pitch: {
          type: "number",
          "default": 0,
          units: "degrees"
        },
        light: {
          type: "light"
        },
        terrain: {
          type: "terrain"
        },
        sources: {
          required: !0,
          type: "sources"
        },
        sprite: {
          type: "string"
        },
        glyphs: {
          type: "string"
        },
        transition: {
          type: "transition"
        },
        layers: {
          required: !0,
          type: "array",
          value: "layer"
        }
      },
      sources: {
        "*": {
          type: "source"
        }
      },
      source: ["source_vector", "source_raster", "source_raster_dem", "source_geojson", "source_video", "source_image"],
      source_vector: {
        type: {
          required: !0,
          type: "enum",
          values: {
            vector: {}
          }
        },
        url: {
          type: "string"
        },
        tiles: {
          type: "array",
          value: "string"
        },
        bounds: {
          type: "array",
          value: "number",
          length: 4,
          "default": [-180, -85.051129, 180, 85.051129]
        },
        scheme: {
          type: "enum",
          values: {
            xyz: {},
            tms: {}
          },
          "default": "xyz"
        },
        minzoom: {
          type: "number",
          "default": 0
        },
        maxzoom: {
          type: "number",
          "default": 22
        },
        attribution: {
          type: "string"
        },
        promoteId: {
          type: "promoteId"
        },
        "volatile": {
          type: "boolean",
          "default": !1
        },
        "*": {
          type: "*"
        }
      },
      source_raster: {
        type: {
          required: !0,
          type: "enum",
          values: {
            raster: {}
          }
        },
        url: {
          type: "string"
        },
        tiles: {
          type: "array",
          value: "string"
        },
        bounds: {
          type: "array",
          value: "number",
          length: 4,
          "default": [-180, -85.051129, 180, 85.051129]
        },
        minzoom: {
          type: "number",
          "default": 0
        },
        maxzoom: {
          type: "number",
          "default": 22
        },
        tileSize: {
          type: "number",
          "default": 512,
          units: "pixels"
        },
        scheme: {
          type: "enum",
          values: {
            xyz: {},
            tms: {}
          },
          "default": "xyz"
        },
        attribution: {
          type: "string"
        },
        "volatile": {
          type: "boolean",
          "default": !1
        },
        "*": {
          type: "*"
        }
      },
      source_raster_dem: {
        type: {
          required: !0,
          type: "enum",
          values: {
            "raster-dem": {}
          }
        },
        url: {
          type: "string"
        },
        tiles: {
          type: "array",
          value: "string"
        },
        bounds: {
          type: "array",
          value: "number",
          length: 4,
          "default": [-180, -85.051129, 180, 85.051129]
        },
        minzoom: {
          type: "number",
          "default": 0
        },
        maxzoom: {
          type: "number",
          "default": 22
        },
        tileSize: {
          type: "number",
          "default": 512,
          units: "pixels"
        },
        attribution: {
          type: "string"
        },
        encoding: {
          type: "enum",
          values: {
            terrarium: {},
            mapbox: {}
          },
          "default": "mapbox"
        },
        "volatile": {
          type: "boolean",
          "default": !1
        },
        "*": {
          type: "*"
        }
      },
      source_geojson: {
        type: {
          required: !0,
          type: "enum",
          values: {
            geojson: {}
          }
        },
        data: {
          type: "*"
        },
        maxzoom: {
          type: "number",
          "default": 18
        },
        attribution: {
          type: "string"
        },
        buffer: {
          type: "number",
          "default": 128,
          maximum: 512,
          minimum: 0
        },
        filter: {
          type: "*"
        },
        tolerance: {
          type: "number",
          "default": .375
        },
        cluster: {
          type: "boolean",
          "default": !1
        },
        clusterRadius: {
          type: "number",
          "default": 50,
          minimum: 0
        },
        clusterMaxZoom: {
          type: "number"
        },
        clusterMinPoints: {
          type: "number"
        },
        clusterProperties: {
          type: "*"
        },
        lineMetrics: {
          type: "boolean",
          "default": !1
        },
        generateId: {
          type: "boolean",
          "default": !1
        },
        promoteId: {
          type: "promoteId"
        }
      },
      source_video: {
        type: {
          required: !0,
          type: "enum",
          values: {
            video: {}
          }
        },
        urls: {
          required: !0,
          type: "array",
          value: "string"
        },
        coordinates: {
          required: !0,
          type: "array",
          length: 4,
          value: {
            type: "array",
            length: 2,
            value: "number"
          }
        }
      },
      source_image: {
        type: {
          required: !0,
          type: "enum",
          values: {
            image: {}
          }
        },
        url: {
          required: !0,
          type: "string"
        },
        coordinates: {
          required: !0,
          type: "array",
          length: 4,
          value: {
            type: "array",
            length: 2,
            value: "number"
          }
        }
      },
      layer: {
        id: {
          type: "string",
          required: !0
        },
        type: {
          type: "enum",
          values: {
            fill: {},
            line: {},
            symbol: {},
            circle: {},
            heatmap: {},
            "fill-extrusion": {},
            raster: {},
            hillshade: {},
            background: {},
            sky: {}
          },
          required: !0
        },
        metadata: {
          type: "*"
        },
        source: {
          type: "string"
        },
        "source-layer": {
          type: "string"
        },
        minzoom: {
          type: "number",
          minimum: 0,
          maximum: 24
        },
        maxzoom: {
          type: "number",
          minimum: 0,
          maximum: 24
        },
        filter: {
          type: "filter"
        },
        layout: {
          type: "layout"
        },
        paint: {
          type: "paint"
        }
      },
      layout: ["layout_fill", "layout_line", "layout_circle", "layout_heatmap", "layout_fill-extrusion", "layout_symbol", "layout_raster", "layout_hillshade", "layout_background", "layout_sky"],
      layout_background: {
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      layout_sky: {
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      layout_fill: {
        "fill-sort-key": {
          type: "number",
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      layout_circle: {
        "circle-sort-key": {
          type: "number",
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      layout_heatmap: {
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      "layout_fill-extrusion": {
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      layout_line: {
        "line-cap": {
          type: "enum",
          values: {
            butt: {},
            round: {},
            square: {}
          },
          "default": "butt",
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "line-join": {
          type: "enum",
          values: {
            bevel: {},
            round: {},
            miter: {}
          },
          "default": "miter",
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "line-miter-limit": {
          type: "number",
          "default": 2,
          requires: [{
            "line-join": "miter"
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "line-round-limit": {
          type: "number",
          "default": 1.05,
          requires: [{
            "line-join": "round"
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "line-sort-key": {
          type: "number",
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      layout_symbol: {
        "symbol-placement": {
          type: "enum",
          values: {
            point: {},
            line: {},
            "line-center": {}
          },
          "default": "point",
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "symbol-spacing": {
          type: "number",
          "default": 250,
          minimum: 1,
          units: "pixels",
          requires: [{
            "symbol-placement": "line"
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "symbol-avoid-edges": {
          type: "boolean",
          "default": !1,
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "symbol-sort-key": {
          type: "number",
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "symbol-z-order": {
          type: "enum",
          values: {
            auto: {},
            "viewport-y": {},
            source: {}
          },
          "default": "auto",
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-allow-overlap": {
          type: "boolean",
          "default": !1,
          requires: ["icon-image"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-ignore-placement": {
          type: "boolean",
          "default": !1,
          requires: ["icon-image"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-optional": {
          type: "boolean",
          "default": !1,
          requires: ["icon-image", "text-field"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-rotation-alignment": {
          type: "enum",
          values: {
            map: {},
            viewport: {},
            auto: {}
          },
          "default": "auto",
          requires: ["icon-image"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-size": {
          type: "number",
          "default": 1,
          minimum: 0,
          units: "factor of the original icon size",
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "icon-text-fit": {
          type: "enum",
          values: {
            none: {},
            width: {},
            height: {},
            both: {}
          },
          "default": "none",
          requires: ["icon-image", "text-field"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-text-fit-padding": {
          type: "array",
          value: "number",
          length: 4,
          "default": [0, 0, 0, 0],
          units: "pixels",
          requires: ["icon-image", "text-field", {
            "icon-text-fit": ["both", "width", "height"]
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-image": {
          type: "resolvedImage",
          tokens: !0,
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "icon-rotate": {
          type: "number",
          "default": 0,
          period: 360,
          units: "degrees",
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "icon-padding": {
          type: "number",
          "default": 2,
          minimum: 0,
          units: "pixels",
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-keep-upright": {
          type: "boolean",
          "default": !1,
          requires: ["icon-image", {
            "icon-rotation-alignment": "map"
          }, {
            "symbol-placement": ["line", "line-center"]
          }],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-offset": {
          type: "array",
          value: "number",
          length: 2,
          "default": [0, 0],
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "icon-anchor": {
          type: "enum",
          values: {
            center: {},
            left: {},
            right: {},
            top: {},
            bottom: {},
            "top-left": {},
            "top-right": {},
            "bottom-left": {},
            "bottom-right": {}
          },
          "default": "center",
          requires: ["icon-image"],
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "icon-pitch-alignment": {
          type: "enum",
          values: {
            map: {},
            viewport: {},
            auto: {}
          },
          "default": "auto",
          requires: ["icon-image"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-pitch-alignment": {
          type: "enum",
          values: {
            map: {},
            viewport: {},
            auto: {}
          },
          "default": "auto",
          requires: ["text-field"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-rotation-alignment": {
          type: "enum",
          values: {
            map: {},
            viewport: {},
            auto: {}
          },
          "default": "auto",
          requires: ["text-field"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-field": {
          type: "formatted",
          "default": "",
          tokens: !0,
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-font": {
          type: "array",
          value: "string",
          "default": ["Open Sans Regular", "Arial Unicode MS Regular"],
          requires: ["text-field"],
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-size": {
          type: "number",
          "default": 16,
          minimum: 0,
          units: "pixels",
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-max-width": {
          type: "number",
          "default": 10,
          minimum: 0,
          units: "ems",
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-line-height": {
          type: "number",
          "default": 1.2,
          units: "ems",
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-letter-spacing": {
          type: "number",
          "default": 0,
          units: "ems",
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-justify": {
          type: "enum",
          values: {
            auto: {},
            left: {},
            center: {},
            right: {}
          },
          "default": "center",
          requires: ["text-field"],
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-radial-offset": {
          type: "number",
          units: "ems",
          "default": 0,
          requires: ["text-field"],
          "property-type": "data-driven",
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature"]
          }
        },
        "text-variable-anchor": {
          type: "array",
          value: "enum",
          values: {
            center: {},
            left: {},
            right: {},
            top: {},
            bottom: {},
            "top-left": {},
            "top-right": {},
            "bottom-left": {},
            "bottom-right": {}
          },
          requires: ["text-field", {
            "symbol-placement": ["point"]
          }],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-anchor": {
          type: "enum",
          values: {
            center: {},
            left: {},
            right: {},
            top: {},
            bottom: {},
            "top-left": {},
            "top-right": {},
            "bottom-left": {},
            "bottom-right": {}
          },
          "default": "center",
          requires: ["text-field", {
            "!": "text-variable-anchor"
          }],
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-max-angle": {
          type: "number",
          "default": 45,
          units: "degrees",
          requires: ["text-field", {
            "symbol-placement": ["line", "line-center"]
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-writing-mode": {
          type: "array",
          value: "enum",
          values: {
            horizontal: {},
            vertical: {}
          },
          requires: ["text-field", {
            "symbol-placement": ["point"]
          }],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-rotate": {
          type: "number",
          "default": 0,
          period: 360,
          units: "degrees",
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-padding": {
          type: "number",
          "default": 2,
          minimum: 0,
          units: "pixels",
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-keep-upright": {
          type: "boolean",
          "default": !0,
          requires: ["text-field", {
            "text-rotation-alignment": "map"
          }, {
            "symbol-placement": ["line", "line-center"]
          }],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-transform": {
          type: "enum",
          values: {
            none: {},
            uppercase: {},
            lowercase: {}
          },
          "default": "none",
          requires: ["text-field"],
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-offset": {
          type: "array",
          value: "number",
          units: "ems",
          length: 2,
          "default": [0, 0],
          requires: ["text-field", {
            "!": "text-radial-offset"
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature"]
          },
          "property-type": "data-driven"
        },
        "text-allow-overlap": {
          type: "boolean",
          "default": !1,
          requires: ["text-field"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-ignore-placement": {
          type: "boolean",
          "default": !1,
          requires: ["text-field"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-optional": {
          type: "boolean",
          "default": !1,
          requires: ["text-field", "icon-image"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      layout_raster: {
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      layout_hillshade: {
        visibility: {
          type: "enum",
          values: {
            visible: {},
            none: {}
          },
          "default": "visible",
          "property-type": "constant"
        }
      },
      filter: {
        type: "array",
        value: "*"
      },
      filter_operator: {
        type: "enum",
        values: {
          "==": {},
          "!=": {},
          ">": {},
          ">=": {},
          "<": {},
          "<=": {},
          "in": {},
          "!in": {},
          all: {},
          any: {},
          none: {},
          has: {},
          "!has": {},
          within: {}
        }
      },
      geometry_type: {
        type: "enum",
        values: {
          Point: {},
          LineString: {},
          Polygon: {}
        }
      },
      "function": {
        expression: {
          type: "expression"
        },
        stops: {
          type: "array",
          value: "function_stop"
        },
        base: {
          type: "number",
          "default": 1,
          minimum: 0
        },
        property: {
          type: "string",
          "default": "$zoom"
        },
        type: {
          type: "enum",
          values: {
            identity: {},
            exponential: {},
            interval: {},
            categorical: {}
          },
          "default": "exponential"
        },
        colorSpace: {
          type: "enum",
          values: {
            rgb: {},
            lab: {},
            hcl: {}
          },
          "default": "rgb"
        },
        "default": {
          type: "*",
          required: !1
        }
      },
      function_stop: {
        type: "array",
        minimum: 0,
        maximum: 24,
        value: ["number", "color"],
        length: 2
      },
      expression: {
        type: "array",
        value: "*",
        minimum: 1
      },
      light: {
        anchor: {
          type: "enum",
          "default": "viewport",
          values: {
            map: {},
            viewport: {}
          },
          "property-type": "data-constant",
          transition: !1,
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          }
        },
        position: {
          type: "array",
          "default": [1.15, 210, 30],
          length: 3,
          value: "number",
          "property-type": "data-constant",
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          }
        },
        color: {
          type: "color",
          "property-type": "data-constant",
          "default": "#ffffff",
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          transition: !0
        },
        intensity: {
          type: "number",
          "property-type": "data-constant",
          "default": .5,
          minimum: 0,
          maximum: 1,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          transition: !0
        }
      },
      terrain: {
        source: {
          type: "string",
          required: !0
        },
        exaggeration: {
          type: "number",
          "property-type": "data-constant",
          "default": 1,
          minimum: 0,
          maximum: 1e3,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          transition: !0
        }
      },
      paint: ["paint_fill", "paint_line", "paint_circle", "paint_heatmap", "paint_fill-extrusion", "paint_symbol", "paint_raster", "paint_hillshade", "paint_background", "paint_sky"],
      paint_fill: {
        "fill-antialias": {
          type: "boolean",
          "default": !0,
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "fill-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "fill-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          requires: [{
            "!": "fill-pattern"
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "fill-outline-color": {
          type: "color",
          transition: !0,
          requires: [{
            "!": "fill-pattern"
          }, {
            "fill-antialias": !0
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "fill-translate": {
          type: "array",
          value: "number",
          length: 2,
          "default": [0, 0],
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "fill-translate-anchor": {
          type: "enum",
          values: {
            map: {},
            viewport: {}
          },
          "default": "map",
          requires: ["fill-translate"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "fill-pattern": {
          type: "resolvedImage",
          transition: !0,
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "cross-faded-data-driven"
        }
      },
      "paint_fill-extrusion": {
        "fill-extrusion-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "fill-extrusion-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          requires: [{
            "!": "fill-extrusion-pattern"
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "fill-extrusion-translate": {
          type: "array",
          value: "number",
          length: 2,
          "default": [0, 0],
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "fill-extrusion-translate-anchor": {
          type: "enum",
          values: {
            map: {},
            viewport: {}
          },
          "default": "map",
          requires: ["fill-extrusion-translate"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "fill-extrusion-pattern": {
          type: "resolvedImage",
          transition: !0,
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "cross-faded-data-driven"
        },
        "fill-extrusion-height": {
          type: "number",
          "default": 0,
          minimum: 0,
          units: "meters",
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "fill-extrusion-base": {
          type: "number",
          "default": 0,
          minimum: 0,
          units: "meters",
          transition: !0,
          requires: ["fill-extrusion-height"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "fill-extrusion-vertical-gradient": {
          type: "boolean",
          "default": !0,
          transition: !1,
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        }
      },
      paint_line: {
        "line-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "line-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          requires: [{
            "!": "line-pattern"
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "line-translate": {
          type: "array",
          value: "number",
          length: 2,
          "default": [0, 0],
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "line-translate-anchor": {
          type: "enum",
          values: {
            map: {},
            viewport: {}
          },
          "default": "map",
          requires: ["line-translate"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "line-width": {
          type: "number",
          "default": 1,
          minimum: 0,
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "line-gap-width": {
          type: "number",
          "default": 0,
          minimum: 0,
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "line-offset": {
          type: "number",
          "default": 0,
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "line-blur": {
          type: "number",
          "default": 0,
          minimum: 0,
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "line-dasharray": {
          type: "array",
          value: "number",
          minimum: 0,
          transition: !0,
          units: "line widths",
          requires: [{
            "!": "line-pattern"
          }],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "cross-faded"
        },
        "line-pattern": {
          type: "resolvedImage",
          transition: !0,
          expression: {
            interpolated: !1,
            parameters: ["zoom", "feature"]
          },
          "property-type": "cross-faded-data-driven"
        },
        "line-gradient": {
          type: "color",
          transition: !1,
          requires: [{
            "!": "line-dasharray"
          }, {
            "!": "line-pattern"
          }, {
            source: "geojson",
            has: {
              lineMetrics: !0
            }
          }],
          expression: {
            interpolated: !0,
            parameters: ["line-progress"]
          },
          "property-type": "color-ramp"
        }
      },
      paint_circle: {
        "circle-radius": {
          type: "number",
          "default": 5,
          minimum: 0,
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "circle-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "circle-blur": {
          type: "number",
          "default": 0,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "circle-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "circle-translate": {
          type: "array",
          value: "number",
          length: 2,
          "default": [0, 0],
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "circle-translate-anchor": {
          type: "enum",
          values: {
            map: {},
            viewport: {}
          },
          "default": "map",
          requires: ["circle-translate"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "circle-pitch-scale": {
          type: "enum",
          values: {
            map: {},
            viewport: {}
          },
          "default": "map",
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "circle-pitch-alignment": {
          type: "enum",
          values: {
            map: {},
            viewport: {}
          },
          "default": "viewport",
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "circle-stroke-width": {
          type: "number",
          "default": 0,
          minimum: 0,
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "circle-stroke-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "circle-stroke-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        }
      },
      paint_heatmap: {
        "heatmap-radius": {
          type: "number",
          "default": 30,
          minimum: 1,
          transition: !0,
          units: "pixels",
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "heatmap-weight": {
          type: "number",
          "default": 1,
          minimum: 0,
          transition: !1,
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "heatmap-intensity": {
          type: "number",
          "default": 1,
          minimum: 0,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "heatmap-color": {
          type: "color",
          "default": ["interpolate", ["linear"], ["heatmap-density"], 0, "rgba(0, 0, 255, 0)", .1, "royalblue", .3, "cyan", .5, "lime", .7, "yellow", 1, "red"],
          transition: !1,
          expression: {
            interpolated: !0,
            parameters: ["heatmap-density"]
          },
          "property-type": "color-ramp"
        },
        "heatmap-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        }
      },
      paint_symbol: {
        "icon-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "icon-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "icon-halo-color": {
          type: "color",
          "default": "rgba(0, 0, 0, 0)",
          transition: !0,
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "icon-halo-width": {
          type: "number",
          "default": 0,
          minimum: 0,
          transition: !0,
          units: "pixels",
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "icon-halo-blur": {
          type: "number",
          "default": 0,
          minimum: 0,
          transition: !0,
          units: "pixels",
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "icon-translate": {
          type: "array",
          value: "number",
          length: 2,
          "default": [0, 0],
          transition: !0,
          units: "pixels",
          requires: ["icon-image"],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "icon-translate-anchor": {
          type: "enum",
          values: {
            map: {},
            viewport: {}
          },
          "default": "map",
          requires: ["icon-image", "icon-translate"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "text-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          overridable: !0,
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "text-halo-color": {
          type: "color",
          "default": "rgba(0, 0, 0, 0)",
          transition: !0,
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "text-halo-width": {
          type: "number",
          "default": 0,
          minimum: 0,
          transition: !0,
          units: "pixels",
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "text-halo-blur": {
          type: "number",
          "default": 0,
          minimum: 0,
          transition: !0,
          units: "pixels",
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom", "feature", "feature-state"]
          },
          "property-type": "data-driven"
        },
        "text-translate": {
          type: "array",
          value: "number",
          length: 2,
          "default": [0, 0],
          transition: !0,
          units: "pixels",
          requires: ["text-field"],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "text-translate-anchor": {
          type: "enum",
          values: {
            map: {},
            viewport: {}
          },
          "default": "map",
          requires: ["text-field", "text-translate"],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        }
      },
      paint_raster: {
        "raster-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "raster-hue-rotate": {
          type: "number",
          "default": 0,
          period: 360,
          transition: !0,
          units: "degrees",
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "raster-brightness-min": {
          type: "number",
          "default": 0,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "raster-brightness-max": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "raster-saturation": {
          type: "number",
          "default": 0,
          minimum: -1,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "raster-contrast": {
          type: "number",
          "default": 0,
          minimum: -1,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "raster-resampling": {
          type: "enum",
          values: {
            linear: {},
            nearest: {}
          },
          "default": "linear",
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "raster-fade-duration": {
          type: "number",
          "default": 300,
          minimum: 0,
          transition: !1,
          units: "milliseconds",
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        }
      },
      paint_hillshade: {
        "hillshade-illumination-direction": {
          type: "number",
          "default": 335,
          minimum: 0,
          maximum: 359,
          transition: !1,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "hillshade-illumination-anchor": {
          type: "enum",
          values: {
            map: {},
            viewport: {}
          },
          "default": "viewport",
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "hillshade-exaggeration": {
          type: "number",
          "default": .5,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "hillshade-shadow-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "hillshade-highlight-color": {
          type: "color",
          "default": "#FFFFFF",
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "hillshade-accent-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        }
      },
      paint_background: {
        "background-color": {
          type: "color",
          "default": "#000000",
          transition: !0,
          requires: [{
            "!": "background-pattern"
          }],
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "background-pattern": {
          type: "resolvedImage",
          transition: !0,
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "cross-faded"
        },
        "background-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        }
      },
      paint_sky: {
        "sky-type": {
          type: "enum",
          values: {
            gradient: {},
            atmosphere: {}
          },
          "default": "atmosphere",
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "sky-atmosphere-sun": {
          type: "array",
          value: "number",
          length: 2,
          transition: !1,
          requires: [{
            "sky-type": "atmosphere"
          }],
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "sky-atmosphere-sun-intensity": {
          type: "number",
          requires: [{
            "sky-type": "atmosphere"
          }],
          "default": 10,
          minimum: 0,
          maximum: 100,
          transition: !1,
          "property-type": "data-constant"
        },
        "sky-gradient-center": {
          type: "array",
          requires: [{
            "sky-type": "gradient"
          }],
          value: "number",
          "default": [0, 0],
          length: 2,
          transition: !1,
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "sky-gradient-radius": {
          type: "number",
          requires: [{
            "sky-type": "gradient"
          }],
          "default": 90,
          minimum: 0,
          maximum: 180,
          transition: !1,
          expression: {
            interpolated: !1,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        },
        "sky-gradient": {
          type: "color",
          "default": ["interpolate", ["linear"], ["sky-radial-progress"], .8, "#87ceeb", 1, "white"],
          transition: !1,
          requires: [{
            "sky-type": "gradient"
          }],
          expression: {
            interpolated: !0,
            parameters: ["sky-radial-progress"]
          },
          "property-type": "color-ramp"
        },
        "sky-atmosphere-halo-color": {
          type: "color",
          "default": "white",
          transition: !1,
          requires: [{
            "sky-type": "atmosphere"
          }],
          "property-type": "data-constant"
        },
        "sky-atmosphere-color": {
          type: "color",
          "default": "white",
          transition: !1,
          requires: [{
            "sky-type": "atmosphere"
          }],
          "property-type": "data-constant"
        },
        "sky-opacity": {
          type: "number",
          "default": 1,
          minimum: 0,
          maximum: 1,
          transition: !0,
          expression: {
            interpolated: !0,
            parameters: ["zoom"]
          },
          "property-type": "data-constant"
        }
      },
      transition: {
        duration: {
          type: "number",
          "default": 300,
          minimum: 0,
          units: "milliseconds"
        },
        delay: {
          type: "number",
          "default": 0,
          minimum: 0,
          units: "milliseconds"
        }
      },
      "property-type": {
        "data-driven": {
          type: "property-type"
        },
        "cross-faded": {
          type: "property-type"
        },
        "cross-faded-data-driven": {
          type: "property-type"
        },
        "color-ramp": {
          type: "property-type"
        },
        "data-constant": {
          type: "property-type"
        },
        constant: {
          type: "property-type"
        }
      },
      promoteId: {
        "*": {
          type: "string"
        }
      }
    };

    var Ft = function Ft(t, e, r, i) {
      _classCallCheck(this, Ft);

      this.message = (t ? "".concat(t, ": ") : "") + r, i && (this.identifier = i), null != e && e.__line__ && (this.line = e.__line__);
    };

    function Rt(t) {
      var e = t.value;
      return e ? [new Ft(t.key, e, "constants have been deprecated as of v8")] : [];
    }

    function Lt(t) {
      for (var _len2 = arguments.length, e = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
        e[_key2 - 1] = arguments[_key2];
      }

      for (var _i9 = 0, _e11 = e; _i9 < _e11.length; _i9++) {
        var _r11 = _e11[_i9];

        for (var _e12 in _r11) {
          t[_e12] = _r11[_e12];
        }
      }

      return t;
    }

    function Ut(t) {
      return t instanceof Number || t instanceof String || t instanceof Boolean ? t.valueOf() : t;
    }

    function Ot(t) {
      if (Array.isArray(t)) return t.map(Ot);

      if (t instanceof Object && !(t instanceof Number || t instanceof String || t instanceof Boolean)) {
        var _e13 = {};

        for (var _r12 in t) {
          _e13[_r12] = Ot(t[_r12]);
        }

        return _e13;
      }

      return Ut(t);
    }

    var $t = /*#__PURE__*/function (_Error2) {
      _inherits($t, _Error2);

      var _super6 = _createSuper($t);

      function $t(t, e) {
        var _this10;

        _classCallCheck(this, $t);

        _this10 = _super6.call(this, e), _this10.message = e, _this10.key = t;
        return _this10;
      }

      return $t;
    }( /*#__PURE__*/_wrapNativeSuper(Error));

    var qt = /*#__PURE__*/function () {
      function qt(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

        _classCallCheck(this, qt);

        this.parent = t, this.bindings = {};

        var _iterator3 = _createForOfIteratorHelper(e),
            _step3;

        try {
          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
            var _ref3 = _step3.value;

            var _ref2 = _slicedToArray(_ref3, 2);

            var _t8 = _ref2[0];
            var _r13 = _ref2[1];
            this.bindings[_t8] = _r13;
          }
        } catch (err) {
          _iterator3.e(err);
        } finally {
          _iterator3.f();
        }
      }

      _createClass(qt, [{
        key: "concat",
        value: function concat(t) {
          return new qt(this, t);
        }
      }, {
        key: "get",
        value: function get(t) {
          if (this.bindings[t]) return this.bindings[t];
          if (this.parent) return this.parent.get(t);
          throw new Error("".concat(t, " not found in scope."));
        }
      }, {
        key: "has",
        value: function has(t) {
          return !!this.bindings[t] || !!this.parent && this.parent.has(t);
        }
      }]);

      return qt;
    }();

    var Nt = {
      kind: "null"
    },
        jt = {
      kind: "number"
    },
        Kt = {
      kind: "string"
    },
        Zt = {
      kind: "boolean"
    },
        Xt = {
      kind: "color"
    },
        Gt = {
      kind: "object"
    },
        Ht = {
      kind: "value"
    },
        Jt = {
      kind: "collator"
    },
        Yt = {
      kind: "formatted"
    },
        Wt = {
      kind: "resolvedImage"
    };

    function Qt(t, e) {
      return {
        kind: "array",
        itemType: t,
        N: e
      };
    }

    function te(t) {
      if ("array" === t.kind) {
        var _e14 = te(t.itemType);

        return "number" == typeof t.N ? "array<".concat(_e14, ", ").concat(t.N, ">") : "value" === t.itemType.kind ? "array" : "array<".concat(_e14, ">");
      }

      return t.kind;
    }

    var ee = [Nt, jt, Kt, Zt, Xt, Yt, Gt, Qt(Ht), Wt];

    function re(t, e) {
      if ("error" === e.kind) return null;

      if ("array" === t.kind) {
        if ("array" === e.kind && (0 === e.N && "value" === e.itemType.kind || !re(t.itemType, e.itemType)) && ("number" != typeof t.N || t.N === e.N)) return null;
      } else {
        if (t.kind === e.kind) return null;

        if ("value" === t.kind) {
          var _iterator4 = _createForOfIteratorHelper(ee),
              _step4;

          try {
            for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
              var _t9 = _step4.value;
              if (!re(_t9, e)) return null;
            }
          } catch (err) {
            _iterator4.e(err);
          } finally {
            _iterator4.f();
          }
        }
      }

      return "Expected ".concat(te(t), " but found ").concat(te(e), " instead.");
    }

    function ie(t, e) {
      return e.some(function (e) {
        return e.kind === t.kind;
      });
    }

    function ne(t, e) {
      return e.some(function (e) {
        return "null" === e ? null === t : "array" === e ? Array.isArray(t) : "object" === e ? t && !Array.isArray(t) && "object" == _typeof(t) : e === _typeof(t);
      });
    }

    function se(t, e) {
      return t(e = {
        exports: {}
      }, e.exports), e.exports;
    }

    var ae = se(function (t, e) {
      var r = {
        transparent: [0, 0, 0, 0],
        aliceblue: [240, 248, 255, 1],
        antiquewhite: [250, 235, 215, 1],
        aqua: [0, 255, 255, 1],
        aquamarine: [127, 255, 212, 1],
        azure: [240, 255, 255, 1],
        beige: [245, 245, 220, 1],
        bisque: [255, 228, 196, 1],
        black: [0, 0, 0, 1],
        blanchedalmond: [255, 235, 205, 1],
        blue: [0, 0, 255, 1],
        blueviolet: [138, 43, 226, 1],
        brown: [165, 42, 42, 1],
        burlywood: [222, 184, 135, 1],
        cadetblue: [95, 158, 160, 1],
        chartreuse: [127, 255, 0, 1],
        chocolate: [210, 105, 30, 1],
        coral: [255, 127, 80, 1],
        cornflowerblue: [100, 149, 237, 1],
        cornsilk: [255, 248, 220, 1],
        crimson: [220, 20, 60, 1],
        cyan: [0, 255, 255, 1],
        darkblue: [0, 0, 139, 1],
        darkcyan: [0, 139, 139, 1],
        darkgoldenrod: [184, 134, 11, 1],
        darkgray: [169, 169, 169, 1],
        darkgreen: [0, 100, 0, 1],
        darkgrey: [169, 169, 169, 1],
        darkkhaki: [189, 183, 107, 1],
        darkmagenta: [139, 0, 139, 1],
        darkolivegreen: [85, 107, 47, 1],
        darkorange: [255, 140, 0, 1],
        darkorchid: [153, 50, 204, 1],
        darkred: [139, 0, 0, 1],
        darksalmon: [233, 150, 122, 1],
        darkseagreen: [143, 188, 143, 1],
        darkslateblue: [72, 61, 139, 1],
        darkslategray: [47, 79, 79, 1],
        darkslategrey: [47, 79, 79, 1],
        darkturquoise: [0, 206, 209, 1],
        darkviolet: [148, 0, 211, 1],
        deeppink: [255, 20, 147, 1],
        deepskyblue: [0, 191, 255, 1],
        dimgray: [105, 105, 105, 1],
        dimgrey: [105, 105, 105, 1],
        dodgerblue: [30, 144, 255, 1],
        firebrick: [178, 34, 34, 1],
        floralwhite: [255, 250, 240, 1],
        forestgreen: [34, 139, 34, 1],
        fuchsia: [255, 0, 255, 1],
        gainsboro: [220, 220, 220, 1],
        ghostwhite: [248, 248, 255, 1],
        gold: [255, 215, 0, 1],
        goldenrod: [218, 165, 32, 1],
        gray: [128, 128, 128, 1],
        green: [0, 128, 0, 1],
        greenyellow: [173, 255, 47, 1],
        grey: [128, 128, 128, 1],
        honeydew: [240, 255, 240, 1],
        hotpink: [255, 105, 180, 1],
        indianred: [205, 92, 92, 1],
        indigo: [75, 0, 130, 1],
        ivory: [255, 255, 240, 1],
        khaki: [240, 230, 140, 1],
        lavender: [230, 230, 250, 1],
        lavenderblush: [255, 240, 245, 1],
        lawngreen: [124, 252, 0, 1],
        lemonchiffon: [255, 250, 205, 1],
        lightblue: [173, 216, 230, 1],
        lightcoral: [240, 128, 128, 1],
        lightcyan: [224, 255, 255, 1],
        lightgoldenrodyellow: [250, 250, 210, 1],
        lightgray: [211, 211, 211, 1],
        lightgreen: [144, 238, 144, 1],
        lightgrey: [211, 211, 211, 1],
        lightpink: [255, 182, 193, 1],
        lightsalmon: [255, 160, 122, 1],
        lightseagreen: [32, 178, 170, 1],
        lightskyblue: [135, 206, 250, 1],
        lightslategray: [119, 136, 153, 1],
        lightslategrey: [119, 136, 153, 1],
        lightsteelblue: [176, 196, 222, 1],
        lightyellow: [255, 255, 224, 1],
        lime: [0, 255, 0, 1],
        limegreen: [50, 205, 50, 1],
        linen: [250, 240, 230, 1],
        magenta: [255, 0, 255, 1],
        maroon: [128, 0, 0, 1],
        mediumaquamarine: [102, 205, 170, 1],
        mediumblue: [0, 0, 205, 1],
        mediumorchid: [186, 85, 211, 1],
        mediumpurple: [147, 112, 219, 1],
        mediumseagreen: [60, 179, 113, 1],
        mediumslateblue: [123, 104, 238, 1],
        mediumspringgreen: [0, 250, 154, 1],
        mediumturquoise: [72, 209, 204, 1],
        mediumvioletred: [199, 21, 133, 1],
        midnightblue: [25, 25, 112, 1],
        mintcream: [245, 255, 250, 1],
        mistyrose: [255, 228, 225, 1],
        moccasin: [255, 228, 181, 1],
        navajowhite: [255, 222, 173, 1],
        navy: [0, 0, 128, 1],
        oldlace: [253, 245, 230, 1],
        olive: [128, 128, 0, 1],
        olivedrab: [107, 142, 35, 1],
        orange: [255, 165, 0, 1],
        orangered: [255, 69, 0, 1],
        orchid: [218, 112, 214, 1],
        palegoldenrod: [238, 232, 170, 1],
        palegreen: [152, 251, 152, 1],
        paleturquoise: [175, 238, 238, 1],
        palevioletred: [219, 112, 147, 1],
        papayawhip: [255, 239, 213, 1],
        peachpuff: [255, 218, 185, 1],
        peru: [205, 133, 63, 1],
        pink: [255, 192, 203, 1],
        plum: [221, 160, 221, 1],
        powderblue: [176, 224, 230, 1],
        purple: [128, 0, 128, 1],
        rebeccapurple: [102, 51, 153, 1],
        red: [255, 0, 0, 1],
        rosybrown: [188, 143, 143, 1],
        royalblue: [65, 105, 225, 1],
        saddlebrown: [139, 69, 19, 1],
        salmon: [250, 128, 114, 1],
        sandybrown: [244, 164, 96, 1],
        seagreen: [46, 139, 87, 1],
        seashell: [255, 245, 238, 1],
        sienna: [160, 82, 45, 1],
        silver: [192, 192, 192, 1],
        skyblue: [135, 206, 235, 1],
        slateblue: [106, 90, 205, 1],
        slategray: [112, 128, 144, 1],
        slategrey: [112, 128, 144, 1],
        snow: [255, 250, 250, 1],
        springgreen: [0, 255, 127, 1],
        steelblue: [70, 130, 180, 1],
        tan: [210, 180, 140, 1],
        teal: [0, 128, 128, 1],
        thistle: [216, 191, 216, 1],
        tomato: [255, 99, 71, 1],
        turquoise: [64, 224, 208, 1],
        violet: [238, 130, 238, 1],
        wheat: [245, 222, 179, 1],
        white: [255, 255, 255, 1],
        whitesmoke: [245, 245, 245, 1],
        yellow: [255, 255, 0, 1],
        yellowgreen: [154, 205, 50, 1]
      };

      function i(t) {
        return (t = Math.round(t)) < 0 ? 0 : t > 255 ? 255 : t;
      }

      function n(t) {
        return i("%" === t[t.length - 1] ? parseFloat(t) / 100 * 255 : parseInt(t));
      }

      function s(t) {
        return (e = "%" === t[t.length - 1] ? parseFloat(t) / 100 : parseFloat(t)) < 0 ? 0 : e > 1 ? 1 : e;
        var e;
      }

      function a(t, e, r) {
        return r < 0 ? r += 1 : r > 1 && (r -= 1), 6 * r < 1 ? t + (e - t) * r * 6 : 2 * r < 1 ? e : 3 * r < 2 ? t + (e - t) * (2 / 3 - r) * 6 : t;
      }

      try {
        e.parseCSSColor = function (t) {
          var e,
              o = t.replace(/ /g, "").toLowerCase();
          if (o in r) return r[o].slice();
          if ("#" === o[0]) return 4 === o.length ? (e = parseInt(o.substr(1), 16)) >= 0 && e <= 4095 ? [(3840 & e) >> 4 | (3840 & e) >> 8, 240 & e | (240 & e) >> 4, 15 & e | (15 & e) << 4, 1] : null : 7 === o.length && (e = parseInt(o.substr(1), 16)) >= 0 && e <= 16777215 ? [(16711680 & e) >> 16, (65280 & e) >> 8, 255 & e, 1] : null;
          var l = o.indexOf("("),
              u = o.indexOf(")");

          if (-1 !== l && u + 1 === o.length) {
            var c = o.substr(0, l),
                h = o.substr(l + 1, u - (l + 1)).split(","),
                p = 1;

            switch (c) {
              case "rgba":
                if (4 !== h.length) return null;
                p = s(h.pop());

              case "rgb":
                return 3 !== h.length ? null : [n(h[0]), n(h[1]), n(h[2]), p];

              case "hsla":
                if (4 !== h.length) return null;
                p = s(h.pop());

              case "hsl":
                if (3 !== h.length) return null;
                var d = (parseFloat(h[0]) % 360 + 360) % 360 / 360,
                    f = s(h[1]),
                    y = s(h[2]),
                    m = y <= .5 ? y * (f + 1) : y + f - y * f,
                    g = 2 * y - m;
                return [i(255 * a(g, m, d + 1 / 3)), i(255 * a(g, m, d)), i(255 * a(g, m, d - 1 / 3)), p];

              default:
                return null;
            }
          }

          return null;
        };
      } catch (t) {}
    }).parseCSSColor;

    var oe = /*#__PURE__*/function () {
      function oe(t, e, r) {
        var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;

        _classCallCheck(this, oe);

        this.r = t, this.g = e, this.b = r, this.a = i;
      }

      _createClass(oe, [{
        key: "toString",
        value: function toString() {
          var _this$toArray = this.toArray(),
              _this$toArray2 = _slicedToArray(_this$toArray, 4),
              t = _this$toArray2[0],
              e = _this$toArray2[1],
              r = _this$toArray2[2],
              i = _this$toArray2[3];

          return "rgba(".concat(Math.round(t), ",").concat(Math.round(e), ",").concat(Math.round(r), ",").concat(i, ")");
        }
      }, {
        key: "toArray",
        value: function toArray() {
          var t = this.r,
              e = this.g,
              r = this.b,
              i = this.a;
          return 0 === i ? [0, 0, 0, 0] : [255 * t / i, 255 * e / i, 255 * r / i, i];
        }
      }], [{
        key: "parse",
        value: function parse(t) {
          if (!t) return;
          if (t instanceof oe) return t;
          if ("string" != typeof t) return;
          var e = ae(t);
          return e ? new oe(e[0] / 255 * e[3], e[1] / 255 * e[3], e[2] / 255 * e[3], e[3]) : void 0;
        }
      }]);

      return oe;
    }();

    oe.black = new oe(0, 0, 0, 1), oe.white = new oe(1, 1, 1, 1), oe.transparent = new oe(0, 0, 0, 0), oe.red = new oe(1, 0, 0, 1), oe.blue = new oe(0, 0, 1, 1);

    var le = /*#__PURE__*/function () {
      function le(t, e, r) {
        _classCallCheck(this, le);

        this.sensitivity = t ? e ? "variant" : "case" : e ? "accent" : "base", this.locale = r, this.collator = new Intl.Collator(this.locale ? this.locale : [], {
          sensitivity: this.sensitivity,
          usage: "search"
        });
      }

      _createClass(le, [{
        key: "compare",
        value: function compare(t, e) {
          return this.collator.compare(t, e);
        }
      }, {
        key: "resolvedLocale",
        value: function resolvedLocale() {
          return new Intl.Collator(this.locale ? this.locale : []).resolvedOptions().locale;
        }
      }]);

      return le;
    }();

    var ue = function ue(t, e, r, i, n) {
      _classCallCheck(this, ue);

      this.text = t, this.image = e, this.scale = r, this.fontStack = i, this.textColor = n;
    };

    var ce = /*#__PURE__*/function () {
      function ce(t) {
        _classCallCheck(this, ce);

        this.sections = t;
      }

      _createClass(ce, [{
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.sections.length || !this.sections.some(function (t) {
            return 0 !== t.text.length || t.image && 0 !== t.image.name.length;
          });
        }
      }, {
        key: "toString",
        value: function toString() {
          return 0 === this.sections.length ? "" : this.sections.map(function (t) {
            return t.text;
          }).join("");
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["format"];

          var _iterator5 = _createForOfIteratorHelper(this.sections),
              _step5;

          try {
            for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {
              var _e15 = _step5.value;

              if (_e15.image) {
                t.push(["image", _e15.image.name]);
                continue;
              }

              t.push(_e15.text);
              var _r14 = {};
              _e15.fontStack && (_r14["text-font"] = ["literal", _e15.fontStack.split(",")]), _e15.scale && (_r14["font-scale"] = _e15.scale), _e15.textColor && (_r14["text-color"] = ["rgba"].concat(_e15.textColor.toArray())), t.push(_r14);
            }
          } catch (err) {
            _iterator5.e(err);
          } finally {
            _iterator5.f();
          }

          return t;
        }
      }], [{
        key: "fromString",
        value: function fromString(t) {
          return new ce([new ue(t, null, null, null, null)]);
        }
      }, {
        key: "factory",
        value: function factory(t) {
          return t instanceof ce ? t : ce.fromString(t);
        }
      }]);

      return ce;
    }();

    var he = /*#__PURE__*/function () {
      function he(t) {
        _classCallCheck(this, he);

        this.name = t.name, this.available = t.available;
      }

      _createClass(he, [{
        key: "toString",
        value: function toString() {
          return this.name;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["image", this.name];
        }
      }], [{
        key: "fromString",
        value: function fromString(t) {
          return t ? new he({
            name: t,
            available: !1
          }) : null;
        }
      }]);

      return he;
    }();

    function pe(t, e, r, i) {
      return "number" == typeof t && t >= 0 && t <= 255 && "number" == typeof e && e >= 0 && e <= 255 && "number" == typeof r && r >= 0 && r <= 255 ? void 0 === i || "number" == typeof i && i >= 0 && i <= 1 ? null : "Invalid rgba value [".concat([t, e, r, i].join(", "), "]: 'a' must be between 0 and 1.") : "Invalid rgba value [".concat(("number" == typeof i ? [t, e, r, i] : [t, e, r]).join(", "), "]: 'r', 'g', and 'b' must be between 0 and 255.");
    }

    function de(t) {
      if (null === t) return !0;
      if ("string" == typeof t) return !0;
      if ("boolean" == typeof t) return !0;
      if ("number" == typeof t) return !0;
      if (t instanceof oe) return !0;
      if (t instanceof le) return !0;
      if (t instanceof ce) return !0;
      if (t instanceof he) return !0;

      if (Array.isArray(t)) {
        var _iterator6 = _createForOfIteratorHelper(t),
            _step6;

        try {
          for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {
            var _e16 = _step6.value;
            if (!de(_e16)) return !1;
          }
        } catch (err) {
          _iterator6.e(err);
        } finally {
          _iterator6.f();
        }

        return !0;
      }

      if ("object" == _typeof(t)) {
        for (var _e17 in t) {
          if (!de(t[_e17])) return !1;
        }

        return !0;
      }

      return !1;
    }

    function fe(t) {
      if (null === t) return Nt;
      if ("string" == typeof t) return Kt;
      if ("boolean" == typeof t) return Zt;
      if ("number" == typeof t) return jt;
      if (t instanceof oe) return Xt;
      if (t instanceof le) return Jt;
      if (t instanceof ce) return Yt;
      if (t instanceof he) return Wt;

      if (Array.isArray(t)) {
        var _e18 = t.length;

        var _r15;

        var _iterator7 = _createForOfIteratorHelper(t),
            _step7;

        try {
          for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {
            var _e19 = _step7.value;

            var _t10 = fe(_e19);

            if (_r15) {
              if (_r15 === _t10) continue;
              _r15 = Ht;
              break;
            }

            _r15 = _t10;
          }
        } catch (err) {
          _iterator7.e(err);
        } finally {
          _iterator7.f();
        }

        return Qt(_r15 || Ht, _e18);
      }

      return Gt;
    }

    function ye(t) {
      var e = _typeof(t);

      return null === t ? "" : "string" === e || "number" === e || "boolean" === e ? String(t) : t instanceof oe || t instanceof ce || t instanceof he ? t.toString() : JSON.stringify(t);
    }

    var me = /*#__PURE__*/function () {
      function me(t, e) {
        _classCallCheck(this, me);

        this.type = t, this.value = e;
      }

      _createClass(me, [{
        key: "evaluate",
        value: function evaluate() {
          return this.value;
        }
      }, {
        key: "eachChild",
        value: function eachChild() {}
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !0;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return "array" === this.type.kind || "object" === this.type.kind ? ["literal", this.value] : this.value instanceof oe ? ["rgba"].concat(this.value.toArray()) : this.value instanceof ce ? this.value.serialize() : this.value;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("'literal' expression requires exactly one argument, but found ".concat(t.length - 1, " instead."));
          if (!de(t[1])) return e.error("invalid value");
          var r = t[1];
          var i = fe(r);
          var n = e.expectedType;
          return "array" !== i.kind || 0 !== i.N || !n || "array" !== n.kind || "number" == typeof n.N && 0 !== n.N || (i = n), new me(i, r);
        }
      }]);

      return me;
    }();

    var ge = /*#__PURE__*/function () {
      function ge(t) {
        _classCallCheck(this, ge);

        this.name = "ExpressionEvaluationError", this.message = t;
      }

      _createClass(ge, [{
        key: "toJSON",
        value: function toJSON() {
          return this.message;
        }
      }]);

      return ge;
    }();

    var xe = {
      string: Kt,
      number: jt,
      "boolean": Zt,
      object: Gt
    };

    var ve = /*#__PURE__*/function () {
      function ve(t, e) {
        _classCallCheck(this, ve);

        this.type = t, this.args = e;
      }

      _createClass(ve, [{
        key: "evaluate",
        value: function evaluate(t) {
          for (var _e20 = 0; _e20 < this.args.length; _e20++) {
            var _r16 = this.args[_e20].evaluate(t);

            if (!re(this.type, fe(_r16))) return _r16;
            if (_e20 === this.args.length - 1) throw new ge("Expected value to be of type ".concat(te(this.type), ", but found ").concat(te(fe(_r16)), " instead."));
          }

          return null;
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.args.forEach(t);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.args.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = this.type,
              e = [t.kind];

          if ("array" === t.kind) {
            var _r17 = t.itemType;

            if ("string" === _r17.kind || "number" === _r17.kind || "boolean" === _r17.kind) {
              e.push(_r17.kind);
              var _i10 = t.N;
              ("number" == typeof _i10 || this.args.length > 1) && e.push(_i10);
            }
          }

          return e.concat(this.args.map(function (t) {
            return t.serialize();
          }));
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 2) return e.error("Expected at least one argument.");
          var r,
              i = 1;
          var n = t[0];

          if ("array" === n) {
            var _n6, _s3;

            if (t.length > 2) {
              var _r18 = t[1];
              if ("string" != typeof _r18 || !(_r18 in xe) || "object" === _r18) return e.error('The item type argument of "array" must be one of string, number, boolean', 1);
              _n6 = xe[_r18], i++;
            } else _n6 = Ht;

            if (t.length > 3) {
              if (null !== t[2] && ("number" != typeof t[2] || t[2] < 0 || t[2] !== Math.floor(t[2]))) return e.error('The length argument to "array" must be a positive integer literal', 2);
              _s3 = t[2], i++;
            }

            r = Qt(_n6, _s3);
          } else r = xe[n];

          var s = [];

          for (; i < t.length; i++) {
            var _r19 = e.parse(t[i], i, Ht);

            if (!_r19) return null;
            s.push(_r19);
          }

          return new ve(r, s);
        }
      }]);

      return ve;
    }();

    var be = /*#__PURE__*/function () {
      function be(t) {
        _classCallCheck(this, be);

        this.type = Yt, this.sections = t;
      }

      _createClass(be, [{
        key: "evaluate",
        value: function evaluate(t) {
          return new ce(this.sections.map(function (e) {
            var r = e.content.evaluate(t);
            return fe(r) === Wt ? new ue("", r, null, null, null) : new ue(ye(r), null, e.scale ? e.scale.evaluate(t) : null, e.font ? e.font.evaluate(t).join(",") : null, e.textColor ? e.textColor.evaluate(t) : null);
          }));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          var _iterator8 = _createForOfIteratorHelper(this.sections),
              _step8;

          try {
            for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {
              var _e21 = _step8.value;
              t(_e21.content), _e21.scale && t(_e21.scale), _e21.font && t(_e21.font), _e21.textColor && t(_e21.textColor);
            }
          } catch (err) {
            _iterator8.e(err);
          } finally {
            _iterator8.f();
          }
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["format"];

          var _iterator9 = _createForOfIteratorHelper(this.sections),
              _step9;

          try {
            for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {
              var _e22 = _step9.value;
              t.push(_e22.content.serialize());
              var _r20 = {};
              _e22.scale && (_r20["font-scale"] = _e22.scale.serialize()), _e22.font && (_r20["text-font"] = _e22.font.serialize()), _e22.textColor && (_r20["text-color"] = _e22.textColor.serialize()), t.push(_r20);
            }
          } catch (err) {
            _iterator9.e(err);
          } finally {
            _iterator9.f();
          }

          return t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 2) return e.error("Expected at least one argument.");
          var r = t[1];
          if (!Array.isArray(r) && "object" == _typeof(r)) return e.error("First argument must be an image or text section.");
          var i = [];
          var n = !1;

          for (var _r21 = 1; _r21 <= t.length - 1; ++_r21) {
            var _s4 = t[_r21];

            if (n && "object" == _typeof(_s4) && !Array.isArray(_s4)) {
              n = !1;
              var _t11 = null;
              if (_s4["font-scale"] && (_t11 = e.parse(_s4["font-scale"], 1, jt), !_t11)) return null;
              var _r22 = null;
              if (_s4["text-font"] && (_r22 = e.parse(_s4["text-font"], 1, Qt(Kt)), !_r22)) return null;
              var _a3 = null;
              if (_s4["text-color"] && (_a3 = e.parse(_s4["text-color"], 1, Xt), !_a3)) return null;
              var _o2 = i[i.length - 1];
              _o2.scale = _t11, _o2.font = _r22, _o2.textColor = _a3;
            } else {
              var _s5 = e.parse(t[_r21], 1, Ht);

              if (!_s5) return null;
              var _a4 = _s5.type.kind;
              if ("string" !== _a4 && "value" !== _a4 && "null" !== _a4 && "resolvedImage" !== _a4) return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");
              n = !0, i.push({
                content: _s5,
                scale: null,
                font: null,
                textColor: null
              });
            }
          }

          return new be(i);
        }
      }]);

      return be;
    }();

    var we = /*#__PURE__*/function () {
      function we(t) {
        _classCallCheck(this, we);

        this.type = Wt, this.input = t;
      }

      _createClass(we, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.input.evaluate(t),
              r = he.fromString(e);
          return r && t.availableImages && (r.available = t.availableImages.indexOf(e) > -1), r;
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["image", this.input.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("Expected two arguments.");
          var r = e.parse(t[1], 1, Kt);
          return r ? new we(r) : e.error("No image name provided.");
        }
      }]);

      return we;
    }();

    var _e = {
      "to-boolean": Zt,
      "to-color": Xt,
      "to-number": jt,
      "to-string": Kt
    };

    var Ae = /*#__PURE__*/function () {
      function Ae(t, e) {
        _classCallCheck(this, Ae);

        this.type = t, this.args = e;
      }

      _createClass(Ae, [{
        key: "evaluate",
        value: function evaluate(t) {
          if ("boolean" === this.type.kind) return Boolean(this.args[0].evaluate(t));

          if ("color" === this.type.kind) {
            var _e23, _r23;

            var _iterator10 = _createForOfIteratorHelper(this.args),
                _step10;

            try {
              for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {
                var _i11 = _step10.value;
                if (_e23 = _i11.evaluate(t), _r23 = null, _e23 instanceof oe) return _e23;

                if ("string" == typeof _e23) {
                  var _r24 = t.parseColor(_e23);

                  if (_r24) return _r24;
                } else if (Array.isArray(_e23) && (_r23 = _e23.length < 3 || _e23.length > 4 ? "Invalid rbga value ".concat(JSON.stringify(_e23), ": expected an array containing either three or four numeric values.") : pe(_e23[0], _e23[1], _e23[2], _e23[3]), !_r23)) return new oe(_e23[0] / 255, _e23[1] / 255, _e23[2] / 255, _e23[3]);
              }
            } catch (err) {
              _iterator10.e(err);
            } finally {
              _iterator10.f();
            }

            throw new ge(_r23 || "Could not parse color from value '".concat("string" == typeof _e23 ? _e23 : String(JSON.stringify(_e23)), "'"));
          }

          if ("number" === this.type.kind) {
            var _e24 = null;

            var _iterator11 = _createForOfIteratorHelper(this.args),
                _step11;

            try {
              for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {
                var _r25 = _step11.value;
                if (_e24 = _r25.evaluate(t), null === _e24) return 0;

                var _i12 = Number(_e24);

                if (!isNaN(_i12)) return _i12;
              }
            } catch (err) {
              _iterator11.e(err);
            } finally {
              _iterator11.f();
            }

            throw new ge("Could not convert ".concat(JSON.stringify(_e24), " to number."));
          }

          return "formatted" === this.type.kind ? ce.fromString(ye(this.args[0].evaluate(t))) : "resolvedImage" === this.type.kind ? he.fromString(ye(this.args[0].evaluate(t))) : ye(this.args[0].evaluate(t));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.args.forEach(t);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.args.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          if ("formatted" === this.type.kind) return new be([{
            content: this.args[0],
            scale: null,
            font: null,
            textColor: null
          }]).serialize();
          if ("resolvedImage" === this.type.kind) return new we(this.args[0]).serialize();
          var t = ["to-".concat(this.type.kind)];
          return this.eachChild(function (e) {
            t.push(e.serialize());
          }), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 2) return e.error("Expected at least one argument.");
          var r = t[0];
          if (("to-boolean" === r || "to-string" === r) && 2 !== t.length) return e.error("Expected one argument.");
          var i = _e[r],
              n = [];

          for (var _r26 = 1; _r26 < t.length; _r26++) {
            var _i13 = e.parse(t[_r26], _r26, Ht);

            if (!_i13) return null;
            n.push(_i13);
          }

          return new Ae(i, n);
        }
      }]);

      return Ae;
    }();

    var ke = ["Unknown", "Point", "LineString", "Polygon"];

    var Se = /*#__PURE__*/function () {
      function Se() {
        _classCallCheck(this, Se);

        this.globals = null, this.feature = null, this.featureState = null, this.formattedSection = null, this._parseColorCache = {}, this.availableImages = null, this.canonical = null;
      }

      _createClass(Se, [{
        key: "id",
        value: function id() {
          return this.feature && "id" in this.feature ? this.feature.id : null;
        }
      }, {
        key: "geometryType",
        value: function geometryType() {
          return this.feature ? "number" == typeof this.feature.type ? ke[this.feature.type] : this.feature.type : null;
        }
      }, {
        key: "geometry",
        value: function geometry() {
          return this.feature && "geometry" in this.feature ? this.feature.geometry : null;
        }
      }, {
        key: "canonicalID",
        value: function canonicalID() {
          return this.canonical;
        }
      }, {
        key: "properties",
        value: function properties() {
          return this.feature && this.feature.properties || {};
        }
      }, {
        key: "parseColor",
        value: function parseColor(t) {
          var e = this._parseColorCache[t];
          return e || (e = this._parseColorCache[t] = oe.parse(t)), e;
        }
      }]);

      return Se;
    }();

    var Ie = /*#__PURE__*/function () {
      function Ie(t, e, r, i) {
        _classCallCheck(this, Ie);

        this.name = t, this.type = e, this._evaluate = r, this.args = i;
      }

      _createClass(Ie, [{
        key: "evaluate",
        value: function evaluate(t) {
          return this._evaluate(t, this.args);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.args.forEach(t);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return [this.name].concat(this.args.map(function (t) {
            return t.serialize();
          }));
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          var _e$errors;

          var r = t[0],
              i = Ie.definitions[r];
          if (!i) return e.error("Unknown expression \"".concat(r, "\". If you wanted a literal array, use [\"literal\", [...]]."), 0);
          var n = Array.isArray(i) ? i[0] : i.type,
              s = Array.isArray(i) ? [[i[1], i[2]]] : i.overloads,
              a = s.filter(function (_ref4) {
            var _ref5 = _slicedToArray(_ref4, 1),
                e = _ref5[0];

            return !Array.isArray(e) || e.length === t.length - 1;
          });
          var o = null;

          var _iterator12 = _createForOfIteratorHelper(a),
              _step12;

          try {
            for (_iterator12.s(); !(_step12 = _iterator12.n()).done;) {
              var _ref10 = _step12.value;

              var _ref7 = _slicedToArray(_ref10, 2);

              var _i15 = _ref7[0];
              var _s6 = _ref7[1];
              o = new Ge(e.registry, e.path, null, e.scope);
              var _a5 = [];

              var _l2 = !1;

              for (var _e25 = 1; _e25 < t.length; _e25++) {
                var _r29 = t[_e25],
                    _n8 = Array.isArray(_i15) ? _i15[_e25 - 1] : _i15.type,
                    _s7 = o.parse(_r29, 1 + _a5.length, _n8);

                if (!_s7) {
                  _l2 = !0;
                  break;
                }

                _a5.push(_s7);
              }

              if (!_l2) if (Array.isArray(_i15) && _i15.length !== _a5.length) o.error("Expected ".concat(_i15.length, " arguments, but found ").concat(_a5.length, " instead."));else {
                for (var _t12 = 0; _t12 < _a5.length; _t12++) {
                  var _e26 = Array.isArray(_i15) ? _i15[_t12] : _i15.type,
                      _r30 = _a5[_t12];

                  o.concat(_t12 + 1).checkSubtype(_e26, _r30.type);
                }

                if (0 === o.errors.length) return new Ie(r, n, _s6, _a5);
              }
            }
          } catch (err) {
            _iterator12.e(err);
          } finally {
            _iterator12.f();
          }

          if (1 === a.length) (_e$errors = e.errors).push.apply(_e$errors, _toConsumableArray(o.errors));else {
            var _r27 = (a.length ? a : s).map(function (_ref8) {
              var _ref9 = _slicedToArray(_ref8, 1),
                  t = _ref9[0];

              return e = t, Array.isArray(e) ? "(".concat(e.map(te).join(", "), ")") : "(".concat(te(e.type), "...)");
              var e;
            }).join(" | "),
                _i14 = [];

            for (var _r28 = 1; _r28 < t.length; _r28++) {
              var _n7 = e.parse(t[_r28], 1 + _i14.length);

              if (!_n7) return null;

              _i14.push(te(_n7.type));
            }

            e.error("Expected arguments of type ".concat(_r27, ", but found (").concat(_i14.join(", "), ") instead."));
          }
          return null;
        }
      }, {
        key: "register",
        value: function register(t, e) {
          Ie.definitions = e;

          for (var _r31 in e) {
            t[_r31] = Ie;
          }
        }
      }]);

      return Ie;
    }();

    var Te = /*#__PURE__*/function () {
      function Te(t, e, r) {
        _classCallCheck(this, Te);

        this.type = Jt, this.locale = r, this.caseSensitive = t, this.diacriticSensitive = e;
      }

      _createClass(Te, [{
        key: "evaluate",
        value: function evaluate(t) {
          return new le(this.caseSensitive.evaluate(t), this.diacriticSensitive.evaluate(t), this.locale ? this.locale.evaluate(t) : null);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.caseSensitive), t(this.diacriticSensitive), this.locale && t(this.locale);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {};
          return t["case-sensitive"] = this.caseSensitive.serialize(), t["diacritic-sensitive"] = this.diacriticSensitive.serialize(), this.locale && (t.locale = this.locale.serialize()), ["collator", t];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("Expected one argument.");
          var r = t[1];
          if ("object" != _typeof(r) || Array.isArray(r)) return e.error("Collator options argument must be an object.");
          var i = e.parse(void 0 !== r["case-sensitive"] && r["case-sensitive"], 1, Zt);
          if (!i) return null;
          var n = e.parse(void 0 !== r["diacritic-sensitive"] && r["diacritic-sensitive"], 1, Zt);
          if (!n) return null;
          var s = null;
          return r.locale && (s = e.parse(r.locale, 1, Kt), !s) ? null : new Te(i, n, s);
        }
      }]);

      return Te;
    }();

    function ze(t, e) {
      t[0] = Math.min(t[0], e[0]), t[1] = Math.min(t[1], e[1]), t[2] = Math.max(t[2], e[0]), t[3] = Math.max(t[3], e[1]);
    }

    function Ee(t, e) {
      return !(t[0] <= e[0] || t[2] >= e[2] || t[1] <= e[1] || t[3] >= e[3]);
    }

    function Ce(t, e) {
      var r = (180 + t[0]) / 360,
          i = (180 - 180 / Math.PI * Math.log(Math.tan(Math.PI / 4 + t[1] * Math.PI / 360))) / 360,
          n = Math.pow(2, e.z);
      return [Math.round(r * n * 8192), Math.round(i * n * 8192)];
    }

    function Me(t, e, r) {
      var i = t[0] - e[0],
          n = t[1] - e[1],
          s = t[0] - r[0],
          a = t[1] - r[1];
      return i * a - s * n == 0 && i * s <= 0 && n * a <= 0;
    }

    function Be(t, e) {
      var r = !1;

      for (var _a6 = 0, _o3 = e.length; _a6 < _o3; _a6++) {
        var _o4 = e[_a6];

        for (var _e27 = 0, _a7 = _o4.length; _e27 < _a7 - 1; _e27++) {
          if (Me(t, _o4[_e27], _o4[_e27 + 1])) return !1;
          (n = _o4[_e27])[1] > (i = t)[1] != (s = _o4[_e27 + 1])[1] > i[1] && i[0] < (s[0] - n[0]) * (i[1] - n[1]) / (s[1] - n[1]) + n[0] && (r = !r);
        }
      }

      var i, n, s;
      return r;
    }

    function De(t, e) {
      for (var _r32 = 0; _r32 < e.length; _r32++) {
        if (Be(t, e[_r32])) return !0;
      }

      return !1;
    }

    function Pe(t, e, r, i) {
      var n = i[0] - r[0],
          s = i[1] - r[1],
          a = (t[0] - r[0]) * s - n * (t[1] - r[1]),
          o = (e[0] - r[0]) * s - n * (e[1] - r[1]);
      return a > 0 && o < 0 || a < 0 && o > 0;
    }

    function Ve(t, e, r) {
      var _iterator13 = _createForOfIteratorHelper(r),
          _step13;

      try {
        for (_iterator13.s(); !(_step13 = _iterator13.n()).done;) {
          var _u2 = _step13.value;

          for (var _r33 = 0; _r33 < _u2.length - 1; ++_r33) {
            if (0 != (o = [(a = _u2[_r33 + 1])[0] - (s = _u2[_r33])[0], a[1] - s[1]])[0] * (l = [(n = e)[0] - (i = t)[0], n[1] - i[1]])[1] - o[1] * l[0] && Pe(i, n, s, a) && Pe(s, a, i, n)) return !0;
          }
        }
      } catch (err) {
        _iterator13.e(err);
      } finally {
        _iterator13.f();
      }

      var i, n, s, a, o, l;
      return !1;
    }

    function Fe(t, e) {
      for (var _r34 = 0; _r34 < t.length; ++_r34) {
        if (!Be(t[_r34], e)) return !1;
      }

      for (var _r35 = 0; _r35 < t.length - 1; ++_r35) {
        if (Ve(t[_r35], t[_r35 + 1], e)) return !1;
      }

      return !0;
    }

    function Re(t, e) {
      for (var _r36 = 0; _r36 < e.length; _r36++) {
        if (Fe(t, e[_r36])) return !0;
      }

      return !1;
    }

    function Le(t, e, r) {
      var i = [];

      for (var _n9 = 0; _n9 < t.length; _n9++) {
        var _s8 = [];

        for (var _i16 = 0; _i16 < t[_n9].length; _i16++) {
          var _a8 = Ce(t[_n9][_i16], r);

          ze(e, _a8), _s8.push(_a8);
        }

        i.push(_s8);
      }

      return i;
    }

    function Ue(t, e, r) {
      var i = [];

      for (var _n10 = 0; _n10 < t.length; _n10++) {
        var _s9 = Le(t[_n10], e, r);

        i.push(_s9);
      }

      return i;
    }

    function Oe(t, e, r, i) {
      if (t[0] < r[0] || t[0] > r[2]) {
        var _e28 = .5 * i;

        var _n11 = t[0] - r[0] > _e28 ? -i : r[0] - t[0] > _e28 ? i : 0;

        0 === _n11 && (_n11 = t[0] - r[2] > _e28 ? -i : r[2] - t[0] > _e28 ? i : 0), t[0] += _n11;
      }

      ze(e, t);
    }

    function $e(t, e, r, i) {
      var n = 8192 * Math.pow(2, i.z),
          s = [8192 * i.x, 8192 * i.y],
          a = [];

      var _iterator14 = _createForOfIteratorHelper(t),
          _step14;

      try {
        for (_iterator14.s(); !(_step14 = _iterator14.n()).done;) {
          var _i17 = _step14.value;

          var _iterator15 = _createForOfIteratorHelper(_i17),
              _step15;

          try {
            for (_iterator15.s(); !(_step15 = _iterator15.n()).done;) {
              var _t13 = _step15.value;
              var _i18 = [_t13.x + s[0], _t13.y + s[1]];
              Oe(_i18, e, r, n), a.push(_i18);
            }
          } catch (err) {
            _iterator15.e(err);
          } finally {
            _iterator15.f();
          }
        }
      } catch (err) {
        _iterator14.e(err);
      } finally {
        _iterator14.f();
      }

      return a;
    }

    function qe(t, e, r, i) {
      var n = 8192 * Math.pow(2, i.z),
          s = [8192 * i.x, 8192 * i.y],
          a = [];

      var _iterator16 = _createForOfIteratorHelper(t),
          _step16;

      try {
        for (_iterator16.s(); !(_step16 = _iterator16.n()).done;) {
          var _r37 = _step16.value;
          var _t15 = [];

          var _iterator19 = _createForOfIteratorHelper(_r37),
              _step19;

          try {
            for (_iterator19.s(); !(_step19 = _iterator19.n()).done;) {
              var _i20 = _step19.value;
              var _r38 = [_i20.x + s[0], _i20.y + s[1]];
              ze(e, _r38), _t15.push(_r38);
            }
          } catch (err) {
            _iterator19.e(err);
          } finally {
            _iterator19.f();
          }

          a.push(_t15);
        }
      } catch (err) {
        _iterator16.e(err);
      } finally {
        _iterator16.f();
      }

      if (e[2] - e[0] <= n / 2) {
        (o = e)[0] = o[1] = 1 / 0, o[2] = o[3] = -1 / 0;

        var _iterator17 = _createForOfIteratorHelper(a),
            _step17;

        try {
          for (_iterator17.s(); !(_step17 = _iterator17.n()).done;) {
            var _t14 = _step17.value;

            var _iterator18 = _createForOfIteratorHelper(_t14),
                _step18;

            try {
              for (_iterator18.s(); !(_step18 = _iterator18.n()).done;) {
                var _i19 = _step18.value;
                Oe(_i19, e, r, n);
              }
            } catch (err) {
              _iterator18.e(err);
            } finally {
              _iterator18.f();
            }
          }
        } catch (err) {
          _iterator17.e(err);
        } finally {
          _iterator17.f();
        }
      }

      var o;
      return a;
    }

    var Ne = /*#__PURE__*/function () {
      function Ne(t, e) {
        _classCallCheck(this, Ne);

        this.type = Zt, this.geojson = t, this.geometries = e;
      }

      _createClass(Ne, [{
        key: "evaluate",
        value: function evaluate(t) {
          if (null != t.geometry() && null != t.canonicalID()) {
            if ("Point" === t.geometryType()) return function (t, e) {
              var r = [1 / 0, 1 / 0, -1 / 0, -1 / 0],
                  i = [1 / 0, 1 / 0, -1 / 0, -1 / 0],
                  n = t.canonicalID();

              if ("Polygon" === e.type) {
                var _s10 = Le(e.coordinates, i, n),
                    _a9 = $e(t.geometry(), r, i, n);

                if (!Ee(r, i)) return !1;

                var _iterator20 = _createForOfIteratorHelper(_a9),
                    _step20;

                try {
                  for (_iterator20.s(); !(_step20 = _iterator20.n()).done;) {
                    var _t16 = _step20.value;
                    if (!Be(_t16, _s10)) return !1;
                  }
                } catch (err) {
                  _iterator20.e(err);
                } finally {
                  _iterator20.f();
                }
              }

              if ("MultiPolygon" === e.type) {
                var _s11 = Ue(e.coordinates, i, n),
                    _a10 = $e(t.geometry(), r, i, n);

                if (!Ee(r, i)) return !1;

                var _iterator21 = _createForOfIteratorHelper(_a10),
                    _step21;

                try {
                  for (_iterator21.s(); !(_step21 = _iterator21.n()).done;) {
                    var _t17 = _step21.value;
                    if (!De(_t17, _s11)) return !1;
                  }
                } catch (err) {
                  _iterator21.e(err);
                } finally {
                  _iterator21.f();
                }
              }

              return !0;
            }(t, this.geometries);
            if ("LineString" === t.geometryType()) return function (t, e) {
              var r = [1 / 0, 1 / 0, -1 / 0, -1 / 0],
                  i = [1 / 0, 1 / 0, -1 / 0, -1 / 0],
                  n = t.canonicalID();

              if ("Polygon" === e.type) {
                var _s12 = Le(e.coordinates, i, n),
                    _a11 = qe(t.geometry(), r, i, n);

                if (!Ee(r, i)) return !1;

                var _iterator22 = _createForOfIteratorHelper(_a11),
                    _step22;

                try {
                  for (_iterator22.s(); !(_step22 = _iterator22.n()).done;) {
                    var _t18 = _step22.value;
                    if (!Fe(_t18, _s12)) return !1;
                  }
                } catch (err) {
                  _iterator22.e(err);
                } finally {
                  _iterator22.f();
                }
              }

              if ("MultiPolygon" === e.type) {
                var _s13 = Ue(e.coordinates, i, n),
                    _a12 = qe(t.geometry(), r, i, n);

                if (!Ee(r, i)) return !1;

                var _iterator23 = _createForOfIteratorHelper(_a12),
                    _step23;

                try {
                  for (_iterator23.s(); !(_step23 = _iterator23.n()).done;) {
                    var _t19 = _step23.value;
                    if (!Re(_t19, _s13)) return !1;
                  }
                } catch (err) {
                  _iterator23.e(err);
                } finally {
                  _iterator23.f();
                }
              }

              return !0;
            }(t, this.geometries);
          }

          return !1;
        }
      }, {
        key: "eachChild",
        value: function eachChild() {}
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !0;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["within", this.geojson];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("'within' expression requires exactly one argument, but found ".concat(t.length - 1, " instead."));

          if (de(t[1])) {
            var _e29 = t[1];
            if ("FeatureCollection" === _e29.type) for (var _t20 = 0; _t20 < _e29.features.length; ++_t20) {
              var _r39 = _e29.features[_t20].geometry.type;
              if ("Polygon" === _r39 || "MultiPolygon" === _r39) return new Ne(_e29, _e29.features[_t20].geometry);
            } else if ("Feature" === _e29.type) {
              var _t21 = _e29.geometry.type;
              if ("Polygon" === _t21 || "MultiPolygon" === _t21) return new Ne(_e29, _e29.geometry);
            } else if ("Polygon" === _e29.type || "MultiPolygon" === _e29.type) return new Ne(_e29, _e29);
          }

          return e.error("'within' expression requires valid geojson object that contains polygon geometry type.");
        }
      }]);

      return Ne;
    }();

    function je(t) {
      if (t instanceof Ie) {
        if ("get" === t.name && 1 === t.args.length) return !1;
        if ("feature-state" === t.name) return !1;
        if ("has" === t.name && 1 === t.args.length) return !1;
        if ("properties" === t.name || "geometry-type" === t.name || "id" === t.name) return !1;
        if (/^filter-/.test(t.name)) return !1;
      }

      if (t instanceof Ne) return !1;
      var e = !0;
      return t.eachChild(function (t) {
        e && !je(t) && (e = !1);
      }), e;
    }

    function Ke(t) {
      if (t instanceof Ie && "feature-state" === t.name) return !1;
      var e = !0;
      return t.eachChild(function (t) {
        e && !Ke(t) && (e = !1);
      }), e;
    }

    function Ze(t, e) {
      if (t instanceof Ie && e.indexOf(t.name) >= 0) return !1;
      var r = !0;
      return t.eachChild(function (t) {
        r && !Ze(t, e) && (r = !1);
      }), r;
    }

    var Xe = /*#__PURE__*/function () {
      function Xe(t, e) {
        _classCallCheck(this, Xe);

        this.type = e.type, this.name = t, this.boundExpression = e;
      }

      _createClass(Xe, [{
        key: "evaluate",
        value: function evaluate(t) {
          return this.boundExpression.evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild() {}
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["var", this.name];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length || "string" != typeof t[1]) return e.error("'var' expression requires exactly one string literal argument.");
          var r = t[1];
          return e.scope.has(r) ? new Xe(r, e.scope.get(r)) : e.error("Unknown variable \"".concat(r, "\". Make sure \"").concat(r, "\" has been bound in an enclosing \"let\" expression before using it."), 1);
        }
      }]);

      return Xe;
    }();

    var Ge = /*#__PURE__*/function () {
      function Ge(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
        var r = arguments.length > 2 ? arguments[2] : undefined;
        var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : new qt();
        var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];

        _classCallCheck(this, Ge);

        this.registry = t, this.path = e, this.key = e.map(function (t) {
          return "[".concat(t, "]");
        }).join(""), this.scope = i, this.errors = n, this.expectedType = r;
      }

      _createClass(Ge, [{
        key: "parse",
        value: function parse(t, e, r, i) {
          var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};
          return e ? this.concat(e, r, i)._parse(t, n) : this._parse(t, n);
        }
      }, {
        key: "_parse",
        value: function _parse(t, e) {
          function r(t, e, r) {
            return "assert" === r ? new ve(e, [t]) : "coerce" === r ? new Ae(e, [t]) : t;
          }

          if (null !== t && "string" != typeof t && "boolean" != typeof t && "number" != typeof t || (t = ["literal", t]), Array.isArray(t)) {
            if (0 === t.length) return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');
            var _i21 = t[0];
            if ("string" != typeof _i21) return this.error("Expression name must be a string, but found ".concat(_typeof(_i21), " instead. If you wanted a literal array, use [\"literal\", [...]]."), 0), null;
            var _n12 = this.registry[_i21];

            if (_n12) {
              var _i22 = _n12.parse(t, this);

              if (!_i22) return null;

              if (this.expectedType) {
                var _t22 = this.expectedType,
                    _n13 = _i22.type;
                if ("string" !== _t22.kind && "number" !== _t22.kind && "boolean" !== _t22.kind && "object" !== _t22.kind && "array" !== _t22.kind || "value" !== _n13.kind) {
                  if ("color" !== _t22.kind && "formatted" !== _t22.kind && "resolvedImage" !== _t22.kind || "value" !== _n13.kind && "string" !== _n13.kind) {
                    if (this.checkSubtype(_t22, _n13)) return null;
                  } else _i22 = r(_i22, _t22, e.typeAnnotation || "coerce");
                } else _i22 = r(_i22, _t22, e.typeAnnotation || "assert");
              }

              if (!(_i22 instanceof me) && "resolvedImage" !== _i22.type.kind && function t(e) {
                if (e instanceof Xe) return t(e.boundExpression);
                if (e instanceof Ie && "error" === e.name) return !1;
                if (e instanceof Te) return !1;
                if (e instanceof Ne) return !1;
                var r = e instanceof Ae || e instanceof ve;
                var i = !0;
                return e.eachChild(function (e) {
                  i = r ? i && t(e) : i && e instanceof me;
                }), !!i && je(e) && Ze(e, ["zoom", "heatmap-density", "line-progress", "sky-radial-progress", "accumulated", "is-supported-script"]);
              }(_i22)) {
                var _t23 = new Se();

                try {
                  _i22 = new me(_i22.type, _i22.evaluate(_t23));
                } catch (t) {
                  return this.error(t.message), null;
                }
              }

              return _i22;
            }

            return this.error("Unknown expression \"".concat(_i21, "\". If you wanted a literal array, use [\"literal\", [...]]."), 0);
          }

          return this.error(void 0 === t ? "'undefined' value invalid. Use null instead." : "object" == _typeof(t) ? 'Bare objects invalid. Use ["literal", {...}] instead.' : "Expected an array, but found ".concat(_typeof(t), " instead."));
        }
      }, {
        key: "concat",
        value: function concat(t, e, r) {
          var i = "number" == typeof t ? this.path.concat(t) : this.path,
              n = r ? this.scope.concat(r) : this.scope;
          return new Ge(this.registry, i, e || null, n, this.errors);
        }
      }, {
        key: "error",
        value: function error(t) {
          for (var _len3 = arguments.length, e = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
            e[_key3 - 1] = arguments[_key3];
          }

          var r = "".concat(this.key).concat(e.map(function (t) {
            return "[".concat(t, "]");
          }).join(""));
          this.errors.push(new $t(r, t));
        }
      }, {
        key: "checkSubtype",
        value: function checkSubtype(t, e) {
          var r = re(t, e);
          return r && this.error(r), r;
        }
      }]);

      return Ge;
    }();

    function He(t, e) {
      var r = t.length - 1;
      var i,
          n,
          s = 0,
          a = r,
          o = 0;

      for (; s <= a;) {
        if (o = Math.floor((s + a) / 2), i = t[o], n = t[o + 1], i <= e) {
          if (o === r || e < n) return o;
          s = o + 1;
        } else {
          if (!(i > e)) throw new ge("Input is not a number.");
          a = o - 1;
        }
      }

      return 0;
    }

    var Je = /*#__PURE__*/function () {
      function Je(t, e, r) {
        _classCallCheck(this, Je);

        this.type = t, this.input = e, this.labels = [], this.outputs = [];

        var _iterator24 = _createForOfIteratorHelper(r),
            _step24;

        try {
          for (_iterator24.s(); !(_step24 = _iterator24.n()).done;) {
            var _ref13 = _step24.value;

            var _ref12 = _slicedToArray(_ref13, 2);

            var _t24 = _ref12[0];
            var _e30 = _ref12[1];
            this.labels.push(_t24), this.outputs.push(_e30);
          }
        } catch (err) {
          _iterator24.e(err);
        } finally {
          _iterator24.f();
        }
      }

      _createClass(Je, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.labels,
              r = this.outputs;
          if (1 === e.length) return r[0].evaluate(t);
          var i = this.input.evaluate(t);
          if (i <= e[0]) return r[0].evaluate(t);
          var n = e.length;
          return i >= e[n - 1] ? r[n - 1].evaluate(t) : r[He(e, i)].evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input);

          var _iterator25 = _createForOfIteratorHelper(this.outputs),
              _step25;

          try {
            for (_iterator25.s(); !(_step25 = _iterator25.n()).done;) {
              var _e31 = _step25.value;
              t(_e31);
            }
          } catch (err) {
            _iterator25.e(err);
          } finally {
            _iterator25.f();
          }
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.outputs.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["step", this.input.serialize()];

          for (var _e32 = 0; _e32 < this.labels.length; _e32++) {
            _e32 > 0 && t.push(this.labels[_e32]), t.push(this.outputs[_e32].serialize());
          }

          return t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length - 1 < 4) return e.error("Expected at least 4 arguments, but found only ".concat(t.length - 1, "."));
          if ((t.length - 1) % 2 != 0) return e.error("Expected an even number of arguments.");
          var r = e.parse(t[1], 1, jt);
          if (!r) return null;
          var i = [];
          var n = null;
          e.expectedType && "value" !== e.expectedType.kind && (n = e.expectedType);

          for (var _r40 = 1; _r40 < t.length; _r40 += 2) {
            var _s14 = 1 === _r40 ? -1 / 0 : t[_r40],
                _a13 = t[_r40 + 1],
                _o5 = _r40,
                _l3 = _r40 + 1;

            if ("number" != typeof _s14) return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.', _o5);
            if (i.length && i[i.length - 1][0] >= _s14) return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.', _o5);

            var _u3 = e.parse(_a13, _l3, n);

            if (!_u3) return null;
            n = n || _u3.type, i.push([_s14, _u3]);
          }

          return new Je(n, r, i);
        }
      }]);

      return Je;
    }();

    function Ye(t, e, r) {
      return t * (1 - r) + e * r;
    }

    var We = Object.freeze({
      __proto__: null,
      number: Ye,
      color: function color(t, e, r) {
        return new oe(Ye(t.r, e.r, r), Ye(t.g, e.g, r), Ye(t.b, e.b, r), Ye(t.a, e.a, r));
      },
      array: function array(t, e, r) {
        return t.map(function (t, i) {
          return Ye(t, e[i], r);
        });
      }
    });
    var Qe = 6 / 29 * 3 * (6 / 29),
        tr = Math.PI / 180,
        er = 180 / Math.PI;

    function rr(t) {
      return t > .008856451679035631 ? Math.pow(t, 1 / 3) : t / Qe + 4 / 29;
    }

    function ir(t) {
      return t > 6 / 29 ? t * t * t : Qe * (t - 4 / 29);
    }

    function nr(t) {
      return 255 * (t <= .0031308 ? 12.92 * t : 1.055 * Math.pow(t, 1 / 2.4) - .055);
    }

    function sr(t) {
      return (t /= 255) <= .04045 ? t / 12.92 : Math.pow((t + .055) / 1.055, 2.4);
    }

    function ar(t) {
      var e = sr(t.r),
          r = sr(t.g),
          i = sr(t.b),
          n = rr((.4124564 * e + .3575761 * r + .1804375 * i) / .95047),
          s = rr((.2126729 * e + .7151522 * r + .072175 * i) / 1);
      return {
        l: 116 * s - 16,
        a: 500 * (n - s),
        b: 200 * (s - rr((.0193339 * e + .119192 * r + .9503041 * i) / 1.08883)),
        alpha: t.a
      };
    }

    function or(t) {
      var e = (t.l + 16) / 116,
          r = isNaN(t.a) ? e : e + t.a / 500,
          i = isNaN(t.b) ? e : e - t.b / 200;
      return e = 1 * ir(e), r = .95047 * ir(r), i = 1.08883 * ir(i), new oe(nr(3.2404542 * r - 1.5371385 * e - .4985314 * i), nr(-.969266 * r + 1.8760108 * e + .041556 * i), nr(.0556434 * r - .2040259 * e + 1.0572252 * i), t.alpha);
    }

    function lr(t, e, r) {
      var i = e - t;
      return t + r * (i > 180 || i < -180 ? i - 360 * Math.round(i / 360) : i);
    }

    var ur = {
      forward: ar,
      reverse: or,
      interpolate: function interpolate(t, e, r) {
        return {
          l: Ye(t.l, e.l, r),
          a: Ye(t.a, e.a, r),
          b: Ye(t.b, e.b, r),
          alpha: Ye(t.alpha, e.alpha, r)
        };
      }
    },
        cr = {
      forward: function forward(t) {
        var _ar = ar(t),
            e = _ar.l,
            r = _ar.a,
            i = _ar.b,
            n = Math.atan2(i, r) * er;

        return {
          h: n < 0 ? n + 360 : n,
          c: Math.sqrt(r * r + i * i),
          l: e,
          alpha: t.a
        };
      },
      reverse: function reverse(t) {
        var e = t.h * tr,
            r = t.c;
        return or({
          l: t.l,
          a: Math.cos(e) * r,
          b: Math.sin(e) * r,
          alpha: t.alpha
        });
      },
      interpolate: function interpolate(t, e, r) {
        return {
          h: lr(t.h, e.h, r),
          c: Ye(t.c, e.c, r),
          l: Ye(t.l, e.l, r),
          alpha: Ye(t.alpha, e.alpha, r)
        };
      }
    };
    var hr = Object.freeze({
      __proto__: null,
      lab: ur,
      hcl: cr
    });

    var pr = /*#__PURE__*/function () {
      function pr(t, e, r, i, n) {
        _classCallCheck(this, pr);

        this.type = t, this.operator = e, this.interpolation = r, this.input = i, this.labels = [], this.outputs = [];

        var _iterator26 = _createForOfIteratorHelper(n),
            _step26;

        try {
          for (_iterator26.s(); !(_step26 = _iterator26.n()).done;) {
            var _ref16 = _step26.value;

            var _ref15 = _slicedToArray(_ref16, 2);

            var _t25 = _ref15[0];
            var _e33 = _ref15[1];
            this.labels.push(_t25), this.outputs.push(_e33);
          }
        } catch (err) {
          _iterator26.e(err);
        } finally {
          _iterator26.f();
        }
      }

      _createClass(pr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.labels,
              r = this.outputs;
          if (1 === e.length) return r[0].evaluate(t);
          var i = this.input.evaluate(t);
          if (i <= e[0]) return r[0].evaluate(t);
          var n = e.length;
          if (i >= e[n - 1]) return r[n - 1].evaluate(t);
          var s = He(e, i),
              a = pr.interpolationFactor(this.interpolation, i, e[s], e[s + 1]),
              o = r[s].evaluate(t),
              l = r[s + 1].evaluate(t);
          return "interpolate" === this.operator ? We[this.type.kind.toLowerCase()](o, l, a) : "interpolate-hcl" === this.operator ? cr.reverse(cr.interpolate(cr.forward(o), cr.forward(l), a)) : ur.reverse(ur.interpolate(ur.forward(o), ur.forward(l), a));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input);

          var _iterator27 = _createForOfIteratorHelper(this.outputs),
              _step27;

          try {
            for (_iterator27.s(); !(_step27 = _iterator27.n()).done;) {
              var _e34 = _step27.value;
              t(_e34);
            }
          } catch (err) {
            _iterator27.e(err);
          } finally {
            _iterator27.f();
          }
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.outputs.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t;
          t = "linear" === this.interpolation.name ? ["linear"] : "exponential" === this.interpolation.name ? 1 === this.interpolation.base ? ["linear"] : ["exponential", this.interpolation.base] : ["cubic-bezier"].concat(this.interpolation.controlPoints);
          var e = [this.operator, t, this.input.serialize()];

          for (var _t26 = 0; _t26 < this.labels.length; _t26++) {
            e.push(this.labels[_t26], this.outputs[_t26].serialize());
          }

          return e;
        }
      }], [{
        key: "interpolationFactor",
        value: function interpolationFactor(t, r, i, n) {
          var s = 0;
          if ("exponential" === t.name) s = dr(r, t.base, i, n);else if ("linear" === t.name) s = dr(r, 1, i, n);else if ("cubic-bezier" === t.name) {
            var _a14 = t.controlPoints;
            s = new e(_a14[0], _a14[1], _a14[2], _a14[3]).solve(dr(r, 1, i, n));
          }
          return s;
        }
      }, {
        key: "parse",
        value: function parse(t, e) {
          var _t27 = _toArray(t),
              r = _t27[0],
              i = _t27[1],
              n = _t27[2],
              s = _t27.slice(3);

          if (!Array.isArray(i) || 0 === i.length) return e.error("Expected an interpolation type expression.", 1);
          if ("linear" === i[0]) i = {
            name: "linear"
          };else if ("exponential" === i[0]) {
            var _t28 = i[1];
            if ("number" != typeof _t28) return e.error("Exponential interpolation requires a numeric base.", 1, 1);
            i = {
              name: "exponential",
              base: _t28
            };
          } else {
            if ("cubic-bezier" !== i[0]) return e.error("Unknown interpolation type ".concat(String(i[0])), 1, 0);
            {
              var _t29 = i.slice(1);

              if (4 !== _t29.length || _t29.some(function (t) {
                return "number" != typeof t || t < 0 || t > 1;
              })) return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.", 1);
              i = {
                name: "cubic-bezier",
                controlPoints: _t29
              };
            }
          }
          if (t.length - 1 < 4) return e.error("Expected at least 4 arguments, but found only ".concat(t.length - 1, "."));
          if ((t.length - 1) % 2 != 0) return e.error("Expected an even number of arguments.");
          if (n = e.parse(n, 2, jt), !n) return null;
          var a = [];
          var o = null;
          "interpolate-hcl" === r || "interpolate-lab" === r ? o = Xt : e.expectedType && "value" !== e.expectedType.kind && (o = e.expectedType);

          for (var _t30 = 0; _t30 < s.length; _t30 += 2) {
            var _r41 = s[_t30],
                _i23 = s[_t30 + 1],
                _n14 = _t30 + 3,
                _l4 = _t30 + 4;

            if ("number" != typeof _r41) return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.', _n14);
            if (a.length && a[a.length - 1][0] >= _r41) return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.', _n14);

            var _u4 = e.parse(_i23, _l4, o);

            if (!_u4) return null;
            o = o || _u4.type, a.push([_r41, _u4]);
          }

          return "number" === o.kind || "color" === o.kind || "array" === o.kind && "number" === o.itemType.kind && "number" == typeof o.N ? new pr(o, r, i, n, a) : e.error("Type ".concat(te(o), " is not interpolatable."));
        }
      }]);

      return pr;
    }();

    function dr(t, e, r, i) {
      var n = i - r,
          s = t - r;
      return 0 === n ? 0 : 1 === e ? s / n : (Math.pow(e, s) - 1) / (Math.pow(e, n) - 1);
    }

    var fr = /*#__PURE__*/function () {
      function fr(t, e) {
        _classCallCheck(this, fr);

        this.type = t, this.args = e;
      }

      _createClass(fr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e,
              r = null,
              i = 0;

          var _iterator28 = _createForOfIteratorHelper(this.args),
              _step28;

          try {
            for (_iterator28.s(); !(_step28 = _iterator28.n()).done;) {
              var _n15 = _step28.value;
              if (i++, r = _n15.evaluate(t), r && r instanceof he && !r.available && (e || (e = r.name), r = null, i === this.args.length && (r = e)), null !== r) break;
            }
          } catch (err) {
            _iterator28.e(err);
          } finally {
            _iterator28.f();
          }

          return r;
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.args.forEach(t);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.args.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["coalesce"];
          return this.eachChild(function (e) {
            t.push(e.serialize());
          }), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 2) return e.error("Expectected at least one argument.");
          var r = null;
          var i = e.expectedType;
          i && "value" !== i.kind && (r = i);
          var n = [];

          var _iterator29 = _createForOfIteratorHelper(t.slice(1)),
              _step29;

          try {
            for (_iterator29.s(); !(_step29 = _iterator29.n()).done;) {
              var _i24 = _step29.value;

              var _t31 = e.parse(_i24, 1 + n.length, r, void 0, {
                typeAnnotation: "omit"
              });

              if (!_t31) return null;
              r = r || _t31.type, n.push(_t31);
            }
          } catch (err) {
            _iterator29.e(err);
          } finally {
            _iterator29.f();
          }

          var s = i && n.some(function (t) {
            return re(i, t.type);
          });
          return new fr(s ? Ht : r, n);
        }
      }]);

      return fr;
    }();

    var yr = /*#__PURE__*/function () {
      function yr(t, e) {
        _classCallCheck(this, yr);

        this.type = e.type, this.bindings = [].concat(t), this.result = e;
      }

      _createClass(yr, [{
        key: "evaluate",
        value: function evaluate(t) {
          return this.result.evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          var _iterator30 = _createForOfIteratorHelper(this.bindings),
              _step30;

          try {
            for (_iterator30.s(); !(_step30 = _iterator30.n()).done;) {
              var _e35 = _step30.value;
              t(_e35[1]);
            }
          } catch (err) {
            _iterator30.e(err);
          } finally {
            _iterator30.f();
          }

          t(this.result);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.result.outputDefined();
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["let"];

          var _iterator31 = _createForOfIteratorHelper(this.bindings),
              _step31;

          try {
            for (_iterator31.s(); !(_step31 = _iterator31.n()).done;) {
              var _ref19 = _step31.value;

              var _ref18 = _slicedToArray(_ref19, 2);

              var _e36 = _ref18[0];
              var _r42 = _ref18[1];
              t.push(_e36, _r42.serialize());
            }
          } catch (err) {
            _iterator31.e(err);
          } finally {
            _iterator31.f();
          }

          return t.push(this.result.serialize()), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 4) return e.error("Expected at least 3 arguments, but found ".concat(t.length - 1, " instead."));
          var r = [];

          for (var _i25 = 1; _i25 < t.length - 1; _i25 += 2) {
            var _n16 = t[_i25];
            if ("string" != typeof _n16) return e.error("Expected string, but found ".concat(_typeof(_n16), " instead."), _i25);
            if (/[^a-zA-Z0-9_]/.test(_n16)) return e.error("Variable names must contain only alphanumeric characters or '_'.", _i25);

            var _s15 = e.parse(t[_i25 + 1], _i25 + 1);

            if (!_s15) return null;
            r.push([_n16, _s15]);
          }

          var i = e.parse(t[t.length - 1], t.length - 1, e.expectedType, r);
          return i ? new yr(r, i) : null;
        }
      }]);

      return yr;
    }();

    var mr = /*#__PURE__*/function () {
      function mr(t, e, r) {
        _classCallCheck(this, mr);

        this.type = t, this.index = e, this.input = r;
      }

      _createClass(mr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.index.evaluate(t),
              r = this.input.evaluate(t);
          if (e < 0) throw new ge("Array index out of bounds: ".concat(e, " < 0."));
          if (e >= r.length) throw new ge("Array index out of bounds: ".concat(e, " > ").concat(r.length - 1, "."));
          if (e !== Math.floor(e)) throw new ge("Array index must be an integer, but found ".concat(e, " instead."));
          return r[e];
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.index), t(this.input);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["at", this.index.serialize(), this.input.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (3 !== t.length) return e.error("Expected 2 arguments, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1, jt),
              i = e.parse(t[2], 2, Qt(e.expectedType || Ht));
          return r && i ? new mr(i.type.itemType, r, i) : null;
        }
      }]);

      return mr;
    }();

    var gr = /*#__PURE__*/function () {
      function gr(t, e) {
        _classCallCheck(this, gr);

        this.type = Zt, this.needle = t, this.haystack = e;
      }

      _createClass(gr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.needle.evaluate(t),
              r = this.haystack.evaluate(t);
          if (!r) return !1;
          if (!ne(e, ["boolean", "string", "number", "null"])) throw new ge("Expected first argument to be of type boolean, string, number or null, but found ".concat(te(fe(e)), " instead."));
          if (!ne(r, ["string", "array"])) throw new ge("Expected second argument to be of type array or string, but found ".concat(te(fe(r)), " instead."));
          return r.indexOf(e) >= 0;
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.needle), t(this.haystack);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !0;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["in", this.needle.serialize(), this.haystack.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (3 !== t.length) return e.error("Expected 2 arguments, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1, Ht),
              i = e.parse(t[2], 2, Ht);
          return r && i ? ie(r.type, [Zt, Kt, jt, Nt, Ht]) ? new gr(r, i) : e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(te(r.type), " instead")) : null;
        }
      }]);

      return gr;
    }();

    var xr = /*#__PURE__*/function () {
      function xr(t, e, r) {
        _classCallCheck(this, xr);

        this.type = jt, this.needle = t, this.haystack = e, this.fromIndex = r;
      }

      _createClass(xr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.needle.evaluate(t),
              r = this.haystack.evaluate(t);
          if (!ne(e, ["boolean", "string", "number", "null"])) throw new ge("Expected first argument to be of type boolean, string, number or null, but found ".concat(te(fe(e)), " instead."));
          if (!ne(r, ["string", "array"])) throw new ge("Expected second argument to be of type array or string, but found ".concat(te(fe(r)), " instead."));

          if (this.fromIndex) {
            var _i26 = this.fromIndex.evaluate(t);

            return r.indexOf(e, _i26);
          }

          return r.indexOf(e);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.needle), t(this.haystack), this.fromIndex && t(this.fromIndex);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          if (null != this.fromIndex && void 0 !== this.fromIndex) {
            var _t32 = this.fromIndex.serialize();

            return ["index-of", this.needle.serialize(), this.haystack.serialize(), _t32];
          }

          return ["index-of", this.needle.serialize(), this.haystack.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length <= 2 || t.length >= 5) return e.error("Expected 3 or 4 arguments, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1, Ht),
              i = e.parse(t[2], 2, Ht);
          if (!r || !i) return null;
          if (!ie(r.type, [Zt, Kt, jt, Nt, Ht])) return e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(te(r.type), " instead"));

          if (4 === t.length) {
            var _n17 = e.parse(t[3], 3, jt);

            return _n17 ? new xr(r, i, _n17) : null;
          }

          return new xr(r, i);
        }
      }]);

      return xr;
    }();

    var vr = /*#__PURE__*/function () {
      function vr(t, e, r, i, n, s) {
        _classCallCheck(this, vr);

        this.inputType = t, this.type = e, this.input = r, this.cases = i, this.outputs = n, this.otherwise = s;
      }

      _createClass(vr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.input.evaluate(t);
          return (fe(e) === this.inputType && this.outputs[this.cases[e]] || this.otherwise).evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input), this.outputs.forEach(t), t(this.otherwise);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.outputs.every(function (t) {
            return t.outputDefined();
          }) && this.otherwise.outputDefined();
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var _this11 = this;

          var t = ["match", this.input.serialize()],
              e = Object.keys(this.cases).sort(),
              r = [],
              i = {};

          var _iterator32 = _createForOfIteratorHelper(e),
              _step32;

          try {
            for (_iterator32.s(); !(_step32 = _iterator32.n()).done;) {
              var _t33 = _step32.value;
              var _e38 = i[this.cases[_t33]];
              void 0 === _e38 ? (i[this.cases[_t33]] = r.length, r.push([this.cases[_t33], [_t33]])) : r[_e38][1].push(_t33);
            }
          } catch (err) {
            _iterator32.e(err);
          } finally {
            _iterator32.f();
          }

          var n = function n(t) {
            return "number" === _this11.inputType.kind ? Number(t) : t;
          };

          for (var _i27 = 0, _r43 = r; _i27 < _r43.length; _i27++) {
            var _ref22 = _r43[_i27];

            var _ref21 = _slicedToArray(_ref22, 2);

            var _e37 = _ref21[0];
            var _i28 = _ref21[1];
            t.push(1 === _i28.length ? n(_i28[0]) : _i28.map(n)), t.push(this.outputs[_e37].serialize());
          }

          return t.push(this.otherwise.serialize()), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 5) return e.error("Expected at least 4 arguments, but found only ".concat(t.length - 1, "."));
          if (t.length % 2 != 1) return e.error("Expected an even number of arguments.");
          var r, i;
          e.expectedType && "value" !== e.expectedType.kind && (i = e.expectedType);
          var n = {},
              s = [];

          for (var _a15 = 2; _a15 < t.length - 1; _a15 += 2) {
            var _o6 = t[_a15];
            var _l5 = t[_a15 + 1];
            Array.isArray(_o6) || (_o6 = [_o6]);

            var _u5 = e.concat(_a15);

            if (0 === _o6.length) return _u5.error("Expected at least one branch label.");

            var _iterator33 = _createForOfIteratorHelper(_o6),
                _step33;

            try {
              for (_iterator33.s(); !(_step33 = _iterator33.n()).done;) {
                var _t34 = _step33.value;
                if ("number" != typeof _t34 && "string" != typeof _t34) return _u5.error("Branch labels must be numbers or strings.");
                if ("number" == typeof _t34 && Math.abs(_t34) > Number.MAX_SAFE_INTEGER) return _u5.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER, "."));
                if ("number" == typeof _t34 && Math.floor(_t34) !== _t34) return _u5.error("Numeric branch labels must be integer values.");

                if (r) {
                  if (_u5.checkSubtype(r, fe(_t34))) return null;
                } else r = fe(_t34);

                if (void 0 !== n[String(_t34)]) return _u5.error("Branch labels must be unique.");
                n[String(_t34)] = s.length;
              }
            } catch (err) {
              _iterator33.e(err);
            } finally {
              _iterator33.f();
            }

            var _c2 = e.parse(_l5, _a15, i);

            if (!_c2) return null;
            i = i || _c2.type, s.push(_c2);
          }

          var a = e.parse(t[1], 1, Ht);
          if (!a) return null;
          var o = e.parse(t[t.length - 1], t.length - 1, i);
          return o ? "value" !== a.type.kind && e.concat(1).checkSubtype(r, a.type) ? null : new vr(r, i, a, n, s, o) : null;
        }
      }]);

      return vr;
    }();

    var br = /*#__PURE__*/function () {
      function br(t, e, r) {
        _classCallCheck(this, br);

        this.type = t, this.branches = e, this.otherwise = r;
      }

      _createClass(br, [{
        key: "evaluate",
        value: function evaluate(t) {
          var _iterator34 = _createForOfIteratorHelper(this.branches),
              _step34;

          try {
            for (_iterator34.s(); !(_step34 = _iterator34.n()).done;) {
              var _ref25 = _step34.value;

              var _ref24 = _slicedToArray(_ref25, 2);

              var _e39 = _ref24[0];
              var _r44 = _ref24[1];
              if (_e39.evaluate(t)) return _r44.evaluate(t);
            }
          } catch (err) {
            _iterator34.e(err);
          } finally {
            _iterator34.f();
          }

          return this.otherwise.evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          var _iterator35 = _createForOfIteratorHelper(this.branches),
              _step35;

          try {
            for (_iterator35.s(); !(_step35 = _iterator35.n()).done;) {
              var _ref28 = _step35.value;

              var _ref27 = _slicedToArray(_ref28, 2);

              var _e40 = _ref27[0];
              var _r45 = _ref27[1];
              t(_e40), t(_r45);
            }
          } catch (err) {
            _iterator35.e(err);
          } finally {
            _iterator35.f();
          }

          t(this.otherwise);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.branches.every(function (_ref29) {
            var _ref30 = _slicedToArray(_ref29, 2),
                t = _ref30[0],
                e = _ref30[1];

            return e.outputDefined();
          }) && this.otherwise.outputDefined();
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["case"];
          return this.eachChild(function (e) {
            t.push(e.serialize());
          }), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 4) return e.error("Expected at least 3 arguments, but found only ".concat(t.length - 1, "."));
          if (t.length % 2 != 0) return e.error("Expected an odd number of arguments.");
          var r;
          e.expectedType && "value" !== e.expectedType.kind && (r = e.expectedType);
          var i = [];

          for (var _n18 = 1; _n18 < t.length - 1; _n18 += 2) {
            var _s16 = e.parse(t[_n18], _n18, Zt);

            if (!_s16) return null;

            var _a16 = e.parse(t[_n18 + 1], _n18 + 1, r);

            if (!_a16) return null;
            i.push([_s16, _a16]), r = r || _a16.type;
          }

          var n = e.parse(t[t.length - 1], t.length - 1, r);
          return n ? new br(r, i, n) : null;
        }
      }]);

      return br;
    }();

    var wr = /*#__PURE__*/function () {
      function wr(t, e, r, i) {
        _classCallCheck(this, wr);

        this.type = t, this.input = e, this.beginIndex = r, this.endIndex = i;
      }

      _createClass(wr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.input.evaluate(t),
              r = this.beginIndex.evaluate(t);
          if (!ne(e, ["string", "array"])) throw new ge("Expected first argument to be of type array or string, but found ".concat(te(fe(e)), " instead."));

          if (this.endIndex) {
            var _i29 = this.endIndex.evaluate(t);

            return e.slice(r, _i29);
          }

          return e.slice(r);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input), t(this.beginIndex), this.endIndex && t(this.endIndex);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          if (null != this.endIndex && void 0 !== this.endIndex) {
            var _t35 = this.endIndex.serialize();

            return ["slice", this.input.serialize(), this.beginIndex.serialize(), _t35];
          }

          return ["slice", this.input.serialize(), this.beginIndex.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length <= 2 || t.length >= 5) return e.error("Expected 3 or 4 arguments, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1, Ht),
              i = e.parse(t[2], 2, jt);
          if (!r || !i) return null;
          if (!ie(r.type, [Qt(Ht), Kt, Ht])) return e.error("Expected first argument to be of type array or string, but found ".concat(te(r.type), " instead"));

          if (4 === t.length) {
            var _n19 = e.parse(t[3], 3, jt);

            return _n19 ? new wr(r.type, r, i, _n19) : null;
          }

          return new wr(r.type, r, i);
        }
      }]);

      return wr;
    }();

    function _r(t, e) {
      return "==" === t || "!=" === t ? "boolean" === e.kind || "string" === e.kind || "number" === e.kind || "null" === e.kind || "value" === e.kind : "string" === e.kind || "number" === e.kind || "value" === e.kind;
    }

    function Ar(t, e, r, i) {
      return 0 === i.compare(e, r);
    }

    function kr(t, e, r) {
      var i = "==" !== t && "!=" !== t;
      return /*#__PURE__*/function () {
        function n(t, e, r) {
          _classCallCheck(this, n);

          this.type = Zt, this.lhs = t, this.rhs = e, this.collator = r, this.hasUntypedArgument = "value" === t.type.kind || "value" === e.type.kind;
        }

        _createClass(n, [{
          key: "evaluate",
          value: function evaluate(n) {
            var s = this.lhs.evaluate(n),
                a = this.rhs.evaluate(n);

            if (i && this.hasUntypedArgument) {
              var _e41 = fe(s),
                  _r46 = fe(a);

              if (_e41.kind !== _r46.kind || "string" !== _e41.kind && "number" !== _e41.kind) throw new ge("Expected arguments for \"".concat(t, "\" to be (string, string) or (number, number), but found (").concat(_e41.kind, ", ").concat(_r46.kind, ") instead."));
            }

            if (this.collator && !i && this.hasUntypedArgument) {
              var _t36 = fe(s),
                  _r47 = fe(a);

              if ("string" !== _t36.kind || "string" !== _r47.kind) return e(n, s, a);
            }

            return this.collator ? r(n, s, a, this.collator.evaluate(n)) : e(n, s, a);
          }
        }, {
          key: "eachChild",
          value: function eachChild(t) {
            t(this.lhs), t(this.rhs), this.collator && t(this.collator);
          }
        }, {
          key: "outputDefined",
          value: function outputDefined() {
            return !0;
          }
        }, {
          key: "serialize",
          value: function serialize() {
            var e = [t];
            return this.eachChild(function (t) {
              e.push(t.serialize());
            }), e;
          }
        }], [{
          key: "parse",
          value: function parse(t, e) {
            if (3 !== t.length && 4 !== t.length) return e.error("Expected two or three arguments.");
            var r = t[0];
            var s = e.parse(t[1], 1, Ht);
            if (!s) return null;
            if (!_r(r, s.type)) return e.concat(1).error("\"".concat(r, "\" comparisons are not supported for type '").concat(te(s.type), "'."));
            var a = e.parse(t[2], 2, Ht);
            if (!a) return null;
            if (!_r(r, a.type)) return e.concat(2).error("\"".concat(r, "\" comparisons are not supported for type '").concat(te(a.type), "'."));
            if (s.type.kind !== a.type.kind && "value" !== s.type.kind && "value" !== a.type.kind) return e.error("Cannot compare types '".concat(te(s.type), "' and '").concat(te(a.type), "'."));
            i && ("value" === s.type.kind && "value" !== a.type.kind ? s = new ve(a.type, [s]) : "value" !== s.type.kind && "value" === a.type.kind && (a = new ve(s.type, [a])));
            var o = null;

            if (4 === t.length) {
              if ("string" !== s.type.kind && "string" !== a.type.kind && "value" !== s.type.kind && "value" !== a.type.kind) return e.error("Cannot use collator to compare non-string types.");
              if (o = e.parse(t[3], 3, Jt), !o) return null;
            }

            return new n(s, a, o);
          }
        }]);

        return n;
      }();
    }

    var Sr = kr("==", function (t, e, r) {
      return e === r;
    }, Ar),
        Ir = kr("!=", function (t, e, r) {
      return e !== r;
    }, function (t, e, r, i) {
      return !Ar(0, e, r, i);
    }),
        Tr = kr("<", function (t, e, r) {
      return e < r;
    }, function (t, e, r, i) {
      return i.compare(e, r) < 0;
    }),
        zr = kr(">", function (t, e, r) {
      return e > r;
    }, function (t, e, r, i) {
      return i.compare(e, r) > 0;
    }),
        Er = kr("<=", function (t, e, r) {
      return e <= r;
    }, function (t, e, r, i) {
      return i.compare(e, r) <= 0;
    });

    var Cr = /*#__PURE__*/function () {
      function Cr(t, e, r, i, n) {
        _classCallCheck(this, Cr);

        this.type = Kt, this.number = t, this.locale = e, this.currency = r, this.minFractionDigits = i, this.maxFractionDigits = n;
      }

      _createClass(Cr, [{
        key: "evaluate",
        value: function evaluate(t) {
          return new Intl.NumberFormat(this.locale ? this.locale.evaluate(t) : [], {
            style: this.currency ? "currency" : "decimal",
            currency: this.currency ? this.currency.evaluate(t) : void 0,
            minimumFractionDigits: this.minFractionDigits ? this.minFractionDigits.evaluate(t) : void 0,
            maximumFractionDigits: this.maxFractionDigits ? this.maxFractionDigits.evaluate(t) : void 0
          }).format(this.number.evaluate(t));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.number), this.locale && t(this.locale), this.currency && t(this.currency), this.minFractionDigits && t(this.minFractionDigits), this.maxFractionDigits && t(this.maxFractionDigits);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {};
          return this.locale && (t.locale = this.locale.serialize()), this.currency && (t.currency = this.currency.serialize()), this.minFractionDigits && (t["min-fraction-digits"] = this.minFractionDigits.serialize()), this.maxFractionDigits && (t["max-fraction-digits"] = this.maxFractionDigits.serialize()), ["number-format", this.number.serialize(), t];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (3 !== t.length) return e.error("Expected two arguments.");
          var r = e.parse(t[1], 1, jt);
          if (!r) return null;
          var i = t[2];
          if ("object" != _typeof(i) || Array.isArray(i)) return e.error("NumberFormat options argument must be an object.");
          var n = null;
          if (i.locale && (n = e.parse(i.locale, 1, Kt), !n)) return null;
          var s = null;
          if (i.currency && (s = e.parse(i.currency, 1, Kt), !s)) return null;
          var a = null;
          if (i["min-fraction-digits"] && (a = e.parse(i["min-fraction-digits"], 1, jt), !a)) return null;
          var o = null;
          return i["max-fraction-digits"] && (o = e.parse(i["max-fraction-digits"], 1, jt), !o) ? null : new Cr(r, n, s, a, o);
        }
      }]);

      return Cr;
    }();

    var Mr = /*#__PURE__*/function () {
      function Mr(t) {
        _classCallCheck(this, Mr);

        this.type = jt, this.input = t;
      }

      _createClass(Mr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.input.evaluate(t);
          if ("string" == typeof e) return e.length;
          if (Array.isArray(e)) return e.length;
          throw new ge("Expected value to be of type string or array, but found ".concat(te(fe(e)), " instead."));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["length"];
          return this.eachChild(function (e) {
            t.push(e.serialize());
          }), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("Expected 1 argument, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1);
          return r ? "array" !== r.type.kind && "string" !== r.type.kind && "value" !== r.type.kind ? e.error("Expected argument of type string or array, but found ".concat(te(r.type), " instead.")) : new Mr(r) : null;
        }
      }]);

      return Mr;
    }();

    var Br = {
      "==": Sr,
      "!=": Ir,
      ">": zr,
      "<": Tr,
      ">=": kr(">=", function (t, e, r) {
        return e >= r;
      }, function (t, e, r, i) {
        return i.compare(e, r) >= 0;
      }),
      "<=": Er,
      array: ve,
      at: mr,
      "boolean": ve,
      "case": br,
      coalesce: fr,
      collator: Te,
      format: be,
      image: we,
      "in": gr,
      "index-of": xr,
      interpolate: pr,
      "interpolate-hcl": pr,
      "interpolate-lab": pr,
      length: Mr,
      "let": yr,
      literal: me,
      match: vr,
      number: ve,
      "number-format": Cr,
      object: ve,
      slice: wr,
      step: Je,
      string: ve,
      "to-boolean": Ae,
      "to-color": Ae,
      "to-number": Ae,
      "to-string": Ae,
      "var": Xe,
      within: Ne
    };

    function Dr(t, _ref31) {
      var _ref32 = _slicedToArray(_ref31, 4),
          e = _ref32[0],
          r = _ref32[1],
          i = _ref32[2],
          n = _ref32[3];

      e = e.evaluate(t), r = r.evaluate(t), i = i.evaluate(t);
      var s = n ? n.evaluate(t) : 1,
          a = pe(e, r, i, s);
      if (a) throw new ge(a);
      return new oe(e / 255 * s, r / 255 * s, i / 255 * s, s);
    }

    function Pr(t, e) {
      return t in e;
    }

    function Vr(t, e) {
      var r = e[t];
      return void 0 === r ? null : r;
    }

    function Fr(t) {
      return {
        type: t
      };
    }

    function Rr(t) {
      return {
        result: "success",
        value: t
      };
    }

    function Lr(t) {
      return {
        result: "error",
        value: t
      };
    }

    function Ur(t) {
      return "data-driven" === t["property-type"] || "cross-faded-data-driven" === t["property-type"];
    }

    function Or(t) {
      return !!t.expression && t.expression.parameters.indexOf("zoom") > -1;
    }

    function $r(t) {
      return !!t.expression && t.expression.interpolated;
    }

    function qr(t) {
      return t instanceof Number ? "number" : t instanceof String ? "string" : t instanceof Boolean ? "boolean" : Array.isArray(t) ? "array" : null === t ? "null" : _typeof(t);
    }

    function Nr(t) {
      return "object" == _typeof(t) && null !== t && !Array.isArray(t);
    }

    function jr(t) {
      return t;
    }

    function Kr(t, e, r) {
      return void 0 !== t ? t : void 0 !== e ? e : void 0 !== r ? r : void 0;
    }

    function Zr(t, e, r, i, n) {
      return Kr(_typeof(r) === n ? i[r] : void 0, t["default"], e["default"]);
    }

    function Xr(t, e, r) {
      if ("number" !== qr(r)) return Kr(t["default"], e["default"]);
      var i = t.stops.length;
      if (1 === i) return t.stops[0][1];
      if (r <= t.stops[0][0]) return t.stops[0][1];
      if (r >= t.stops[i - 1][0]) return t.stops[i - 1][1];
      var n = He(t.stops.map(function (t) {
        return t[0];
      }), r);
      return t.stops[n][1];
    }

    function Gr(t, e, r) {
      var i = void 0 !== t.base ? t.base : 1;
      if ("number" !== qr(r)) return Kr(t["default"], e["default"]);
      var n = t.stops.length;
      if (1 === n) return t.stops[0][1];
      if (r <= t.stops[0][0]) return t.stops[0][1];
      if (r >= t.stops[n - 1][0]) return t.stops[n - 1][1];

      var s = He(t.stops.map(function (t) {
        return t[0];
      }), r),
          a = function (t, e, r, i) {
        var n = i - r,
            s = t - r;
        return 0 === n ? 0 : 1 === e ? s / n : (Math.pow(e, s) - 1) / (Math.pow(e, n) - 1);
      }(r, i, t.stops[s][0], t.stops[s + 1][0]),
          o = t.stops[s][1],
          l = t.stops[s + 1][1];

      var u = We[e.type] || jr;

      if (t.colorSpace && "rgb" !== t.colorSpace) {
        var _e42 = hr[t.colorSpace];

        u = function u(t, r) {
          return _e42.reverse(_e42.interpolate(_e42.forward(t), _e42.forward(r), a));
        };
      }

      return "function" == typeof o.evaluate ? {
        evaluate: function evaluate() {
          for (var _len4 = arguments.length, t = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
            t[_key4] = arguments[_key4];
          }

          var e = o.evaluate.apply(void 0, t),
              r = l.evaluate.apply(void 0, t);
          if (void 0 !== e && void 0 !== r) return u(e, r, a);
        }
      } : u(o, l, a);
    }

    function Hr(t, e, r) {
      return "color" === e.type ? r = oe.parse(r) : "formatted" === e.type ? r = ce.fromString(r.toString()) : "resolvedImage" === e.type ? r = he.fromString(r.toString()) : qr(r) === e.type || "enum" === e.type && e.values[r] || (r = void 0), Kr(r, t["default"], e["default"]);
    }

    Ie.register(Br, {
      error: [{
        kind: "error"
      }, [Kt], function (t, _ref33) {
        var _ref34 = _slicedToArray(_ref33, 1),
            e = _ref34[0];

        throw new ge(e.evaluate(t));
      }],
      "typeof": [Kt, [Ht], function (t, _ref35) {
        var _ref36 = _slicedToArray(_ref35, 1),
            e = _ref36[0];

        return te(fe(e.evaluate(t)));
      }],
      "to-rgba": [Qt(jt, 4), [Xt], function (t, _ref37) {
        var _ref38 = _slicedToArray(_ref37, 1),
            e = _ref38[0];

        return e.evaluate(t).toArray();
      }],
      rgb: [Xt, [jt, jt, jt], Dr],
      rgba: [Xt, [jt, jt, jt, jt], Dr],
      has: {
        type: Zt,
        overloads: [[[Kt], function (t, _ref39) {
          var _ref40 = _slicedToArray(_ref39, 1),
              e = _ref40[0];

          return Pr(e.evaluate(t), t.properties());
        }], [[Kt, Gt], function (t, _ref41) {
          var _ref42 = _slicedToArray(_ref41, 2),
              e = _ref42[0],
              r = _ref42[1];

          return Pr(e.evaluate(t), r.evaluate(t));
        }]]
      },
      get: {
        type: Ht,
        overloads: [[[Kt], function (t, _ref43) {
          var _ref44 = _slicedToArray(_ref43, 1),
              e = _ref44[0];

          return Vr(e.evaluate(t), t.properties());
        }], [[Kt, Gt], function (t, _ref45) {
          var _ref46 = _slicedToArray(_ref45, 2),
              e = _ref46[0],
              r = _ref46[1];

          return Vr(e.evaluate(t), r.evaluate(t));
        }]]
      },
      "feature-state": [Ht, [Kt], function (t, _ref47) {
        var _ref48 = _slicedToArray(_ref47, 1),
            e = _ref48[0];

        return Vr(e.evaluate(t), t.featureState || {});
      }],
      properties: [Gt, [], function (t) {
        return t.properties();
      }],
      "geometry-type": [Kt, [], function (t) {
        return t.geometryType();
      }],
      id: [Ht, [], function (t) {
        return t.id();
      }],
      zoom: [jt, [], function (t) {
        return t.globals.zoom;
      }],
      "heatmap-density": [jt, [], function (t) {
        return t.globals.heatmapDensity || 0;
      }],
      "line-progress": [jt, [], function (t) {
        return t.globals.lineProgress || 0;
      }],
      "sky-radial-progress": [jt, [], function (t) {
        return t.globals.skyRadialProgress || 0;
      }],
      accumulated: [Ht, [], function (t) {
        return void 0 === t.globals.accumulated ? null : t.globals.accumulated;
      }],
      "+": [jt, Fr(jt), function (t, e) {
        var r = 0;

        var _iterator36 = _createForOfIteratorHelper(e),
            _step36;

        try {
          for (_iterator36.s(); !(_step36 = _iterator36.n()).done;) {
            var _i30 = _step36.value;
            r += _i30.evaluate(t);
          }
        } catch (err) {
          _iterator36.e(err);
        } finally {
          _iterator36.f();
        }

        return r;
      }],
      "*": [jt, Fr(jt), function (t, e) {
        var r = 1;

        var _iterator37 = _createForOfIteratorHelper(e),
            _step37;

        try {
          for (_iterator37.s(); !(_step37 = _iterator37.n()).done;) {
            var _i31 = _step37.value;
            r *= _i31.evaluate(t);
          }
        } catch (err) {
          _iterator37.e(err);
        } finally {
          _iterator37.f();
        }

        return r;
      }],
      "-": {
        type: jt,
        overloads: [[[jt, jt], function (t, _ref49) {
          var _ref50 = _slicedToArray(_ref49, 2),
              e = _ref50[0],
              r = _ref50[1];

          return e.evaluate(t) - r.evaluate(t);
        }], [[jt], function (t, _ref51) {
          var _ref52 = _slicedToArray(_ref51, 1),
              e = _ref52[0];

          return -e.evaluate(t);
        }]]
      },
      "/": [jt, [jt, jt], function (t, _ref53) {
        var _ref54 = _slicedToArray(_ref53, 2),
            e = _ref54[0],
            r = _ref54[1];

        return e.evaluate(t) / r.evaluate(t);
      }],
      "%": [jt, [jt, jt], function (t, _ref55) {
        var _ref56 = _slicedToArray(_ref55, 2),
            e = _ref56[0],
            r = _ref56[1];

        return e.evaluate(t) % r.evaluate(t);
      }],
      ln2: [jt, [], function () {
        return Math.LN2;
      }],
      pi: [jt, [], function () {
        return Math.PI;
      }],
      e: [jt, [], function () {
        return Math.E;
      }],
      "^": [jt, [jt, jt], function (t, _ref57) {
        var _ref58 = _slicedToArray(_ref57, 2),
            e = _ref58[0],
            r = _ref58[1];

        return Math.pow(e.evaluate(t), r.evaluate(t));
      }],
      sqrt: [jt, [jt], function (t, _ref59) {
        var _ref60 = _slicedToArray(_ref59, 1),
            e = _ref60[0];

        return Math.sqrt(e.evaluate(t));
      }],
      log10: [jt, [jt], function (t, _ref61) {
        var _ref62 = _slicedToArray(_ref61, 1),
            e = _ref62[0];

        return Math.log(e.evaluate(t)) / Math.LN10;
      }],
      ln: [jt, [jt], function (t, _ref63) {
        var _ref64 = _slicedToArray(_ref63, 1),
            e = _ref64[0];

        return Math.log(e.evaluate(t));
      }],
      log2: [jt, [jt], function (t, _ref65) {
        var _ref66 = _slicedToArray(_ref65, 1),
            e = _ref66[0];

        return Math.log(e.evaluate(t)) / Math.LN2;
      }],
      sin: [jt, [jt], function (t, _ref67) {
        var _ref68 = _slicedToArray(_ref67, 1),
            e = _ref68[0];

        return Math.sin(e.evaluate(t));
      }],
      cos: [jt, [jt], function (t, _ref69) {
        var _ref70 = _slicedToArray(_ref69, 1),
            e = _ref70[0];

        return Math.cos(e.evaluate(t));
      }],
      tan: [jt, [jt], function (t, _ref71) {
        var _ref72 = _slicedToArray(_ref71, 1),
            e = _ref72[0];

        return Math.tan(e.evaluate(t));
      }],
      asin: [jt, [jt], function (t, _ref73) {
        var _ref74 = _slicedToArray(_ref73, 1),
            e = _ref74[0];

        return Math.asin(e.evaluate(t));
      }],
      acos: [jt, [jt], function (t, _ref75) {
        var _ref76 = _slicedToArray(_ref75, 1),
            e = _ref76[0];

        return Math.acos(e.evaluate(t));
      }],
      atan: [jt, [jt], function (t, _ref77) {
        var _ref78 = _slicedToArray(_ref77, 1),
            e = _ref78[0];

        return Math.atan(e.evaluate(t));
      }],
      min: [jt, Fr(jt), function (t, e) {
        return Math.min.apply(Math, _toConsumableArray(e.map(function (e) {
          return e.evaluate(t);
        })));
      }],
      max: [jt, Fr(jt), function (t, e) {
        return Math.max.apply(Math, _toConsumableArray(e.map(function (e) {
          return e.evaluate(t);
        })));
      }],
      abs: [jt, [jt], function (t, _ref79) {
        var _ref80 = _slicedToArray(_ref79, 1),
            e = _ref80[0];

        return Math.abs(e.evaluate(t));
      }],
      round: [jt, [jt], function (t, _ref81) {
        var _ref82 = _slicedToArray(_ref81, 1),
            e = _ref82[0];

        var r = e.evaluate(t);
        return r < 0 ? -Math.round(-r) : Math.round(r);
      }],
      floor: [jt, [jt], function (t, _ref83) {
        var _ref84 = _slicedToArray(_ref83, 1),
            e = _ref84[0];

        return Math.floor(e.evaluate(t));
      }],
      ceil: [jt, [jt], function (t, _ref85) {
        var _ref86 = _slicedToArray(_ref85, 1),
            e = _ref86[0];

        return Math.ceil(e.evaluate(t));
      }],
      "filter-==": [Zt, [Kt, Ht], function (t, _ref87) {
        var _ref88 = _slicedToArray(_ref87, 2),
            e = _ref88[0],
            r = _ref88[1];

        return t.properties()[e.value] === r.value;
      }],
      "filter-id-==": [Zt, [Ht], function (t, _ref89) {
        var _ref90 = _slicedToArray(_ref89, 1),
            e = _ref90[0];

        return t.id() === e.value;
      }],
      "filter-type-==": [Zt, [Kt], function (t, _ref91) {
        var _ref92 = _slicedToArray(_ref91, 1),
            e = _ref92[0];

        return t.geometryType() === e.value;
      }],
      "filter-<": [Zt, [Kt, Ht], function (t, _ref93) {
        var _ref94 = _slicedToArray(_ref93, 2),
            e = _ref94[0],
            r = _ref94[1];

        var i = t.properties()[e.value],
            n = r.value;
        return _typeof(i) == _typeof(n) && i < n;
      }],
      "filter-id-<": [Zt, [Ht], function (t, _ref95) {
        var _ref96 = _slicedToArray(_ref95, 1),
            e = _ref96[0];

        var r = t.id(),
            i = e.value;
        return _typeof(r) == _typeof(i) && r < i;
      }],
      "filter->": [Zt, [Kt, Ht], function (t, _ref97) {
        var _ref98 = _slicedToArray(_ref97, 2),
            e = _ref98[0],
            r = _ref98[1];

        var i = t.properties()[e.value],
            n = r.value;
        return _typeof(i) == _typeof(n) && i > n;
      }],
      "filter-id->": [Zt, [Ht], function (t, _ref99) {
        var _ref100 = _slicedToArray(_ref99, 1),
            e = _ref100[0];

        var r = t.id(),
            i = e.value;
        return _typeof(r) == _typeof(i) && r > i;
      }],
      "filter-<=": [Zt, [Kt, Ht], function (t, _ref101) {
        var _ref102 = _slicedToArray(_ref101, 2),
            e = _ref102[0],
            r = _ref102[1];

        var i = t.properties()[e.value],
            n = r.value;
        return _typeof(i) == _typeof(n) && i <= n;
      }],
      "filter-id-<=": [Zt, [Ht], function (t, _ref103) {
        var _ref104 = _slicedToArray(_ref103, 1),
            e = _ref104[0];

        var r = t.id(),
            i = e.value;
        return _typeof(r) == _typeof(i) && r <= i;
      }],
      "filter->=": [Zt, [Kt, Ht], function (t, _ref105) {
        var _ref106 = _slicedToArray(_ref105, 2),
            e = _ref106[0],
            r = _ref106[1];

        var i = t.properties()[e.value],
            n = r.value;
        return _typeof(i) == _typeof(n) && i >= n;
      }],
      "filter-id->=": [Zt, [Ht], function (t, _ref107) {
        var _ref108 = _slicedToArray(_ref107, 1),
            e = _ref108[0];

        var r = t.id(),
            i = e.value;
        return _typeof(r) == _typeof(i) && r >= i;
      }],
      "filter-has": [Zt, [Ht], function (t, _ref109) {
        var _ref110 = _slicedToArray(_ref109, 1),
            e = _ref110[0];

        return e.value in t.properties();
      }],
      "filter-has-id": [Zt, [], function (t) {
        return null !== t.id() && void 0 !== t.id();
      }],
      "filter-type-in": [Zt, [Qt(Kt)], function (t, _ref111) {
        var _ref112 = _slicedToArray(_ref111, 1),
            e = _ref112[0];

        return e.value.indexOf(t.geometryType()) >= 0;
      }],
      "filter-id-in": [Zt, [Qt(Ht)], function (t, _ref113) {
        var _ref114 = _slicedToArray(_ref113, 1),
            e = _ref114[0];

        return e.value.indexOf(t.id()) >= 0;
      }],
      "filter-in-small": [Zt, [Kt, Qt(Ht)], function (t, _ref115) {
        var _ref116 = _slicedToArray(_ref115, 2),
            e = _ref116[0],
            r = _ref116[1];

        return r.value.indexOf(t.properties()[e.value]) >= 0;
      }],
      "filter-in-large": [Zt, [Kt, Qt(Ht)], function (t, _ref117) {
        var _ref118 = _slicedToArray(_ref117, 2),
            e = _ref118[0],
            r = _ref118[1];

        return function (t, e, r, i) {
          for (; r <= i;) {
            var _n20 = r + i >> 1;

            if (e[_n20] === t) return !0;
            e[_n20] > t ? i = _n20 - 1 : r = _n20 + 1;
          }

          return !1;
        }(t.properties()[e.value], r.value, 0, r.value.length - 1);
      }],
      all: {
        type: Zt,
        overloads: [[[Zt, Zt], function (t, _ref119) {
          var _ref120 = _slicedToArray(_ref119, 2),
              e = _ref120[0],
              r = _ref120[1];

          return e.evaluate(t) && r.evaluate(t);
        }], [Fr(Zt), function (t, e) {
          var _iterator38 = _createForOfIteratorHelper(e),
              _step38;

          try {
            for (_iterator38.s(); !(_step38 = _iterator38.n()).done;) {
              var _r48 = _step38.value;
              if (!_r48.evaluate(t)) return !1;
            }
          } catch (err) {
            _iterator38.e(err);
          } finally {
            _iterator38.f();
          }

          return !0;
        }]]
      },
      any: {
        type: Zt,
        overloads: [[[Zt, Zt], function (t, _ref121) {
          var _ref122 = _slicedToArray(_ref121, 2),
              e = _ref122[0],
              r = _ref122[1];

          return e.evaluate(t) || r.evaluate(t);
        }], [Fr(Zt), function (t, e) {
          var _iterator39 = _createForOfIteratorHelper(e),
              _step39;

          try {
            for (_iterator39.s(); !(_step39 = _iterator39.n()).done;) {
              var _r49 = _step39.value;
              if (_r49.evaluate(t)) return !0;
            }
          } catch (err) {
            _iterator39.e(err);
          } finally {
            _iterator39.f();
          }

          return !1;
        }]]
      },
      "!": [Zt, [Zt], function (t, _ref123) {
        var _ref124 = _slicedToArray(_ref123, 1),
            e = _ref124[0];

        return !e.evaluate(t);
      }],
      "is-supported-script": [Zt, [Kt], function (t, _ref125) {
        var _ref126 = _slicedToArray(_ref125, 1),
            e = _ref126[0];

        var r = t.globals && t.globals.isSupportedScript;
        return !r || r(e.evaluate(t));
      }],
      upcase: [Kt, [Kt], function (t, _ref127) {
        var _ref128 = _slicedToArray(_ref127, 1),
            e = _ref128[0];

        return e.evaluate(t).toUpperCase();
      }],
      downcase: [Kt, [Kt], function (t, _ref129) {
        var _ref130 = _slicedToArray(_ref129, 1),
            e = _ref130[0];

        return e.evaluate(t).toLowerCase();
      }],
      concat: [Kt, Fr(Ht), function (t, e) {
        return e.map(function (e) {
          return ye(e.evaluate(t));
        }).join("");
      }],
      "resolved-locale": [Kt, [Jt], function (t, _ref131) {
        var _ref132 = _slicedToArray(_ref131, 1),
            e = _ref132[0];

        return e.evaluate(t).resolvedLocale();
      }]
    });

    var Jr = /*#__PURE__*/function () {
      function Jr(t, e) {
        _classCallCheck(this, Jr);

        this.expression = t, this._warningHistory = {}, this._evaluator = new Se(), this._defaultValue = e ? function (t) {
          return "color" === t.type && Nr(t["default"]) ? new oe(0, 0, 0, 0) : "color" === t.type ? oe.parse(t["default"]) || null : void 0 === t["default"] ? null : t["default"];
        }(e) : null, this._enumValues = e && "enum" === e.type ? e.values : null;
      }

      _createClass(Jr, [{
        key: "evaluateWithoutErrorHandling",
        value: function evaluateWithoutErrorHandling(t, e, r, i, n, s) {
          return this._evaluator.globals = t, this._evaluator.feature = e, this._evaluator.featureState = r, this._evaluator.canonical = i, this._evaluator.availableImages = n || null, this._evaluator.formattedSection = s, this.expression.evaluate(this._evaluator);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, i, n, s) {
          this._evaluator.globals = t, this._evaluator.feature = e || null, this._evaluator.featureState = r || null, this._evaluator.canonical = i, this._evaluator.availableImages = n || null, this._evaluator.formattedSection = s || null;

          try {
            var _t37 = this.expression.evaluate(this._evaluator);

            if (null == _t37 || "number" == typeof _t37 && _t37 != _t37) return this._defaultValue;
            if (this._enumValues && !(_t37 in this._enumValues)) throw new ge("Expected value to be one of ".concat(Object.keys(this._enumValues).map(function (t) {
              return JSON.stringify(t);
            }).join(", "), ", but found ").concat(JSON.stringify(_t37), " instead."));
            return _t37;
          } catch (t) {
            return this._warningHistory[t.message] || (this._warningHistory[t.message] = !0, "undefined" != typeof console && console.warn(t.message)), this._defaultValue;
          }
        }
      }]);

      return Jr;
    }();

    function Yr(t) {
      return Array.isArray(t) && t.length > 0 && "string" == typeof t[0] && t[0] in Br;
    }

    function Wr(t, e) {
      var r = new Ge(Br, [], e ? function (t) {
        var e = {
          color: Xt,
          string: Kt,
          number: jt,
          "enum": Kt,
          "boolean": Zt,
          formatted: Yt,
          resolvedImage: Wt
        };
        return "array" === t.type ? Qt(e[t.value] || Ht, t.length) : e[t.type];
      }(e) : void 0),
          i = r.parse(t, void 0, void 0, void 0, e && "string" === e.type ? {
        typeAnnotation: "coerce"
      } : void 0);
      return i ? Rr(new Jr(i, e)) : Lr(r.errors);
    }

    var Qr = /*#__PURE__*/function () {
      function Qr(t, e) {
        _classCallCheck(this, Qr);

        this.kind = t, this._styleExpression = e, this.isStateDependent = "constant" !== t && !Ke(e.expression);
      }

      _createClass(Qr, [{
        key: "evaluateWithoutErrorHandling",
        value: function evaluateWithoutErrorHandling(t, e, r, i, n, s) {
          return this._styleExpression.evaluateWithoutErrorHandling(t, e, r, i, n, s);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, i, n, s) {
          return this._styleExpression.evaluate(t, e, r, i, n, s);
        }
      }]);

      return Qr;
    }();

    var ti = /*#__PURE__*/function () {
      function ti(t, e, r, i) {
        _classCallCheck(this, ti);

        this.kind = t, this.zoomStops = r, this._styleExpression = e, this.isStateDependent = "camera" !== t && !Ke(e.expression), this.interpolationType = i;
      }

      _createClass(ti, [{
        key: "evaluateWithoutErrorHandling",
        value: function evaluateWithoutErrorHandling(t, e, r, i, n, s) {
          return this._styleExpression.evaluateWithoutErrorHandling(t, e, r, i, n, s);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, i, n, s) {
          return this._styleExpression.evaluate(t, e, r, i, n, s);
        }
      }, {
        key: "interpolationFactor",
        value: function interpolationFactor(t, e, r) {
          return this.interpolationType ? pr.interpolationFactor(this.interpolationType, t, e, r) : 0;
        }
      }]);

      return ti;
    }();

    function ei(t, e) {
      if ("error" === (t = Wr(t, e)).result) return t;
      var r = t.value.expression,
          i = je(r);
      if (!i && !Ur(e)) return Lr([new $t("", "data expressions not supported")]);
      var n = Ze(r, ["zoom"]);
      if (!n && !Or(e)) return Lr([new $t("", "zoom expressions not supported")]);

      var s = function t(e) {
        var r = null;
        if (e instanceof yr) r = t(e.result);else if (e instanceof fr) {
          var _iterator40 = _createForOfIteratorHelper(e.args),
              _step40;

          try {
            for (_iterator40.s(); !(_step40 = _iterator40.n()).done;) {
              var _i32 = _step40.value;
              if (r = t(_i32), r) break;
            }
          } catch (err) {
            _iterator40.e(err);
          } finally {
            _iterator40.f();
          }
        } else (e instanceof Je || e instanceof pr) && e.input instanceof Ie && "zoom" === e.input.name && (r = e);
        return r instanceof $t || e.eachChild(function (e) {
          var i = t(e);
          i instanceof $t ? r = i : !r && i ? r = new $t("", '"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.') : r && i && r !== i && (r = new $t("", 'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'));
        }), r;
      }(r);

      return s || n ? s instanceof $t ? Lr([s]) : s instanceof pr && !$r(e) ? Lr([new $t("", '"interpolate" expressions cannot be used with this property')]) : Rr(s ? new ti(i ? "camera" : "composite", t.value, s.labels, s instanceof pr ? s.interpolation : void 0) : new Qr(i ? "constant" : "source", t.value)) : Lr([new $t("", '"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);
    }

    var ri = /*#__PURE__*/function () {
      function ri(t, e) {
        _classCallCheck(this, ri);

        this._parameters = t, this._specification = e, Lt(this, function t(e, r) {
          var i = "color" === r.type,
              n = e.stops && "object" == _typeof(e.stops[0][0]),
              s = n || !(n || void 0 !== e.property),
              a = e.type || ($r(r) ? "exponential" : "interval");

          if (i && ((e = Lt({}, e)).stops && (e.stops = e.stops.map(function (t) {
            return [t[0], oe.parse(t[1])];
          })), e["default"] = oe.parse(e["default"] ? e["default"] : r["default"])), e.colorSpace && "rgb" !== e.colorSpace && !hr[e.colorSpace]) throw new Error("Unknown color space: ".concat(e.colorSpace));
          var o, l, u;
          if ("exponential" === a) o = Gr;else if ("interval" === a) o = Xr;else if ("categorical" === a) {
            o = Zr, l = Object.create(null);

            var _iterator41 = _createForOfIteratorHelper(e.stops),
                _step41;

            try {
              for (_iterator41.s(); !(_step41 = _iterator41.n()).done;) {
                var _t38 = _step41.value;
                l[_t38[0]] = _t38[1];
              }
            } catch (err) {
              _iterator41.e(err);
            } finally {
              _iterator41.f();
            }

            u = _typeof(e.stops[0][0]);
          } else {
            if ("identity" !== a) throw new Error("Unknown function type \"".concat(a, "\""));
            o = Hr;
          }

          if (n) {
            var _i33 = {},
                _n21 = [];

            for (var _t39 = 0; _t39 < e.stops.length; _t39++) {
              var _r50 = e.stops[_t39],
                  _s18 = _r50[0].zoom;
              void 0 === _i33[_s18] && (_i33[_s18] = {
                zoom: _s18,
                type: e.type,
                property: e.property,
                "default": e["default"],
                stops: []
              }, _n21.push(_s18)), _i33[_s18].stops.push([_r50[0].value, _r50[1]]);
            }

            var _s17 = [];

            for (var _i34 = 0, _n22 = _n21; _i34 < _n22.length; _i34++) {
              var _e43 = _n22[_i34];

              _s17.push([_i33[_e43].zoom, t(_i33[_e43], r)]);
            }

            var _a17 = {
              name: "linear"
            };
            return {
              kind: "composite",
              interpolationType: _a17,
              interpolationFactor: pr.interpolationFactor.bind(void 0, _a17),
              zoomStops: _s17.map(function (t) {
                return t[0];
              }),
              evaluate: function evaluate(_ref133, i) {
                var t = _ref133.zoom;
                return Gr({
                  stops: _s17,
                  base: e.base
                }, r, t).evaluate(t, i);
              }
            };
          }

          if (s) {
            var _t40 = "exponential" === a ? {
              name: "exponential",
              base: void 0 !== e.base ? e.base : 1
            } : null;

            return {
              kind: "camera",
              interpolationType: _t40,
              interpolationFactor: pr.interpolationFactor.bind(void 0, _t40),
              zoomStops: e.stops.map(function (t) {
                return t[0];
              }),
              evaluate: function evaluate(_ref134) {
                var t = _ref134.zoom;
                return o(e, r, t, l, u);
              }
            };
          }

          return {
            kind: "source",
            evaluate: function evaluate(t, i) {
              var n = i && i.properties ? i.properties[e.property] : void 0;
              return void 0 === n ? Kr(e["default"], r["default"]) : o(e, r, n, l, u);
            }
          };
        }(this._parameters, this._specification));
      }

      _createClass(ri, null, [{
        key: "deserialize",
        value: function deserialize(t) {
          return new ri(t._parameters, t._specification);
        }
      }, {
        key: "serialize",
        value: function serialize(t) {
          return {
            _parameters: t._parameters,
            _specification: t._specification
          };
        }
      }]);

      return ri;
    }();

    function ii(t) {
      var e = t.key,
          r = t.value,
          i = t.valueSpec || {},
          n = t.objectElementValidators || {},
          s = t.style,
          a = t.styleSpec;
      var o = [];
      var l = qr(r);
      if ("object" !== l) return [new Ft(e, r, "object expected, ".concat(l, " found"))];

      for (var _t41 in r) {
        var _l6 = _t41.split(".")[0],
            _u6 = i[_l6] || i["*"];

        var _c3 = void 0;

        if (n[_l6]) _c3 = n[_l6];else if (i[_l6]) _c3 = Ei;else if (n["*"]) _c3 = n["*"];else {
          if (!i["*"]) {
            o.push(new Ft(e, r[_t41], "unknown property \"".concat(_t41, "\"")));
            continue;
          }

          _c3 = Ei;
        }
        o = o.concat(_c3({
          key: (e ? "".concat(e, ".") : e) + _t41,
          value: r[_t41],
          valueSpec: _u6,
          style: s,
          styleSpec: a,
          object: r,
          objectKey: _t41
        }, r));
      }

      for (var _t42 in i) {
        n[_t42] || i[_t42].required && void 0 === i[_t42]["default"] && void 0 === r[_t42] && o.push(new Ft(e, r, "missing required property \"".concat(_t42, "\"")));
      }

      return o;
    }

    function ni(t) {
      var e = t.value,
          r = t.valueSpec,
          i = t.style,
          n = t.styleSpec,
          s = t.key,
          a = t.arrayElementValidator || Ei;
      if ("array" !== qr(e)) return [new Ft(s, e, "array expected, ".concat(qr(e), " found"))];
      if (r.length && e.length !== r.length) return [new Ft(s, e, "array length ".concat(r.length, " expected, length ").concat(e.length, " found"))];
      if (r["min-length"] && e.length < r["min-length"]) return [new Ft(s, e, "array length at least ".concat(r["min-length"], " expected, length ").concat(e.length, " found"))];
      var o = {
        type: r.value,
        values: r.values
      };
      n.$version < 7 && (o["function"] = r["function"]), "object" === qr(r.value) && (o = r.value);
      var l = [];

      for (var _t43 = 0; _t43 < e.length; _t43++) {
        l = l.concat(a({
          array: e,
          arrayIndex: _t43,
          value: e[_t43],
          valueSpec: o,
          style: i,
          styleSpec: n,
          key: "".concat(s, "[").concat(_t43, "]")
        }));
      }

      return l;
    }

    function si(t) {
      var e = t.key,
          r = t.value,
          i = t.valueSpec;
      var n = qr(r);
      return "number" === n && r != r && (n = "NaN"), "number" !== n ? [new Ft(e, r, "number expected, ".concat(n, " found"))] : "minimum" in i && r < i.minimum ? [new Ft(e, r, "".concat(r, " is less than the minimum value ").concat(i.minimum))] : "maximum" in i && r > i.maximum ? [new Ft(e, r, "".concat(r, " is greater than the maximum value ").concat(i.maximum))] : [];
    }

    function ai(t) {
      var e = t.valueSpec,
          r = Ut(t.value.type);
      var i,
          n,
          s,
          a = {};
      var o = "categorical" !== r && void 0 === t.value.property,
          l = !o,
          u = "array" === qr(t.value.stops) && "array" === qr(t.value.stops[0]) && "object" === qr(t.value.stops[0][0]),
          c = ii({
        key: t.key,
        value: t.value,
        valueSpec: t.styleSpec["function"],
        style: t.style,
        styleSpec: t.styleSpec,
        objectElementValidators: {
          stops: function stops(t) {
            if ("identity" === r) return [new Ft(t.key, t.value, 'identity function may not have a "stops" property')];
            var e = [];
            var i = t.value;
            return e = e.concat(ni({
              key: t.key,
              value: i,
              valueSpec: t.valueSpec,
              style: t.style,
              styleSpec: t.styleSpec,
              arrayElementValidator: h
            })), "array" === qr(i) && 0 === i.length && e.push(new Ft(t.key, i, "array must have at least one stop")), e;
          },
          "default": function _default(t) {
            return Ei({
              key: t.key,
              value: t.value,
              valueSpec: e,
              style: t.style,
              styleSpec: t.styleSpec
            });
          }
        }
      });
      return "identity" === r && o && c.push(new Ft(t.key, t.value, 'missing required property "property"')), "identity" === r || t.value.stops || c.push(new Ft(t.key, t.value, 'missing required property "stops"')), "exponential" === r && t.valueSpec.expression && !$r(t.valueSpec) && c.push(new Ft(t.key, t.value, "exponential functions not supported")), t.styleSpec.$version >= 8 && (l && !Ur(t.valueSpec) ? c.push(new Ft(t.key, t.value, "property functions not supported")) : o && !Or(t.valueSpec) && c.push(new Ft(t.key, t.value, "zoom functions not supported"))), "categorical" !== r && !u || void 0 !== t.value.property || c.push(new Ft(t.key, t.value, '"property" property is required')), c;

      function h(t) {
        var r = [];
        var i = t.value,
            o = t.key;
        if ("array" !== qr(i)) return [new Ft(o, i, "array expected, ".concat(qr(i), " found"))];
        if (2 !== i.length) return [new Ft(o, i, "array length 2 expected, length ".concat(i.length, " found"))];

        if (u) {
          if ("object" !== qr(i[0])) return [new Ft(o, i, "object expected, ".concat(qr(i[0]), " found"))];
          if (void 0 === i[0].zoom) return [new Ft(o, i, "object stop key must have zoom")];
          if (void 0 === i[0].value) return [new Ft(o, i, "object stop key must have value")];
          if (s && s > Ut(i[0].zoom)) return [new Ft(o, i[0].zoom, "stop zoom values must appear in ascending order")];
          Ut(i[0].zoom) !== s && (s = Ut(i[0].zoom), n = void 0, a = {}), r = r.concat(ii({
            key: "".concat(o, "[0]"),
            value: i[0],
            valueSpec: {
              zoom: {}
            },
            style: t.style,
            styleSpec: t.styleSpec,
            objectElementValidators: {
              zoom: si,
              value: p
            }
          }));
        } else r = r.concat(p({
          key: "".concat(o, "[0]"),
          value: i[0],
          valueSpec: {},
          style: t.style,
          styleSpec: t.styleSpec
        }, i));

        return Yr(Ot(i[1])) ? r.concat([new Ft("".concat(o, "[1]"), i[1], "expressions are not allowed in function stops.")]) : r.concat(Ei({
          key: "".concat(o, "[1]"),
          value: i[1],
          valueSpec: e,
          style: t.style,
          styleSpec: t.styleSpec
        }));
      }

      function p(t, s) {
        var o = qr(t.value),
            l = Ut(t.value),
            u = null !== t.value ? t.value : s;

        if (i) {
          if (o !== i) return [new Ft(t.key, u, "".concat(o, " stop domain type must match previous stop domain type ").concat(i))];
        } else i = o;

        if ("number" !== o && "string" !== o && "boolean" !== o) return [new Ft(t.key, u, "stop domain value must be a number, string, or boolean")];

        if ("number" !== o && "categorical" !== r) {
          var _i35 = "number expected, ".concat(o, " found");

          return Ur(e) && void 0 === r && (_i35 += '\nIf you intended to use a categorical function, specify `"type": "categorical"`.'), [new Ft(t.key, u, _i35)];
        }

        return "categorical" !== r || "number" !== o || isFinite(l) && Math.floor(l) === l ? "categorical" !== r && "number" === o && void 0 !== n && l < n ? [new Ft(t.key, u, "stop domain values must appear in ascending order")] : (n = l, "categorical" === r && l in a ? [new Ft(t.key, u, "stop domain values must be unique")] : (a[l] = !0, [])) : [new Ft(t.key, u, "integer expected, found ".concat(l))];
      }
    }

    function oi(t) {
      var e = ("property" === t.expressionContext ? ei : Wr)(Ot(t.value), t.valueSpec);
      if ("error" === e.result) return e.value.map(function (e) {
        return new Ft("".concat(t.key).concat(e.key), t.value, e.message);
      });
      var r = e.value.expression || e.value._styleExpression.expression;
      if ("property" === t.expressionContext && "text-font" === t.propertyKey && !r.outputDefined()) return [new Ft(t.key, t.value, "Invalid data expression for \"".concat(t.propertyKey, "\". Output values must be contained as literals within the expression."))];
      if ("property" === t.expressionContext && "layout" === t.propertyType && !Ke(r)) return [new Ft(t.key, t.value, '"feature-state" data expressions are not supported with layout properties.')];
      if ("filter" === t.expressionContext && !Ke(r)) return [new Ft(t.key, t.value, '"feature-state" data expressions are not supported with filters.')];

      if (t.expressionContext && 0 === t.expressionContext.indexOf("cluster")) {
        if (!Ze(r, ["zoom", "feature-state"])) return [new Ft(t.key, t.value, '"zoom" and "feature-state" expressions are not supported with cluster properties.')];
        if ("cluster-initial" === t.expressionContext && !je(r)) return [new Ft(t.key, t.value, "Feature data expressions are not supported with initial expression part of cluster properties.")];
      }

      return [];
    }

    function li(t) {
      var e = t.key,
          r = t.value,
          i = t.valueSpec,
          n = [];
      return Array.isArray(i.values) ? -1 === i.values.indexOf(Ut(r)) && n.push(new Ft(e, r, "expected one of [".concat(i.values.join(", "), "], ").concat(JSON.stringify(r), " found"))) : -1 === Object.keys(i.values).indexOf(Ut(r)) && n.push(new Ft(e, r, "expected one of [".concat(Object.keys(i.values).join(", "), "], ").concat(JSON.stringify(r), " found"))), n;
    }

    function ui(t) {
      if (!0 === t || !1 === t) return !0;
      if (!Array.isArray(t) || 0 === t.length) return !1;

      switch (t[0]) {
        case "has":
          return t.length >= 2 && "$id" !== t[1] && "$type" !== t[1];

        case "in":
          return t.length >= 3 && ("string" != typeof t[1] || Array.isArray(t[2]));

        case "!in":
        case "!has":
        case "none":
          return !1;

        case "==":
        case "!=":
        case ">":
        case ">=":
        case "<":
        case "<=":
          return 3 !== t.length || Array.isArray(t[1]) || Array.isArray(t[2]);

        case "any":
        case "all":
          var _iterator42 = _createForOfIteratorHelper(t.slice(1)),
              _step42;

          try {
            for (_iterator42.s(); !(_step42 = _iterator42.n()).done;) {
              var _e44 = _step42.value;
              if (!ui(_e44) && "boolean" != typeof _e44) return !1;
            }
          } catch (err) {
            _iterator42.e(err);
          } finally {
            _iterator42.f();
          }

          return !0;

        default:
          return !0;
      }
    }

    var ci = {
      type: "boolean",
      "default": !1,
      transition: !1,
      "property-type": "data-driven",
      expression: {
        interpolated: !1,
        parameters: ["zoom", "feature"]
      }
    };

    function hi(t) {
      if (null == t) return {
        filter: function filter() {
          return !0;
        },
        needGeometry: !1
      };
      ui(t) || (t = di(t));
      var e = Wr(t, ci);
      if ("error" === e.result) throw new Error(e.value.map(function (t) {
        return "".concat(t.key, ": ").concat(t.message);
      }).join(", "));
      return {
        filter: function filter(t, r, i) {
          return e.value.evaluate(t, r, {}, i);
        },
        needGeometry: function t(e) {
          if (!Array.isArray(e)) return !1;
          if ("within" === e[0]) return !0;

          for (var _r51 = 1; _r51 < e.length; _r51++) {
            if (t(e[_r51])) return !0;
          }

          return !1;
        }(t)
      };
    }

    function pi(t, e) {
      return t < e ? -1 : t > e ? 1 : 0;
    }

    function di(t) {
      if (!t) return !0;
      var e = t[0];
      return t.length <= 1 ? "any" !== e : "==" === e ? fi(t[1], t[2], "==") : "!=" === e ? gi(fi(t[1], t[2], "==")) : "<" === e || ">" === e || "<=" === e || ">=" === e ? fi(t[1], t[2], e) : "any" === e ? (r = t.slice(1), ["any"].concat(r.map(di))) : "all" === e ? ["all"].concat(t.slice(1).map(di)) : "none" === e ? ["all"].concat(t.slice(1).map(di).map(gi)) : "in" === e ? yi(t[1], t.slice(2)) : "!in" === e ? gi(yi(t[1], t.slice(2))) : "has" === e ? mi(t[1]) : "!has" === e ? gi(mi(t[1])) : "within" !== e || t;
      var r;
    }

    function fi(t, e, r) {
      switch (t) {
        case "$type":
          return ["filter-type-".concat(r), e];

        case "$id":
          return ["filter-id-".concat(r), e];

        default:
          return ["filter-".concat(r), t, e];
      }
    }

    function yi(t, e) {
      if (0 === e.length) return !1;

      switch (t) {
        case "$type":
          return ["filter-type-in", ["literal", e]];

        case "$id":
          return ["filter-id-in", ["literal", e]];

        default:
          return e.length > 200 && !e.some(function (t) {
            return _typeof(t) != _typeof(e[0]);
          }) ? ["filter-in-large", t, ["literal", e.sort(pi)]] : ["filter-in-small", t, ["literal", e]];
      }
    }

    function mi(t) {
      switch (t) {
        case "$type":
          return !0;

        case "$id":
          return ["filter-has-id"];

        default:
          return ["filter-has", t];
      }
    }

    function gi(t) {
      return ["!", t];
    }

    function xi(t) {
      return ui(Ot(t.value)) ? oi(Lt({}, t, {
        expressionContext: "filter",
        valueSpec: {
          value: "boolean"
        }
      })) : function t(e) {
        var r = e.value,
            i = e.key;
        if ("array" !== qr(r)) return [new Ft(i, r, "array expected, ".concat(qr(r), " found"))];
        var n = e.styleSpec;
        var s,
            a = [];
        if (r.length < 1) return [new Ft(i, r, "filter array must have at least 1 element")];

        switch (a = a.concat(li({
          key: "".concat(i, "[0]"),
          value: r[0],
          valueSpec: n.filter_operator,
          style: e.style,
          styleSpec: e.styleSpec
        })), Ut(r[0])) {
          case "<":
          case "<=":
          case ">":
          case ">=":
            r.length >= 2 && "$type" === Ut(r[1]) && a.push(new Ft(i, r, "\"$type\" cannot be use with operator \"".concat(r[0], "\"")));

          case "==":
          case "!=":
            3 !== r.length && a.push(new Ft(i, r, "filter array for operator \"".concat(r[0], "\" must have 3 elements")));

          case "in":
          case "!in":
            r.length >= 2 && (s = qr(r[1]), "string" !== s && a.push(new Ft("".concat(i, "[1]"), r[1], "string expected, ".concat(s, " found"))));

            for (var _t44 = 2; _t44 < r.length; _t44++) {
              s = qr(r[_t44]), "$type" === Ut(r[1]) ? a = a.concat(li({
                key: "".concat(i, "[").concat(_t44, "]"),
                value: r[_t44],
                valueSpec: n.geometry_type,
                style: e.style,
                styleSpec: e.styleSpec
              })) : "string" !== s && "number" !== s && "boolean" !== s && a.push(new Ft("".concat(i, "[").concat(_t44, "]"), r[_t44], "string, number, or boolean expected, ".concat(s, " found")));
            }

            break;

          case "any":
          case "all":
          case "none":
            for (var _n23 = 1; _n23 < r.length; _n23++) {
              a = a.concat(t({
                key: "".concat(i, "[").concat(_n23, "]"),
                value: r[_n23],
                style: e.style,
                styleSpec: e.styleSpec
              }));
            }

            break;

          case "has":
          case "!has":
            s = qr(r[1]), 2 !== r.length ? a.push(new Ft(i, r, "filter array for \"".concat(r[0], "\" operator must have 2 elements"))) : "string" !== s && a.push(new Ft("".concat(i, "[1]"), r[1], "string expected, ".concat(s, " found")));
            break;

          case "within":
            s = qr(r[1]), 2 !== r.length ? a.push(new Ft(i, r, "filter array for \"".concat(r[0], "\" operator must have 2 elements"))) : "object" !== s && a.push(new Ft("".concat(i, "[1]"), r[1], "object expected, ".concat(s, " found")));
        }

        return a;
      }(t);
    }

    function vi(t, e) {
      var r = t.key,
          i = t.style,
          n = t.styleSpec,
          s = t.value,
          a = t.objectKey,
          o = n["".concat(e, "_").concat(t.layerType)];
      if (!o) return [];
      var l = a.match(/^(.*)-transition$/);
      if ("paint" === e && l && o[l[1]] && o[l[1]].transition) return Ei({
        key: r,
        value: s,
        valueSpec: n.transition,
        style: i,
        styleSpec: n
      });
      var u = t.valueSpec || o[a];
      if (!u) return [new Ft(r, s, "unknown property \"".concat(a, "\""))];
      var c;
      if ("string" === qr(s) && Ur(u) && !u.tokens && (c = /^{([^}]+)}$/.exec(s))) return [new Ft(r, s, "\"".concat(a, "\" does not support interpolation syntax\n") + "Use an identity property function instead: `{ \"type\": \"identity\", \"property\": ".concat(JSON.stringify(c[1]), " }`."))];
      var h = [];
      return "symbol" === t.layerType && ("text-field" === a && i && !i.glyphs && h.push(new Ft(r, s, 'use of "text-field" requires a style "glyphs" property')), "text-font" === a && Nr(Ot(s)) && "identity" === Ut(s.type) && h.push(new Ft(r, s, '"text-font" does not support identity functions'))), h.concat(Ei({
        key: t.key,
        value: s,
        valueSpec: u,
        style: i,
        styleSpec: n,
        expressionContext: "property",
        propertyType: e,
        propertyKey: a
      }));
    }

    function bi(t) {
      return vi(t, "paint");
    }

    function wi(t) {
      return vi(t, "layout");
    }

    function _i(t) {
      var e = [];
      var r = t.value,
          i = t.key,
          n = t.style,
          s = t.styleSpec;
      r.type || r.ref || e.push(new Ft(i, r, 'either "type" or "ref" is required'));
      var a = Ut(r.type);
      var o = Ut(r.ref);

      if (r.id) {
        var _s19 = Ut(r.id);

        for (var _a18 = 0; _a18 < t.arrayIndex; _a18++) {
          var _t45 = n.layers[_a18];
          Ut(_t45.id) === _s19 && e.push(new Ft(i, r.id, "duplicate layer id \"".concat(r.id, "\", previously used at line ").concat(_t45.id.__line__)));
        }
      }

      if ("ref" in r) {
        var _t46;

        ["type", "source", "source-layer", "filter", "layout"].forEach(function (t) {
          t in r && e.push(new Ft(i, r[t], "\"".concat(t, "\" is prohibited for ref layers")));
        }), n.layers.forEach(function (e) {
          Ut(e.id) === o && (_t46 = e);
        }), _t46 ? _t46.ref ? e.push(new Ft(i, r.ref, "ref cannot reference another ref layer")) : a = Ut(_t46.type) : e.push(new Ft(i, r.ref, "ref layer \"".concat(o, "\" not found")));
      } else if ("background" !== a && "sky" !== a) if (r.source) {
        var _t47 = n.sources && n.sources[r.source],
            _s20 = _t47 && Ut(_t47.type);

        _t47 ? "vector" === _s20 && "raster" === a ? e.push(new Ft(i, r.source, "layer \"".concat(r.id, "\" requires a raster source"))) : "raster" === _s20 && "raster" !== a ? e.push(new Ft(i, r.source, "layer \"".concat(r.id, "\" requires a vector source"))) : "vector" !== _s20 || r["source-layer"] ? "raster-dem" === _s20 && "hillshade" !== a ? e.push(new Ft(i, r.source, "raster-dem source can only be used with layer type 'hillshade'.")) : "line" !== a || !r.paint || !r.paint["line-gradient"] || "geojson" === _s20 && _t47.lineMetrics || e.push(new Ft(i, r, "layer \"".concat(r.id, "\" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled."))) : e.push(new Ft(i, r, "layer \"".concat(r.id, "\" must specify a \"source-layer\""))) : e.push(new Ft(i, r.source, "source \"".concat(r.source, "\" not found")));
      } else e.push(new Ft(i, r, 'missing required property "source"'));

      return e = e.concat(ii({
        key: i,
        value: r,
        valueSpec: s.layer,
        style: t.style,
        styleSpec: t.styleSpec,
        objectElementValidators: {
          "*": function _() {
            return [];
          },
          type: function type() {
            return Ei({
              key: "".concat(i, ".type"),
              value: r.type,
              valueSpec: s.layer.type,
              style: t.style,
              styleSpec: t.styleSpec,
              object: r,
              objectKey: "type"
            });
          },
          filter: xi,
          layout: function layout(t) {
            return ii({
              layer: r,
              key: t.key,
              value: t.value,
              style: t.style,
              styleSpec: t.styleSpec,
              objectElementValidators: {
                "*": function _(t) {
                  return wi(Lt({
                    layerType: a
                  }, t));
                }
              }
            });
          },
          paint: function paint(t) {
            return ii({
              layer: r,
              key: t.key,
              value: t.value,
              style: t.style,
              styleSpec: t.styleSpec,
              objectElementValidators: {
                "*": function _(t) {
                  return bi(Lt({
                    layerType: a
                  }, t));
                }
              }
            });
          }
        }
      })), e;
    }

    function Ai(t) {
      var e = t.value,
          r = t.key,
          i = qr(e);
      return "string" !== i ? [new Ft(r, e, "string expected, ".concat(i, " found"))] : [];
    }

    var ki = {
      promoteId: function promoteId(_ref135) {
        var t = _ref135.key,
            e = _ref135.value;
        if ("string" === qr(e)) return Ai({
          key: t,
          value: e
        });
        {
          var _r52 = [];

          for (var _i36 in e) {
            _r52.push.apply(_r52, _toConsumableArray(Ai({
              key: "".concat(t, ".").concat(_i36),
              value: e[_i36]
            })));
          }

          return _r52;
        }
      }
    };

    function Si(t) {
      var e = t.value,
          r = t.key,
          i = t.styleSpec,
          n = t.style;
      if (!e.type) return [new Ft(r, e, '"type" is required')];
      var s = Ut(e.type);
      var a;

      switch (s) {
        case "vector":
        case "raster":
        case "raster-dem":
          return a = ii({
            key: r,
            value: e,
            valueSpec: i["source_".concat(s.replace("-", "_"))],
            style: t.style,
            styleSpec: i,
            objectElementValidators: ki
          }), a;

        case "geojson":
          if (a = ii({
            key: r,
            value: e,
            valueSpec: i.source_geojson,
            style: n,
            styleSpec: i,
            objectElementValidators: ki
          }), e.cluster) for (var _t48 in e.clusterProperties) {
            var _a19, _a20;

            var _e$clusterProperties$ = _slicedToArray(e.clusterProperties[_t48], 2),
                _i37 = _e$clusterProperties$[0],
                _n24 = _e$clusterProperties$[1],
                _s21 = "string" == typeof _i37 ? [_i37, ["accumulated"], ["get", _t48]] : _i37;

            (_a19 = a).push.apply(_a19, _toConsumableArray(oi({
              key: "".concat(r, ".").concat(_t48, ".map"),
              value: _n24,
              expressionContext: "cluster-map"
            }))), (_a20 = a).push.apply(_a20, _toConsumableArray(oi({
              key: "".concat(r, ".").concat(_t48, ".reduce"),
              value: _s21,
              expressionContext: "cluster-reduce"
            })));
          }
          return a;

        case "video":
          return ii({
            key: r,
            value: e,
            valueSpec: i.source_video,
            style: n,
            styleSpec: i
          });

        case "image":
          return ii({
            key: r,
            value: e,
            valueSpec: i.source_image,
            style: n,
            styleSpec: i
          });

        case "canvas":
          return [new Ft(r, null, "Please use runtime APIs to add canvas sources, rather than including them in stylesheets.", "source.canvas")];

        default:
          return li({
            key: "".concat(r, ".type"),
            value: e.type,
            valueSpec: {
              values: ["vector", "raster", "raster-dem", "geojson", "video", "image"]
            },
            style: n,
            styleSpec: i
          });
      }
    }

    function Ii(t) {
      var e = t.value,
          r = t.styleSpec,
          i = r.light,
          n = t.style;
      var s = [];
      var a = qr(e);
      if (void 0 === e) return s;
      if ("object" !== a) return s = s.concat([new Ft("light", e, "object expected, ".concat(a, " found"))]), s;

      for (var _t49 in e) {
        var _a21 = _t49.match(/^(.*)-transition$/);

        s = s.concat(_a21 && i[_a21[1]] && i[_a21[1]].transition ? Ei({
          key: _t49,
          value: e[_t49],
          valueSpec: r.transition,
          style: n,
          styleSpec: r
        }) : i[_t49] ? Ei({
          key: _t49,
          value: e[_t49],
          valueSpec: i[_t49],
          style: n,
          styleSpec: r
        }) : [new Ft(_t49, e[_t49], "unknown property \"".concat(_t49, "\""))]);
      }

      return s;
    }

    function Ti(t) {
      var e = t.value,
          r = t.key,
          i = t.style,
          n = t.styleSpec,
          s = n.terrain;
      var a = [];
      var o = qr(e);
      if (void 0 === e) return a;
      if ("object" !== o) return a = a.concat([new Ft("terrain", e, "object expected, ".concat(o, " found"))]), a;

      for (var _t50 in e) {
        var _r53 = _t50.match(/^(.*)-transition$/);

        a = a.concat(_r53 && s[_r53[1]] && s[_r53[1]].transition ? Ei({
          key: _t50,
          value: e[_t50],
          valueSpec: n.transition,
          style: i,
          styleSpec: n
        }) : s[_t50] ? Ei({
          key: _t50,
          value: e[_t50],
          valueSpec: s[_t50],
          style: i,
          styleSpec: n
        }) : [new Ft(_t50, e[_t50], "unknown property \"".concat(_t50, "\""))]);
      }

      if (e.source) {
        var _t51 = i.sources && i.sources[e.source],
            _n25 = _t51 && Ut(_t51.type);

        _t51 ? "raster-dem" !== _n25 && a.push(new Ft(r, e.source, "terrain cannot be used with a source of type ".concat(_n25, ", it only be used with a \"raster-dem\" source type"))) : a.push(new Ft(r, e.source, "source \"".concat(e.source, "\" not found")));
      } else a.push(new Ft(r, e, 'terrain is missing required property "source"'));

      return a;
    }

    var zi = {
      "*": function _() {
        return [];
      },
      array: ni,
      "boolean": function boolean(t) {
        var e = t.value,
            r = t.key,
            i = qr(e);
        return "boolean" !== i ? [new Ft(r, e, "boolean expected, ".concat(i, " found"))] : [];
      },
      number: si,
      color: function color(t) {
        var e = t.key,
            r = t.value,
            i = qr(r);
        return "string" !== i ? [new Ft(e, r, "color expected, ".concat(i, " found"))] : null === ae(r) ? [new Ft(e, r, "color expected, \"".concat(r, "\" found"))] : [];
      },
      constants: Rt,
      "enum": li,
      filter: xi,
      "function": ai,
      layer: _i,
      object: ii,
      source: Si,
      light: Ii,
      terrain: Ti,
      string: Ai,
      formatted: function formatted(t) {
        return 0 === Ai(t).length ? [] : oi(t);
      },
      resolvedImage: function resolvedImage(t) {
        return 0 === Ai(t).length ? [] : oi(t);
      }
    };

    function Ei(t) {
      var e = t.value,
          r = t.valueSpec,
          i = t.styleSpec;
      return r.expression && Nr(Ut(e)) ? ai(t) : r.expression && Yr(Ot(e)) ? oi(t) : r.type && zi[r.type] ? zi[r.type](t) : ii(Lt({}, t, {
        valueSpec: r.type ? i[r.type] : r
      }));
    }

    function Ci(t) {
      var e = t.value,
          r = t.key,
          i = Ai(t);
      return i.length || (-1 === e.indexOf("{fontstack}") && i.push(new Ft(r, e, '"glyphs" url must include a "{fontstack}" token')), -1 === e.indexOf("{range}") && i.push(new Ft(r, e, '"glyphs" url must include a "{range}" token'))), i;
    }

    function Mi(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Vt;
      var r = [];
      return r = r.concat(Ei({
        key: "",
        value: t,
        valueSpec: e.$root,
        styleSpec: e,
        style: t,
        objectElementValidators: {
          glyphs: Ci,
          "*": function _() {
            return [];
          }
        }
      })), t.constants && (r = r.concat(Rt({
        key: "constants",
        value: t.constants,
        style: t,
        styleSpec: e
      }))), Bi(r);
    }

    function Bi(t) {
      return [].concat(t).sort(function (t, e) {
        return t.line - e.line;
      });
    }

    function Di(t) {
      return function () {
        for (var _len5 = arguments.length, e = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {
          e[_key5] = arguments[_key5];
        }

        return Bi(t.apply(this, e));
      };
    }

    Mi.source = Di(Si), Mi.light = Di(Ii), Mi.terrain = Di(Ti), Mi.layer = Di(_i), Mi.filter = Di(xi), Mi.paintProperty = Di(bi), Mi.layoutProperty = Di(wi);
    var Pi = Mi,
        Vi = Pi.light,
        Fi = Pi.paintProperty,
        Ri = Pi.layoutProperty;

    function Li(t, e) {
      var r = !1;

      if (e && e.length) {
        var _iterator43 = _createForOfIteratorHelper(e),
            _step43;

        try {
          for (_iterator43.s(); !(_step43 = _iterator43.n()).done;) {
            var _i38 = _step43.value;
            t.fire(new Dt(new Error(_i38.message))), r = !0;
          }
        } catch (err) {
          _iterator43.e(err);
        } finally {
          _iterator43.f();
        }
      }

      return r;
    }

    var Ui = Oi;

    function Oi(t, e, r) {
      var i = this.cells = [];

      if (t instanceof ArrayBuffer) {
        this.arrayBuffer = t;
        var n = new Int32Array(this.arrayBuffer);
        t = n[0], this.d = (e = n[1]) + 2 * (r = n[2]);

        for (var s = 0; s < this.d * this.d; s++) {
          var a = n[3 + s],
              o = n[3 + s + 1];
          i.push(a === o ? null : n.subarray(a, o));
        }

        var l = n[3 + i.length + 1];
        this.keys = n.subarray(n[3 + i.length], l), this.bboxes = n.subarray(l), this.insert = this._insertReadonly;
      } else {
        this.d = e + 2 * r;

        for (var u = 0; u < this.d * this.d; u++) {
          i.push([]);
        }

        this.keys = [], this.bboxes = [];
      }

      this.n = e, this.extent = t, this.padding = r, this.scale = e / t, this.uid = 0;
      var c = r / e * t;
      this.min = -c, this.max = t + c;
    }

    Oi.prototype.insert = function (t, e, r, i, n) {
      this._forEachCell(e, r, i, n, this._insertCell, this.uid++), this.keys.push(t), this.bboxes.push(e), this.bboxes.push(r), this.bboxes.push(i), this.bboxes.push(n);
    }, Oi.prototype._insertReadonly = function () {
      throw "Cannot insert into a GridIndex created from an ArrayBuffer.";
    }, Oi.prototype._insertCell = function (t, e, r, i, n, s) {
      this.cells[n].push(s);
    }, Oi.prototype.query = function (t, e, r, i, n) {
      var s = this.min,
          a = this.max;
      if (t <= s && e <= s && a <= r && a <= i && !n) return Array.prototype.slice.call(this.keys);
      var o = [];
      return this._forEachCell(t, e, r, i, this._queryCell, o, {}, n), o;
    }, Oi.prototype._queryCell = function (t, e, r, i, n, s, a, o) {
      var l = this.cells[n];
      if (null !== l) for (var u = this.keys, c = this.bboxes, h = 0; h < l.length; h++) {
        var p = l[h];

        if (void 0 === a[p]) {
          var d = 4 * p;
          (o ? o(c[d + 0], c[d + 1], c[d + 2], c[d + 3]) : t <= c[d + 2] && e <= c[d + 3] && r >= c[d + 0] && i >= c[d + 1]) ? (a[p] = !0, s.push(u[p])) : a[p] = !1;
        }
      }
    }, Oi.prototype._forEachCell = function (t, e, r, i, n, s, a, o) {
      for (var l = this._convertToCellCoord(t), u = this._convertToCellCoord(e), c = this._convertToCellCoord(r), h = this._convertToCellCoord(i), p = l; p <= c; p++) {
        for (var d = u; d <= h; d++) {
          var f = this.d * d + p;
          if ((!o || o(this._convertFromCellCoord(p), this._convertFromCellCoord(d), this._convertFromCellCoord(p + 1), this._convertFromCellCoord(d + 1))) && n.call(this, t, e, r, i, f, s, a, o)) return;
        }
      }
    }, Oi.prototype._convertFromCellCoord = function (t) {
      return (t - this.padding) / this.scale;
    }, Oi.prototype._convertToCellCoord = function (t) {
      return Math.max(0, Math.min(this.d - 1, Math.floor(t * this.scale) + this.padding));
    }, Oi.prototype.toArrayBuffer = function () {
      if (this.arrayBuffer) return this.arrayBuffer;

      for (var t = this.cells, e = 3 + this.cells.length + 1 + 1, r = 0, i = 0; i < this.cells.length; i++) {
        r += this.cells[i].length;
      }

      var n = new Int32Array(e + r + this.keys.length + this.bboxes.length);
      n[0] = this.extent, n[1] = this.n, n[2] = this.padding;

      for (var s = e, a = 0; a < t.length; a++) {
        var o = t[a];
        n[3 + a] = s, n.set(o, s), s += o.length;
      }

      return n[3 + t.length] = s, n.set(this.keys, s), n[3 + t.length + 1] = s += this.keys.length, n.set(this.bboxes, s), s += this.bboxes.length, n.buffer;
    };
    var $i = s.ImageData,
        qi = s.ImageBitmap,
        Ni = {};

    function ji(t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
      Object.defineProperty(e, "_classRegistryKey", {
        value: t,
        writeable: !1
      }), Ni[t] = {
        klass: e,
        omit: r.omit || [],
        shallow: r.shallow || []
      };
    }

    ji("Object", Object), Ui.serialize = function (t, e) {
      var r = t.toArrayBuffer();
      return e && e.push(r), {
        buffer: r
      };
    }, Ui.deserialize = function (t) {
      return new Ui(t.buffer);
    }, ji("Grid", Ui), ji("Color", oe), ji("Error", Error), ji("ResolvedImage", he), ji("StylePropertyFunction", ri), ji("StyleExpression", Jr, {
      omit: ["_evaluator"]
    }), ji("ZoomDependentExpression", ti), ji("ZoomConstantExpression", Qr), ji("CompoundExpression", Ie, {
      omit: ["_evaluate"]
    });

    for (var _t52 in Br) {
      Br[_t52]._classRegistryKey || ji("Expression_".concat(_t52), Br[_t52]);
    }

    function Ki(t) {
      return t && "undefined" != typeof ArrayBuffer && (t instanceof ArrayBuffer || t.constructor && "ArrayBuffer" === t.constructor.name);
    }

    function Zi(t) {
      return qi && t instanceof qi;
    }

    function Xi(t, e) {
      if (null == t || "boolean" == typeof t || "number" == typeof t || "string" == typeof t || t instanceof Boolean || t instanceof Number || t instanceof String || t instanceof Date || t instanceof RegExp) return t;
      if (Ki(t) || Zi(t)) return e && e.push(t), t;

      if (ArrayBuffer.isView(t)) {
        var _r54 = t;
        return e && e.push(_r54.buffer), _r54;
      }

      if (t instanceof $i) return e && e.push(t.data.buffer), t;

      if (Array.isArray(t)) {
        var _r55 = [];

        var _iterator44 = _createForOfIteratorHelper(t),
            _step44;

        try {
          for (_iterator44.s(); !(_step44 = _iterator44.n()).done;) {
            var _i39 = _step44.value;

            _r55.push(Xi(_i39, e));
          }
        } catch (err) {
          _iterator44.e(err);
        } finally {
          _iterator44.f();
        }

        return _r55;
      }

      if ("object" == _typeof(t)) {
        var _r56 = t.constructor,
            _i40 = _r56._classRegistryKey;
        if (!_i40) throw new Error("can't serialize object of unregistered class");

        var _n26 = _r56.serialize ? _r56.serialize(t, e) : {};

        if (!_r56.serialize) {
          for (var _r57 in t) {
            if (!t.hasOwnProperty(_r57)) continue;
            if (Ni[_i40].omit.indexOf(_r57) >= 0) continue;
            var _s22 = t[_r57];
            _n26[_r57] = Ni[_i40].shallow.indexOf(_r57) >= 0 ? _s22 : Xi(_s22, e);
          }

          t instanceof Error && (_n26.message = t.message);
        }

        if (_n26.$name) throw new Error("$name property is reserved for worker serialization logic.");
        return "Object" !== _i40 && (_n26.$name = _i40), _n26;
      }

      throw new Error("can't serialize object of type ".concat(_typeof(t)));
    }

    function Gi(t) {
      if (null == t || "boolean" == typeof t || "number" == typeof t || "string" == typeof t || t instanceof Boolean || t instanceof Number || t instanceof String || t instanceof Date || t instanceof RegExp || Ki(t) || Zi(t) || ArrayBuffer.isView(t) || t instanceof $i) return t;
      if (Array.isArray(t)) return t.map(Gi);

      if ("object" == _typeof(t)) {
        var _e45 = t.$name || "Object",
            _r58 = Ni[_e45].klass;

        if (!_r58) throw new Error("can't deserialize unregistered class ".concat(_e45));
        if (_r58.deserialize) return _r58.deserialize(t);

        var _i41 = Object.create(_r58.prototype);

        for (var _i42 = 0, _Object$keys = Object.keys(t); _i42 < _Object$keys.length; _i42++) {
          var _r59 = _Object$keys[_i42];
          if ("$name" === _r59) continue;
          var _n27 = t[_r59];
          _i41[_r59] = Ni[_e45].shallow.indexOf(_r59) >= 0 ? _n27 : Gi(_n27);
        }

        return _i41;
      }

      throw new Error("can't deserialize object of type ".concat(_typeof(t)));
    }

    var Hi = /*#__PURE__*/function () {
      function Hi() {
        _classCallCheck(this, Hi);

        this.first = !0;
      }

      _createClass(Hi, [{
        key: "update",
        value: function update(t, e) {
          var r = Math.floor(t);
          return this.first ? (this.first = !1, this.lastIntegerZoom = r, this.lastIntegerZoomTime = 0, this.lastZoom = t, this.lastFloorZoom = r, !0) : (this.lastFloorZoom > r ? (this.lastIntegerZoom = r + 1, this.lastIntegerZoomTime = e) : this.lastFloorZoom < r && (this.lastIntegerZoom = r, this.lastIntegerZoomTime = e), t !== this.lastZoom && (this.lastZoom = t, this.lastFloorZoom = r, !0));
        }
      }]);

      return Hi;
    }();

    var Ji = {
      "Latin-1 Supplement": function Latin1Supplement(t) {
        return t >= 128 && t <= 255;
      },
      Arabic: function Arabic(t) {
        return t >= 1536 && t <= 1791;
      },
      "Arabic Supplement": function ArabicSupplement(t) {
        return t >= 1872 && t <= 1919;
      },
      "Arabic Extended-A": function ArabicExtendedA(t) {
        return t >= 2208 && t <= 2303;
      },
      "Hangul Jamo": function HangulJamo(t) {
        return t >= 4352 && t <= 4607;
      },
      "Unified Canadian Aboriginal Syllabics": function UnifiedCanadianAboriginalSyllabics(t) {
        return t >= 5120 && t <= 5759;
      },
      Khmer: function Khmer(t) {
        return t >= 6016 && t <= 6143;
      },
      "Unified Canadian Aboriginal Syllabics Extended": function UnifiedCanadianAboriginalSyllabicsExtended(t) {
        return t >= 6320 && t <= 6399;
      },
      "General Punctuation": function GeneralPunctuation(t) {
        return t >= 8192 && t <= 8303;
      },
      "Letterlike Symbols": function LetterlikeSymbols(t) {
        return t >= 8448 && t <= 8527;
      },
      "Number Forms": function NumberForms(t) {
        return t >= 8528 && t <= 8591;
      },
      "Miscellaneous Technical": function MiscellaneousTechnical(t) {
        return t >= 8960 && t <= 9215;
      },
      "Control Pictures": function ControlPictures(t) {
        return t >= 9216 && t <= 9279;
      },
      "Optical Character Recognition": function OpticalCharacterRecognition(t) {
        return t >= 9280 && t <= 9311;
      },
      "Enclosed Alphanumerics": function EnclosedAlphanumerics(t) {
        return t >= 9312 && t <= 9471;
      },
      "Geometric Shapes": function GeometricShapes(t) {
        return t >= 9632 && t <= 9727;
      },
      "Miscellaneous Symbols": function MiscellaneousSymbols(t) {
        return t >= 9728 && t <= 9983;
      },
      "Miscellaneous Symbols and Arrows": function MiscellaneousSymbolsAndArrows(t) {
        return t >= 11008 && t <= 11263;
      },
      "CJK Radicals Supplement": function CJKRadicalsSupplement(t) {
        return t >= 11904 && t <= 12031;
      },
      "Kangxi Radicals": function KangxiRadicals(t) {
        return t >= 12032 && t <= 12255;
      },
      "Ideographic Description Characters": function IdeographicDescriptionCharacters(t) {
        return t >= 12272 && t <= 12287;
      },
      "CJK Symbols and Punctuation": function CJKSymbolsAndPunctuation(t) {
        return t >= 12288 && t <= 12351;
      },
      Hiragana: function Hiragana(t) {
        return t >= 12352 && t <= 12447;
      },
      Katakana: function Katakana(t) {
        return t >= 12448 && t <= 12543;
      },
      Bopomofo: function Bopomofo(t) {
        return t >= 12544 && t <= 12591;
      },
      "Hangul Compatibility Jamo": function HangulCompatibilityJamo(t) {
        return t >= 12592 && t <= 12687;
      },
      Kanbun: function Kanbun(t) {
        return t >= 12688 && t <= 12703;
      },
      "Bopomofo Extended": function BopomofoExtended(t) {
        return t >= 12704 && t <= 12735;
      },
      "CJK Strokes": function CJKStrokes(t) {
        return t >= 12736 && t <= 12783;
      },
      "Katakana Phonetic Extensions": function KatakanaPhoneticExtensions(t) {
        return t >= 12784 && t <= 12799;
      },
      "Enclosed CJK Letters and Months": function EnclosedCJKLettersAndMonths(t) {
        return t >= 12800 && t <= 13055;
      },
      "CJK Compatibility": function CJKCompatibility(t) {
        return t >= 13056 && t <= 13311;
      },
      "CJK Unified Ideographs Extension A": function CJKUnifiedIdeographsExtensionA(t) {
        return t >= 13312 && t <= 19903;
      },
      "Yijing Hexagram Symbols": function YijingHexagramSymbols(t) {
        return t >= 19904 && t <= 19967;
      },
      "CJK Unified Ideographs": function CJKUnifiedIdeographs(t) {
        return t >= 19968 && t <= 40959;
      },
      "Yi Syllables": function YiSyllables(t) {
        return t >= 40960 && t <= 42127;
      },
      "Yi Radicals": function YiRadicals(t) {
        return t >= 42128 && t <= 42191;
      },
      "Hangul Jamo Extended-A": function HangulJamoExtendedA(t) {
        return t >= 43360 && t <= 43391;
      },
      "Hangul Syllables": function HangulSyllables(t) {
        return t >= 44032 && t <= 55215;
      },
      "Hangul Jamo Extended-B": function HangulJamoExtendedB(t) {
        return t >= 55216 && t <= 55295;
      },
      "Private Use Area": function PrivateUseArea(t) {
        return t >= 57344 && t <= 63743;
      },
      "CJK Compatibility Ideographs": function CJKCompatibilityIdeographs(t) {
        return t >= 63744 && t <= 64255;
      },
      "Arabic Presentation Forms-A": function ArabicPresentationFormsA(t) {
        return t >= 64336 && t <= 65023;
      },
      "Vertical Forms": function VerticalForms(t) {
        return t >= 65040 && t <= 65055;
      },
      "CJK Compatibility Forms": function CJKCompatibilityForms(t) {
        return t >= 65072 && t <= 65103;
      },
      "Small Form Variants": function SmallFormVariants(t) {
        return t >= 65104 && t <= 65135;
      },
      "Arabic Presentation Forms-B": function ArabicPresentationFormsB(t) {
        return t >= 65136 && t <= 65279;
      },
      "Halfwidth and Fullwidth Forms": function HalfwidthAndFullwidthForms(t) {
        return t >= 65280 && t <= 65519;
      }
    };

    function Yi(t) {
      var _iterator45 = _createForOfIteratorHelper(t),
          _step45;

      try {
        for (_iterator45.s(); !(_step45 = _iterator45.n()).done;) {
          var _e46 = _step45.value;
          if (tn(_e46.charCodeAt(0))) return !0;
        }
      } catch (err) {
        _iterator45.e(err);
      } finally {
        _iterator45.f();
      }

      return !1;
    }

    function Wi(t) {
      var _iterator46 = _createForOfIteratorHelper(t),
          _step46;

      try {
        for (_iterator46.s(); !(_step46 = _iterator46.n()).done;) {
          var _e47 = _step46.value;
          if (!Qi(_e47.charCodeAt(0))) return !1;
        }
      } catch (err) {
        _iterator46.e(err);
      } finally {
        _iterator46.f();
      }

      return !0;
    }

    function Qi(t) {
      return !(Ji.Arabic(t) || Ji["Arabic Supplement"](t) || Ji["Arabic Extended-A"](t) || Ji["Arabic Presentation Forms-A"](t) || Ji["Arabic Presentation Forms-B"](t));
    }

    function tn(t) {
      return !(746 !== t && 747 !== t && (t < 4352 || !(Ji["Bopomofo Extended"](t) || Ji.Bopomofo(t) || Ji["CJK Compatibility Forms"](t) && !(t >= 65097 && t <= 65103) || Ji["CJK Compatibility Ideographs"](t) || Ji["CJK Compatibility"](t) || Ji["CJK Radicals Supplement"](t) || Ji["CJK Strokes"](t) || !(!Ji["CJK Symbols and Punctuation"](t) || t >= 12296 && t <= 12305 || t >= 12308 && t <= 12319 || 12336 === t) || Ji["CJK Unified Ideographs Extension A"](t) || Ji["CJK Unified Ideographs"](t) || Ji["Enclosed CJK Letters and Months"](t) || Ji["Hangul Compatibility Jamo"](t) || Ji["Hangul Jamo Extended-A"](t) || Ji["Hangul Jamo Extended-B"](t) || Ji["Hangul Jamo"](t) || Ji["Hangul Syllables"](t) || Ji.Hiragana(t) || Ji["Ideographic Description Characters"](t) || Ji.Kanbun(t) || Ji["Kangxi Radicals"](t) || Ji["Katakana Phonetic Extensions"](t) || Ji.Katakana(t) && 12540 !== t || !(!Ji["Halfwidth and Fullwidth Forms"](t) || 65288 === t || 65289 === t || 65293 === t || t >= 65306 && t <= 65310 || 65339 === t || 65341 === t || 65343 === t || t >= 65371 && t <= 65503 || 65507 === t || t >= 65512 && t <= 65519) || !(!Ji["Small Form Variants"](t) || t >= 65112 && t <= 65118 || t >= 65123 && t <= 65126) || Ji["Unified Canadian Aboriginal Syllabics"](t) || Ji["Unified Canadian Aboriginal Syllabics Extended"](t) || Ji["Vertical Forms"](t) || Ji["Yijing Hexagram Symbols"](t) || Ji["Yi Syllables"](t) || Ji["Yi Radicals"](t))));
    }

    function en(t) {
      return !(tn(t) || function (t) {
        return !!(Ji["Latin-1 Supplement"](t) && (167 === t || 169 === t || 174 === t || 177 === t || 188 === t || 189 === t || 190 === t || 215 === t || 247 === t) || Ji["General Punctuation"](t) && (8214 === t || 8224 === t || 8225 === t || 8240 === t || 8241 === t || 8251 === t || 8252 === t || 8258 === t || 8263 === t || 8264 === t || 8265 === t || 8273 === t) || Ji["Letterlike Symbols"](t) || Ji["Number Forms"](t) || Ji["Miscellaneous Technical"](t) && (t >= 8960 && t <= 8967 || t >= 8972 && t <= 8991 || t >= 8996 && t <= 9e3 || 9003 === t || t >= 9085 && t <= 9114 || t >= 9150 && t <= 9165 || 9167 === t || t >= 9169 && t <= 9179 || t >= 9186 && t <= 9215) || Ji["Control Pictures"](t) && 9251 !== t || Ji["Optical Character Recognition"](t) || Ji["Enclosed Alphanumerics"](t) || Ji["Geometric Shapes"](t) || Ji["Miscellaneous Symbols"](t) && !(t >= 9754 && t <= 9759) || Ji["Miscellaneous Symbols and Arrows"](t) && (t >= 11026 && t <= 11055 || t >= 11088 && t <= 11097 || t >= 11192 && t <= 11243) || Ji["CJK Symbols and Punctuation"](t) || Ji.Katakana(t) || Ji["Private Use Area"](t) || Ji["CJK Compatibility Forms"](t) || Ji["Small Form Variants"](t) || Ji["Halfwidth and Fullwidth Forms"](t) || 8734 === t || 8756 === t || 8757 === t || t >= 9984 && t <= 10087 || t >= 10102 && t <= 10131 || 65532 === t || 65533 === t);
      }(t));
    }

    function rn(t) {
      return t >= 1424 && t <= 2303 || Ji["Arabic Presentation Forms-A"](t) || Ji["Arabic Presentation Forms-B"](t);
    }

    function nn(t, e) {
      return !(!e && rn(t) || t >= 2304 && t <= 3583 || t >= 3840 && t <= 4255 || Ji.Khmer(t));
    }

    function sn(t) {
      var _iterator47 = _createForOfIteratorHelper(t),
          _step47;

      try {
        for (_iterator47.s(); !(_step47 = _iterator47.n()).done;) {
          var _e48 = _step47.value;
          if (rn(_e48.charCodeAt(0))) return !0;
        }
      } catch (err) {
        _iterator47.e(err);
      } finally {
        _iterator47.f();
      }

      return !1;
    }

    var an = null,
        on = "unavailable",
        ln = null;

    var un = function un(t) {
      t && "string" == typeof t && t.indexOf("NetworkError") > -1 && (on = "error"), an && an(t);
    };

    function cn() {
      hn.fire(new Bt("pluginStateChange", {
        pluginStatus: on,
        pluginURL: ln
      }));
    }

    var hn = new Pt(),
        pn = function pn() {
      return on;
    },
        dn = function dn() {
      if ("deferred" !== on || !ln) throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");
      on = "loading", cn(), ln && _t({
        url: ln
      }, function (t) {
        t ? un(t) : (on = "loaded", cn());
      });
    },
        fn = {
      applyArabicShaping: null,
      processBidirectionalText: null,
      processStyledBidirectionalText: null,
      isLoaded: function isLoaded() {
        return "loaded" === on || null != fn.applyArabicShaping;
      },
      isLoading: function isLoading() {
        return "loading" === on;
      },
      setState: function setState(t) {
        on = t.pluginStatus, ln = t.pluginURL;
      },
      isParsed: function isParsed() {
        return null != fn.applyArabicShaping && null != fn.processBidirectionalText && null != fn.processStyledBidirectionalText;
      },
      getPluginURL: function getPluginURL() {
        return ln;
      }
    };

    var yn = /*#__PURE__*/function () {
      function yn(t, e) {
        _classCallCheck(this, yn);

        this.zoom = t, e ? (this.now = e.now, this.fadeDuration = e.fadeDuration, this.zoomHistory = e.zoomHistory, this.transition = e.transition) : (this.now = 0, this.fadeDuration = 0, this.zoomHistory = new Hi(), this.transition = {});
      }

      _createClass(yn, [{
        key: "isSupportedScript",
        value: function isSupportedScript(t) {
          return function (t, e) {
            var _iterator48 = _createForOfIteratorHelper(t),
                _step48;

            try {
              for (_iterator48.s(); !(_step48 = _iterator48.n()).done;) {
                var _r60 = _step48.value;
                if (!nn(_r60.charCodeAt(0), e)) return !1;
              }
            } catch (err) {
              _iterator48.e(err);
            } finally {
              _iterator48.f();
            }

            return !0;
          }(t, fn.isLoaded());
        }
      }, {
        key: "crossFadingFactor",
        value: function crossFadingFactor() {
          return 0 === this.fadeDuration ? 1 : Math.min((this.now - this.zoomHistory.lastIntegerZoomTime) / this.fadeDuration, 1);
        }
      }, {
        key: "getCrossfadeParameters",
        value: function getCrossfadeParameters() {
          var t = this.zoom,
              e = t - Math.floor(t),
              r = this.crossFadingFactor();
          return t > this.zoomHistory.lastIntegerZoom ? {
            fromScale: 2,
            toScale: 1,
            t: e + (1 - e) * r
          } : {
            fromScale: .5,
            toScale: 1,
            t: 1 - (1 - r) * e
          };
        }
      }]);

      return yn;
    }();

    var mn = /*#__PURE__*/function () {
      function mn(t, e) {
        _classCallCheck(this, mn);

        this.property = t, this.value = e, this.expression = function (t, e) {
          if (Nr(t)) return new ri(t, e);

          if (Yr(t)) {
            var _r61 = ei(t, e);

            if ("error" === _r61.result) throw new Error(_r61.value.map(function (t) {
              return "".concat(t.key, ": ").concat(t.message);
            }).join(", "));
            return _r61.value;
          }

          {
            var _r62 = t;
            return "string" == typeof t && "color" === e.type && (_r62 = oe.parse(t)), {
              kind: "constant",
              evaluate: function evaluate() {
                return _r62;
              }
            };
          }
        }(void 0 === e ? t.specification["default"] : e, t.specification);
      }

      _createClass(mn, [{
        key: "isDataDriven",
        value: function isDataDriven() {
          return "source" === this.expression.kind || "composite" === this.expression.kind;
        }
      }, {
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r) {
          return this.property.possiblyEvaluate(this, t, e, r);
        }
      }]);

      return mn;
    }();

    var gn = /*#__PURE__*/function () {
      function gn(t) {
        _classCallCheck(this, gn);

        this.property = t, this.value = new mn(t, void 0);
      }

      _createClass(gn, [{
        key: "transitioned",
        value: function transitioned(t, e) {
          return new vn(this.property, this.value, e, g({}, t.transition, this.transition), t.now);
        }
      }, {
        key: "untransitioned",
        value: function untransitioned() {
          return new vn(this.property, this.value, null, {}, 0);
        }
      }]);

      return gn;
    }();

    var xn = /*#__PURE__*/function () {
      function xn(t) {
        _classCallCheck(this, xn);

        this._properties = t, this._values = Object.create(t.defaultTransitionablePropertyValues);
      }

      _createClass(xn, [{
        key: "getValue",
        value: function getValue(t) {
          return I(this._values[t].value.value);
        }
      }, {
        key: "setValue",
        value: function setValue(t, e) {
          this._values.hasOwnProperty(t) || (this._values[t] = new gn(this._values[t].property)), this._values[t].value = new mn(this._values[t].property, null === e ? void 0 : I(e));
        }
      }, {
        key: "getTransition",
        value: function getTransition(t) {
          return I(this._values[t].transition);
        }
      }, {
        key: "setTransition",
        value: function setTransition(t, e) {
          this._values.hasOwnProperty(t) || (this._values[t] = new gn(this._values[t].property)), this._values[t].transition = I(e) || void 0;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {};

          for (var _i43 = 0, _Object$keys2 = Object.keys(this._values); _i43 < _Object$keys2.length; _i43++) {
            var _e49 = _Object$keys2[_i43];

            var _r63 = this.getValue(_e49);

            void 0 !== _r63 && (t[_e49] = _r63);

            var _i44 = this.getTransition(_e49);

            void 0 !== _i44 && (t["".concat(_e49, "-transition")] = _i44);
          }

          return t;
        }
      }, {
        key: "transitioned",
        value: function transitioned(t, e) {
          var r = new bn(this._properties);

          for (var _i45 = 0, _Object$keys3 = Object.keys(this._values); _i45 < _Object$keys3.length; _i45++) {
            var _i46 = _Object$keys3[_i45];
            r._values[_i46] = this._values[_i46].transitioned(t, e._values[_i46]);
          }

          return r;
        }
      }, {
        key: "untransitioned",
        value: function untransitioned() {
          var t = new bn(this._properties);

          for (var _i47 = 0, _Object$keys4 = Object.keys(this._values); _i47 < _Object$keys4.length; _i47++) {
            var _e50 = _Object$keys4[_i47];
            t._values[_e50] = this._values[_e50].untransitioned();
          }

          return t;
        }
      }]);

      return xn;
    }();

    var vn = /*#__PURE__*/function () {
      function vn(t, e, r, i, n) {
        _classCallCheck(this, vn);

        this.property = t, this.value = e, this.begin = n + i.delay || 0, this.end = this.begin + i.duration || 0, t.specification.transition && (i.delay || i.duration) && (this.prior = r);
      }

      _createClass(vn, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r) {
          var i = t.now || 0,
              n = this.value.possiblyEvaluate(t, e, r),
              s = this.prior;

          if (s) {
            if (i > this.end) return this.prior = null, n;
            if (this.value.isDataDriven()) return this.prior = null, n;
            if (i < this.begin) return s.possiblyEvaluate(t, e, r);
            {
              var _a22 = (i - this.begin) / (this.end - this.begin);

              return this.property.interpolate(s.possiblyEvaluate(t, e, r), n, h(_a22));
            }
          }

          return n;
        }
      }]);

      return vn;
    }();

    var bn = /*#__PURE__*/function () {
      function bn(t) {
        _classCallCheck(this, bn);

        this._properties = t, this._values = Object.create(t.defaultTransitioningPropertyValues);
      }

      _createClass(bn, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r) {
          var i = new An(this._properties);

          for (var _i48 = 0, _Object$keys5 = Object.keys(this._values); _i48 < _Object$keys5.length; _i48++) {
            var _n28 = _Object$keys5[_i48];
            i._values[_n28] = this._values[_n28].possiblyEvaluate(t, e, r);
          }

          return i;
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          for (var _i49 = 0, _Object$keys6 = Object.keys(this._values); _i49 < _Object$keys6.length; _i49++) {
            var _t53 = _Object$keys6[_i49];
            if (this._values[_t53].prior) return !0;
          }

          return !1;
        }
      }]);

      return bn;
    }();

    var wn = /*#__PURE__*/function () {
      function wn(t) {
        _classCallCheck(this, wn);

        this._properties = t, this._values = Object.create(t.defaultPropertyValues);
      }

      _createClass(wn, [{
        key: "getValue",
        value: function getValue(t) {
          return I(this._values[t].value);
        }
      }, {
        key: "setValue",
        value: function setValue(t, e) {
          this._values[t] = new mn(this._values[t].property, null === e ? void 0 : I(e));
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {};

          for (var _i50 = 0, _Object$keys7 = Object.keys(this._values); _i50 < _Object$keys7.length; _i50++) {
            var _e51 = _Object$keys7[_i50];

            var _r64 = this.getValue(_e51);

            void 0 !== _r64 && (t[_e51] = _r64);
          }

          return t;
        }
      }, {
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r) {
          var i = new An(this._properties);

          for (var _i51 = 0, _Object$keys8 = Object.keys(this._values); _i51 < _Object$keys8.length; _i51++) {
            var _n29 = _Object$keys8[_i51];
            i._values[_n29] = this._values[_n29].possiblyEvaluate(t, e, r);
          }

          return i;
        }
      }]);

      return wn;
    }();

    var _n = /*#__PURE__*/function () {
      function _n(t, e, r) {
        _classCallCheck(this, _n);

        this.property = t, this.value = e, this.parameters = r;
      }

      _createClass(_n, [{
        key: "isConstant",
        value: function isConstant() {
          return "constant" === this.value.kind;
        }
      }, {
        key: "constantOr",
        value: function constantOr(t) {
          return "constant" === this.value.kind ? this.value.value : t;
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, i) {
          return this.property.evaluate(this.value, this.parameters, t, e, r, i);
        }
      }]);

      return _n;
    }();

    var An = /*#__PURE__*/function () {
      function An(t) {
        _classCallCheck(this, An);

        this._properties = t, this._values = Object.create(t.defaultPossiblyEvaluatedValues);
      }

      _createClass(An, [{
        key: "get",
        value: function get(t) {
          return this._values[t];
        }
      }]);

      return An;
    }();

    var kn = /*#__PURE__*/function () {
      function kn(t) {
        _classCallCheck(this, kn);

        this.specification = t;
      }

      _createClass(kn, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e) {
          return t.expression.evaluate(e);
        }
      }, {
        key: "interpolate",
        value: function interpolate(t, e, r) {
          var i = We[this.specification.type];
          return i ? i(t, e, r) : t;
        }
      }]);

      return kn;
    }();

    var Sn = /*#__PURE__*/function () {
      function Sn(t, e) {
        _classCallCheck(this, Sn);

        this.specification = t, this.overrides = e;
      }

      _createClass(Sn, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r, i) {
          return new _n(this, "constant" === t.expression.kind || "camera" === t.expression.kind ? {
            kind: "constant",
            value: t.expression.evaluate(e, null, {}, r, i)
          } : t.expression, e);
        }
      }, {
        key: "interpolate",
        value: function interpolate(t, e, r) {
          if ("constant" !== t.value.kind || "constant" !== e.value.kind) return t;
          if (void 0 === t.value.value || void 0 === e.value.value) return new _n(this, {
            kind: "constant",
            value: void 0
          }, t.parameters);
          var i = We[this.specification.type];
          return i ? new _n(this, {
            kind: "constant",
            value: i(t.value.value, e.value.value, r)
          }, t.parameters) : t;
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, i, n, s) {
          return "constant" === t.kind ? t.value : t.evaluate(e, r, i, n, s);
        }
      }]);

      return Sn;
    }();

    var In = /*#__PURE__*/function (_Sn) {
      _inherits(In, _Sn);

      var _super7 = _createSuper(In);

      function In() {
        _classCallCheck(this, In);

        return _super7.apply(this, arguments);
      }

      _createClass(In, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r, i) {
          if (void 0 === t.value) return new _n(this, {
            kind: "constant",
            value: void 0
          }, e);

          if ("constant" === t.expression.kind) {
            var _n30 = t.expression.evaluate(e, null, {}, r, i),
                _s23 = "resolvedImage" === t.property.specification.type && "string" != typeof _n30 ? _n30.name : _n30,
                _a23 = this._calculate(_s23, _s23, _s23, e);

            return new _n(this, {
              kind: "constant",
              value: _a23
            }, e);
          }

          if ("camera" === t.expression.kind) {
            var _r65 = this._calculate(t.expression.evaluate({
              zoom: e.zoom - 1
            }), t.expression.evaluate({
              zoom: e.zoom
            }), t.expression.evaluate({
              zoom: e.zoom + 1
            }), e);

            return new _n(this, {
              kind: "constant",
              value: _r65
            }, e);
          }

          return new _n(this, t.expression, e);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, i, n, s) {
          if ("source" === t.kind) {
            var _a24 = t.evaluate(e, r, i, n, s);

            return this._calculate(_a24, _a24, _a24, e);
          }

          return "composite" === t.kind ? this._calculate(t.evaluate({
            zoom: Math.floor(e.zoom) - 1
          }, r, i), t.evaluate({
            zoom: Math.floor(e.zoom)
          }, r, i), t.evaluate({
            zoom: Math.floor(e.zoom) + 1
          }, r, i), e) : t.value;
        }
      }, {
        key: "_calculate",
        value: function _calculate(t, e, r, i) {
          return i.zoom > i.zoomHistory.lastIntegerZoom ? {
            from: t,
            to: e
          } : {
            from: r,
            to: e
          };
        }
      }, {
        key: "interpolate",
        value: function interpolate(t) {
          return t;
        }
      }]);

      return In;
    }(Sn);

    var Tn = /*#__PURE__*/function () {
      function Tn(t) {
        _classCallCheck(this, Tn);

        this.specification = t;
      }

      _createClass(Tn, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r, i) {
          if (void 0 !== t.value) {
            if ("constant" === t.expression.kind) {
              var _n31 = t.expression.evaluate(e, null, {}, r, i);

              return this._calculate(_n31, _n31, _n31, e);
            }

            return this._calculate(t.expression.evaluate(new yn(Math.floor(e.zoom - 1), e)), t.expression.evaluate(new yn(Math.floor(e.zoom), e)), t.expression.evaluate(new yn(Math.floor(e.zoom + 1), e)), e);
          }
        }
      }, {
        key: "_calculate",
        value: function _calculate(t, e, r, i) {
          return i.zoom > i.zoomHistory.lastIntegerZoom ? {
            from: t,
            to: e
          } : {
            from: r,
            to: e
          };
        }
      }, {
        key: "interpolate",
        value: function interpolate(t) {
          return t;
        }
      }]);

      return Tn;
    }();

    var zn = /*#__PURE__*/function () {
      function zn(t) {
        _classCallCheck(this, zn);

        this.specification = t;
      }

      _createClass(zn, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r, i) {
          return !!t.expression.evaluate(e, null, {}, r, i);
        }
      }, {
        key: "interpolate",
        value: function interpolate() {
          return !1;
        }
      }]);

      return zn;
    }();

    var En = function En(t) {
      _classCallCheck(this, En);

      this.properties = t, this.defaultPropertyValues = {}, this.defaultTransitionablePropertyValues = {}, this.defaultTransitioningPropertyValues = {}, this.defaultPossiblyEvaluatedValues = {}, this.overridableProperties = [];

      for (var _e52 in t) {
        var _r66 = t[_e52];
        _r66.specification.overridable && this.overridableProperties.push(_e52);

        var _i52 = this.defaultPropertyValues[_e52] = new mn(_r66, void 0),
            _n32 = this.defaultTransitionablePropertyValues[_e52] = new gn(_r66);

        this.defaultTransitioningPropertyValues[_e52] = _n32.untransitioned(), this.defaultPossiblyEvaluatedValues[_e52] = _i52.possiblyEvaluate({});
      }
    };

    function Cn(t, e) {
      return 256 * (t = f(Math.floor(t), 0, 255)) + f(Math.floor(e), 0, 255);
    }

    ji("DataDrivenProperty", Sn), ji("DataConstantProperty", kn), ji("CrossFadedDataDrivenProperty", In), ji("CrossFadedProperty", Tn), ji("ColorRampProperty", zn);
    var Mn = {
      Int8: Int8Array,
      Uint8: Uint8Array,
      Int16: Int16Array,
      Uint16: Uint16Array,
      Int32: Int32Array,
      Uint32: Uint32Array,
      Float32: Float32Array
    };

    var Bn = function Bn(t, e) {
      _classCallCheck(this, Bn);

      this._structArray = t, this._pos1 = e * this.size, this._pos2 = this._pos1 / 2, this._pos4 = this._pos1 / 4, this._pos8 = this._pos1 / 8;
    };

    var Dn = /*#__PURE__*/function () {
      function Dn() {
        _classCallCheck(this, Dn);

        this.isTransferred = !1, this.capacity = -1, this.resize(0);
      }

      _createClass(Dn, [{
        key: "_trim",
        value: function _trim() {
          this.length !== this.capacity && (this.capacity = this.length, this.arrayBuffer = this.arrayBuffer.slice(0, this.length * this.bytesPerElement), this._refreshViews());
        }
      }, {
        key: "clear",
        value: function clear() {
          this.length = 0;
        }
      }, {
        key: "resize",
        value: function resize(t) {
          this.reserve(t), this.length = t;
        }
      }, {
        key: "reserve",
        value: function reserve(t) {
          if (t > this.capacity) {
            this.capacity = Math.max(t, Math.floor(5 * this.capacity), 128), this.arrayBuffer = new ArrayBuffer(this.capacity * this.bytesPerElement);
            var _e53 = this.uint8;
            this._refreshViews(), _e53 && this.uint8.set(_e53);
          }
        }
      }, {
        key: "_refreshViews",
        value: function _refreshViews() {
          throw new Error("_refreshViews() must be implemented by each concrete StructArray layout");
        }
      }], [{
        key: "serialize",
        value: function serialize(t, e) {
          return t._trim(), e && (t.isTransferred = !0, e.push(t.arrayBuffer)), {
            length: t.length,
            arrayBuffer: t.arrayBuffer
          };
        }
      }, {
        key: "deserialize",
        value: function deserialize(t) {
          var e = Object.create(this.prototype);
          return e.arrayBuffer = t.arrayBuffer, e.length = t.length, e.capacity = t.arrayBuffer.byteLength / e.bytesPerElement, e._refreshViews(), e;
        }
      }]);

      return Dn;
    }();

    function Pn(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = 0,
          i = 0;
      return {
        members: t.map(function (t) {
          var n = Mn[t.type].BYTES_PER_ELEMENT,
              s = r = Vn(r, Math.max(e, n)),
              a = t.components || 1;
          return i = Math.max(i, n), r += n * a, {
            name: t.name,
            type: t.type,
            components: a,
            offset: s
          };
        }),
        size: Vn(r, Math.max(i, e)),
        alignment: e
      };
    }

    function Vn(t, e) {
      return Math.ceil(t / e) * e;
    }

    var Fn = /*#__PURE__*/function (_Dn) {
      _inherits(Fn, _Dn);

      var _super8 = _createSuper(Fn);

      function Fn() {
        _classCallCheck(this, Fn);

        return _super8.apply(this, arguments);
      }

      _createClass(Fn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e) {
          var r = this.length;
          return this.resize(r + 1), this.emplace(r, t, e);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r) {
          var i = 2 * t;
          return this.int16[i + 0] = e, this.int16[i + 1] = r, t;
        }
      }]);

      return Fn;
    }(Dn);

    Fn.prototype.bytesPerElement = 4, ji("StructArrayLayout2i4", Fn);

    var Rn = /*#__PURE__*/function (_Dn2) {
      _inherits(Rn, _Dn2);

      var _super9 = _createSuper(Rn);

      function Rn() {
        _classCallCheck(this, Rn);

        return _super9.apply(this, arguments);
      }

      _createClass(Rn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i) {
          var n = this.length;
          return this.resize(n + 1), this.emplace(n, t, e, r, i);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n) {
          var s = 4 * t;
          return this.int16[s + 0] = e, this.int16[s + 1] = r, this.int16[s + 2] = i, this.int16[s + 3] = n, t;
        }
      }]);

      return Rn;
    }(Dn);

    Rn.prototype.bytesPerElement = 8, ji("StructArrayLayout4i8", Rn);

    var Ln = /*#__PURE__*/function (_Dn3) {
      _inherits(Ln, _Dn3);

      var _super10 = _createSuper(Ln);

      function Ln() {
        _classCallCheck(this, Ln);

        return _super10.apply(this, arguments);
      }

      _createClass(Ln, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i, n, s, a) {
          var o = this.length;
          return this.resize(o + 1), this.emplace(o, t, e, r, i, n, s, a);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n, s, a, o) {
          var l = 6 * t,
              u = 12 * t,
              c = 3 * t;
          return this.int16[l + 0] = e, this.int16[l + 1] = r, this.uint8[u + 4] = i, this.uint8[u + 5] = n, this.uint8[u + 6] = s, this.uint8[u + 7] = a, this.float32[c + 2] = o, t;
        }
      }]);

      return Ln;
    }(Dn);

    Ln.prototype.bytesPerElement = 12, ji("StructArrayLayout2i4ub1f12", Ln);

    var Un = /*#__PURE__*/function (_Dn4) {
      _inherits(Un, _Dn4);

      var _super11 = _createSuper(Un);

      function Un() {
        _classCallCheck(this, Un);

        return _super11.apply(this, arguments);
      }

      _createClass(Un, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e) {
          var r = this.length;
          return this.resize(r + 1), this.emplace(r, t, e);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r) {
          var i = 2 * t;
          return this.float32[i + 0] = e, this.float32[i + 1] = r, t;
        }
      }]);

      return Un;
    }(Dn);

    Un.prototype.bytesPerElement = 8, ji("StructArrayLayout2f8", Un);

    var On = /*#__PURE__*/function (_Dn5) {
      _inherits(On, _Dn5);

      var _super12 = _createSuper(On);

      function On() {
        _classCallCheck(this, On);

        return _super12.apply(this, arguments);
      }

      _createClass(On, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i, n, s, a, o, l, u) {
          var c = this.length;
          return this.resize(c + 1), this.emplace(c, t, e, r, i, n, s, a, o, l, u);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n, s, a, o, l, u, c) {
          var h = 10 * t;
          return this.uint16[h + 0] = e, this.uint16[h + 1] = r, this.uint16[h + 2] = i, this.uint16[h + 3] = n, this.uint16[h + 4] = s, this.uint16[h + 5] = a, this.uint16[h + 6] = o, this.uint16[h + 7] = l, this.uint16[h + 8] = u, this.uint16[h + 9] = c, t;
        }
      }]);

      return On;
    }(Dn);

    On.prototype.bytesPerElement = 20, ji("StructArrayLayout10ui20", On);

    var $n = /*#__PURE__*/function (_Dn6) {
      _inherits($n, _Dn6);

      var _super13 = _createSuper($n);

      function $n() {
        _classCallCheck(this, $n);

        return _super13.apply(this, arguments);
      }

      _createClass($n, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i, n, s, a, o, l, u, c, h) {
          var p = this.length;
          return this.resize(p + 1), this.emplace(p, t, e, r, i, n, s, a, o, l, u, c, h);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n, s, a, o, l, u, c, h, p) {
          var d = 12 * t;
          return this.int16[d + 0] = e, this.int16[d + 1] = r, this.int16[d + 2] = i, this.int16[d + 3] = n, this.uint16[d + 4] = s, this.uint16[d + 5] = a, this.uint16[d + 6] = o, this.uint16[d + 7] = l, this.int16[d + 8] = u, this.int16[d + 9] = c, this.int16[d + 10] = h, this.int16[d + 11] = p, t;
        }
      }]);

      return $n;
    }(Dn);

    $n.prototype.bytesPerElement = 24, ji("StructArrayLayout4i4ui4i24", $n);

    var qn = /*#__PURE__*/function (_Dn7) {
      _inherits(qn, _Dn7);

      var _super14 = _createSuper(qn);

      function qn() {
        _classCallCheck(this, qn);

        return _super14.apply(this, arguments);
      }

      _createClass(qn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r) {
          var i = this.length;
          return this.resize(i + 1), this.emplace(i, t, e, r);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i) {
          var n = 3 * t;
          return this.float32[n + 0] = e, this.float32[n + 1] = r, this.float32[n + 2] = i, t;
        }
      }]);

      return qn;
    }(Dn);

    qn.prototype.bytesPerElement = 12, ji("StructArrayLayout3f12", qn);

    var Nn = /*#__PURE__*/function (_Dn8) {
      _inherits(Nn, _Dn8);

      var _super15 = _createSuper(Nn);

      function Nn() {
        _classCallCheck(this, Nn);

        return _super15.apply(this, arguments);
      }

      _createClass(Nn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t) {
          var e = this.length;
          return this.resize(e + 1), this.emplace(e, t);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e) {
          return this.uint32[1 * t + 0] = e, t;
        }
      }]);

      return Nn;
    }(Dn);

    Nn.prototype.bytesPerElement = 4, ji("StructArrayLayout1ul4", Nn);

    var jn = /*#__PURE__*/function (_Dn9) {
      _inherits(jn, _Dn9);

      var _super16 = _createSuper(jn);

      function jn() {
        _classCallCheck(this, jn);

        return _super16.apply(this, arguments);
      }

      _createClass(jn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i, n, s, a, o, l, u) {
          var c = this.length;
          return this.resize(c + 1), this.emplace(c, t, e, r, i, n, s, a, o, l, u);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n, s, a, o, l, u, c) {
          var h = 16 * t,
              p = 8 * t;
          return this.int16[h + 0] = e, this.int16[h + 1] = r, this.float32[p + 1] = i, this.float32[p + 2] = n, this.float32[p + 3] = s, this.float32[p + 4] = a, this.int16[h + 10] = o, this.uint32[p + 6] = l, this.uint16[h + 14] = u, this.uint16[h + 15] = c, t;
        }
      }]);

      return jn;
    }(Dn);

    jn.prototype.bytesPerElement = 32, ji("StructArrayLayout2i4f1i1ul2ui32", jn);

    var Kn = /*#__PURE__*/function (_Dn10) {
      _inherits(Kn, _Dn10);

      var _super17 = _createSuper(Kn);

      function Kn() {
        _classCallCheck(this, Kn);

        return _super17.apply(this, arguments);
      }

      _createClass(Kn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i, n, s) {
          var a = this.length;
          return this.resize(a + 1), this.emplace(a, t, e, r, i, n, s);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n, s, a) {
          var o = 6 * t;
          return this.int16[o + 0] = e, this.int16[o + 1] = r, this.int16[o + 2] = i, this.int16[o + 3] = n, this.int16[o + 4] = s, this.int16[o + 5] = a, t;
        }
      }]);

      return Kn;
    }(Dn);

    Kn.prototype.bytesPerElement = 12, ji("StructArrayLayout2i2i2i12", Kn);

    var Zn = /*#__PURE__*/function (_Dn11) {
      _inherits(Zn, _Dn11);

      var _super18 = _createSuper(Zn);

      function Zn() {
        _classCallCheck(this, Zn);

        return _super18.apply(this, arguments);
      }

      _createClass(Zn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i, n) {
          var s = this.length;
          return this.resize(s + 1), this.emplace(s, t, e, r, i, n);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n, s) {
          var a = 4 * t,
              o = 8 * t;
          return this.float32[a + 0] = e, this.float32[a + 1] = r, this.float32[a + 2] = i, this.int16[o + 6] = n, this.int16[o + 7] = s, t;
        }
      }]);

      return Zn;
    }(Dn);

    Zn.prototype.bytesPerElement = 16, ji("StructArrayLayout2f1f2i16", Zn);

    var Xn = /*#__PURE__*/function (_Dn12) {
      _inherits(Xn, _Dn12);

      var _super19 = _createSuper(Xn);

      function Xn() {
        _classCallCheck(this, Xn);

        return _super19.apply(this, arguments);
      }

      _createClass(Xn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i) {
          var n = this.length;
          return this.resize(n + 1), this.emplace(n, t, e, r, i);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n) {
          var s = 12 * t,
              a = 3 * t;
          return this.uint8[s + 0] = e, this.uint8[s + 1] = r, this.float32[a + 1] = i, this.float32[a + 2] = n, t;
        }
      }]);

      return Xn;
    }(Dn);

    Xn.prototype.bytesPerElement = 12, ji("StructArrayLayout2ub2f12", Xn);

    var Gn = /*#__PURE__*/function (_Dn13) {
      _inherits(Gn, _Dn13);

      var _super20 = _createSuper(Gn);

      function Gn() {
        _classCallCheck(this, Gn);

        return _super20.apply(this, arguments);
      }

      _createClass(Gn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r) {
          var i = this.length;
          return this.resize(i + 1), this.emplace(i, t, e, r);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i) {
          var n = 3 * t;
          return this.uint16[n + 0] = e, this.uint16[n + 1] = r, this.uint16[n + 2] = i, t;
        }
      }]);

      return Gn;
    }(Dn);

    Gn.prototype.bytesPerElement = 6, ji("StructArrayLayout3ui6", Gn);

    var Hn = /*#__PURE__*/function (_Dn14) {
      _inherits(Hn, _Dn14);

      var _super21 = _createSuper(Hn);

      function Hn() {
        _classCallCheck(this, Hn);

        return _super21.apply(this, arguments);
      }

      _createClass(Hn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i, n, s, a, o, l, u, c, h, p, d, f, y, m) {
          var g = this.length;
          return this.resize(g + 1), this.emplace(g, t, e, r, i, n, s, a, o, l, u, c, h, p, d, f, y, m);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n, s, a, o, l, u, c, h, p, d, f, y, m, g) {
          var x = 24 * t,
              v = 12 * t,
              b = 48 * t;
          return this.int16[x + 0] = e, this.int16[x + 1] = r, this.uint16[x + 2] = i, this.uint16[x + 3] = n, this.uint32[v + 2] = s, this.uint32[v + 3] = a, this.uint32[v + 4] = o, this.uint16[x + 10] = l, this.uint16[x + 11] = u, this.uint16[x + 12] = c, this.float32[v + 7] = h, this.float32[v + 8] = p, this.uint8[b + 36] = d, this.uint8[b + 37] = f, this.uint8[b + 38] = y, this.uint32[v + 10] = m, this.int16[x + 22] = g, t;
        }
      }]);

      return Hn;
    }(Dn);

    Hn.prototype.bytesPerElement = 48, ji("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48", Hn);

    var Jn = /*#__PURE__*/function (_Dn15) {
      _inherits(Jn, _Dn15);

      var _super22 = _createSuper(Jn);

      function Jn() {
        _classCallCheck(this, Jn);

        return _super22.apply(this, arguments);
      }

      _createClass(Jn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i, n, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b, w, _, A, k, S, I, T) {
          var z = this.length;
          return this.resize(z + 1), this.emplace(z, t, e, r, i, n, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b, w, _, A, k, S, I, T);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b, w, _, A, k, S, I, T, z) {
          var E = 34 * t,
              C = 17 * t;
          return this.int16[E + 0] = e, this.int16[E + 1] = r, this.int16[E + 2] = i, this.int16[E + 3] = n, this.int16[E + 4] = s, this.int16[E + 5] = a, this.int16[E + 6] = o, this.int16[E + 7] = l, this.uint16[E + 8] = u, this.uint16[E + 9] = c, this.uint16[E + 10] = h, this.uint16[E + 11] = p, this.uint16[E + 12] = d, this.uint16[E + 13] = f, this.uint16[E + 14] = y, this.uint16[E + 15] = m, this.uint16[E + 16] = g, this.uint16[E + 17] = x, this.uint16[E + 18] = v, this.uint16[E + 19] = b, this.uint16[E + 20] = w, this.uint16[E + 21] = _, this.uint16[E + 22] = A, this.uint32[C + 12] = k, this.float32[C + 13] = S, this.float32[C + 14] = I, this.float32[C + 15] = T, this.float32[C + 16] = z, t;
        }
      }]);

      return Jn;
    }(Dn);

    Jn.prototype.bytesPerElement = 68, ji("StructArrayLayout8i15ui1ul4f68", Jn);

    var Yn = /*#__PURE__*/function (_Dn16) {
      _inherits(Yn, _Dn16);

      var _super23 = _createSuper(Yn);

      function Yn() {
        _classCallCheck(this, Yn);

        return _super23.apply(this, arguments);
      }

      _createClass(Yn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t) {
          var e = this.length;
          return this.resize(e + 1), this.emplace(e, t);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e) {
          return this.float32[1 * t + 0] = e, t;
        }
      }]);

      return Yn;
    }(Dn);

    Yn.prototype.bytesPerElement = 4, ji("StructArrayLayout1f4", Yn);

    var Wn = /*#__PURE__*/function (_Dn17) {
      _inherits(Wn, _Dn17);

      var _super24 = _createSuper(Wn);

      function Wn() {
        _classCallCheck(this, Wn);

        return _super24.apply(this, arguments);
      }

      _createClass(Wn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r) {
          var i = this.length;
          return this.resize(i + 1), this.emplace(i, t, e, r);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i) {
          var n = 3 * t;
          return this.int16[n + 0] = e, this.int16[n + 1] = r, this.int16[n + 2] = i, t;
        }
      }]);

      return Wn;
    }(Dn);

    Wn.prototype.bytesPerElement = 6, ji("StructArrayLayout3i6", Wn);

    var Qn = /*#__PURE__*/function (_Dn18) {
      _inherits(Qn, _Dn18);

      var _super25 = _createSuper(Qn);

      function Qn() {
        _classCallCheck(this, Qn);

        return _super25.apply(this, arguments);
      }

      _createClass(Qn, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r) {
          var i = this.length;
          return this.resize(i + 1), this.emplace(i, t, e, r);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i) {
          var n = 4 * t;
          return this.uint32[2 * t + 0] = e, this.uint16[n + 2] = r, this.uint16[n + 3] = i, t;
        }
      }]);

      return Qn;
    }(Dn);

    Qn.prototype.bytesPerElement = 8, ji("StructArrayLayout1ul2ui8", Qn);

    var ts = /*#__PURE__*/function (_Dn19) {
      _inherits(ts, _Dn19);

      var _super26 = _createSuper(ts);

      function ts() {
        _classCallCheck(this, ts);

        return _super26.apply(this, arguments);
      }

      _createClass(ts, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e) {
          var r = this.length;
          return this.resize(r + 1), this.emplace(r, t, e);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r) {
          var i = 2 * t;
          return this.uint16[i + 0] = e, this.uint16[i + 1] = r, t;
        }
      }]);

      return ts;
    }(Dn);

    ts.prototype.bytesPerElement = 4, ji("StructArrayLayout2ui4", ts);

    var es = /*#__PURE__*/function (_Dn20) {
      _inherits(es, _Dn20);

      var _super27 = _createSuper(es);

      function es() {
        _classCallCheck(this, es);

        return _super27.apply(this, arguments);
      }

      _createClass(es, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t) {
          var e = this.length;
          return this.resize(e + 1), this.emplace(e, t);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e) {
          return this.uint16[1 * t + 0] = e, t;
        }
      }]);

      return es;
    }(Dn);

    es.prototype.bytesPerElement = 2, ji("StructArrayLayout1ui2", es);

    var rs = /*#__PURE__*/function (_Dn21) {
      _inherits(rs, _Dn21);

      var _super28 = _createSuper(rs);

      function rs() {
        _classCallCheck(this, rs);

        return _super28.apply(this, arguments);
      }

      _createClass(rs, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, i) {
          var n = this.length;
          return this.resize(n + 1), this.emplace(n, t, e, r, i);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, i, n) {
          var s = 4 * t;
          return this.float32[s + 0] = e, this.float32[s + 1] = r, this.float32[s + 2] = i, this.float32[s + 3] = n, t;
        }
      }]);

      return rs;
    }(Dn);

    rs.prototype.bytesPerElement = 16, ji("StructArrayLayout4f16", rs);

    var is = /*#__PURE__*/function (_Bn) {
      _inherits(is, _Bn);

      var _super29 = _createSuper(is);

      function is() {
        _classCallCheck(this, is);

        return _super29.apply(this, arguments);
      }

      _createClass(is, [{
        key: "anchorPointX",
        get: function get() {
          return this._structArray.int16[this._pos2 + 0];
        }
      }, {
        key: "anchorPointY",
        get: function get() {
          return this._structArray.int16[this._pos2 + 1];
        }
      }, {
        key: "x1",
        get: function get() {
          return this._structArray.float32[this._pos4 + 1];
        }
      }, {
        key: "y1",
        get: function get() {
          return this._structArray.float32[this._pos4 + 2];
        }
      }, {
        key: "x2",
        get: function get() {
          return this._structArray.float32[this._pos4 + 3];
        }
      }, {
        key: "y2",
        get: function get() {
          return this._structArray.float32[this._pos4 + 4];
        }
      }, {
        key: "padding",
        get: function get() {
          return this._structArray.int16[this._pos2 + 10];
        }
      }, {
        key: "featureIndex",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 6];
        }
      }, {
        key: "sourceLayerIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 14];
        }
      }, {
        key: "bucketIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 15];
        }
      }, {
        key: "anchorPoint",
        get: function get() {
          return new i(this.anchorPointX, this.anchorPointY);
        }
      }]);

      return is;
    }(Bn);

    is.prototype.size = 32;

    var ns = /*#__PURE__*/function (_jn) {
      _inherits(ns, _jn);

      var _super30 = _createSuper(ns);

      function ns() {
        _classCallCheck(this, ns);

        return _super30.apply(this, arguments);
      }

      _createClass(ns, [{
        key: "get",
        value: function get(t) {
          return new is(this, t);
        }
      }]);

      return ns;
    }(jn);

    ji("CollisionBoxArray", ns);

    var ss = /*#__PURE__*/function (_Bn2) {
      _inherits(ss, _Bn2);

      var _super31 = _createSuper(ss);

      function ss() {
        _classCallCheck(this, ss);

        return _super31.apply(this, arguments);
      }

      _createClass(ss, [{
        key: "anchorX",
        get: function get() {
          return this._structArray.int16[this._pos2 + 0];
        }
      }, {
        key: "anchorY",
        get: function get() {
          return this._structArray.int16[this._pos2 + 1];
        }
      }, {
        key: "glyphStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 2];
        }
      }, {
        key: "numGlyphs",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 3];
        }
      }, {
        key: "vertexStartIndex",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 2];
        }
      }, {
        key: "lineStartIndex",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 3];
        }
      }, {
        key: "lineLength",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 4];
        }
      }, {
        key: "segment",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 10];
        }
      }, {
        key: "lowerSize",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 11];
        }
      }, {
        key: "upperSize",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 12];
        }
      }, {
        key: "lineOffsetX",
        get: function get() {
          return this._structArray.float32[this._pos4 + 7];
        }
      }, {
        key: "lineOffsetY",
        get: function get() {
          return this._structArray.float32[this._pos4 + 8];
        }
      }, {
        key: "writingMode",
        get: function get() {
          return this._structArray.uint8[this._pos1 + 36];
        }
      }, {
        key: "placedOrientation",
        get: function get() {
          return this._structArray.uint8[this._pos1 + 37];
        },
        set: function set(t) {
          this._structArray.uint8[this._pos1 + 37] = t;
        }
      }, {
        key: "hidden",
        get: function get() {
          return this._structArray.uint8[this._pos1 + 38];
        },
        set: function set(t) {
          this._structArray.uint8[this._pos1 + 38] = t;
        }
      }, {
        key: "crossTileID",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 10];
        },
        set: function set(t) {
          this._structArray.uint32[this._pos4 + 10] = t;
        }
      }, {
        key: "associatedIconIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 22];
        }
      }]);

      return ss;
    }(Bn);

    ss.prototype.size = 48;

    var as = /*#__PURE__*/function (_Hn) {
      _inherits(as, _Hn);

      var _super32 = _createSuper(as);

      function as() {
        _classCallCheck(this, as);

        return _super32.apply(this, arguments);
      }

      _createClass(as, [{
        key: "get",
        value: function get(t) {
          return new ss(this, t);
        }
      }]);

      return as;
    }(Hn);

    ji("PlacedSymbolArray", as);

    var os = /*#__PURE__*/function (_Bn3) {
      _inherits(os, _Bn3);

      var _super33 = _createSuper(os);

      function os() {
        _classCallCheck(this, os);

        return _super33.apply(this, arguments);
      }

      _createClass(os, [{
        key: "anchorX",
        get: function get() {
          return this._structArray.int16[this._pos2 + 0];
        }
      }, {
        key: "anchorY",
        get: function get() {
          return this._structArray.int16[this._pos2 + 1];
        }
      }, {
        key: "rightJustifiedTextSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 2];
        }
      }, {
        key: "centerJustifiedTextSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 3];
        }
      }, {
        key: "leftJustifiedTextSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 4];
        }
      }, {
        key: "verticalPlacedTextSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 5];
        }
      }, {
        key: "placedIconSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 6];
        }
      }, {
        key: "verticalPlacedIconSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 7];
        }
      }, {
        key: "key",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 8];
        }
      }, {
        key: "textBoxStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 9];
        }
      }, {
        key: "textBoxEndIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 10];
        }
      }, {
        key: "verticalTextBoxStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 11];
        }
      }, {
        key: "verticalTextBoxEndIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 12];
        }
      }, {
        key: "iconBoxStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 13];
        }
      }, {
        key: "iconBoxEndIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 14];
        }
      }, {
        key: "verticalIconBoxStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 15];
        }
      }, {
        key: "verticalIconBoxEndIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 16];
        }
      }, {
        key: "featureIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 17];
        }
      }, {
        key: "numHorizontalGlyphVertices",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 18];
        }
      }, {
        key: "numVerticalGlyphVertices",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 19];
        }
      }, {
        key: "numIconVertices",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 20];
        }
      }, {
        key: "numVerticalIconVertices",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 21];
        }
      }, {
        key: "useRuntimeCollisionCircles",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 22];
        }
      }, {
        key: "crossTileID",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 12];
        },
        set: function set(t) {
          this._structArray.uint32[this._pos4 + 12] = t;
        }
      }, {
        key: "textBoxScale",
        get: function get() {
          return this._structArray.float32[this._pos4 + 13];
        }
      }, {
        key: "textOffset0",
        get: function get() {
          return this._structArray.float32[this._pos4 + 14];
        }
      }, {
        key: "textOffset1",
        get: function get() {
          return this._structArray.float32[this._pos4 + 15];
        }
      }, {
        key: "collisionCircleDiameter",
        get: function get() {
          return this._structArray.float32[this._pos4 + 16];
        }
      }]);

      return os;
    }(Bn);

    os.prototype.size = 68;

    var ls = /*#__PURE__*/function (_Jn) {
      _inherits(ls, _Jn);

      var _super34 = _createSuper(ls);

      function ls() {
        _classCallCheck(this, ls);

        return _super34.apply(this, arguments);
      }

      _createClass(ls, [{
        key: "get",
        value: function get(t) {
          return new os(this, t);
        }
      }]);

      return ls;
    }(Jn);

    ji("SymbolInstanceArray", ls);

    var us = /*#__PURE__*/function (_Yn) {
      _inherits(us, _Yn);

      var _super35 = _createSuper(us);

      function us() {
        _classCallCheck(this, us);

        return _super35.apply(this, arguments);
      }

      _createClass(us, [{
        key: "getoffsetX",
        value: function getoffsetX(t) {
          return this.float32[1 * t + 0];
        }
      }]);

      return us;
    }(Yn);

    ji("GlyphOffsetArray", us);

    var cs = /*#__PURE__*/function (_Wn) {
      _inherits(cs, _Wn);

      var _super36 = _createSuper(cs);

      function cs() {
        _classCallCheck(this, cs);

        return _super36.apply(this, arguments);
      }

      _createClass(cs, [{
        key: "getx",
        value: function getx(t) {
          return this.int16[3 * t + 0];
        }
      }, {
        key: "gety",
        value: function gety(t) {
          return this.int16[3 * t + 1];
        }
      }, {
        key: "gettileUnitDistanceFromAnchor",
        value: function gettileUnitDistanceFromAnchor(t) {
          return this.int16[3 * t + 2];
        }
      }]);

      return cs;
    }(Wn);

    ji("SymbolLineVertexArray", cs);

    var hs = /*#__PURE__*/function (_Bn4) {
      _inherits(hs, _Bn4);

      var _super37 = _createSuper(hs);

      function hs() {
        _classCallCheck(this, hs);

        return _super37.apply(this, arguments);
      }

      _createClass(hs, [{
        key: "featureIndex",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 0];
        }
      }, {
        key: "sourceLayerIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 2];
        }
      }, {
        key: "bucketIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 3];
        }
      }]);

      return hs;
    }(Bn);

    hs.prototype.size = 8;

    var ps = /*#__PURE__*/function (_Qn) {
      _inherits(ps, _Qn);

      var _super38 = _createSuper(ps);

      function ps() {
        _classCallCheck(this, ps);

        return _super38.apply(this, arguments);
      }

      _createClass(ps, [{
        key: "get",
        value: function get(t) {
          return new hs(this, t);
        }
      }]);

      return ps;
    }(Qn);

    ji("FeatureIndexArray", ps);
    var ds = Pn([{
      name: "a_pattern_from",
      components: 4,
      type: "Uint16"
    }, {
      name: "a_pattern_to",
      components: 4,
      type: "Uint16"
    }, {
      name: "a_pixel_ratio_from",
      components: 1,
      type: "Uint16"
    }, {
      name: "a_pixel_ratio_to",
      components: 1,
      type: "Uint16"
    }]);
    var fs = se(function (t) {
      t.exports = function (t, e) {
        var r, i, n, s, a, o, l, u;

        for (i = t.length - (r = 3 & t.length), n = e, a = 3432918353, o = 461845907, u = 0; u < i;) {
          l = 255 & t.charCodeAt(u) | (255 & t.charCodeAt(++u)) << 8 | (255 & t.charCodeAt(++u)) << 16 | (255 & t.charCodeAt(++u)) << 24, ++u, n = 27492 + (65535 & (s = 5 * (65535 & (n = (n ^= l = (65535 & (l = (l = (65535 & l) * a + (((l >>> 16) * a & 65535) << 16) & 4294967295) << 15 | l >>> 17)) * o + (((l >>> 16) * o & 65535) << 16) & 4294967295) << 13 | n >>> 19)) + ((5 * (n >>> 16) & 65535) << 16) & 4294967295)) + ((58964 + (s >>> 16) & 65535) << 16);
        }

        switch (l = 0, r) {
          case 3:
            l ^= (255 & t.charCodeAt(u + 2)) << 16;

          case 2:
            l ^= (255 & t.charCodeAt(u + 1)) << 8;

          case 1:
            n ^= l = (65535 & (l = (l = (65535 & (l ^= 255 & t.charCodeAt(u))) * a + (((l >>> 16) * a & 65535) << 16) & 4294967295) << 15 | l >>> 17)) * o + (((l >>> 16) * o & 65535) << 16) & 4294967295;
        }

        return n ^= t.length, n = 2246822507 * (65535 & (n ^= n >>> 16)) + ((2246822507 * (n >>> 16) & 65535) << 16) & 4294967295, n = 3266489909 * (65535 & (n ^= n >>> 13)) + ((3266489909 * (n >>> 16) & 65535) << 16) & 4294967295, (n ^= n >>> 16) >>> 0;
      };
    }),
        ys = se(function (t) {
      t.exports = function (t, e) {
        for (var r, i = t.length, n = e ^ i, s = 0; i >= 4;) {
          r = 1540483477 * (65535 & (r = 255 & t.charCodeAt(s) | (255 & t.charCodeAt(++s)) << 8 | (255 & t.charCodeAt(++s)) << 16 | (255 & t.charCodeAt(++s)) << 24)) + ((1540483477 * (r >>> 16) & 65535) << 16), n = 1540483477 * (65535 & n) + ((1540483477 * (n >>> 16) & 65535) << 16) ^ (r = 1540483477 * (65535 & (r ^= r >>> 24)) + ((1540483477 * (r >>> 16) & 65535) << 16)), i -= 4, ++s;
        }

        switch (i) {
          case 3:
            n ^= (255 & t.charCodeAt(s + 2)) << 16;

          case 2:
            n ^= (255 & t.charCodeAt(s + 1)) << 8;

          case 1:
            n = 1540483477 * (65535 & (n ^= 255 & t.charCodeAt(s))) + ((1540483477 * (n >>> 16) & 65535) << 16);
        }

        return n = 1540483477 * (65535 & (n ^= n >>> 13)) + ((1540483477 * (n >>> 16) & 65535) << 16), (n ^= n >>> 15) >>> 0;
      };
    }),
        ms = fs,
        gs = ys;
    ms.murmur3 = fs, ms.murmur2 = gs;

    var xs = /*#__PURE__*/function () {
      function xs() {
        _classCallCheck(this, xs);

        this.ids = [], this.positions = [], this.indexed = !1;
      }

      _createClass(xs, [{
        key: "add",
        value: function add(t, e, r, i) {
          this.ids.push(vs(t)), this.positions.push(e, r, i);
        }
      }, {
        key: "getPositions",
        value: function getPositions(t) {
          var e = vs(t);
          var r = 0,
              i = this.ids.length - 1;

          for (; r < i;) {
            var _t54 = r + i >> 1;

            this.ids[_t54] >= e ? i = _t54 : r = _t54 + 1;
          }

          var n = [];

          for (; this.ids[r] === e;) {
            n.push({
              index: this.positions[3 * r],
              start: this.positions[3 * r + 1],
              end: this.positions[3 * r + 2]
            }), r++;
          }

          return n;
        }
      }], [{
        key: "serialize",
        value: function serialize(t, e) {
          var r = new Float64Array(t.ids),
              i = new Uint32Array(t.positions);
          return function t(e, r, i, n) {
            for (; i < n;) {
              var _s24 = e[i + n >> 1];

              var _a25 = i - 1,
                  _o7 = n + 1;

              for (;;) {
                do {
                  _a25++;
                } while (e[_a25] < _s24);

                do {
                  _o7--;
                } while (e[_o7] > _s24);

                if (_a25 >= _o7) break;
                bs(e, _a25, _o7), bs(r, 3 * _a25, 3 * _o7), bs(r, 3 * _a25 + 1, 3 * _o7 + 1), bs(r, 3 * _a25 + 2, 3 * _o7 + 2);
              }

              _o7 - i < n - _o7 ? (t(e, r, i, _o7), i = _o7 + 1) : (t(e, r, _o7 + 1, n), n = _o7);
            }
          }(r, i, 0, r.length - 1), e && e.push(r.buffer, i.buffer), {
            ids: r,
            positions: i
          };
        }
      }, {
        key: "deserialize",
        value: function deserialize(t) {
          var e = new xs();
          return e.ids = t.ids, e.positions = t.positions, e.indexed = !0, e;
        }
      }]);

      return xs;
    }();

    function vs(t) {
      var e = +t;
      return !isNaN(e) && e <= o ? e : ms(String(t));
    }

    function bs(t, e, r) {
      var i = t[e];
      t[e] = t[r], t[r] = i;
    }

    ji("FeaturePositionMap", xs);

    var ws = function ws(t, e) {
      _classCallCheck(this, ws);

      this.gl = t.gl, this.location = e;
    };

    var _s = /*#__PURE__*/function (_ws) {
      _inherits(_s, _ws);

      var _super39 = _createSuper(_s);

      function _s(t, e) {
        var _this12;

        _classCallCheck(this, _s);

        _this12 = _super39.call(this, t, e), _this12.current = 0;
        return _this12;
      }

      _createClass(_s, [{
        key: "set",
        value: function set(t) {
          this.current !== t && (this.current = t, this.gl.uniform1f(this.location, t));
        }
      }]);

      return _s;
    }(ws);

    var As = /*#__PURE__*/function (_ws2) {
      _inherits(As, _ws2);

      var _super40 = _createSuper(As);

      function As(t, e) {
        var _this13;

        _classCallCheck(this, As);

        _this13 = _super40.call(this, t, e), _this13.current = [0, 0, 0, 0];
        return _this13;
      }

      _createClass(As, [{
        key: "set",
        value: function set(t) {
          t[0] === this.current[0] && t[1] === this.current[1] && t[2] === this.current[2] && t[3] === this.current[3] || (this.current = t, this.gl.uniform4f(this.location, t[0], t[1], t[2], t[3]));
        }
      }]);

      return As;
    }(ws);

    var ks = /*#__PURE__*/function (_ws3) {
      _inherits(ks, _ws3);

      var _super41 = _createSuper(ks);

      function ks(t, e) {
        var _this14;

        _classCallCheck(this, ks);

        _this14 = _super41.call(this, t, e), _this14.current = oe.transparent;
        return _this14;
      }

      _createClass(ks, [{
        key: "set",
        value: function set(t) {
          t.r === this.current.r && t.g === this.current.g && t.b === this.current.b && t.a === this.current.a || (this.current = t, this.gl.uniform4f(this.location, t.r, t.g, t.b, t.a));
        }
      }]);

      return ks;
    }(ws);

    var Ss = new Float32Array(16),
        Is = new Float32Array(9);

    function Ts(t) {
      return [Cn(255 * t.r, 255 * t.g), Cn(255 * t.b, 255 * t.a)];
    }

    var zs = /*#__PURE__*/function () {
      function zs(t, e, r) {
        _classCallCheck(this, zs);

        this.value = t, this.uniformNames = e.map(function (t) {
          return "u_".concat(t);
        }), this.type = r;
      }

      _createClass(zs, [{
        key: "setUniform",
        value: function setUniform(t, e, r) {
          t.set(r.constantOr(this.value));
        }
      }, {
        key: "getBinding",
        value: function getBinding(t, e, r) {
          return "color" === this.type ? new ks(t, e) : new _s(t, e);
        }
      }]);

      return zs;
    }();

    var Es = /*#__PURE__*/function () {
      function Es(t, e) {
        _classCallCheck(this, Es);

        this.uniformNames = e.map(function (t) {
          return "u_".concat(t);
        }), this.patternFrom = null, this.patternTo = null, this.pixelRatioFrom = 1, this.pixelRatioTo = 1;
      }

      _createClass(Es, [{
        key: "setConstantPatternPositions",
        value: function setConstantPatternPositions(t, e) {
          this.pixelRatioFrom = e.pixelRatio, this.pixelRatioTo = t.pixelRatio, this.patternFrom = e.tlbr, this.patternTo = t.tlbr;
        }
      }, {
        key: "setUniform",
        value: function setUniform(t, e, r, i) {
          var n = "u_pattern_to" === i ? this.patternTo : "u_pattern_from" === i ? this.patternFrom : "u_pixel_ratio_to" === i ? this.pixelRatioTo : "u_pixel_ratio_from" === i ? this.pixelRatioFrom : null;
          n && t.set(n);
        }
      }, {
        key: "getBinding",
        value: function getBinding(t, e, r) {
          return "u_pattern" === r.substr(0, 9) ? new As(t, e) : new _s(t, e);
        }
      }]);

      return Es;
    }();

    var Cs = /*#__PURE__*/function () {
      function Cs(t, e, r, i) {
        _classCallCheck(this, Cs);

        this.expression = t, this.type = r, this.maxValue = 0, this.paintVertexAttributes = e.map(function (t) {
          return {
            name: "a_".concat(t),
            type: "Float32",
            components: "color" === r ? 2 : 1,
            offset: 0
          };
        }), this.paintVertexArray = new i();
      }

      _createClass(Cs, [{
        key: "populatePaintArray",
        value: function populatePaintArray(t, e, r, i, n) {
          var s = this.paintVertexArray.length,
              a = this.expression.evaluate(new yn(0), e, {}, i, [], n);
          this.paintVertexArray.resize(t), this._setPaintValue(s, t, a);
        }
      }, {
        key: "updatePaintArray",
        value: function updatePaintArray(t, e, r, i) {
          var n = this.expression.evaluate({
            zoom: 0
          }, r, i);

          this._setPaintValue(t, e, n);
        }
      }, {
        key: "_setPaintValue",
        value: function _setPaintValue(t, e, r) {
          if ("color" === this.type) {
            var _i53 = Ts(r);

            for (var _r67 = t; _r67 < e; _r67++) {
              this.paintVertexArray.emplace(_r67, _i53[0], _i53[1]);
            }
          } else {
            for (var _i54 = t; _i54 < e; _i54++) {
              this.paintVertexArray.emplace(_i54, r);
            }

            this.maxValue = Math.max(this.maxValue, Math.abs(r));
          }
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.paintVertexArray && this.paintVertexArray.arrayBuffer && (this.paintVertexBuffer && this.paintVertexBuffer.buffer ? this.paintVertexBuffer.updateData(this.paintVertexArray) : this.paintVertexBuffer = t.createVertexBuffer(this.paintVertexArray, this.paintVertexAttributes, this.expression.isStateDependent));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.paintVertexBuffer && this.paintVertexBuffer.destroy();
        }
      }]);

      return Cs;
    }();

    var Ms = /*#__PURE__*/function () {
      function Ms(t, e, r, i, n, s) {
        _classCallCheck(this, Ms);

        this.expression = t, this.uniformNames = e.map(function (t) {
          return "u_".concat(t, "_t");
        }), this.type = r, this.useIntegerZoom = i, this.zoom = n, this.maxValue = 0, this.paintVertexAttributes = e.map(function (t) {
          return {
            name: "a_".concat(t),
            type: "Float32",
            components: "color" === r ? 4 : 2,
            offset: 0
          };
        }), this.paintVertexArray = new s();
      }

      _createClass(Ms, [{
        key: "populatePaintArray",
        value: function populatePaintArray(t, e, r, i, n) {
          var s = this.expression.evaluate(new yn(this.zoom), e, {}, i, [], n),
              a = this.expression.evaluate(new yn(this.zoom + 1), e, {}, i, [], n),
              o = this.paintVertexArray.length;
          this.paintVertexArray.resize(t), this._setPaintValue(o, t, s, a);
        }
      }, {
        key: "updatePaintArray",
        value: function updatePaintArray(t, e, r, i) {
          var n = this.expression.evaluate({
            zoom: this.zoom
          }, r, i),
              s = this.expression.evaluate({
            zoom: this.zoom + 1
          }, r, i);

          this._setPaintValue(t, e, n, s);
        }
      }, {
        key: "_setPaintValue",
        value: function _setPaintValue(t, e, r, i) {
          if ("color" === this.type) {
            var _n33 = Ts(r),
                _s25 = Ts(i);

            for (var _r68 = t; _r68 < e; _r68++) {
              this.paintVertexArray.emplace(_r68, _n33[0], _n33[1], _s25[0], _s25[1]);
            }
          } else {
            for (var _n34 = t; _n34 < e; _n34++) {
              this.paintVertexArray.emplace(_n34, r, i);
            }

            this.maxValue = Math.max(this.maxValue, Math.abs(r), Math.abs(i));
          }
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.paintVertexArray && this.paintVertexArray.arrayBuffer && (this.paintVertexBuffer && this.paintVertexBuffer.buffer ? this.paintVertexBuffer.updateData(this.paintVertexArray) : this.paintVertexBuffer = t.createVertexBuffer(this.paintVertexArray, this.paintVertexAttributes, this.expression.isStateDependent));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.paintVertexBuffer && this.paintVertexBuffer.destroy();
        }
      }, {
        key: "setUniform",
        value: function setUniform(t, e) {
          var r = this.useIntegerZoom ? Math.floor(e.zoom) : e.zoom,
              i = f(this.expression.interpolationFactor(r, this.zoom, this.zoom + 1), 0, 1);
          t.set(i);
        }
      }, {
        key: "getBinding",
        value: function getBinding(t, e, r) {
          return new _s(t, e);
        }
      }]);

      return Ms;
    }();

    var Bs = /*#__PURE__*/function () {
      function Bs(t, e, r, i, n, s) {
        _classCallCheck(this, Bs);

        this.expression = t, this.type = e, this.useIntegerZoom = r, this.zoom = i, this.layerId = s, this.zoomInPaintVertexArray = new n(), this.zoomOutPaintVertexArray = new n();
      }

      _createClass(Bs, [{
        key: "populatePaintArray",
        value: function populatePaintArray(t, e, r) {
          var i = this.zoomInPaintVertexArray.length;
          this.zoomInPaintVertexArray.resize(t), this.zoomOutPaintVertexArray.resize(t), this._setPaintValues(i, t, e.patterns && e.patterns[this.layerId], r);
        }
      }, {
        key: "updatePaintArray",
        value: function updatePaintArray(t, e, r, i, n) {
          this._setPaintValues(t, e, r.patterns && r.patterns[this.layerId], n);
        }
      }, {
        key: "_setPaintValues",
        value: function _setPaintValues(t, e, r, i) {
          if (!i || !r) return;
          var n = r.min,
              s = r.mid,
              a = r.max,
              o = i[n],
              l = i[s],
              u = i[a];
          if (o && l && u) for (var _r69 = t; _r69 < e; _r69++) {
            this.zoomInPaintVertexArray.emplace(_r69, l.tl[0], l.tl[1], l.br[0], l.br[1], o.tl[0], o.tl[1], o.br[0], o.br[1], l.pixelRatio, o.pixelRatio), this.zoomOutPaintVertexArray.emplace(_r69, l.tl[0], l.tl[1], l.br[0], l.br[1], u.tl[0], u.tl[1], u.br[0], u.br[1], l.pixelRatio, u.pixelRatio);
          }
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.zoomInPaintVertexArray && this.zoomInPaintVertexArray.arrayBuffer && this.zoomOutPaintVertexArray && this.zoomOutPaintVertexArray.arrayBuffer && (this.zoomInPaintVertexBuffer = t.createVertexBuffer(this.zoomInPaintVertexArray, ds.members, this.expression.isStateDependent), this.zoomOutPaintVertexBuffer = t.createVertexBuffer(this.zoomOutPaintVertexArray, ds.members, this.expression.isStateDependent));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.zoomOutPaintVertexBuffer && this.zoomOutPaintVertexBuffer.destroy(), this.zoomInPaintVertexBuffer && this.zoomInPaintVertexBuffer.destroy();
        }
      }]);

      return Bs;
    }();

    var Ds = /*#__PURE__*/function () {
      function Ds(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {
          return !0;
        };

        _classCallCheck(this, Ds);

        this.binders = {}, this._buffers = [];
        var i = [];

        for (var _n35 in t.paint._values) {
          if (!r(_n35)) continue;

          var _s26 = t.paint.get(_n35);

          if (!(_s26 instanceof _n && Ur(_s26.property.specification))) continue;

          var _a26 = Vs(_n35, t.type),
              _o8 = _s26.value,
              _l7 = _s26.property.specification.type,
              _u7 = _s26.property.useIntegerZoom,
              _c4 = _s26.property.specification["property-type"],
              _h2 = "cross-faded" === _c4 || "cross-faded-data-driven" === _c4;

          if ("constant" === _o8.kind) this.binders[_n35] = _h2 ? new Es(_o8.value, _a26) : new zs(_o8.value, _a26, _l7), i.push("/u_".concat(_n35));else if ("source" === _o8.kind || _h2) {
            var _r70 = Fs(_n35, _l7, "source");

            this.binders[_n35] = _h2 ? new Bs(_o8, _l7, _u7, e, _r70, t.id) : new Cs(_o8, _a26, _l7, _r70), i.push("/a_".concat(_n35));
          } else {
            var _t55 = Fs(_n35, _l7, "composite");

            this.binders[_n35] = new Ms(_o8, _a26, _l7, _u7, e, _t55), i.push("/z_".concat(_n35));
          }
        }

        this.cacheKey = i.sort().join("");
      }

      _createClass(Ds, [{
        key: "getMaxValue",
        value: function getMaxValue(t) {
          var e = this.binders[t];
          return e instanceof Cs || e instanceof Ms ? e.maxValue : 0;
        }
      }, {
        key: "populatePaintArrays",
        value: function populatePaintArrays(t, e, r, i, n) {
          for (var _s27 in this.binders) {
            var _a27 = this.binders[_s27];
            (_a27 instanceof Cs || _a27 instanceof Ms || _a27 instanceof Bs) && _a27.populatePaintArray(t, e, r, i, n);
          }
        }
      }, {
        key: "setConstantPatternPositions",
        value: function setConstantPatternPositions(t, e) {
          for (var _r71 in this.binders) {
            var _i55 = this.binders[_r71];
            _i55 instanceof Es && _i55.setConstantPatternPositions(t, e);
          }
        }
      }, {
        key: "updatePaintArrays",
        value: function updatePaintArrays(t, e, r, i, n) {
          var s = !1;

          for (var _a28 in t) {
            var _o9 = e.getPositions(_a28);

            var _iterator49 = _createForOfIteratorHelper(_o9),
                _step49;

            try {
              for (_iterator49.s(); !(_step49 = _iterator49.n()).done;) {
                var _e54 = _step49.value;

                var _o10 = r.feature(_e54.index);

                for (var _r72 in this.binders) {
                  var _l8 = this.binders[_r72];

                  if ((_l8 instanceof Cs || _l8 instanceof Ms || _l8 instanceof Bs) && !0 === _l8.expression.isStateDependent) {
                    var _u8 = i.paint.get(_r72);

                    _l8.expression = _u8.value, _l8.updatePaintArray(_e54.start, _e54.end, _o10, t[_a28], n), s = !0;
                  }
                }
              }
            } catch (err) {
              _iterator49.e(err);
            } finally {
              _iterator49.f();
            }
          }

          return s;
        }
      }, {
        key: "defines",
        value: function defines() {
          var t = [];

          for (var _e55 in this.binders) {
            var _r73 = this.binders[_e55];
            (_r73 instanceof zs || _r73 instanceof Es) && t.push.apply(t, _toConsumableArray(_r73.uniformNames.map(function (t) {
              return "#define HAS_UNIFORM_".concat(t);
            })));
          }

          return t;
        }
      }, {
        key: "getBinderAttributes",
        value: function getBinderAttributes() {
          var t = [];

          for (var _e56 in this.binders) {
            var _r74 = this.binders[_e56];
            if (_r74 instanceof Cs || _r74 instanceof Ms) for (var _e57 = 0; _e57 < _r74.paintVertexAttributes.length; _e57++) {
              t.push(_r74.paintVertexAttributes[_e57].name);
            } else if (_r74 instanceof Bs) for (var _e58 = 0; _e58 < ds.members.length; _e58++) {
              t.push(ds.members[_e58].name);
            }
          }

          return t;
        }
      }, {
        key: "getBinderUniforms",
        value: function getBinderUniforms() {
          var t = [];

          for (var _e59 in this.binders) {
            var _r75 = this.binders[_e59];

            if (_r75 instanceof zs || _r75 instanceof Es || _r75 instanceof Ms) {
              var _iterator50 = _createForOfIteratorHelper(_r75.uniformNames),
                  _step50;

              try {
                for (_iterator50.s(); !(_step50 = _iterator50.n()).done;) {
                  var _e60 = _step50.value;
                  t.push(_e60);
                }
              } catch (err) {
                _iterator50.e(err);
              } finally {
                _iterator50.f();
              }
            }
          }

          return t;
        }
      }, {
        key: "getPaintVertexBuffers",
        value: function getPaintVertexBuffers() {
          return this._buffers;
        }
      }, {
        key: "getUniforms",
        value: function getUniforms(t, e) {
          var r = [];

          for (var _i56 in this.binders) {
            var _n36 = this.binders[_i56];

            if (_n36 instanceof zs || _n36 instanceof Es || _n36 instanceof Ms) {
              var _iterator51 = _createForOfIteratorHelper(_n36.uniformNames),
                  _step51;

              try {
                for (_iterator51.s(); !(_step51 = _iterator51.n()).done;) {
                  var _s28 = _step51.value;

                  if (e[_s28]) {
                    var _a29 = _n36.getBinding(t, e[_s28], _s28);

                    r.push({
                      name: _s28,
                      property: _i56,
                      binding: _a29
                    });
                  }
                }
              } catch (err) {
                _iterator51.e(err);
              } finally {
                _iterator51.f();
              }
            }
          }

          return r;
        }
      }, {
        key: "setUniforms",
        value: function setUniforms(t, e, r, i) {
          var _iterator52 = _createForOfIteratorHelper(e),
              _step52;

          try {
            for (_iterator52.s(); !(_step52 = _iterator52.n()).done;) {
              var _ref137 = _step52.value;
              var _t56 = _ref137.name;
              var _n37 = _ref137.property;
              var _s29 = _ref137.binding;

              this.binders[_n37].setUniform(_s29, i, r.get(_n37), _t56);
            }
          } catch (err) {
            _iterator52.e(err);
          } finally {
            _iterator52.f();
          }
        }
      }, {
        key: "updatePaintBuffers",
        value: function updatePaintBuffers(t) {
          this._buffers = [];

          for (var _e61 in this.binders) {
            var _r76 = this.binders[_e61];

            if (t && _r76 instanceof Bs) {
              var _e62 = 2 === t.fromScale ? _r76.zoomInPaintVertexBuffer : _r76.zoomOutPaintVertexBuffer;

              _e62 && this._buffers.push(_e62);
            } else (_r76 instanceof Cs || _r76 instanceof Ms) && _r76.paintVertexBuffer && this._buffers.push(_r76.paintVertexBuffer);
          }
        }
      }, {
        key: "upload",
        value: function upload(t) {
          for (var _e63 in this.binders) {
            var _r77 = this.binders[_e63];
            (_r77 instanceof Cs || _r77 instanceof Ms || _r77 instanceof Bs) && _r77.upload(t);
          }

          this.updatePaintBuffers();
        }
      }, {
        key: "destroy",
        value: function destroy() {
          for (var _t57 in this.binders) {
            var _e64 = this.binders[_t57];
            (_e64 instanceof Cs || _e64 instanceof Ms || _e64 instanceof Bs) && _e64.destroy();
          }
        }
      }]);

      return Ds;
    }();

    var Ps = /*#__PURE__*/function () {
      function Ps(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {
          return !0;
        };

        _classCallCheck(this, Ps);

        this.programConfigurations = {};

        var _iterator53 = _createForOfIteratorHelper(t),
            _step53;

        try {
          for (_iterator53.s(); !(_step53 = _iterator53.n()).done;) {
            var _i57 = _step53.value;
            this.programConfigurations[_i57.id] = new Ds(_i57, e, r);
          }
        } catch (err) {
          _iterator53.e(err);
        } finally {
          _iterator53.f();
        }

        this.needsUpload = !1, this._featureMap = new xs(), this._bufferOffset = 0;
      }

      _createClass(Ps, [{
        key: "populatePaintArrays",
        value: function populatePaintArrays(t, e, r, i, n, s) {
          for (var _r78 in this.programConfigurations) {
            this.programConfigurations[_r78].populatePaintArrays(t, e, i, n, s);
          }

          void 0 !== e.id && this._featureMap.add(e.id, r, this._bufferOffset, t), this._bufferOffset = t, this.needsUpload = !0;
        }
      }, {
        key: "updatePaintArrays",
        value: function updatePaintArrays(t, e, r, i) {
          var _iterator54 = _createForOfIteratorHelper(r),
              _step54;

          try {
            for (_iterator54.s(); !(_step54 = _iterator54.n()).done;) {
              var _n38 = _step54.value;
              this.needsUpload = this.programConfigurations[_n38.id].updatePaintArrays(t, this._featureMap, e, _n38, i) || this.needsUpload;
            }
          } catch (err) {
            _iterator54.e(err);
          } finally {
            _iterator54.f();
          }
        }
      }, {
        key: "get",
        value: function get(t) {
          return this.programConfigurations[t];
        }
      }, {
        key: "upload",
        value: function upload(t) {
          if (this.needsUpload) {
            for (var _e65 in this.programConfigurations) {
              this.programConfigurations[_e65].upload(t);
            }

            this.needsUpload = !1;
          }
        }
      }, {
        key: "destroy",
        value: function destroy() {
          for (var _t58 in this.programConfigurations) {
            this.programConfigurations[_t58].destroy();
          }
        }
      }]);

      return Ps;
    }();

    function Vs(t, e) {
      return {
        "text-opacity": ["opacity"],
        "icon-opacity": ["opacity"],
        "text-color": ["fill_color"],
        "icon-color": ["fill_color"],
        "text-halo-color": ["halo_color"],
        "icon-halo-color": ["halo_color"],
        "text-halo-blur": ["halo_blur"],
        "icon-halo-blur": ["halo_blur"],
        "text-halo-width": ["halo_width"],
        "icon-halo-width": ["halo_width"],
        "line-gap-width": ["gapwidth"],
        "line-pattern": ["pattern_to", "pattern_from", "pixel_ratio_to", "pixel_ratio_from"],
        "fill-pattern": ["pattern_to", "pattern_from", "pixel_ratio_to", "pixel_ratio_from"],
        "fill-extrusion-pattern": ["pattern_to", "pattern_from", "pixel_ratio_to", "pixel_ratio_from"]
      }[t] || [t.replace("".concat(e, "-"), "").replace(/-/g, "_")];
    }

    function Fs(t, e, r) {
      var i = {
        color: {
          source: Un,
          composite: rs
        },
        number: {
          source: Yn,
          composite: Un
        }
      },
          n = function (t) {
        return {
          "line-pattern": {
            source: On,
            composite: On
          },
          "fill-pattern": {
            source: On,
            composite: On
          },
          "fill-extrusion-pattern": {
            source: On,
            composite: On
          }
        }[t];
      }(t);

      return n && n[r] || i[e][r];
    }

    ji("ConstantBinder", zs), ji("CrossFadedConstantBinder", Es), ji("SourceExpressionBinder", Cs), ji("CrossFadedCompositeBinder", Bs), ji("CompositeExpressionBinder", Ms), ji("ProgramConfiguration", Ds, {
      omit: ["_buffers"]
    }), ji("ProgramConfigurationSet", Ps);

    var Rs = /*#__PURE__*/function (_Pt) {
      _inherits(Rs, _Pt);

      var _super42 = _createSuper(Rs);

      function Rs(t, e) {
        var _this15;

        _classCallCheck(this, Rs);

        if (_this15 = _super42.call(this), _this15.id = t.id, _this15.type = t.type, _this15._featureFilter = {
          filter: function filter() {
            return !0;
          },
          needGeometry: !1
        }, "custom" !== t.type && (_this15.metadata = (t = t).metadata, _this15.minzoom = t.minzoom, _this15.maxzoom = t.maxzoom, "background" !== t.type && "sky" !== t.type && (_this15.source = t.source, _this15.sourceLayer = t["source-layer"], _this15.filter = t.filter), e.layout && (_this15._unevaluatedLayout = new wn(e.layout)), e.paint)) {
          _this15._transitionablePaint = new xn(e.paint);

          for (var _e66 in t.paint) {
            _this15.setPaintProperty(_e66, t.paint[_e66], {
              validate: !1
            });
          }

          for (var _e67 in t.layout) {
            _this15.setLayoutProperty(_e67, t.layout[_e67], {
              validate: !1
            });
          }

          _this15._transitioningPaint = _this15._transitionablePaint.untransitioned(), _this15.paint = new An(e.paint);
        }

        return _possibleConstructorReturn(_this15);
      }

      _createClass(Rs, [{
        key: "getCrossfadeParameters",
        value: function getCrossfadeParameters() {
          return this._crossfadeParameters;
        }
      }, {
        key: "getLayoutProperty",
        value: function getLayoutProperty(t) {
          return "visibility" === t ? this.visibility : this._unevaluatedLayout.getValue(t);
        }
      }, {
        key: "setLayoutProperty",
        value: function setLayoutProperty(t, e) {
          var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          null != e && this._validate(Ri, "layers.".concat(this.id, ".layout.").concat(t), t, e, r) || ("visibility" !== t ? this._unevaluatedLayout.setValue(t, e) : this.visibility = e);
        }
      }, {
        key: "getPaintProperty",
        value: function getPaintProperty(t) {
          return A(t, "-transition") ? this._transitionablePaint.getTransition(t.slice(0, -"-transition".length)) : this._transitionablePaint.getValue(t);
        }
      }, {
        key: "setPaintProperty",
        value: function setPaintProperty(t, e) {
          var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          if (null != e && this._validate(Fi, "layers.".concat(this.id, ".paint.").concat(t), t, e, r)) return !1;
          if (A(t, "-transition")) return this._transitionablePaint.setTransition(t.slice(0, -"-transition".length), e || void 0), !1;
          {
            var _r79 = this._transitionablePaint._values[t],
                _i58 = "cross-faded-data-driven" === _r79.property.specification["property-type"],
                _n39 = _r79.value.isDataDriven(),
                _s30 = _r79.value;

            this._transitionablePaint.setValue(t, e), this._handleSpecialPaintPropertyUpdate(t);
            var _a30 = this._transitionablePaint._values[t].value;
            return _a30.isDataDriven() || _n39 || _i58 || this._handleOverridablePaintPropertyUpdate(t, _s30, _a30);
          }
        }
      }, {
        key: "_handleSpecialPaintPropertyUpdate",
        value: function _handleSpecialPaintPropertyUpdate(t) {}
      }, {
        key: "getProgramIds",
        value: function getProgramIds() {
          return null;
        }
      }, {
        key: "getProgramConfiguration",
        value: function getProgramConfiguration(t) {
          return null;
        }
      }, {
        key: "_handleOverridablePaintPropertyUpdate",
        value: function _handleOverridablePaintPropertyUpdate(t, e, r) {
          return !1;
        }
      }, {
        key: "isHidden",
        value: function isHidden(t) {
          return !!(this.minzoom && t < this.minzoom) || !!(this.maxzoom && t >= this.maxzoom) || "none" === this.visibility;
        }
      }, {
        key: "updateTransitions",
        value: function updateTransitions(t) {
          this._transitioningPaint = this._transitionablePaint.transitioned(t, this._transitioningPaint);
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return this._transitioningPaint.hasTransition();
        }
      }, {
        key: "recalculate",
        value: function recalculate(t, e) {
          t.getCrossfadeParameters && (this._crossfadeParameters = t.getCrossfadeParameters()), this._unevaluatedLayout && (this.layout = this._unevaluatedLayout.possiblyEvaluate(t, void 0, e)), this.paint = this._transitioningPaint.possiblyEvaluate(t, void 0, e);
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {
            id: this.id,
            type: this.type,
            source: this.source,
            "source-layer": this.sourceLayer,
            metadata: this.metadata,
            minzoom: this.minzoom,
            maxzoom: this.maxzoom,
            filter: this.filter,
            layout: this._unevaluatedLayout && this._unevaluatedLayout.serialize(),
            paint: this._transitionablePaint && this._transitionablePaint.serialize()
          };
          return this.visibility && (t.layout = t.layout || {}, t.layout.visibility = this.visibility), S(t, function (t, e) {
            return !(void 0 === t || "layout" === e && !Object.keys(t).length || "paint" === e && !Object.keys(t).length);
          });
        }
      }, {
        key: "_validate",
        value: function _validate(t, e, r, i) {
          var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};
          return (!n || !1 !== n.validate) && Li(this, t.call(Pi, {
            key: e,
            layerType: this.type,
            objectKey: r,
            value: i,
            styleSpec: Vt,
            style: {
              glyphs: !0,
              sprite: !0
            }
          }));
        }
      }, {
        key: "is3D",
        value: function is3D() {
          return !1;
        }
      }, {
        key: "isSky",
        value: function isSky() {
          return !1;
        }
      }, {
        key: "isTileClipped",
        value: function isTileClipped() {
          return !1;
        }
      }, {
        key: "hasOffscreenPass",
        value: function hasOffscreenPass() {
          return !1;
        }
      }, {
        key: "resize",
        value: function resize() {}
      }, {
        key: "isStateDependent",
        value: function isStateDependent() {
          for (var _t59 in this.paint._values) {
            var _e68 = this.paint.get(_t59);

            if (_e68 instanceof _n && Ur(_e68.property.specification) && ("source" === _e68.value.kind || "composite" === _e68.value.kind) && _e68.value.isStateDependent) return !0;
          }

          return !1;
        }
      }]);

      return Rs;
    }(Pt);

    var Ls = Pn([{
      name: "a_pos",
      components: 2,
      type: "Int16"
    }], 4),
        Us = Ls.members;

    var Os = /*#__PURE__*/function () {
      function Os() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

        _classCallCheck(this, Os);

        this.segments = t;
      }

      _createClass(Os, [{
        key: "prepareSegment",
        value: function prepareSegment(t, e, r, i) {
          var n = this.segments[this.segments.length - 1];
          return t > Os.MAX_VERTEX_ARRAY_LENGTH && z("Max vertices per segment is ".concat(Os.MAX_VERTEX_ARRAY_LENGTH, ": bucket requested ").concat(t)), (!n || n.vertexLength + t > Os.MAX_VERTEX_ARRAY_LENGTH || n.sortKey !== i) && (n = {
            vertexOffset: e.length,
            primitiveOffset: r.length,
            vertexLength: 0,
            primitiveLength: 0
          }, void 0 !== i && (n.sortKey = i), this.segments.push(n)), n;
        }
      }, {
        key: "get",
        value: function get() {
          return this.segments;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          var _iterator55 = _createForOfIteratorHelper(this.segments),
              _step55;

          try {
            for (_iterator55.s(); !(_step55 = _iterator55.n()).done;) {
              var _t60 = _step55.value;

              for (var _e69 in _t60.vaos) {
                _t60.vaos[_e69].destroy();
              }
            }
          } catch (err) {
            _iterator55.e(err);
          } finally {
            _iterator55.f();
          }
        }
      }], [{
        key: "simpleSegment",
        value: function simpleSegment(t, e, r, i) {
          return new Os([{
            vertexOffset: t,
            primitiveOffset: e,
            vertexLength: r,
            primitiveLength: i,
            vaos: {},
            sortKey: 0
          }]);
        }
      }]);

      return Os;
    }();

    Os.MAX_VERTEX_ARRAY_LENGTH = Math.pow(2, 16) - 1, ji("SegmentVector", Os);
    var $s = Math.pow(2, 14) - 1,
        qs = -$s - 1;

    function Ns(t) {
      var e = 8192 / t.extent,
          r = t.loadGeometry();

      for (var _t61 = 0; _t61 < r.length; _t61++) {
        var _i59 = r[_t61];

        for (var _t62 = 0; _t62 < _i59.length; _t62++) {
          var _r80 = _i59[_t62],
              _n40 = Math.round(_r80.x * e),
              _s31 = Math.round(_r80.y * e);

          _r80.x = f(_n40, qs, $s), _r80.y = f(_s31, qs, $s), (_n40 < _r80.x || _n40 > _r80.x + 1 || _s31 < _r80.y || _s31 > _r80.y + 1) && z("Geometry exceeds allowed extent, reduce your vector tile buffer size");
        }
      }

      return r;
    }

    function js(t, e) {
      return {
        type: t.type,
        id: t.id,
        properties: t.properties,
        geometry: e ? Ns(t) : []
      };
    }

    function Ks(t, e, r, i, n) {
      t.emplaceBack(2 * e + (i + 1) / 2, 2 * r + (n + 1) / 2);
    }

    var Zs = /*#__PURE__*/function () {
      function Zs(t) {
        _classCallCheck(this, Zs);

        this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.hasPattern = !1, this.layoutVertexArray = new Fn(), this.indexArray = new Gn(), this.segments = new Os(), this.programConfigurations = new Ps(t.layers, t.zoom), this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        });
      }

      _createClass(Zs, [{
        key: "populate",
        value: function populate(t, e, r) {
          var i = this.layers[0],
              n = [];
          var s = null;
          "circle" === i.type && (s = i.layout.get("circle-sort-key"));

          var _iterator56 = _createForOfIteratorHelper(t),
              _step56;

          try {
            for (_iterator56.s(); !(_step56 = _iterator56.n()).done;) {
              var _ref139 = _step56.value;
              var _e70 = _ref139.feature;
              var _i62 = _ref139.id;
              var _a32 = _ref139.index;
              var _o12 = _ref139.sourceLayerIndex;

              var _t63 = this.layers[0]._featureFilter.needGeometry,
                  _l9 = js(_e70, _t63);

              if (!this.layers[0]._featureFilter.filter(new yn(this.zoom), _l9, r)) continue;

              var _u9 = s ? s.evaluate(_l9, {}, r) : void 0,
                  _c5 = {
                id: _i62,
                properties: _e70.properties,
                type: _e70.type,
                sourceLayerIndex: _o12,
                index: _a32,
                geometry: _t63 ? _l9.geometry : Ns(_e70),
                patterns: {},
                sortKey: _u9
              };

              n.push(_c5);
            }
          } catch (err) {
            _iterator56.e(err);
          } finally {
            _iterator56.f();
          }

          s && n.sort(function (t, e) {
            return t.sortKey - e.sortKey;
          });

          for (var _i60 = 0, _n41 = n; _i60 < _n41.length; _i60++) {
            var _i61 = _n41[_i60];
            var _n42 = _i61.geometry,
                _s32 = _i61.index,
                _a31 = _i61.sourceLayerIndex,
                _o11 = t[_s32].feature;
            this.addFeature(_i61, _n42, _s32, r), e.featureIndex.insert(_o11, _n42, _s32, _a31, this.index);
          }
        }
      }, {
        key: "update",
        value: function update(t, e, r) {
          this.stateDependentLayers.length && this.programConfigurations.updatePaintArrays(t, e, this.stateDependentLayers, r);
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.uploaded || (this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, Us), this.indexBuffer = t.createIndexBuffer(this.indexArray)), this.programConfigurations.upload(t), this.uploaded = !0;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.programConfigurations.destroy(), this.segments.destroy());
        }
      }, {
        key: "addFeature",
        value: function addFeature(t, e, r, i) {
          var _iterator57 = _createForOfIteratorHelper(e),
              _step57;

          try {
            for (_iterator57.s(); !(_step57 = _iterator57.n()).done;) {
              var _r81 = _step57.value;

              var _iterator58 = _createForOfIteratorHelper(_r81),
                  _step58;

              try {
                for (_iterator58.s(); !(_step58 = _iterator58.n()).done;) {
                  var _e71 = _step58.value;
                  var _r82 = _e71.x,
                      _i63 = _e71.y;
                  if (_r82 < 0 || _r82 >= 8192 || _i63 < 0 || _i63 >= 8192) continue;

                  var _n43 = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray, t.sortKey),
                      _s33 = _n43.vertexLength;

                  Ks(this.layoutVertexArray, _r82, _i63, -1, -1), Ks(this.layoutVertexArray, _r82, _i63, 1, -1), Ks(this.layoutVertexArray, _r82, _i63, 1, 1), Ks(this.layoutVertexArray, _r82, _i63, -1, 1), this.indexArray.emplaceBack(_s33, _s33 + 1, _s33 + 2), this.indexArray.emplaceBack(_s33, _s33 + 3, _s33 + 2), _n43.vertexLength += 4, _n43.primitiveLength += 2;
                }
              } catch (err) {
                _iterator58.e(err);
              } finally {
                _iterator58.f();
              }
            }
          } catch (err) {
            _iterator57.e(err);
          } finally {
            _iterator57.f();
          }

          this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, t, r, {}, i);
        }
      }]);

      return Zs;
    }();

    function Xs(t, e) {
      for (var _r83 = 0; _r83 < t.length; _r83++) {
        if (ra(e, t[_r83])) return !0;
      }

      for (var _r84 = 0; _r84 < e.length; _r84++) {
        if (ra(t, e[_r84])) return !0;
      }

      return !!Ys(t, e);
    }

    function Gs(t, e, r) {
      return !!ra(t, e) || !!Qs(e, t, r);
    }

    function Hs(t, e) {
      if (1 === t.length) return ea(e, t[0]);

      for (var _r85 = 0; _r85 < e.length; _r85++) {
        var _i64 = e[_r85];

        for (var _e72 = 0; _e72 < _i64.length; _e72++) {
          if (ra(t, _i64[_e72])) return !0;
        }
      }

      for (var _r86 = 0; _r86 < t.length; _r86++) {
        if (ea(e, t[_r86])) return !0;
      }

      for (var _r87 = 0; _r87 < e.length; _r87++) {
        if (Ys(t, e[_r87])) return !0;
      }

      return !1;
    }

    function Js(t, e, r) {
      if (t.length > 1) {
        if (Ys(t, e)) return !0;

        for (var _i65 = 0; _i65 < e.length; _i65++) {
          if (Qs(e[_i65], t, r)) return !0;
        }
      }

      for (var _i66 = 0; _i66 < t.length; _i66++) {
        if (Qs(t[_i66], e, r)) return !0;
      }

      return !1;
    }

    function Ys(t, e) {
      if (0 === t.length || 0 === e.length) return !1;

      for (var _r88 = 0; _r88 < t.length - 1; _r88++) {
        var _i67 = t[_r88],
            _n44 = t[_r88 + 1];

        for (var _t64 = 0; _t64 < e.length - 1; _t64++) {
          if (Ws(_i67, _n44, e[_t64], e[_t64 + 1])) return !0;
        }
      }

      return !1;
    }

    function Ws(t, e, r, i) {
      return E(t, r, i) !== E(e, r, i) && E(t, e, r) !== E(t, e, i);
    }

    function Qs(t, e, r) {
      var i = r * r;
      if (1 === e.length) return t.distSqr(e[0]) < i;

      for (var _r89 = 1; _r89 < e.length; _r89++) {
        if (ta(t, e[_r89 - 1], e[_r89]) < i) return !0;
      }

      return !1;
    }

    function ta(t, e, r) {
      var i = e.distSqr(r);
      if (0 === i) return t.distSqr(e);
      var n = ((t.x - e.x) * (r.x - e.x) + (t.y - e.y) * (r.y - e.y)) / i;
      return t.distSqr(n < 0 ? e : n > 1 ? r : r.sub(e)._mult(n)._add(e));
    }

    function ea(t, e) {
      var r,
          i,
          n,
          s = !1;

      for (var _a33 = 0; _a33 < t.length; _a33++) {
        r = t[_a33];

        for (var _t65 = 0, _a34 = r.length - 1; _t65 < r.length; _a34 = _t65++) {
          i = r[_t65], n = r[_a34], i.y > e.y != n.y > e.y && e.x < (n.x - i.x) * (e.y - i.y) / (n.y - i.y) + i.x && (s = !s);
        }
      }

      return s;
    }

    function ra(t, e) {
      var r = !1;

      for (var _i68 = 0, _n45 = t.length - 1; _i68 < t.length; _n45 = _i68++) {
        var _s34 = t[_i68],
            _a35 = t[_n45];
        _s34.y > e.y != _a35.y > e.y && e.x < (_a35.x - _s34.x) * (e.y - _s34.y) / (_a35.y - _s34.y) + _s34.x && (r = !r);
      }

      return r;
    }

    function ia(t, e, r, n, s) {
      var _iterator59 = _createForOfIteratorHelper(t),
          _step59;

      try {
        for (_iterator59.s(); !(_step59 = _iterator59.n()).done;) {
          var _i69 = _step59.value;
          if (e <= _i69.x && r <= _i69.y && n >= _i69.x && s >= _i69.y) return !0;
        }
      } catch (err) {
        _iterator59.e(err);
      } finally {
        _iterator59.f();
      }

      var a = [new i(e, r), new i(e, s), new i(n, s), new i(n, r)];

      if (t.length > 2) {
        var _iterator60 = _createForOfIteratorHelper(a),
            _step60;

        try {
          for (_iterator60.s(); !(_step60 = _iterator60.n()).done;) {
            var _e73 = _step60.value;
            if (ra(t, _e73)) return !0;
          }
        } catch (err) {
          _iterator60.e(err);
        } finally {
          _iterator60.f();
        }
      }

      for (var _e74 = 0; _e74 < t.length - 1; _e74++) {
        if (na(t[_e74], t[_e74 + 1], a)) return !0;
      }

      return !1;
    }

    function na(t, e, r) {
      var i = r[0],
          n = r[2];
      if (t.x < i.x && e.x < i.x || t.x > n.x && e.x > n.x || t.y < i.y && e.y < i.y || t.y > n.y && e.y > n.y) return !1;
      var s = E(t, e, r[0]);
      return s !== E(t, e, r[1]) || s !== E(t, e, r[2]) || s !== E(t, e, r[3]);
    }

    function sa(t, e, r) {
      var i = e.paint.get(t).value;
      return "constant" === i.kind ? i.value : r.programConfigurations.get(e.id).getMaxValue(t);
    }

    function aa(t) {
      return Math.sqrt(t[0] * t[0] + t[1] * t[1]);
    }

    function oa(t, e, r, n, s) {
      if (!e[0] && !e[1]) return t;

      var a = i.convert(e)._mult(s);

      "viewport" === r && a._rotate(-n);
      var o = [];

      for (var _e75 = 0; _e75 < t.length; _e75++) {
        o.push(t[_e75].sub(a));
      }

      return o;
    }

    function la(t, e, r, n) {
      var s = i.convert(t)._mult(n);

      return "viewport" === e && s._rotate(-r), s;
    }

    ji("CircleBucket", Zs, {
      omit: ["layers"]
    });
    var ua = new En({
      "circle-sort-key": new Sn(Vt.layout_circle["circle-sort-key"])
    });
    var ca = {
      paint: new En({
        "circle-radius": new Sn(Vt.paint_circle["circle-radius"]),
        "circle-color": new Sn(Vt.paint_circle["circle-color"]),
        "circle-blur": new Sn(Vt.paint_circle["circle-blur"]),
        "circle-opacity": new Sn(Vt.paint_circle["circle-opacity"]),
        "circle-translate": new kn(Vt.paint_circle["circle-translate"]),
        "circle-translate-anchor": new kn(Vt.paint_circle["circle-translate-anchor"]),
        "circle-pitch-scale": new kn(Vt.paint_circle["circle-pitch-scale"]),
        "circle-pitch-alignment": new kn(Vt.paint_circle["circle-pitch-alignment"]),
        "circle-stroke-width": new Sn(Vt.paint_circle["circle-stroke-width"]),
        "circle-stroke-color": new Sn(Vt.paint_circle["circle-stroke-color"]),
        "circle-stroke-opacity": new Sn(Vt.paint_circle["circle-stroke-opacity"])
      }),
      layout: ua
    },
        ha = "undefined" != typeof Float32Array ? Float32Array : Array;

    function pa() {
      var t = new ha(9);
      return ha != Float32Array && (t[1] = 0, t[2] = 0, t[3] = 0, t[5] = 0, t[6] = 0, t[7] = 0), t[0] = 1, t[4] = 1, t[8] = 1, t;
    }

    function da(t) {
      return t[0] = 1, t[1] = 0, t[2] = 0, t[3] = 0, t[4] = 0, t[5] = 1, t[6] = 0, t[7] = 0, t[8] = 0, t[9] = 0, t[10] = 1, t[11] = 0, t[12] = 0, t[13] = 0, t[14] = 0, t[15] = 1, t;
    }

    function fa(t, e, r) {
      var i = e[0],
          n = e[1],
          s = e[2],
          a = e[3],
          o = e[4],
          l = e[5],
          u = e[6],
          c = e[7],
          h = e[8],
          p = e[9],
          d = e[10],
          f = e[11],
          y = e[12],
          m = e[13],
          g = e[14],
          x = e[15],
          v = r[0],
          b = r[1],
          w = r[2],
          _ = r[3];
      return t[0] = v * i + b * o + w * h + _ * y, t[1] = v * n + b * l + w * p + _ * m, t[2] = v * s + b * u + w * d + _ * g, t[3] = v * a + b * c + w * f + _ * x, t[4] = (v = r[4]) * i + (b = r[5]) * o + (w = r[6]) * h + (_ = r[7]) * y, t[5] = v * n + b * l + w * p + _ * m, t[6] = v * s + b * u + w * d + _ * g, t[7] = v * a + b * c + w * f + _ * x, t[8] = (v = r[8]) * i + (b = r[9]) * o + (w = r[10]) * h + (_ = r[11]) * y, t[9] = v * n + b * l + w * p + _ * m, t[10] = v * s + b * u + w * d + _ * g, t[11] = v * a + b * c + w * f + _ * x, t[12] = (v = r[12]) * i + (b = r[13]) * o + (w = r[14]) * h + (_ = r[15]) * y, t[13] = v * n + b * l + w * p + _ * m, t[14] = v * s + b * u + w * d + _ * g, t[15] = v * a + b * c + w * f + _ * x, t;
    }

    Math.hypot || (Math.hypot = function () {
      for (var t = 0, e = arguments.length; e--;) {
        t += arguments[e] * arguments[e];
      }

      return Math.sqrt(t);
    });
    var ya = fa;

    function ma() {
      var t = new ha(3);
      return ha != Float32Array && (t[0] = 0, t[1] = 0, t[2] = 0), t;
    }

    function ga(t) {
      var e = new ha(3);
      return e[0] = t[0], e[1] = t[1], e[2] = t[2], e;
    }

    function xa(t) {
      return Math.hypot(t[0], t[1], t[2]);
    }

    function va(t, e, r) {
      var i = new ha(3);
      return i[0] = t, i[1] = e, i[2] = r, i;
    }

    function ba(t, e, r) {
      return t[0] = e[0] + r[0], t[1] = e[1] + r[1], t[2] = e[2] + r[2], t;
    }

    function wa(t, e, r) {
      return t[0] = e[0] - r[0], t[1] = e[1] - r[1], t[2] = e[2] - r[2], t;
    }

    function _a(t, e, r) {
      return t[0] = e[0] * r, t[1] = e[1] * r, t[2] = e[2] * r, t;
    }

    function Aa(t, e, r, i) {
      return t[0] = e[0] + r[0] * i, t[1] = e[1] + r[1] * i, t[2] = e[2] + r[2] * i, t;
    }

    function ka(t, e) {
      var r = e[0],
          i = e[1],
          n = e[2],
          s = r * r + i * i + n * n;
      return s > 0 && (s = 1 / Math.sqrt(s)), t[0] = e[0] * s, t[1] = e[1] * s, t[2] = e[2] * s, t;
    }

    function Sa(t, e) {
      return t[0] * e[0] + t[1] * e[1] + t[2] * e[2];
    }

    function Ia(t, e, r) {
      var i = e[0],
          n = e[1],
          s = e[2],
          a = r[0],
          o = r[1],
          l = r[2];
      return t[0] = n * l - s * o, t[1] = s * a - i * l, t[2] = i * o - n * a, t;
    }

    function Ta(t, e, r) {
      var i = r[0],
          n = r[1],
          s = r[2],
          a = e[0],
          o = e[1],
          l = e[2],
          u = n * l - s * o,
          c = s * a - i * l,
          h = i * o - n * a,
          p = n * h - s * c,
          d = s * u - i * h,
          f = i * c - n * u,
          y = 2 * r[3];
      return c *= y, h *= y, d *= 2, f *= 2, t[0] = a + (u *= y) + (p *= 2), t[1] = o + c + d, t[2] = l + h + f, t;
    }

    var za,
        Ea = wa,
        Ca = xa;

    function Ma(t, e, r) {
      var i = e[0],
          n = e[1],
          s = e[2],
          a = e[3];
      return t[0] = r[0] * i + r[4] * n + r[8] * s + r[12] * a, t[1] = r[1] * i + r[5] * n + r[9] * s + r[13] * a, t[2] = r[2] * i + r[6] * n + r[10] * s + r[14] * a, t[3] = r[3] * i + r[7] * n + r[11] * s + r[15] * a, t;
    }

    function Ba() {
      var t = new ha(4);
      return ha != Float32Array && (t[0] = 0, t[1] = 0, t[2] = 0), t[3] = 1, t;
    }

    function Da(t) {
      return t[0] = 0, t[1] = 0, t[2] = 0, t[3] = 1, t;
    }

    function Pa(t, e, r) {
      r *= .5;
      var i = e[0],
          n = e[1],
          s = e[2],
          a = e[3],
          o = Math.sin(r),
          l = Math.cos(r);
      return t[0] = i * l + a * o, t[1] = n * l + s * o, t[2] = s * l - n * o, t[3] = a * l - i * o, t;
    }

    ma(), za = new ha(4), ha != Float32Array && (za[0] = 0, za[1] = 0, za[2] = 0, za[3] = 0), ma(), va(1, 0, 0), va(0, 1, 0), Ba(), Ba(), pa();

    var Va = /*#__PURE__*/function () {
      function Va(t, e) {
        _classCallCheck(this, Va);

        this.points = t, this.planes = e;
      }

      _createClass(Va, null, [{
        key: "fromInvProjectionMatrix",
        value: function fromInvProjectionMatrix(t, e, r) {
          var i = Math.pow(2, r),
              n = [[-1, 1, -1, 1], [1, 1, -1, 1], [1, -1, -1, 1], [-1, -1, -1, 1], [-1, 1, 1, 1], [1, 1, 1, 1], [1, -1, 1, 1], [-1, -1, 1, 1]].map(function (r) {
            var n = Ma([], r, t),
                s = 1 / n[3] / e * i;
            return function (t, e, r) {
              return t[0] = e[0] * r[0], t[1] = e[1] * r[1], t[2] = e[2] * r[2], t[3] = e[3] * r[3], t;
            }(n, n, [s, s, 1 / n[3], s]);
          }),
              s = [[0, 1, 2], [6, 5, 4], [0, 3, 7], [2, 1, 5], [3, 2, 6], [0, 4, 5]].map(function (t) {
            var e = ka([], Ia([], Ea([], n[t[0]], n[t[1]]), Ea([], n[t[2]], n[t[1]]))),
                r = -Sa(e, n[t[1]]);
            return e.concat(r);
          });
          return new Va(n, s);
        }
      }]);

      return Va;
    }();

    var Fa = /*#__PURE__*/function () {
      function Fa(t, e) {
        _classCallCheck(this, Fa);

        this.min = t, this.max = e, this.center = _a([], ba([], this.min, this.max), .5);
      }

      _createClass(Fa, [{
        key: "quadrant",
        value: function quadrant(t) {
          var e = [t % 2 == 0, t < 2],
              r = ga(this.min),
              i = ga(this.max);

          for (var _t66 = 0; _t66 < e.length; _t66++) {
            r[_t66] = e[_t66] ? this.min[_t66] : this.center[_t66], i[_t66] = e[_t66] ? this.center[_t66] : this.max[_t66];
          }

          return i[2] = this.max[2], new Fa(r, i);
        }
      }, {
        key: "distanceX",
        value: function distanceX(t) {
          return Math.max(Math.min(this.max[0], t[0]), this.min[0]) - t[0];
        }
      }, {
        key: "distanceY",
        value: function distanceY(t) {
          return Math.max(Math.min(this.max[1], t[1]), this.min[1]) - t[1];
        }
      }, {
        key: "distanceZ",
        value: function distanceZ(t) {
          return Math.max(Math.min(this.max[2], t[2]), this.min[2]) - t[2];
        }
      }, {
        key: "intersects",
        value: function intersects(t) {
          var e = [[this.min[0], this.min[1], this.min[2], 1], [this.max[0], this.min[1], this.min[2], 1], [this.max[0], this.max[1], this.min[2], 1], [this.min[0], this.max[1], this.min[2], 1], [this.min[0], this.min[1], this.max[2], 1], [this.max[0], this.min[1], this.max[2], 1], [this.max[0], this.max[1], this.max[2], 1], [this.min[0], this.max[1], this.max[2], 1]];
          var r = !0;

          for (var _s35 = 0; _s35 < t.planes.length; _s35++) {
            var _a36 = t.planes[_s35];
            var _o13 = 0;

            for (var _t67 = 0; _t67 < e.length; _t67++) {
              _o13 += (i = _a36)[0] * (n = e[_t67])[0] + i[1] * n[1] + i[2] * n[2] + i[3] * n[3] >= 0;
            }

            if (0 === _o13) return 0;
            _o13 !== e.length && (r = !1);
          }

          var i, n;
          if (r) return 2;

          for (var _e76 = 0; _e76 < 3; _e76++) {
            var _r90 = Number.MAX_VALUE,
                _i70 = -Number.MAX_VALUE;

            for (var _n46 = 0; _n46 < t.points.length; _n46++) {
              var _s36 = t.points[_n46][_e76] - this.min[_e76];

              _r90 = Math.min(_r90, _s36), _i70 = Math.max(_i70, _s36);
            }

            if (_i70 < 0 || _r90 > this.max[_e76] - this.min[_e76]) return 0;
          }

          return 1;
        }
      }]);

      return Fa;
    }();

    function Ra(t, e, r) {
      var n = Ma([], [t.x, t.y, e, 1], r);
      return new i(n[0] / n[3], n[1] / n[3]);
    }

    var La = va(0, 0, 0),
        Ua = va(0, 0, 1);

    function Oa(t, e) {
      var r = ma();
      return La[2] = e, t.intersectsPlane(La, Ua, r), new i(r[0], r[1]);
    }

    var $a = /*#__PURE__*/function (_Zs) {
      _inherits($a, _Zs);

      var _super43 = _createSuper($a);

      function $a() {
        _classCallCheck(this, $a);

        return _super43.apply(this, arguments);
      }

      return $a;
    }(Zs);

    function qa(t, _ref140, i, n) {
      var e = _ref140.width,
          r = _ref140.height;

      if (n) {
        if (n instanceof Uint8ClampedArray) n = new Uint8Array(n.buffer);else if (n.length !== e * r * i) throw new RangeError("mismatched image size");
      } else n = new Uint8Array(e * r * i);

      return t.width = e, t.height = r, t.data = n, t;
    }

    function Na(t, _ref141, i) {
      var e = _ref141.width,
          r = _ref141.height;
      if (e === t.width && r === t.height) return;
      var n = qa({}, {
        width: e,
        height: r
      }, i);
      ja(t, n, {
        x: 0,
        y: 0
      }, {
        x: 0,
        y: 0
      }, {
        width: Math.min(t.width, e),
        height: Math.min(t.height, r)
      }, i), t.width = e, t.height = r, t.data = n.data;
    }

    function ja(t, e, r, i, n, s) {
      if (0 === n.width || 0 === n.height) return e;
      if (n.width > t.width || n.height > t.height || r.x > t.width - n.width || r.y > t.height - n.height) throw new RangeError("out of range source coordinates for image copy");
      if (n.width > e.width || n.height > e.height || i.x > e.width - n.width || i.y > e.height - n.height) throw new RangeError("out of range destination coordinates for image copy");
      var a = t.data,
          o = e.data;

      for (var _l10 = 0; _l10 < n.height; _l10++) {
        var _u10 = ((r.y + _l10) * t.width + r.x) * s,
            _c6 = ((i.y + _l10) * e.width + i.x) * s;

        for (var _t68 = 0; _t68 < n.width * s; _t68++) {
          o[_c6 + _t68] = a[_u10 + _t68];
        }
      }

      return e;
    }

    ji("HeatmapBucket", $a, {
      omit: ["layers"]
    });

    var Ka = /*#__PURE__*/function () {
      function Ka(t, e) {
        _classCallCheck(this, Ka);

        qa(this, t, 1, e);
      }

      _createClass(Ka, [{
        key: "resize",
        value: function resize(t) {
          Na(this, t, 1);
        }
      }, {
        key: "clone",
        value: function clone() {
          return new Ka({
            width: this.width,
            height: this.height
          }, new Uint8Array(this.data));
        }
      }], [{
        key: "copy",
        value: function copy(t, e, r, i, n) {
          ja(t, e, r, i, n, 1);
        }
      }]);

      return Ka;
    }();

    var Za = /*#__PURE__*/function () {
      function Za(t, e) {
        _classCallCheck(this, Za);

        qa(this, t, 4, e);
      }

      _createClass(Za, [{
        key: "resize",
        value: function resize(t) {
          Na(this, t, 4);
        }
      }, {
        key: "replace",
        value: function replace(t, e) {
          e ? this.data.set(t) : this.data = t instanceof Uint8ClampedArray ? new Uint8Array(t.buffer) : t;
        }
      }, {
        key: "clone",
        value: function clone() {
          return new Za({
            width: this.width,
            height: this.height
          }, new Uint8Array(this.data));
        }
      }], [{
        key: "copy",
        value: function copy(t, e, r, i, n) {
          ja(t, e, r, i, n, 4);
        }
      }]);

      return Za;
    }();

    ji("AlphaImage", Ka), ji("RGBAImage", Za);
    var Xa = {
      paint: new En({
        "heatmap-radius": new Sn(Vt.paint_heatmap["heatmap-radius"]),
        "heatmap-weight": new Sn(Vt.paint_heatmap["heatmap-weight"]),
        "heatmap-intensity": new kn(Vt.paint_heatmap["heatmap-intensity"]),
        "heatmap-color": new zn(Vt.paint_heatmap["heatmap-color"]),
        "heatmap-opacity": new kn(Vt.paint_heatmap["heatmap-opacity"])
      })
    };

    function Ga(t) {
      var e = {},
          r = t.resolution || 256,
          i = t.clips ? t.clips.length : 1,
          n = t.image || new Za({
        width: r,
        height: i
      }),
          s = function s(r, i, _s37) {
        e[t.evaluationKey] = _s37;
        var a = t.expression.evaluate(e);
        n.data[r + i + 0] = Math.floor(255 * a.r / a.a), n.data[r + i + 1] = Math.floor(255 * a.g / a.a), n.data[r + i + 2] = Math.floor(255 * a.b / a.a), n.data[r + i + 3] = Math.floor(255 * a.a);
      };

      if (t.clips) for (var _e77 = 0, _n47 = 0; _e77 < i; ++_e77, _n47 += 4 * r) {
        for (var _i71 = 0, _a37 = 0; _i71 < r; _i71++, _a37 += 4) {
          var _o14 = _i71 / (r - 1),
              _t$clips$_e = t.clips[_e77],
              _l11 = _t$clips$_e.start,
              _u11 = _t$clips$_e.end;

          s(_n47, _a37, _l11 * (1 - _o14) + _u11 * _o14);
        }
      } else for (var _t69 = 0, _e78 = 0; _t69 < r; _t69++, _e78 += 4) {
        s(0, _e78, _t69 / (r - 1));
      }
      return n;
    }

    var Ha = {
      paint: new En({
        "hillshade-illumination-direction": new kn(Vt.paint_hillshade["hillshade-illumination-direction"]),
        "hillshade-illumination-anchor": new kn(Vt.paint_hillshade["hillshade-illumination-anchor"]),
        "hillshade-exaggeration": new kn(Vt.paint_hillshade["hillshade-exaggeration"]),
        "hillshade-shadow-color": new kn(Vt.paint_hillshade["hillshade-shadow-color"]),
        "hillshade-highlight-color": new kn(Vt.paint_hillshade["hillshade-highlight-color"]),
        "hillshade-accent-color": new kn(Vt.paint_hillshade["hillshade-accent-color"])
      })
    };
    var Ja = Pn([{
      name: "a_pos",
      components: 2,
      type: "Int16"
    }], 4),
        Ya = Ja.members;
    var Wa = to,
        Qa = to;

    function to(t, e, r) {
      r = r || 2;
      var i,
          n,
          s,
          a,
          o,
          l,
          u,
          c = e && e.length,
          h = c ? e[0] * r : t.length,
          p = eo(t, 0, h, r, !0),
          d = [];
      if (!p || p.next === p.prev) return d;

      if (c && (p = function (t, e, r, i) {
        var n,
            s,
            a,
            o = [];

        for (n = 0, s = e.length; n < s; n++) {
          (a = eo(t, e[n] * i, n < s - 1 ? e[n + 1] * i : t.length, i, !1)) === a.next && (a.steiner = !0), o.push(po(a));
        }

        for (o.sort(lo), n = 0; n < o.length; n++) {
          uo(o[n], r), r = ro(r, r.next);
        }

        return r;
      }(t, e, p, r)), t.length > 80 * r) {
        i = s = t[0], n = a = t[1];

        for (var f = r; f < h; f += r) {
          (o = t[f]) < i && (i = o), (l = t[f + 1]) < n && (n = l), o > s && (s = o), l > a && (a = l);
        }

        u = 0 !== (u = Math.max(s - i, a - n)) ? 1 / u : 0;
      }

      return io(p, d, r, i, n, u), d;
    }

    function eo(t, e, r, i, n) {
      var s, a;
      if (n === Io(t, e, r, i) > 0) for (s = e; s < r; s += i) {
        a = Ao(s, t[s], t[s + 1], a);
      } else for (s = r - i; s >= e; s -= i) {
        a = Ao(s, t[s], t[s + 1], a);
      }
      return a && go(a, a.next) && (ko(a), a = a.next), a;
    }

    function ro(t, e) {
      if (!t) return t;
      e || (e = t);
      var r,
          i = t;

      do {
        if (r = !1, i.steiner || !go(i, i.next) && 0 !== mo(i.prev, i, i.next)) i = i.next;else {
          if (ko(i), (i = e = i.prev) === i.next) break;
          r = !0;
        }
      } while (r || i !== e);

      return e;
    }

    function io(t, e, r, i, n, s, a) {
      if (t) {
        !a && s && function (t, e, r, i) {
          var n = t;

          do {
            null === n.z && (n.z = ho(n.x, n.y, e, r, i)), n.prevZ = n.prev, n.nextZ = n.next, n = n.next;
          } while (n !== t);

          n.prevZ.nextZ = null, n.prevZ = null, function (t) {
            var e,
                r,
                i,
                n,
                s,
                a,
                o,
                l,
                u = 1;

            do {
              for (r = t, t = null, s = null, a = 0; r;) {
                for (a++, i = r, o = 0, e = 0; e < u && (o++, i = i.nextZ); e++) {
                  ;
                }

                for (l = u; o > 0 || l > 0 && i;) {
                  0 !== o && (0 === l || !i || r.z <= i.z) ? (n = r, r = r.nextZ, o--) : (n = i, i = i.nextZ, l--), s ? s.nextZ = n : t = n, n.prevZ = s, s = n;
                }

                r = i;
              }

              s.nextZ = null, u *= 2;
            } while (a > 1);
          }(n);
        }(t, i, n, s);

        for (var o, l, u = t; t.prev !== t.next;) {
          if (o = t.prev, l = t.next, s ? so(t, i, n, s) : no(t)) e.push(o.i / r), e.push(t.i / r), e.push(l.i / r), ko(t), t = l.next, u = l.next;else if ((t = l) === u) {
            a ? 1 === a ? io(t = ao(ro(t), e, r), e, r, i, n, s, 2) : 2 === a && oo(t, e, r, i, n, s) : io(ro(t), e, r, i, n, s, 1);
            break;
          }
        }
      }
    }

    function no(t) {
      var e = t.prev,
          r = t,
          i = t.next;
      if (mo(e, r, i) >= 0) return !1;

      for (var n = t.next.next; n !== t.prev;) {
        if (fo(e.x, e.y, r.x, r.y, i.x, i.y, n.x, n.y) && mo(n.prev, n, n.next) >= 0) return !1;
        n = n.next;
      }

      return !0;
    }

    function so(t, e, r, i) {
      var n = t.prev,
          s = t,
          a = t.next;
      if (mo(n, s, a) >= 0) return !1;

      for (var o = n.x > s.x ? n.x > a.x ? n.x : a.x : s.x > a.x ? s.x : a.x, l = n.y > s.y ? n.y > a.y ? n.y : a.y : s.y > a.y ? s.y : a.y, u = ho(n.x < s.x ? n.x < a.x ? n.x : a.x : s.x < a.x ? s.x : a.x, n.y < s.y ? n.y < a.y ? n.y : a.y : s.y < a.y ? s.y : a.y, e, r, i), c = ho(o, l, e, r, i), h = t.prevZ, p = t.nextZ; h && h.z >= u && p && p.z <= c;) {
        if (h !== t.prev && h !== t.next && fo(n.x, n.y, s.x, s.y, a.x, a.y, h.x, h.y) && mo(h.prev, h, h.next) >= 0) return !1;
        if (h = h.prevZ, p !== t.prev && p !== t.next && fo(n.x, n.y, s.x, s.y, a.x, a.y, p.x, p.y) && mo(p.prev, p, p.next) >= 0) return !1;
        p = p.nextZ;
      }

      for (; h && h.z >= u;) {
        if (h !== t.prev && h !== t.next && fo(n.x, n.y, s.x, s.y, a.x, a.y, h.x, h.y) && mo(h.prev, h, h.next) >= 0) return !1;
        h = h.prevZ;
      }

      for (; p && p.z <= c;) {
        if (p !== t.prev && p !== t.next && fo(n.x, n.y, s.x, s.y, a.x, a.y, p.x, p.y) && mo(p.prev, p, p.next) >= 0) return !1;
        p = p.nextZ;
      }

      return !0;
    }

    function ao(t, e, r) {
      var i = t;

      do {
        var n = i.prev,
            s = i.next.next;
        !go(n, s) && xo(n, i, i.next, s) && wo(n, s) && wo(s, n) && (e.push(n.i / r), e.push(i.i / r), e.push(s.i / r), ko(i), ko(i.next), i = t = s), i = i.next;
      } while (i !== t);

      return ro(i);
    }

    function oo(t, e, r, i, n, s) {
      var a = t;

      do {
        for (var o = a.next.next; o !== a.prev;) {
          if (a.i !== o.i && yo(a, o)) {
            var l = _o(a, o);

            return a = ro(a, a.next), l = ro(l, l.next), io(a, e, r, i, n, s), void io(l, e, r, i, n, s);
          }

          o = o.next;
        }

        a = a.next;
      } while (a !== t);
    }

    function lo(t, e) {
      return t.x - e.x;
    }

    function uo(t, e) {
      if (e = function (t, e) {
        var r,
            i = e,
            n = t.x,
            s = t.y,
            a = -1 / 0;

        do {
          if (s <= i.y && s >= i.next.y && i.next.y !== i.y) {
            var o = i.x + (s - i.y) * (i.next.x - i.x) / (i.next.y - i.y);

            if (o <= n && o > a) {
              if (a = o, o === n) {
                if (s === i.y) return i;
                if (s === i.next.y) return i.next;
              }

              r = i.x < i.next.x ? i : i.next;
            }
          }

          i = i.next;
        } while (i !== e);

        if (!r) return null;
        if (n === a) return r;
        var l,
            u = r,
            c = r.x,
            h = r.y,
            p = 1 / 0;
        i = r;

        do {
          n >= i.x && i.x >= c && n !== i.x && fo(s < h ? n : a, s, c, h, s < h ? a : n, s, i.x, i.y) && (l = Math.abs(s - i.y) / (n - i.x), wo(i, t) && (l < p || l === p && (i.x > r.x || i.x === r.x && co(r, i))) && (r = i, p = l)), i = i.next;
        } while (i !== u);

        return r;
      }(t, e)) {
        var r = _o(e, t);

        ro(e, e.next), ro(r, r.next);
      }
    }

    function co(t, e) {
      return mo(t.prev, t, e.prev) < 0 && mo(e.next, t, t.next) < 0;
    }

    function ho(t, e, r, i, n) {
      return (t = 1431655765 & ((t = 858993459 & ((t = 252645135 & ((t = 16711935 & ((t = 32767 * (t - r) * n) | t << 8)) | t << 4)) | t << 2)) | t << 1)) | (e = 1431655765 & ((e = 858993459 & ((e = 252645135 & ((e = 16711935 & ((e = 32767 * (e - i) * n) | e << 8)) | e << 4)) | e << 2)) | e << 1)) << 1;
    }

    function po(t) {
      var e = t,
          r = t;

      do {
        (e.x < r.x || e.x === r.x && e.y < r.y) && (r = e), e = e.next;
      } while (e !== t);

      return r;
    }

    function fo(t, e, r, i, n, s, a, o) {
      return (n - a) * (e - o) - (t - a) * (s - o) >= 0 && (t - a) * (i - o) - (r - a) * (e - o) >= 0 && (r - a) * (s - o) - (n - a) * (i - o) >= 0;
    }

    function yo(t, e) {
      return t.next.i !== e.i && t.prev.i !== e.i && !function (t, e) {
        var r = t;

        do {
          if (r.i !== t.i && r.next.i !== t.i && r.i !== e.i && r.next.i !== e.i && xo(r, r.next, t, e)) return !0;
          r = r.next;
        } while (r !== t);

        return !1;
      }(t, e) && (wo(t, e) && wo(e, t) && function (t, e) {
        var r = t,
            i = !1,
            n = (t.x + e.x) / 2,
            s = (t.y + e.y) / 2;

        do {
          r.y > s != r.next.y > s && r.next.y !== r.y && n < (r.next.x - r.x) * (s - r.y) / (r.next.y - r.y) + r.x && (i = !i), r = r.next;
        } while (r !== t);

        return i;
      }(t, e) && (mo(t.prev, t, e.prev) || mo(t, e.prev, e)) || go(t, e) && mo(t.prev, t, t.next) > 0 && mo(e.prev, e, e.next) > 0);
    }

    function mo(t, e, r) {
      return (e.y - t.y) * (r.x - e.x) - (e.x - t.x) * (r.y - e.y);
    }

    function go(t, e) {
      return t.x === e.x && t.y === e.y;
    }

    function xo(t, e, r, i) {
      var n = bo(mo(t, e, r)),
          s = bo(mo(t, e, i)),
          a = bo(mo(r, i, t)),
          o = bo(mo(r, i, e));
      return n !== s && a !== o || !(0 !== n || !vo(t, r, e)) || !(0 !== s || !vo(t, i, e)) || !(0 !== a || !vo(r, t, i)) || !(0 !== o || !vo(r, e, i));
    }

    function vo(t, e, r) {
      return e.x <= Math.max(t.x, r.x) && e.x >= Math.min(t.x, r.x) && e.y <= Math.max(t.y, r.y) && e.y >= Math.min(t.y, r.y);
    }

    function bo(t) {
      return t > 0 ? 1 : t < 0 ? -1 : 0;
    }

    function wo(t, e) {
      return mo(t.prev, t, t.next) < 0 ? mo(t, e, t.next) >= 0 && mo(t, t.prev, e) >= 0 : mo(t, e, t.prev) < 0 || mo(t, t.next, e) < 0;
    }

    function _o(t, e) {
      var r = new So(t.i, t.x, t.y),
          i = new So(e.i, e.x, e.y),
          n = t.next,
          s = e.prev;
      return t.next = e, e.prev = t, r.next = n, n.prev = r, i.next = r, r.prev = i, s.next = i, i.prev = s, i;
    }

    function Ao(t, e, r, i) {
      var n = new So(t, e, r);
      return i ? (n.next = i.next, n.prev = i, i.next.prev = n, i.next = n) : (n.prev = n, n.next = n), n;
    }

    function ko(t) {
      t.next.prev = t.prev, t.prev.next = t.next, t.prevZ && (t.prevZ.nextZ = t.nextZ), t.nextZ && (t.nextZ.prevZ = t.prevZ);
    }

    function So(t, e, r) {
      this.i = t, this.x = e, this.y = r, this.prev = null, this.next = null, this.z = null, this.prevZ = null, this.nextZ = null, this.steiner = !1;
    }

    function Io(t, e, r, i) {
      for (var n = 0, s = e, a = r - i; s < r; s += i) {
        n += (t[a] - t[s]) * (t[s + 1] + t[a + 1]), a = s;
      }

      return n;
    }

    function To(t, e, r, i, n) {
      !function t(e, r, i, n, s) {
        for (; n > i;) {
          if (n - i > 600) {
            var a = n - i + 1,
                o = r - i + 1,
                l = Math.log(a),
                u = .5 * Math.exp(2 * l / 3),
                c = .5 * Math.sqrt(l * u * (a - u) / a) * (o - a / 2 < 0 ? -1 : 1);
            t(e, r, Math.max(i, Math.floor(r - o * u / a + c)), Math.min(n, Math.floor(r + (a - o) * u / a + c)), s);
          }

          var h = e[r],
              p = i,
              d = n;

          for (zo(e, i, r), s(e[n], h) > 0 && zo(e, i, n); p < d;) {
            for (zo(e, p, d), p++, d--; s(e[p], h) < 0;) {
              p++;
            }

            for (; s(e[d], h) > 0;) {
              d--;
            }
          }

          0 === s(e[i], h) ? zo(e, i, d) : zo(e, ++d, n), d <= r && (i = d + 1), r <= d && (n = d - 1);
        }
      }(t, e, r || 0, i || t.length - 1, n || Eo);
    }

    function zo(t, e, r) {
      var i = t[e];
      t[e] = t[r], t[r] = i;
    }

    function Eo(t, e) {
      return t < e ? -1 : t > e ? 1 : 0;
    }

    function Co(t, e) {
      var r = t.length;
      if (r <= 1) return [t];
      var i = [];
      var n, s;

      for (var _e79 = 0; _e79 < r; _e79++) {
        var _r91 = C(t[_e79]);

        0 !== _r91 && (t[_e79].area = Math.abs(_r91), void 0 === s && (s = _r91 < 0), s === _r91 < 0 ? (n && i.push(n), n = [t[_e79]]) : n.push(t[_e79]));
      }

      if (n && i.push(n), e > 1) for (var _t70 = 0; _t70 < i.length; _t70++) {
        i[_t70].length <= e || (To(i[_t70], e, 1, i[_t70].length - 1, Mo), i[_t70] = i[_t70].slice(0, e));
      }
      return i;
    }

    function Mo(t, e) {
      return e.area - t.area;
    }

    function Bo(t, e, r) {
      var i = r.patternDependencies;
      var n = !1;

      var _iterator61 = _createForOfIteratorHelper(e),
          _step61;

      try {
        for (_iterator61.s(); !(_step61 = _iterator61.n()).done;) {
          var _r92 = _step61.value;

          var _e80 = _r92.paint.get("".concat(t, "-pattern"));

          _e80.isConstant() || (n = !0);

          var _s38 = _e80.constantOr(null);

          _s38 && (n = !0, i[_s38.to] = !0, i[_s38.from] = !0);
        }
      } catch (err) {
        _iterator61.e(err);
      } finally {
        _iterator61.f();
      }

      return n;
    }

    function Do(t, e, r, i, n) {
      var s = n.patternDependencies;

      var _iterator62 = _createForOfIteratorHelper(e),
          _step62;

      try {
        for (_iterator62.s(); !(_step62 = _iterator62.n()).done;) {
          var _a38 = _step62.value;

          var _e81 = _a38.paint.get("".concat(t, "-pattern")).value;

          if ("constant" !== _e81.kind) {
            var _t71 = _e81.evaluate({
              zoom: i - 1
            }, r, {}, n.availableImages),
                _o15 = _e81.evaluate({
              zoom: i
            }, r, {}, n.availableImages),
                _l12 = _e81.evaluate({
              zoom: i + 1
            }, r, {}, n.availableImages);

            _t71 = _t71 && _t71.name ? _t71.name : _t71, _o15 = _o15 && _o15.name ? _o15.name : _o15, _l12 = _l12 && _l12.name ? _l12.name : _l12, s[_t71] = !0, s[_o15] = !0, s[_l12] = !0, r.patterns[_a38.id] = {
              min: _t71,
              mid: _o15,
              max: _l12
            };
          }
        }
      } catch (err) {
        _iterator62.e(err);
      } finally {
        _iterator62.f();
      }

      return r;
    }

    to.deviation = function (t, e, r, i) {
      var n = e && e.length,
          s = Math.abs(Io(t, 0, n ? e[0] * r : t.length, r));
      if (n) for (var a = 0, o = e.length; a < o; a++) {
        s -= Math.abs(Io(t, e[a] * r, a < o - 1 ? e[a + 1] * r : t.length, r));
      }
      var l = 0;

      for (a = 0; a < i.length; a += 3) {
        var u = i[a] * r,
            c = i[a + 1] * r,
            h = i[a + 2] * r;
        l += Math.abs((t[u] - t[h]) * (t[c + 1] - t[u + 1]) - (t[u] - t[c]) * (t[h + 1] - t[u + 1]));
      }

      return 0 === s && 0 === l ? 0 : Math.abs((l - s) / s);
    }, to.flatten = function (t) {
      for (var e = t[0][0].length, r = {
        vertices: [],
        holes: [],
        dimensions: e
      }, i = 0, n = 0; n < t.length; n++) {
        for (var s = 0; s < t[n].length; s++) {
          for (var a = 0; a < e; a++) {
            r.vertices.push(t[n][s][a]);
          }
        }

        n > 0 && r.holes.push(i += t[n - 1].length);
      }

      return r;
    }, Wa["default"] = Qa;

    var Po = /*#__PURE__*/function () {
      function Po(t) {
        _classCallCheck(this, Po);

        this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.hasPattern = !1, this.patternFeatures = [], this.layoutVertexArray = new Fn(), this.indexArray = new Gn(), this.indexArray2 = new ts(), this.programConfigurations = new Ps(t.layers, t.zoom), this.segments = new Os(), this.segments2 = new Os(), this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        });
      }

      _createClass(Po, [{
        key: "populate",
        value: function populate(t, e, r) {
          this.hasPattern = Bo("fill", this.layers, e);
          var i = this.layers[0].layout.get("fill-sort-key"),
              n = [];

          var _iterator63 = _createForOfIteratorHelper(t),
              _step63;

          try {
            for (_iterator63.s(); !(_step63 = _iterator63.n()).done;) {
              var _ref143 = _step63.value;
              var _s40 = _ref143.feature;
              var _a40 = _ref143.id;
              var _o16 = _ref143.index;
              var _l13 = _ref143.sourceLayerIndex;

              var _t73 = this.layers[0]._featureFilter.needGeometry,
                  _u12 = js(_s40, _t73);

              if (!this.layers[0]._featureFilter.filter(new yn(this.zoom), _u12, r)) continue;

              var _c7 = i ? i.evaluate(_u12, {}, r, e.availableImages) : void 0,
                  _h3 = {
                id: _a40,
                properties: _s40.properties,
                type: _s40.type,
                sourceLayerIndex: _l13,
                index: _o16,
                geometry: _t73 ? _u12.geometry : Ns(_s40),
                patterns: {},
                sortKey: _c7
              };

              n.push(_h3);
            }
          } catch (err) {
            _iterator63.e(err);
          } finally {
            _iterator63.f();
          }

          i && n.sort(function (t, e) {
            return t.sortKey - e.sortKey;
          });

          for (var _i72 = 0, _n48 = n; _i72 < _n48.length; _i72++) {
            var _i73 = _n48[_i72];
            var _n49 = _i73.geometry,
                _s39 = _i73.index,
                _a39 = _i73.sourceLayerIndex;

            if (this.hasPattern) {
              var _t72 = Do("fill", this.layers, _i73, this.zoom, e);

              this.patternFeatures.push(_t72);
            } else this.addFeature(_i73, _n49, _s39, r, {});

            e.featureIndex.insert(t[_s39].feature, _n49, _s39, _a39, this.index);
          }
        }
      }, {
        key: "update",
        value: function update(t, e, r) {
          this.stateDependentLayers.length && this.programConfigurations.updatePaintArrays(t, e, this.stateDependentLayers, r);
        }
      }, {
        key: "addFeatures",
        value: function addFeatures(t, e, r) {
          var _iterator64 = _createForOfIteratorHelper(this.patternFeatures),
              _step64;

          try {
            for (_iterator64.s(); !(_step64 = _iterator64.n()).done;) {
              var _t74 = _step64.value;
              this.addFeature(_t74, _t74.geometry, _t74.index, e, r);
            }
          } catch (err) {
            _iterator64.e(err);
          } finally {
            _iterator64.f();
          }
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.uploaded || (this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, Ya), this.indexBuffer = t.createIndexBuffer(this.indexArray), this.indexBuffer2 = t.createIndexBuffer(this.indexArray2)), this.programConfigurations.upload(t), this.uploaded = !0;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.indexBuffer2.destroy(), this.programConfigurations.destroy(), this.segments.destroy(), this.segments2.destroy());
        }
      }, {
        key: "addFeature",
        value: function addFeature(t, e, r, i, n) {
          var _iterator65 = _createForOfIteratorHelper(Co(e, 500)),
              _step65;

          try {
            for (_iterator65.s(); !(_step65 = _iterator65.n()).done;) {
              var _t75 = _step65.value;
              var _e82 = 0;

              var _iterator66 = _createForOfIteratorHelper(_t75),
                  _step66;

              try {
                for (_iterator66.s(); !(_step66 = _iterator66.n()).done;) {
                  var _r94 = _step66.value;
                  _e82 += _r94.length;
                }
              } catch (err) {
                _iterator66.e(err);
              } finally {
                _iterator66.f();
              }

              var _r93 = this.segments.prepareSegment(_e82, this.layoutVertexArray, this.indexArray),
                  _i74 = _r93.vertexLength,
                  _n50 = [],
                  _s41 = [];

              var _iterator67 = _createForOfIteratorHelper(_t75),
                  _step67;

              try {
                for (_iterator67.s(); !(_step67 = _iterator67.n()).done;) {
                  var _e83 = _step67.value;
                  if (0 === _e83.length) continue;
                  _e83 !== _t75[0] && _s41.push(_n50.length / 2);

                  var _r95 = this.segments2.prepareSegment(_e83.length, this.layoutVertexArray, this.indexArray2),
                      _i75 = _r95.vertexLength;

                  this.layoutVertexArray.emplaceBack(_e83[0].x, _e83[0].y), this.indexArray2.emplaceBack(_i75 + _e83.length - 1, _i75), _n50.push(_e83[0].x), _n50.push(_e83[0].y);

                  for (var _t77 = 1; _t77 < _e83.length; _t77++) {
                    this.layoutVertexArray.emplaceBack(_e83[_t77].x, _e83[_t77].y), this.indexArray2.emplaceBack(_i75 + _t77 - 1, _i75 + _t77), _n50.push(_e83[_t77].x), _n50.push(_e83[_t77].y);
                  }

                  _r95.vertexLength += _e83.length, _r95.primitiveLength += _e83.length;
                }
              } catch (err) {
                _iterator67.e(err);
              } finally {
                _iterator67.f();
              }

              var _a41 = Wa(_n50, _s41);

              for (var _t76 = 0; _t76 < _a41.length; _t76 += 3) {
                this.indexArray.emplaceBack(_i74 + _a41[_t76], _i74 + _a41[_t76 + 1], _i74 + _a41[_t76 + 2]);
              }

              _r93.vertexLength += _e82, _r93.primitiveLength += _a41.length / 3;
            }
          } catch (err) {
            _iterator65.e(err);
          } finally {
            _iterator65.f();
          }

          this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, t, r, n, i);
        }
      }]);

      return Po;
    }();

    ji("FillBucket", Po, {
      omit: ["layers", "patternFeatures"]
    });
    var Vo = new En({
      "fill-sort-key": new Sn(Vt.layout_fill["fill-sort-key"])
    });
    var Fo = {
      paint: new En({
        "fill-antialias": new kn(Vt.paint_fill["fill-antialias"]),
        "fill-opacity": new Sn(Vt.paint_fill["fill-opacity"]),
        "fill-color": new Sn(Vt.paint_fill["fill-color"]),
        "fill-outline-color": new Sn(Vt.paint_fill["fill-outline-color"]),
        "fill-translate": new kn(Vt.paint_fill["fill-translate"]),
        "fill-translate-anchor": new kn(Vt.paint_fill["fill-translate-anchor"]),
        "fill-pattern": new In(Vt.paint_fill["fill-pattern"])
      }),
      layout: Vo
    };
    var Ro = Pn([{
      name: "a_pos_normal_ed",
      components: 4,
      type: "Int16"
    }]),
        Lo = Pn([{
      name: "a_centroid_pos",
      components: 2,
      type: "Uint16"
    }]),
        Uo = Ro.members;
    var Oo = $o;

    function $o(t, e, r, i, n) {
      this.properties = {}, this.extent = r, this.type = 0, this._pbf = t, this._geometry = -1, this._keys = i, this._values = n, t.readFields(qo, this, e);
    }

    function qo(t, e, r) {
      1 == t ? e.id = r.readVarint() : 2 == t ? function (t, e) {
        for (var r = t.readVarint() + t.pos; t.pos < r;) {
          var i = e._keys[t.readVarint()],
              n = e._values[t.readVarint()];

          e.properties[i] = n;
        }
      }(r, e) : 3 == t ? e.type = r.readVarint() : 4 == t && (e._geometry = r.pos);
    }

    function No(t) {
      for (var e, r, i = 0, n = 0, s = t.length, a = s - 1; n < s; a = n++) {
        i += ((r = t[a]).x - (e = t[n]).x) * (e.y + r.y);
      }

      return i;
    }

    $o.types = ["Unknown", "Point", "LineString", "Polygon"], $o.prototype.loadGeometry = function () {
      var t = this._pbf;
      t.pos = this._geometry;

      for (var e, r = t.readVarint() + t.pos, n = 1, s = 0, a = 0, o = 0, l = []; t.pos < r;) {
        if (s <= 0) {
          var u = t.readVarint();
          n = 7 & u, s = u >> 3;
        }

        if (s--, 1 === n || 2 === n) a += t.readSVarint(), o += t.readSVarint(), 1 === n && (e && l.push(e), e = []), e.push(new i(a, o));else {
          if (7 !== n) throw new Error("unknown command " + n);
          e && e.push(e[0].clone());
        }
      }

      return e && l.push(e), l;
    }, $o.prototype.bbox = function () {
      var t = this._pbf;
      t.pos = this._geometry;

      for (var e = t.readVarint() + t.pos, r = 1, i = 0, n = 0, s = 0, a = 1 / 0, o = -1 / 0, l = 1 / 0, u = -1 / 0; t.pos < e;) {
        if (i <= 0) {
          var c = t.readVarint();
          r = 7 & c, i = c >> 3;
        }

        if (i--, 1 === r || 2 === r) (n += t.readSVarint()) < a && (a = n), n > o && (o = n), (s += t.readSVarint()) < l && (l = s), s > u && (u = s);else if (7 !== r) throw new Error("unknown command " + r);
      }

      return [a, l, o, u];
    }, $o.prototype.toGeoJSON = function (t, e, r) {
      var i,
          n,
          s = this.extent * Math.pow(2, r),
          a = this.extent * t,
          o = this.extent * e,
          l = this.loadGeometry(),
          u = $o.types[this.type];

      function c(t) {
        for (var e = 0; e < t.length; e++) {
          var r = t[e];
          t[e] = [360 * (r.x + a) / s - 180, 360 / Math.PI * Math.atan(Math.exp((180 - 360 * (r.y + o) / s) * Math.PI / 180)) - 90];
        }
      }

      switch (this.type) {
        case 1:
          var h = [];

          for (i = 0; i < l.length; i++) {
            h[i] = l[i][0];
          }

          c(l = h);
          break;

        case 2:
          for (i = 0; i < l.length; i++) {
            c(l[i]);
          }

          break;

        case 3:
          for (l = function (t) {
            var e = t.length;
            if (e <= 1) return [t];

            for (var r, i, n = [], s = 0; s < e; s++) {
              var a = No(t[s]);
              0 !== a && (void 0 === i && (i = a < 0), i === a < 0 ? (r && n.push(r), r = [t[s]]) : r.push(t[s]));
            }

            return r && n.push(r), n;
          }(l), i = 0; i < l.length; i++) {
            for (n = 0; n < l[i].length; n++) {
              c(l[i][n]);
            }
          }

      }

      1 === l.length ? l = l[0] : u = "Multi" + u;
      var p = {
        type: "Feature",
        geometry: {
          type: u,
          coordinates: l
        },
        properties: this.properties
      };
      return "id" in this && (p.id = this.id), p;
    };
    var jo = Ko;

    function Ko(t, e) {
      this.version = 1, this.name = null, this.extent = 4096, this.length = 0, this._pbf = t, this._keys = [], this._values = [], this._features = [], t.readFields(Zo, this, e), this.length = this._features.length;
    }

    function Zo(t, e, r) {
      15 === t ? e.version = r.readVarint() : 1 === t ? e.name = r.readString() : 5 === t ? e.extent = r.readVarint() : 2 === t ? e._features.push(r.pos) : 3 === t ? e._keys.push(r.readString()) : 4 === t && e._values.push(function (t) {
        for (var e = null, r = t.readVarint() + t.pos; t.pos < r;) {
          var i = t.readVarint() >> 3;
          e = 1 === i ? t.readString() : 2 === i ? t.readFloat() : 3 === i ? t.readDouble() : 4 === i ? t.readVarint64() : 5 === i ? t.readVarint() : 6 === i ? t.readSVarint() : 7 === i ? t.readBoolean() : null;
        }

        return e;
      }(r));
    }

    function Xo(t, e, r) {
      if (3 === t) {
        var i = new jo(r, r.readVarint() + r.pos);
        i.length && (e[i.name] = i);
      }
    }

    Ko.prototype.feature = function (t) {
      if (t < 0 || t >= this._features.length) throw new Error("feature index out of bounds");
      this._pbf.pos = this._features[t];

      var e = this._pbf.readVarint() + this._pbf.pos;

      return new Oo(this._pbf, e, this.extent, this._keys, this._values);
    };

    var Go = {
      VectorTile: function VectorTile(t, e) {
        this.layers = t.readFields(Xo, {}, e);
      },
      VectorTileFeature: Oo,
      VectorTileLayer: jo
    };
    var Ho = Go.VectorTileFeature.types,
        Jo = Math.pow(2, 13);

    function Yo(t, e, r, i, n, s, a, o) {
      t.emplaceBack((e << 1) + a, (r << 1) + s, (Math.floor(i * Jo) << 1) + n, Math.round(o));
    }

    var Wo = /*#__PURE__*/function () {
      function Wo() {
        _classCallCheck(this, Wo);

        this.acc = new i(0, 0), this.polyCount = [];
      }

      _createClass(Wo, [{
        key: "startRing",
        value: function startRing(t) {
          this.currentPolyCount = {
            edges: 0,
            top: 0
          }, this.polyCount.push(this.currentPolyCount), this.min || (this.min = new i(t.x, t.y), this.max = new i(t.x, t.y));
        }
      }, {
        key: "append",
        value: function append(t, e) {
          this.currentPolyCount.edges++, this.acc._add(t);
          var r = !!this.borders;
          var i = this.min,
              n = this.max;
          t.x < i.x ? (i.x = t.x, r = !0) : t.x > n.x && (n.x = t.x, r = !0), t.y < i.y ? (i.y = t.y, r = !0) : t.y > n.y && (n.y = t.y, r = !0), ((0 === t.x || 8192 === t.x) && t.x === e.x) != ((0 === t.y || 8192 === t.y) && t.y === e.y) && this.processBorderOverlap(t, e), r && this.checkBorderIntersection(t, e);
        }
      }, {
        key: "checkBorderIntersection",
        value: function checkBorderIntersection(t, e) {
          e.x < 0 != t.x < 0 && this.addBorderIntersection(0, Ye(e.y, t.y, (0 - e.x) / (t.x - e.x))), e.x > 8192 != t.x > 8192 && this.addBorderIntersection(1, Ye(e.y, t.y, (8192 - e.x) / (t.x - e.x))), e.y < 0 != t.y < 0 && this.addBorderIntersection(2, Ye(e.x, t.x, (0 - e.y) / (t.y - e.y))), e.y > 8192 != t.y > 8192 && this.addBorderIntersection(3, Ye(e.x, t.x, (8192 - e.y) / (t.y - e.y)));
        }
      }, {
        key: "addBorderIntersection",
        value: function addBorderIntersection(t, e) {
          this.borders || (this.borders = [[Number.MAX_VALUE, -Number.MAX_VALUE], [Number.MAX_VALUE, -Number.MAX_VALUE], [Number.MAX_VALUE, -Number.MAX_VALUE], [Number.MAX_VALUE, -Number.MAX_VALUE]]);
          var r = this.borders[t];
          e < r[0] && (r[0] = e), e > r[1] && (r[1] = e);
        }
      }, {
        key: "processBorderOverlap",
        value: function processBorderOverlap(t, e) {
          if (t.x === e.x) {
            if (t.y === e.y) return;

            var _r96 = 0 === t.x ? 0 : 1;

            this.addBorderIntersection(_r96, e.y), this.addBorderIntersection(_r96, t.y);
          } else {
            var _r97 = 0 === t.y ? 2 : 3;

            this.addBorderIntersection(_r97, e.x), this.addBorderIntersection(_r97, t.x);
          }
        }
      }, {
        key: "centroid",
        value: function centroid() {
          var t = this.polyCount.reduce(function (t, e) {
            return t + e.edges;
          }, 0);
          return 0 !== t ? this.acc.div(t)._round() : new i(0, 0);
        }
      }, {
        key: "span",
        value: function span() {
          return new i(this.max.x - this.min.x, this.max.y - this.min.y);
        }
      }, {
        key: "intersectsCount",
        value: function intersectsCount() {
          return this.borders.reduce(function (t, e) {
            return t + +(e[0] !== Number.MAX_VALUE);
          }, 0);
        }
      }]);

      return Wo;
    }();

    var Qo = /*#__PURE__*/function () {
      function Qo(t) {
        _classCallCheck(this, Qo);

        this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.hasPattern = !1, this.layoutVertexArray = new Rn(), this.centroidVertexArray = new ts(), this.indexArray = new Gn(), this.programConfigurations = new Ps(t.layers, t.zoom), this.segments = new Os(), this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        }), this.enableTerrain = t.enableTerrain;
      }

      _createClass(Qo, [{
        key: "populate",
        value: function populate(t, e, r) {
          this.features = [], this.hasPattern = Bo("fill-extrusion", this.layers, e), this.featuresOnBorder = [], this.borders = [[], [], [], []], this.borderDone = [!1, !1, !1, !1], this.tileToMeter = function (t) {
            var e = Math.exp(Math.PI * (1 - t.y / (1 << t.z) * 2));
            return 80150034 * e / (e * e + 1) / 8192 / (1 << t.z);
          }(r);

          var _iterator68 = _createForOfIteratorHelper(t),
              _step68;

          try {
            for (_iterator68.s(); !(_step68 = _iterator68.n()).done;) {
              var _ref145 = _step68.value;
              var _i76 = _ref145.feature;
              var _n51 = _ref145.id;
              var _s42 = _ref145.index;
              var _a42 = _ref145.sourceLayerIndex;

              var _t78 = this.layers[0]._featureFilter.needGeometry,
                  _o17 = js(_i76, _t78);

              if (!this.layers[0]._featureFilter.filter(new yn(this.zoom), _o17, r)) continue;
              var _l14 = {
                id: _n51,
                sourceLayerIndex: _a42,
                index: _s42,
                geometry: _t78 ? _o17.geometry : Ns(_i76),
                properties: _i76.properties,
                type: _i76.type,
                patterns: {}
              };
              this.hasPattern ? this.features.push(Do("fill-extrusion", this.layers, _l14, this.zoom, e)) : this.addFeature(_l14, _l14.geometry, _s42, r, {}), e.featureIndex.insert(_i76, _l14.geometry, _s42, _a42, this.index);
            }
          } catch (err) {
            _iterator68.e(err);
          } finally {
            _iterator68.f();
          }

          this.sortBorders();
        }
      }, {
        key: "addFeatures",
        value: function addFeatures(t, e, r) {
          var _iterator69 = _createForOfIteratorHelper(this.features),
              _step69;

          try {
            for (_iterator69.s(); !(_step69 = _iterator69.n()).done;) {
              var _t79 = _step69.value;
              var _i77 = _t79.geometry;
              this.addFeature(_t79, _i77, _t79.index, e, r);
            }
          } catch (err) {
            _iterator69.e(err);
          } finally {
            _iterator69.f();
          }

          this.sortBorders();
        }
      }, {
        key: "update",
        value: function update(t, e, r) {
          this.stateDependentLayers.length && this.programConfigurations.updatePaintArrays(t, e, this.stateDependentLayers, r);
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.uploaded || (this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, Uo), this.indexBuffer = t.createIndexBuffer(this.indexArray)), this.programConfigurations.upload(t), this.uploaded = !0;
        }
      }, {
        key: "uploadCentroid",
        value: function uploadCentroid(t) {
          0 !== this.centroidVertexArray.length && (this.centroidVertexBuffer ? this.needsCentroidUpdate && this.centroidVertexBuffer.updateData(this.centroidVertexArray) : this.centroidVertexBuffer = t.createVertexBuffer(this.centroidVertexArray, Lo.members, !0), this.needsCentroidUpdate = !1);
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.centroidVertexBuffer && this.centroidVertexBuffer.destroy(), this.indexBuffer.destroy(), this.programConfigurations.destroy(), this.segments.destroy());
        }
      }, {
        key: "addFeature",
        value: function addFeature(t, e, r, i, n) {
          var s = this.enableTerrain && t.properties && t.properties.hasOwnProperty("type") && t.properties.hasOwnProperty("height") && "Polygon" === Ho[t.type] ? new Wo() : null;

          var _iterator70 = _createForOfIteratorHelper(Co(e, 500)),
              _step70;

          try {
            for (_iterator70.s(); !(_step70 = _iterator70.n()).done;) {
              var _r99 = _step70.value;

              var _e85 = 0,
                  _i78 = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray);

              if (0 === _r99.length || (a = _r99[0]).every(function (t) {
                return t.x <= 0;
              }) || a.every(function (t) {
                return t.x >= 8192;
              }) || a.every(function (t) {
                return t.y <= 0;
              }) || a.every(function (t) {
                return t.y >= 8192;
              })) continue;

              for (var _t81 = 0; _t81 < _r99.length; _t81++) {
                var _n53 = _r99[_t81];
                if (0 === _n53.length) continue;
                _e85 += _n53.length;
                var _a43 = 0;
                s && s.startRing(_n53[0]);

                for (var _t82 = 0; _t82 < _n53.length; _t82++) {
                  var _e86 = _n53[_t82];

                  if (_t82 >= 1) {
                    var _r100 = _n53[_t82 - 1];

                    if (!tl(_e86, _r100)) {
                      s && s.append(_e86, _r100), _i78.vertexLength + 4 > Os.MAX_VERTEX_ARRAY_LENGTH && (_i78 = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray));

                      var _t83 = _e86.sub(_r100)._perp(),
                          _n54 = _t83.x / (Math.abs(_t83.x) + Math.abs(_t83.y)),
                          _o19 = _t83.y > 0 ? 1 : 0,
                          _l16 = _r100.dist(_e86);

                      _a43 + _l16 > 32768 && (_a43 = 0), Yo(this.layoutVertexArray, _e86.x, _e86.y, _n54, _o19, 0, 0, _a43), Yo(this.layoutVertexArray, _e86.x, _e86.y, _n54, _o19, 0, 1, _a43), _a43 += _l16, Yo(this.layoutVertexArray, _r100.x, _r100.y, _n54, _o19, 0, 0, _a43), Yo(this.layoutVertexArray, _r100.x, _r100.y, _n54, _o19, 0, 1, _a43);
                      var _u14 = _i78.vertexLength;
                      this.indexArray.emplaceBack(_u14, _u14 + 2, _u14 + 1), this.indexArray.emplaceBack(_u14 + 1, _u14 + 2, _u14 + 3), _i78.vertexLength += 4, _i78.primitiveLength += 2;
                    }
                  }
                }
              }

              if (_i78.vertexLength + _e85 > Os.MAX_VERTEX_ARRAY_LENGTH && (_i78 = this.segments.prepareSegment(_e85, this.layoutVertexArray, this.indexArray)), "Polygon" !== Ho[t.type]) continue;
              var _n52 = [],
                  _o18 = [],
                  _l15 = _i78.vertexLength;

              for (var _t84 = 0; _t84 < _r99.length; _t84++) {
                var _e87 = _r99[_t84];

                if (0 !== _e87.length) {
                  _e87 !== _r99[0] && _o18.push(_n52.length / 2);

                  for (var _t85 = 0; _t85 < _e87.length; _t85++) {
                    var _r101 = _e87[_t85];
                    Yo(this.layoutVertexArray, _r101.x, _r101.y, 0, 0, 1, 1, 0), _n52.push(_r101.x), _n52.push(_r101.y), s && s.currentPolyCount.top++;
                  }
                }
              }

              var _u13 = Wa(_n52, _o18);

              for (var _t86 = 0; _t86 < _u13.length; _t86 += 3) {
                this.indexArray.emplaceBack(_l15 + _u13[_t86], _l15 + _u13[_t86 + 2], _l15 + _u13[_t86 + 1]);
              }

              _i78.primitiveLength += _u13.length / 3, _i78.vertexLength += _e85;
            }
          } catch (err) {
            _iterator70.e(err);
          } finally {
            _iterator70.f();
          }

          var a;

          if (s && s.polyCount.length > 0) {
            if (s.borders) {
              s.vertexArrayOffset = this.centroidVertexArray.length;

              var _t80 = s.borders,
                  _e84 = this.featuresOnBorder.push(s) - 1;

              for (var _r98 = 0; _r98 < 4; _r98++) {
                _t80[_r98][0] !== Number.MAX_VALUE && this.borders[_r98].push(_e84);
              }
            }

            this.encodeCentroid(s.borders ? void 0 : s.centroid(), s);
          }

          this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, t, r, n, i);
        }
      }, {
        key: "sortBorders",
        value: function sortBorders() {
          var _this16 = this;

          var _loop = function _loop(_t87) {
            _this16.borders[_t87].sort(function (e, r) {
              return _this16.featuresOnBorder[e].borders[_t87][0] - _this16.featuresOnBorder[r].borders[_t87][0];
            });
          };

          for (var _t87 = 0; _t87 < 4; _t87++) {
            _loop(_t87);
          }
        }
      }, {
        key: "encodeCentroid",
        value: function encodeCentroid(t, e) {
          var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;
          var i, n;
          if (t) {
            if (0 !== t.y) {
              var _r102 = e.span()._mult(this.tileToMeter);

              i = (Math.max(t.x, 1) << 3) + Math.min(7, Math.round(_r102.x / 10)), n = (Math.max(t.y, 1) << 3) + Math.min(7, Math.round(_r102.y / 10));
            } else i = Math.ceil(7.3 * t.x), n = 0;
          } else i = 0, n = +r;
          var s = r ? this.centroidVertexArray.length : e.vertexArrayOffset;

          var _iterator71 = _createForOfIteratorHelper(e.polyCount),
              _step71;

          try {
            for (_iterator71.s(); !(_step71 = _iterator71.n()).done;) {
              var _t88 = _step71.value;
              r && this.centroidVertexArray.resize(this.centroidVertexArray.length + 4 * _t88.edges + _t88.top);

              for (var _e88 = 0; _e88 < 2 * _t88.edges; _e88++) {
                this.centroidVertexArray.emplace(s++, 0, n), this.centroidVertexArray.emplace(s++, i, n);
              }

              for (var _e89 = 0; _e89 < _t88.top; _e89++) {
                this.centroidVertexArray.emplace(s++, i, n);
              }
            }
          } catch (err) {
            _iterator71.e(err);
          } finally {
            _iterator71.f();
          }
        }
      }]);

      return Qo;
    }();

    function tl(t, e) {
      return t.x === e.x && (t.x < 0 || t.x > 8192) || t.y === e.y && (t.y < 0 || t.y > 8192);
    }

    ji("FillExtrusionBucket", Qo, {
      omit: ["layers", "features"]
    }), ji("PartMetadata", Wo);
    var el = {
      paint: new En({
        "fill-extrusion-opacity": new kn(Vt["paint_fill-extrusion"]["fill-extrusion-opacity"]),
        "fill-extrusion-color": new Sn(Vt["paint_fill-extrusion"]["fill-extrusion-color"]),
        "fill-extrusion-translate": new kn(Vt["paint_fill-extrusion"]["fill-extrusion-translate"]),
        "fill-extrusion-translate-anchor": new kn(Vt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),
        "fill-extrusion-pattern": new In(Vt["paint_fill-extrusion"]["fill-extrusion-pattern"]),
        "fill-extrusion-height": new Sn(Vt["paint_fill-extrusion"]["fill-extrusion-height"]),
        "fill-extrusion-base": new Sn(Vt["paint_fill-extrusion"]["fill-extrusion-base"]),
        "fill-extrusion-vertical-gradient": new kn(Vt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])
      })
    };

    function rl(t, e) {
      return t.x * e.x + t.y * e.y;
    }

    function il(t, e) {
      if (1 === t.length) {
        var _r103 = 0;
        var _i79 = e[_r103++];

        var _n55;

        for (; !_n55 || _i79.equals(_n55);) {
          if (_n55 = e[_r103++], !_n55) return 1 / 0;
        }

        for (; _r103 < e.length; _r103++) {
          var _s43 = e[_r103],
              _a44 = t[0],
              _o20 = _n55.sub(_i79),
              _l17 = _s43.sub(_i79),
              _u15 = _a44.sub(_i79),
              _c8 = rl(_o20, _o20),
              _h4 = rl(_o20, _l17),
              _p = rl(_l17, _l17),
              _d2 = rl(_u15, _o20),
              _f = rl(_u15, _l17),
              _y = _c8 * _p - _h4 * _h4,
              _m = (_p * _d2 - _h4 * _f) / _y,
              _g = (_c8 * _f - _h4 * _d2) / _y,
              _x = _i79.z * (1 - _m - _g) + _n55.z * _m + _s43.z * _g;

          if (isFinite(_x)) return _x;
        }

        return 1 / 0;
      }

      {
        var _t89 = 1 / 0;

        var _iterator72 = _createForOfIteratorHelper(e),
            _step72;

        try {
          for (_iterator72.s(); !(_step72 = _iterator72.n()).done;) {
            var _r104 = _step72.value;
            _t89 = Math.min(_t89, _r104.z);
          }
        } catch (err) {
          _iterator72.e(err);
        } finally {
          _iterator72.f();
        }

        return _t89;
      }
    }

    var nl = Pn([{
      name: "a_pos_normal",
      components: 2,
      type: "Int16"
    }, {
      name: "a_data",
      components: 4,
      type: "Uint8"
    }, {
      name: "a_linesofar",
      components: 1,
      type: "Float32"
    }], 4),
        sl = nl.members,
        al = Pn([{
      name: "a_uv_x",
      components: 1,
      type: "Float32"
    }, {
      name: "a_split_index",
      components: 1,
      type: "Float32"
    }]),
        ol = al.members,
        ll = Go.VectorTileFeature.types,
        ul = Math.cos(Math.PI / 180 * 37.5);

    var cl = /*#__PURE__*/function () {
      function cl(t) {
        var _this17 = this;

        _classCallCheck(this, cl);

        this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.hasPattern = !1, this.patternFeatures = [], this.lineClipsArray = [], this.gradients = {}, this.layers.forEach(function (t) {
          _this17.gradients[t.id] = {};
        }), this.layoutVertexArray = new Ln(), this.layoutVertexArray2 = new Un(), this.indexArray = new Gn(), this.programConfigurations = new Ps(t.layers, t.zoom), this.segments = new Os(), this.maxLineLength = 0, this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        });
      }

      _createClass(cl, [{
        key: "populate",
        value: function populate(t, e, r) {
          this.hasPattern = Bo("line", this.layers, e);
          var i = this.layers[0].layout.get("line-sort-key"),
              n = [];

          var _iterator73 = _createForOfIteratorHelper(t),
              _step73;

          try {
            for (_iterator73.s(); !(_step73 = _iterator73.n()).done;) {
              var _ref147 = _step73.value;
              var _e90 = _ref147.feature;
              var _s45 = _ref147.id;
              var _a46 = _ref147.index;
              var _o21 = _ref147.sourceLayerIndex;

              var _t91 = this.layers[0]._featureFilter.needGeometry,
                  _l18 = js(_e90, _t91);

              if (!this.layers[0]._featureFilter.filter(new yn(this.zoom), _l18, r)) continue;

              var _u16 = i ? i.evaluate(_l18, {}, r) : void 0,
                  _c9 = {
                id: _s45,
                properties: _e90.properties,
                type: _e90.type,
                sourceLayerIndex: _o21,
                index: _a46,
                geometry: _t91 ? _l18.geometry : Ns(_e90),
                patterns: {},
                sortKey: _u16
              };

              n.push(_c9);
            }
          } catch (err) {
            _iterator73.e(err);
          } finally {
            _iterator73.f();
          }

          i && n.sort(function (t, e) {
            return t.sortKey - e.sortKey;
          });

          for (var _i80 = 0, _n56 = n; _i80 < _n56.length; _i80++) {
            var _i81 = _n56[_i80];
            var _n57 = _i81.geometry,
                _s44 = _i81.index,
                _a45 = _i81.sourceLayerIndex;

            if (this.hasPattern) {
              var _t90 = Do("line", this.layers, _i81, this.zoom, e);

              this.patternFeatures.push(_t90);
            } else this.addFeature(_i81, _n57, _s44, r, {});

            e.featureIndex.insert(t[_s44].feature, _n57, _s44, _a45, this.index);
          }
        }
      }, {
        key: "update",
        value: function update(t, e, r) {
          this.stateDependentLayers.length && this.programConfigurations.updatePaintArrays(t, e, this.stateDependentLayers, r);
        }
      }, {
        key: "addFeatures",
        value: function addFeatures(t, e, r) {
          var _iterator74 = _createForOfIteratorHelper(this.patternFeatures),
              _step74;

          try {
            for (_iterator74.s(); !(_step74 = _iterator74.n()).done;) {
              var _t92 = _step74.value;
              this.addFeature(_t92, _t92.geometry, _t92.index, e, r);
            }
          } catch (err) {
            _iterator74.e(err);
          } finally {
            _iterator74.f();
          }
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.uploaded || (0 !== this.layoutVertexArray2.length && (this.layoutVertexBuffer2 = t.createVertexBuffer(this.layoutVertexArray2, ol)), this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, sl), this.indexBuffer = t.createIndexBuffer(this.indexArray)), this.programConfigurations.upload(t), this.uploaded = !0;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.programConfigurations.destroy(), this.segments.destroy());
        }
      }, {
        key: "lineFeatureClips",
        value: function lineFeatureClips(t) {
          if (t.properties && t.properties.hasOwnProperty("mapbox_clip_start") && t.properties.hasOwnProperty("mapbox_clip_end")) return {
            start: +t.properties.mapbox_clip_start,
            end: +t.properties.mapbox_clip_end
          };
        }
      }, {
        key: "addFeature",
        value: function addFeature(t, e, r, i, n) {
          var s = this.layers[0].layout,
              a = s.get("line-join").evaluate(t, {}),
              o = s.get("line-cap"),
              l = s.get("line-miter-limit"),
              u = s.get("line-round-limit");
          this.lineClips = this.lineFeatureClips(t);

          var _iterator75 = _createForOfIteratorHelper(e),
              _step75;

          try {
            for (_iterator75.s(); !(_step75 = _iterator75.n()).done;) {
              var _r105 = _step75.value;
              this.addLine(_r105, t, a, o, l, u);
            }
          } catch (err) {
            _iterator75.e(err);
          } finally {
            _iterator75.f();
          }

          this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, t, r, n, i);
        }
      }, {
        key: "addLine",
        value: function addLine(t, e, r, i, n, s) {
          if (this.distance = 0, this.scaledDistance = 0, this.totalDistance = 0, this.lineSoFar = 0, this.lineClips) {
            this.lineClipsArray.push(this.lineClips);

            for (var _e91 = 0; _e91 < t.length - 1; _e91++) {
              this.totalDistance += t[_e91].dist(t[_e91 + 1]);
            }

            this.updateScaledDistance(), this.maxLineLength = Math.max(this.maxLineLength, this.totalDistance);
          }

          var a = "Polygon" === ll[e.type];
          var o = t.length;

          for (; o >= 2 && t[o - 1].equals(t[o - 2]);) {
            o--;
          }

          var l = 0;

          for (; l < o - 1 && t[l].equals(t[l + 1]);) {
            l++;
          }

          if (o < (a ? 3 : 2)) return;
          "bevel" === r && (n = 1.05);
          var u = this.overscaling <= 16 ? 122880 / (512 * this.overscaling) : 0,
              c = this.segments.prepareSegment(10 * o, this.layoutVertexArray, this.indexArray);
          var h,
              p = void 0,
              d = void 0,
              f = void 0,
              y = void 0;
          this.e1 = this.e2 = -1, a && (h = t[o - 2], y = t[l].sub(h)._unit()._perp());

          for (var _e92 = l; _e92 < o; _e92++) {
            if (d = _e92 === o - 1 ? a ? t[l + 1] : void 0 : t[_e92 + 1], d && t[_e92].equals(d)) continue;
            y && (f = y), h && (p = h), h = t[_e92], y = d ? d.sub(h)._unit()._perp() : f, f = f || y;

            var _m2 = f.add(y);

            0 === _m2.x && 0 === _m2.y || _m2._unit();

            var _g2 = f.x * y.x + f.y * y.y,
                _x2 = _m2.x * y.x + _m2.y * y.y,
                _v = 0 !== _x2 ? 1 / _x2 : 1 / 0,
                _b = 2 * Math.sqrt(2 - 2 * _x2),
                _w = _x2 < ul && p && d,
                _2 = f.x * y.y - f.y * y.x > 0;

            if (_w && _e92 > l) {
              var _t93 = h.dist(p);

              if (_t93 > 2 * u) {
                var _e93 = h.sub(h.sub(p)._mult(u / _t93)._round());

                this.updateDistance(p, _e93), this.addCurrentVertex(_e93, f, 0, 0, c), p = _e93;
              }
            }

            var _A = p && d;

            var _k = _A ? r : a ? "butt" : i;

            if (_A && "round" === _k && (_v < s ? _k = "miter" : _v <= 2 && (_k = "fakeround")), "miter" === _k && _v > n && (_k = "bevel"), "bevel" === _k && (_v > 2 && (_k = "flipbevel"), _v < n && (_k = "miter")), p && this.updateDistance(p, h), "miter" === _k) _m2._mult(_v), this.addCurrentVertex(h, _m2, 0, 0, c);else if ("flipbevel" === _k) {
              if (_v > 100) _m2 = y.mult(-1);else {
                var _t94 = _v * f.add(y).mag() / f.sub(y).mag();

                _m2._perp()._mult(_t94 * (_2 ? -1 : 1));
              }
              this.addCurrentVertex(h, _m2, 0, 0, c), this.addCurrentVertex(h, _m2.mult(-1), 0, 0, c);
            } else if ("bevel" === _k || "fakeround" === _k) {
              var _t95 = -Math.sqrt(_v * _v - 1),
                  _e94 = _2 ? _t95 : 0,
                  _r106 = _2 ? 0 : _t95;

              if (p && this.addCurrentVertex(h, f, _e94, _r106, c), "fakeround" === _k) {
                var _t96 = Math.round(180 * _b / Math.PI / 20);

                for (var _e95 = 1; _e95 < _t96; _e95++) {
                  var _r107 = _e95 / _t96;

                  if (.5 !== _r107) {
                    var _t97 = _r107 - .5;

                    _r107 += _r107 * _t97 * (_r107 - 1) * ((1.0904 + _g2 * (_g2 * (3.55645 - 1.43519 * _g2) - 3.2452)) * _t97 * _t97 + (.848013 + _g2 * (.215638 * _g2 - 1.06021)));
                  }

                  var _i82 = y.sub(f)._mult(_r107)._add(f)._unit()._mult(_2 ? -1 : 1);

                  this.addHalfVertex(h, _i82.x, _i82.y, !1, _2, 0, c);
                }
              }

              d && this.addCurrentVertex(h, y, -_e94, -_r106, c);
            } else if ("butt" === _k) this.addCurrentVertex(h, _m2, 0, 0, c);else if ("square" === _k) {
              var _t98 = p ? 1 : -1;

              this.addCurrentVertex(h, _m2, _t98, _t98, c);
            } else "round" === _k && (p && (this.addCurrentVertex(h, f, 0, 0, c), this.addCurrentVertex(h, f, 1, 1, c, !0)), d && (this.addCurrentVertex(h, y, -1, -1, c, !0), this.addCurrentVertex(h, y, 0, 0, c)));

            if (_w && _e92 < o - 1) {
              var _t99 = h.dist(d);

              if (_t99 > 2 * u) {
                var _e96 = h.add(d.sub(h)._mult(u / _t99)._round());

                this.updateDistance(h, _e96), this.addCurrentVertex(_e96, y, 0, 0, c), h = _e96;
              }
            }
          }
        }
      }, {
        key: "addCurrentVertex",
        value: function addCurrentVertex(t, e, r, i, n) {
          var s = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : !1;
          var a = e.y * i - e.x,
              o = -e.y - e.x * i;
          this.addHalfVertex(t, e.x + e.y * r, e.y - e.x * r, s, !1, r, n), this.addHalfVertex(t, a, o, s, !0, -i, n);
        }
      }, {
        key: "addHalfVertex",
        value: function addHalfVertex(_ref148, r, i, n, s, a, o) {
          var t = _ref148.x,
              e = _ref148.y;
          this.layoutVertexArray.emplaceBack((t << 1) + (n ? 1 : 0), (e << 1) + (s ? 1 : 0), Math.round(63 * r) + 128, Math.round(63 * i) + 128, 1 + (0 === a ? 0 : a < 0 ? -1 : 1), 0, this.lineSoFar), this.lineClips && this.layoutVertexArray2.emplaceBack(this.scaledDistance, this.lineClipsArray.length);
          var l = o.vertexLength++;
          this.e1 >= 0 && this.e2 >= 0 && (this.indexArray.emplaceBack(this.e1, this.e2, l), o.primitiveLength++), s ? this.e2 = l : this.e1 = l;
        }
      }, {
        key: "updateScaledDistance",
        value: function updateScaledDistance() {
          if (this.lineClips) {
            var _t100 = this.totalDistance / (this.lineClips.end - this.lineClips.start);

            this.scaledDistance = this.distance / this.totalDistance, this.lineSoFar = _t100 * this.lineClips.start + this.distance;
          } else this.lineSoFar = this.distance;
        }
      }, {
        key: "updateDistance",
        value: function updateDistance(t, e) {
          this.distance += t.dist(e), this.updateScaledDistance();
        }
      }]);

      return cl;
    }();

    ji("LineBucket", cl, {
      omit: ["layers", "patternFeatures"]
    });
    var hl = new En({
      "line-cap": new kn(Vt.layout_line["line-cap"]),
      "line-join": new Sn(Vt.layout_line["line-join"]),
      "line-miter-limit": new kn(Vt.layout_line["line-miter-limit"]),
      "line-round-limit": new kn(Vt.layout_line["line-round-limit"]),
      "line-sort-key": new Sn(Vt.layout_line["line-sort-key"])
    });
    var pl = {
      paint: new En({
        "line-opacity": new Sn(Vt.paint_line["line-opacity"]),
        "line-color": new Sn(Vt.paint_line["line-color"]),
        "line-translate": new kn(Vt.paint_line["line-translate"]),
        "line-translate-anchor": new kn(Vt.paint_line["line-translate-anchor"]),
        "line-width": new Sn(Vt.paint_line["line-width"]),
        "line-gap-width": new Sn(Vt.paint_line["line-gap-width"]),
        "line-offset": new Sn(Vt.paint_line["line-offset"]),
        "line-blur": new Sn(Vt.paint_line["line-blur"]),
        "line-dasharray": new Tn(Vt.paint_line["line-dasharray"]),
        "line-pattern": new In(Vt.paint_line["line-pattern"]),
        "line-gradient": new zn(Vt.paint_line["line-gradient"])
      }),
      layout: hl
    };
    var dl = new ( /*#__PURE__*/function (_Sn2) {
      _inherits(_class4, _Sn2);

      var _super44 = _createSuper(_class4);

      function _class4() {
        _classCallCheck(this, _class4);

        return _super44.apply(this, arguments);
      }

      _createClass(_class4, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e) {
          return e = new yn(Math.floor(e.zoom), {
            now: e.now,
            fadeDuration: e.fadeDuration,
            zoomHistory: e.zoomHistory,
            transition: e.transition
          }), _get(_getPrototypeOf(_class4.prototype), "possiblyEvaluate", this).call(this, t, e);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, i) {
          return e = g({}, e, {
            zoom: Math.floor(e.zoom)
          }), _get(_getPrototypeOf(_class4.prototype), "evaluate", this).call(this, t, e, r, i);
        }
      }]);

      return _class4;
    }(Sn))(pl.paint.properties["line-width"].specification);

    function fl(t, e) {
      return e > 0 ? e + 2 * t : t;
    }

    dl.useIntegerZoom = !0;
    var yl = Pn([{
      name: "a_pos_offset",
      components: 4,
      type: "Int16"
    }, {
      name: "a_data",
      components: 4,
      type: "Uint16"
    }, {
      name: "a_pixeloffset",
      components: 4,
      type: "Int16"
    }], 4),
        ml = Pn([{
      name: "a_projected_pos",
      components: 3,
      type: "Float32"
    }], 4),
        gl = (Pn([{
      name: "a_fade_opacity",
      components: 1,
      type: "Uint32"
    }], 4), Pn([{
      name: "a_placed",
      components: 2,
      type: "Uint8"
    }, {
      name: "a_shift",
      components: 2,
      type: "Float32"
    }])),
        xl = Pn([{
      name: "a_size_scale",
      components: 1,
      type: "Float32"
    }, {
      name: "a_padding",
      components: 2,
      type: "Float32"
    }]),
        vl = (Pn([{
      type: "Int16",
      name: "anchorPointX"
    }, {
      type: "Int16",
      name: "anchorPointY"
    }, {
      type: "Float32",
      name: "x1"
    }, {
      type: "Float32",
      name: "y1"
    }, {
      type: "Float32",
      name: "x2"
    }, {
      type: "Float32",
      name: "y2"
    }, {
      type: "Int16",
      name: "padding"
    }, {
      type: "Uint32",
      name: "featureIndex"
    }, {
      type: "Uint16",
      name: "sourceLayerIndex"
    }, {
      type: "Uint16",
      name: "bucketIndex"
    }]), Pn([{
      name: "a_pos",
      components: 2,
      type: "Int16"
    }, {
      name: "a_anchor_pos",
      components: 2,
      type: "Int16"
    }, {
      name: "a_extrude",
      components: 2,
      type: "Int16"
    }], 4)),
        bl = Pn([{
      name: "a_pos_2f",
      components: 2,
      type: "Float32"
    }, {
      name: "a_radius",
      components: 1,
      type: "Float32"
    }, {
      name: "a_flags",
      components: 2,
      type: "Int16"
    }], 4);

    function wl(t, e) {
      var r = e.expression;
      if ("constant" === r.kind) return {
        kind: "constant",
        layoutSize: r.evaluate(new yn(t + 1))
      };
      if ("source" === r.kind) return {
        kind: "source"
      };
      {
        var _e97 = r.zoomStops,
            _i83 = r.interpolationType;
        var _n58 = 0;

        for (; _n58 < _e97.length && _e97[_n58] <= t;) {
          _n58++;
        }

        _n58 = Math.max(0, _n58 - 1);
        var _s46 = _n58;

        for (; _s46 < _e97.length && _e97[_s46] < t + 1;) {
          _s46++;
        }

        _s46 = Math.min(_e97.length - 1, _s46);
        var _a47 = _e97[_n58],
            _o22 = _e97[_s46];
        return "composite" === r.kind ? {
          kind: "composite",
          minZoom: _a47,
          maxZoom: _o22,
          interpolationType: _i83
        } : {
          kind: "camera",
          minZoom: _a47,
          maxZoom: _o22,
          minSize: r.evaluate(new yn(_a47)),
          maxSize: r.evaluate(new yn(_o22)),
          interpolationType: _i83
        };
      }
    }

    function _l(t, _ref149, _ref150) {
      var e = _ref149.uSize,
          r = _ref149.uSizeT;
      var i = _ref150.lowerSize,
          n = _ref150.upperSize;
      return "source" === t.kind ? i / 128 : "composite" === t.kind ? Ye(i / 128, n / 128, r) : e;
    }

    function Al(t, e) {
      var r = 0,
          i = 0;
      if ("constant" === t.kind) i = t.layoutSize;else if ("source" !== t.kind) {
        var _n59 = t.interpolationType,
            _s47 = t.minZoom,
            _a48 = t.maxZoom,
            _o23 = _n59 ? f(pr.interpolationFactor(_n59, e, _s47, _a48), 0, 1) : 0;

        "camera" === t.kind ? i = Ye(t.minSize, t.maxSize, _o23) : r = _o23;
      }
      return {
        uSizeT: r,
        uSize: i
      };
    }

    Pn([{
      name: "triangle",
      components: 3,
      type: "Uint16"
    }]), Pn([{
      type: "Int16",
      name: "anchorX"
    }, {
      type: "Int16",
      name: "anchorY"
    }, {
      type: "Uint16",
      name: "glyphStartIndex"
    }, {
      type: "Uint16",
      name: "numGlyphs"
    }, {
      type: "Uint32",
      name: "vertexStartIndex"
    }, {
      type: "Uint32",
      name: "lineStartIndex"
    }, {
      type: "Uint32",
      name: "lineLength"
    }, {
      type: "Uint16",
      name: "segment"
    }, {
      type: "Uint16",
      name: "lowerSize"
    }, {
      type: "Uint16",
      name: "upperSize"
    }, {
      type: "Float32",
      name: "lineOffsetX"
    }, {
      type: "Float32",
      name: "lineOffsetY"
    }, {
      type: "Uint8",
      name: "writingMode"
    }, {
      type: "Uint8",
      name: "placedOrientation"
    }, {
      type: "Uint8",
      name: "hidden"
    }, {
      type: "Uint32",
      name: "crossTileID"
    }, {
      type: "Int16",
      name: "associatedIconIndex"
    }]), Pn([{
      type: "Int16",
      name: "anchorX"
    }, {
      type: "Int16",
      name: "anchorY"
    }, {
      type: "Int16",
      name: "rightJustifiedTextSymbolIndex"
    }, {
      type: "Int16",
      name: "centerJustifiedTextSymbolIndex"
    }, {
      type: "Int16",
      name: "leftJustifiedTextSymbolIndex"
    }, {
      type: "Int16",
      name: "verticalPlacedTextSymbolIndex"
    }, {
      type: "Int16",
      name: "placedIconSymbolIndex"
    }, {
      type: "Int16",
      name: "verticalPlacedIconSymbolIndex"
    }, {
      type: "Uint16",
      name: "key"
    }, {
      type: "Uint16",
      name: "textBoxStartIndex"
    }, {
      type: "Uint16",
      name: "textBoxEndIndex"
    }, {
      type: "Uint16",
      name: "verticalTextBoxStartIndex"
    }, {
      type: "Uint16",
      name: "verticalTextBoxEndIndex"
    }, {
      type: "Uint16",
      name: "iconBoxStartIndex"
    }, {
      type: "Uint16",
      name: "iconBoxEndIndex"
    }, {
      type: "Uint16",
      name: "verticalIconBoxStartIndex"
    }, {
      type: "Uint16",
      name: "verticalIconBoxEndIndex"
    }, {
      type: "Uint16",
      name: "featureIndex"
    }, {
      type: "Uint16",
      name: "numHorizontalGlyphVertices"
    }, {
      type: "Uint16",
      name: "numVerticalGlyphVertices"
    }, {
      type: "Uint16",
      name: "numIconVertices"
    }, {
      type: "Uint16",
      name: "numVerticalIconVertices"
    }, {
      type: "Uint16",
      name: "useRuntimeCollisionCircles"
    }, {
      type: "Uint32",
      name: "crossTileID"
    }, {
      type: "Float32",
      name: "textBoxScale"
    }, {
      type: "Float32",
      components: 2,
      name: "textOffset"
    }, {
      type: "Float32",
      name: "collisionCircleDiameter"
    }]), Pn([{
      type: "Float32",
      name: "offsetX"
    }]), Pn([{
      type: "Int16",
      name: "x"
    }, {
      type: "Int16",
      name: "y"
    }, {
      type: "Int16",
      name: "tileUnitDistanceFromAnchor"
    }]);
    var kl = Object.freeze({
      __proto__: null,
      getSizeData: wl,
      evaluateSizeForFeature: _l,
      evaluateSizeForZoom: Al,
      SIZE_PACK_FACTOR: 128
    });

    function Sl(t, e, r) {
      return t.sections.forEach(function (t) {
        t.text = function (t, e, r) {
          var i = e.layout.get("text-transform").evaluate(r, {});
          return "uppercase" === i ? t = t.toLocaleUpperCase() : "lowercase" === i && (t = t.toLocaleLowerCase()), fn.applyArabicShaping && (t = fn.applyArabicShaping(t)), t;
        }(t.text, e, r);
      }), t;
    }

    var Il = {
      "!": "ï¸•",
      "#": "ï¼ƒ",
      $: "ï¼„",
      "%": "ï¼…",
      "&": "ï¼†",
      "(": "ï¸µ",
      ")": "ï¸¶",
      "*": "ï¼Š",
      "+": "ï¼‹",
      ",": "ï¸",
      "-": "ï¸²",
      ".": "ãƒ»",
      "/": "ï¼",
      ":": "ï¸“",
      ";": "ï¸”",
      "<": "ï¸¿",
      "=": "ï¼",
      ">": "ï¹€",
      "?": "ï¸–",
      "@": "ï¼ ",
      "[": "ï¹‡",
      "\\": "ï¼¼",
      "]": "ï¹ˆ",
      "^": "ï¼¾",
      _: "ï¸³",
      "`": "ï½€",
      "{": "ï¸·",
      "|": "â€•",
      "}": "ï¸¸",
      "~": "ï½ž",
      "Â¢": "ï¿ ",
      "Â£": "ï¿¡",
      "Â¥": "ï¿¥",
      "Â¦": "ï¿¤",
      "Â¬": "ï¿¢",
      "Â¯": "ï¿£",
      "â€“": "ï¸²",
      "â€”": "ï¸±",
      "â€˜": "ï¹ƒ",
      "â€™": "ï¹„",
      "â€œ": "ï¹",
      "â€": "ï¹‚",
      "â€¦": "ï¸™",
      "â€§": "ãƒ»",
      "â‚©": "ï¿¦",
      "ã€": "ï¸‘",
      "ã€‚": "ï¸’",
      "ã€ˆ": "ï¸¿",
      "ã€‰": "ï¹€",
      "ã€Š": "ï¸½",
      "ã€‹": "ï¸¾",
      "ã€Œ": "ï¹",
      "ã€": "ï¹‚",
      "ã€Ž": "ï¹ƒ",
      "ã€": "ï¹„",
      "ã€": "ï¸»",
      "ã€‘": "ï¸¼",
      "ã€”": "ï¸¹",
      "ã€•": "ï¸º",
      "ã€–": "ï¸—",
      "ã€—": "ï¸˜",
      "ï¼": "ï¸•",
      "ï¼ˆ": "ï¸µ",
      "ï¼‰": "ï¸¶",
      "ï¼Œ": "ï¸",
      "ï¼": "ï¸²",
      "ï¼Ž": "ãƒ»",
      "ï¼š": "ï¸“",
      "ï¼›": "ï¸”",
      "ï¼œ": "ï¸¿",
      "ï¼ž": "ï¹€",
      "ï¼Ÿ": "ï¸–",
      "ï¼»": "ï¹‡",
      "ï¼½": "ï¹ˆ",
      "ï¼¿": "ï¸³",
      "ï½›": "ï¸·",
      "ï½œ": "â€•",
      "ï½": "ï¸¸",
      "ï½Ÿ": "ï¸µ",
      "ï½ ": "ï¸¶",
      "ï½¡": "ï¸’",
      "ï½¢": "ï¹",
      "ï½£": "ï¹‚"
    };

    var Tl = function Tl(t, e, r, i, n) {
      var s,
          a,
          o = 8 * n - i - 1,
          l = (1 << o) - 1,
          u = l >> 1,
          c = -7,
          h = r ? n - 1 : 0,
          p = r ? -1 : 1,
          d = t[e + h];

      for (h += p, s = d & (1 << -c) - 1, d >>= -c, c += o; c > 0; s = 256 * s + t[e + h], h += p, c -= 8) {
        ;
      }

      for (a = s & (1 << -c) - 1, s >>= -c, c += i; c > 0; a = 256 * a + t[e + h], h += p, c -= 8) {
        ;
      }

      if (0 === s) s = 1 - u;else {
        if (s === l) return a ? NaN : 1 / 0 * (d ? -1 : 1);
        a += Math.pow(2, i), s -= u;
      }
      return (d ? -1 : 1) * a * Math.pow(2, s - i);
    },
        zl = function zl(t, e, r, i, n, s) {
      var a,
          o,
          l,
          u = 8 * s - n - 1,
          c = (1 << u) - 1,
          h = c >> 1,
          p = 23 === n ? Math.pow(2, -24) - Math.pow(2, -77) : 0,
          d = i ? 0 : s - 1,
          f = i ? 1 : -1,
          y = e < 0 || 0 === e && 1 / e < 0 ? 1 : 0;

      for (e = Math.abs(e), isNaN(e) || e === 1 / 0 ? (o = isNaN(e) ? 1 : 0, a = c) : (a = Math.floor(Math.log(e) / Math.LN2), e * (l = Math.pow(2, -a)) < 1 && (a--, l *= 2), (e += a + h >= 1 ? p / l : p * Math.pow(2, 1 - h)) * l >= 2 && (a++, l /= 2), a + h >= c ? (o = 0, a = c) : a + h >= 1 ? (o = (e * l - 1) * Math.pow(2, n), a += h) : (o = e * Math.pow(2, h - 1) * Math.pow(2, n), a = 0)); n >= 8; t[r + d] = 255 & o, d += f, o /= 256, n -= 8) {
        ;
      }

      for (a = a << n | o, u += n; u > 0; t[r + d] = 255 & a, d += f, a /= 256, u -= 8) {
        ;
      }

      t[r + d - f] |= 128 * y;
    },
        El = Cl;

    function Cl(t) {
      this.buf = ArrayBuffer.isView && ArrayBuffer.isView(t) ? t : new Uint8Array(t || 0), this.pos = 0, this.type = 0, this.length = this.buf.length;
    }

    Cl.Varint = 0, Cl.Fixed64 = 1, Cl.Bytes = 2, Cl.Fixed32 = 5;
    var Ml = "undefined" == typeof TextDecoder ? null : new TextDecoder("utf8");

    function Bl(t) {
      return t.type === Cl.Bytes ? t.readVarint() + t.pos : t.pos + 1;
    }

    function Dl(t, e, r) {
      return r ? 4294967296 * e + (t >>> 0) : 4294967296 * (e >>> 0) + (t >>> 0);
    }

    function Pl(t, e, r) {
      var i = e <= 16383 ? 1 : e <= 2097151 ? 2 : e <= 268435455 ? 3 : Math.floor(Math.log(e) / (7 * Math.LN2));
      r.realloc(i);

      for (var n = r.pos - 1; n >= t; n--) {
        r.buf[n + i] = r.buf[n];
      }
    }

    function Vl(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeVarint(t[r]);
      }
    }

    function Fl(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeSVarint(t[r]);
      }
    }

    function Rl(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeFloat(t[r]);
      }
    }

    function Ll(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeDouble(t[r]);
      }
    }

    function Ul(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeBoolean(t[r]);
      }
    }

    function Ol(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeFixed32(t[r]);
      }
    }

    function $l(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeSFixed32(t[r]);
      }
    }

    function ql(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeFixed64(t[r]);
      }
    }

    function Nl(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeSFixed64(t[r]);
      }
    }

    function jl(t, e) {
      return (t[e] | t[e + 1] << 8 | t[e + 2] << 16) + 16777216 * t[e + 3];
    }

    function Kl(t, e, r) {
      t[r] = e, t[r + 1] = e >>> 8, t[r + 2] = e >>> 16, t[r + 3] = e >>> 24;
    }

    function Zl(t, e) {
      return (t[e] | t[e + 1] << 8 | t[e + 2] << 16) + (t[e + 3] << 24);
    }

    function Xl(t, e, r) {
      1 === t && r.readMessage(Gl, e);
    }

    function Gl(t, e, r) {
      if (3 === t) {
        var _r$readMessage = r.readMessage(Hl, {}),
            _t101 = _r$readMessage.id,
            _i84 = _r$readMessage.bitmap,
            _n60 = _r$readMessage.width,
            _s48 = _r$readMessage.height,
            _a49 = _r$readMessage.left,
            _o24 = _r$readMessage.top,
            _l19 = _r$readMessage.advance;

        e.push({
          id: _t101,
          bitmap: new Ka({
            width: _n60 + 6,
            height: _s48 + 6
          }, _i84),
          metrics: {
            width: _n60,
            height: _s48,
            left: _a49,
            top: _o24,
            advance: _l19
          }
        });
      }
    }

    function Hl(t, e, r) {
      1 === t ? e.id = r.readVarint() : 2 === t ? e.bitmap = r.readBytes() : 3 === t ? e.width = r.readVarint() : 4 === t ? e.height = r.readVarint() : 5 === t ? e.left = r.readSVarint() : 6 === t ? e.top = r.readSVarint() : 7 === t && (e.advance = r.readVarint());
    }

    function Jl(t) {
      var e = 0,
          r = 0;

      var _iterator76 = _createForOfIteratorHelper(t),
          _step76;

      try {
        for (_iterator76.s(); !(_step76 = _iterator76.n()).done;) {
          var _i85 = _step76.value;
          e += _i85.w * _i85.h, r = Math.max(r, _i85.w);
        }
      } catch (err) {
        _iterator76.e(err);
      } finally {
        _iterator76.f();
      }

      t.sort(function (t, e) {
        return e.h - t.h;
      });
      var i = [{
        x: 0,
        y: 0,
        w: Math.max(Math.ceil(Math.sqrt(e / .95)), r),
        h: 1 / 0
      }];
      var n = 0,
          s = 0;

      var _iterator77 = _createForOfIteratorHelper(t),
          _step77;

      try {
        for (_iterator77.s(); !(_step77 = _iterator77.n()).done;) {
          var _e98 = _step77.value;

          for (var _t102 = i.length - 1; _t102 >= 0; _t102--) {
            var _r108 = i[_t102];

            if (!(_e98.w > _r108.w || _e98.h > _r108.h)) {
              if (_e98.x = _r108.x, _e98.y = _r108.y, s = Math.max(s, _e98.y + _e98.h), n = Math.max(n, _e98.x + _e98.w), _e98.w === _r108.w && _e98.h === _r108.h) {
                var _e99 = i.pop();

                _t102 < i.length && (i[_t102] = _e99);
              } else _e98.h === _r108.h ? (_r108.x += _e98.w, _r108.w -= _e98.w) : _e98.w === _r108.w ? (_r108.y += _e98.h, _r108.h -= _e98.h) : (i.push({
                x: _r108.x + _e98.w,
                y: _r108.y,
                w: _r108.w - _e98.w,
                h: _e98.h
              }), _r108.y += _e98.h, _r108.h -= _e98.h);

              break;
            }
          }
        }
      } catch (err) {
        _iterator77.e(err);
      } finally {
        _iterator77.f();
      }

      return {
        w: n,
        h: s,
        fill: e / (n * s) || 0
      };
    }

    Cl.prototype = {
      destroy: function destroy() {
        this.buf = null;
      },
      readFields: function readFields(t, e, r) {
        for (r = r || this.length; this.pos < r;) {
          var i = this.readVarint(),
              n = i >> 3,
              s = this.pos;
          this.type = 7 & i, t(n, e, this), this.pos === s && this.skip(i);
        }

        return e;
      },
      readMessage: function readMessage(t, e) {
        return this.readFields(t, e, this.readVarint() + this.pos);
      },
      readFixed32: function readFixed32() {
        var t = jl(this.buf, this.pos);
        return this.pos += 4, t;
      },
      readSFixed32: function readSFixed32() {
        var t = Zl(this.buf, this.pos);
        return this.pos += 4, t;
      },
      readFixed64: function readFixed64() {
        var t = jl(this.buf, this.pos) + 4294967296 * jl(this.buf, this.pos + 4);
        return this.pos += 8, t;
      },
      readSFixed64: function readSFixed64() {
        var t = jl(this.buf, this.pos) + 4294967296 * Zl(this.buf, this.pos + 4);
        return this.pos += 8, t;
      },
      readFloat: function readFloat() {
        var t = Tl(this.buf, this.pos, !0, 23, 4);
        return this.pos += 4, t;
      },
      readDouble: function readDouble() {
        var t = Tl(this.buf, this.pos, !0, 52, 8);
        return this.pos += 8, t;
      },
      readVarint: function readVarint(t) {
        var e,
            r,
            i = this.buf;
        return e = 127 & (r = i[this.pos++]), r < 128 ? e : (e |= (127 & (r = i[this.pos++])) << 7, r < 128 ? e : (e |= (127 & (r = i[this.pos++])) << 14, r < 128 ? e : (e |= (127 & (r = i[this.pos++])) << 21, r < 128 ? e : function (t, e, r) {
          var i,
              n,
              s = r.buf;
          if (i = (112 & (n = s[r.pos++])) >> 4, n < 128) return Dl(t, i, e);
          if (i |= (127 & (n = s[r.pos++])) << 3, n < 128) return Dl(t, i, e);
          if (i |= (127 & (n = s[r.pos++])) << 10, n < 128) return Dl(t, i, e);
          if (i |= (127 & (n = s[r.pos++])) << 17, n < 128) return Dl(t, i, e);
          if (i |= (127 & (n = s[r.pos++])) << 24, n < 128) return Dl(t, i, e);
          if (i |= (1 & (n = s[r.pos++])) << 31, n < 128) return Dl(t, i, e);
          throw new Error("Expected varint not more than 10 bytes");
        }(e |= (15 & (r = i[this.pos])) << 28, t, this))));
      },
      readVarint64: function readVarint64() {
        return this.readVarint(!0);
      },
      readSVarint: function readSVarint() {
        var t = this.readVarint();
        return t % 2 == 1 ? (t + 1) / -2 : t / 2;
      },
      readBoolean: function readBoolean() {
        return Boolean(this.readVarint());
      },
      readString: function readString() {
        var t = this.readVarint() + this.pos,
            e = this.pos;
        return this.pos = t, t - e >= 12 && Ml ? function (t, e, r) {
          return Ml.decode(t.subarray(e, r));
        }(this.buf, e, t) : function (t, e, r) {
          for (var i = "", n = e; n < r;) {
            var s,
                a,
                o,
                l = t[n],
                u = null,
                c = l > 239 ? 4 : l > 223 ? 3 : l > 191 ? 2 : 1;
            if (n + c > r) break;
            1 === c ? l < 128 && (u = l) : 2 === c ? 128 == (192 & (s = t[n + 1])) && (u = (31 & l) << 6 | 63 & s) <= 127 && (u = null) : 3 === c ? (a = t[n + 2], 128 == (192 & (s = t[n + 1])) && 128 == (192 & a) && ((u = (15 & l) << 12 | (63 & s) << 6 | 63 & a) <= 2047 || u >= 55296 && u <= 57343) && (u = null)) : 4 === c && (a = t[n + 2], o = t[n + 3], 128 == (192 & (s = t[n + 1])) && 128 == (192 & a) && 128 == (192 & o) && ((u = (15 & l) << 18 | (63 & s) << 12 | (63 & a) << 6 | 63 & o) <= 65535 || u >= 1114112) && (u = null)), null === u ? (u = 65533, c = 1) : u > 65535 && (u -= 65536, i += String.fromCharCode(u >>> 10 & 1023 | 55296), u = 56320 | 1023 & u), i += String.fromCharCode(u), n += c;
          }

          return i;
        }(this.buf, e, t);
      },
      readBytes: function readBytes() {
        var t = this.readVarint() + this.pos,
            e = this.buf.subarray(this.pos, t);
        return this.pos = t, e;
      },
      readPackedVarint: function readPackedVarint(t, e) {
        if (this.type !== Cl.Bytes) return t.push(this.readVarint(e));
        var r = Bl(this);

        for (t = t || []; this.pos < r;) {
          t.push(this.readVarint(e));
        }

        return t;
      },
      readPackedSVarint: function readPackedSVarint(t) {
        if (this.type !== Cl.Bytes) return t.push(this.readSVarint());
        var e = Bl(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readSVarint());
        }

        return t;
      },
      readPackedBoolean: function readPackedBoolean(t) {
        if (this.type !== Cl.Bytes) return t.push(this.readBoolean());
        var e = Bl(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readBoolean());
        }

        return t;
      },
      readPackedFloat: function readPackedFloat(t) {
        if (this.type !== Cl.Bytes) return t.push(this.readFloat());
        var e = Bl(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readFloat());
        }

        return t;
      },
      readPackedDouble: function readPackedDouble(t) {
        if (this.type !== Cl.Bytes) return t.push(this.readDouble());
        var e = Bl(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readDouble());
        }

        return t;
      },
      readPackedFixed32: function readPackedFixed32(t) {
        if (this.type !== Cl.Bytes) return t.push(this.readFixed32());
        var e = Bl(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readFixed32());
        }

        return t;
      },
      readPackedSFixed32: function readPackedSFixed32(t) {
        if (this.type !== Cl.Bytes) return t.push(this.readSFixed32());
        var e = Bl(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readSFixed32());
        }

        return t;
      },
      readPackedFixed64: function readPackedFixed64(t) {
        if (this.type !== Cl.Bytes) return t.push(this.readFixed64());
        var e = Bl(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readFixed64());
        }

        return t;
      },
      readPackedSFixed64: function readPackedSFixed64(t) {
        if (this.type !== Cl.Bytes) return t.push(this.readSFixed64());
        var e = Bl(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readSFixed64());
        }

        return t;
      },
      skip: function skip(t) {
        var e = 7 & t;
        if (e === Cl.Varint) for (; this.buf[this.pos++] > 127;) {
          ;
        } else if (e === Cl.Bytes) this.pos = this.readVarint() + this.pos;else if (e === Cl.Fixed32) this.pos += 4;else {
          if (e !== Cl.Fixed64) throw new Error("Unimplemented type: " + e);
          this.pos += 8;
        }
      },
      writeTag: function writeTag(t, e) {
        this.writeVarint(t << 3 | e);
      },
      realloc: function realloc(t) {
        for (var e = this.length || 16; e < this.pos + t;) {
          e *= 2;
        }

        if (e !== this.length) {
          var r = new Uint8Array(e);
          r.set(this.buf), this.buf = r, this.length = e;
        }
      },
      finish: function finish() {
        return this.length = this.pos, this.pos = 0, this.buf.subarray(0, this.length);
      },
      writeFixed32: function writeFixed32(t) {
        this.realloc(4), Kl(this.buf, t, this.pos), this.pos += 4;
      },
      writeSFixed32: function writeSFixed32(t) {
        this.realloc(4), Kl(this.buf, t, this.pos), this.pos += 4;
      },
      writeFixed64: function writeFixed64(t) {
        this.realloc(8), Kl(this.buf, -1 & t, this.pos), Kl(this.buf, Math.floor(t * (1 / 4294967296)), this.pos + 4), this.pos += 8;
      },
      writeSFixed64: function writeSFixed64(t) {
        this.realloc(8), Kl(this.buf, -1 & t, this.pos), Kl(this.buf, Math.floor(t * (1 / 4294967296)), this.pos + 4), this.pos += 8;
      },
      writeVarint: function writeVarint(t) {
        (t = +t || 0) > 268435455 || t < 0 ? function (t, e) {
          var r, i;
          if (t >= 0 ? (r = t % 4294967296 | 0, i = t / 4294967296 | 0) : (i = ~(-t / 4294967296), 4294967295 ^ (r = ~(-t % 4294967296)) ? r = r + 1 | 0 : (r = 0, i = i + 1 | 0)), t >= 0x10000000000000000 || t < -0x10000000000000000) throw new Error("Given varint doesn't fit into 10 bytes");
          e.realloc(10), function (t, e, r) {
            r.buf[r.pos++] = 127 & t | 128, t >>>= 7, r.buf[r.pos++] = 127 & t | 128, t >>>= 7, r.buf[r.pos++] = 127 & t | 128, t >>>= 7, r.buf[r.pos++] = 127 & t | 128, r.buf[r.pos] = 127 & (t >>>= 7);
          }(r, 0, e), function (t, e) {
            var r = (7 & t) << 4;
            e.buf[e.pos++] |= r | ((t >>>= 3) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t | ((t >>>= 7) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t | ((t >>>= 7) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t | ((t >>>= 7) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t | ((t >>>= 7) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t)))));
          }(i, e);
        }(t, this) : (this.realloc(4), this.buf[this.pos++] = 127 & t | (t > 127 ? 128 : 0), t <= 127 || (this.buf[this.pos++] = 127 & (t >>>= 7) | (t > 127 ? 128 : 0), t <= 127 || (this.buf[this.pos++] = 127 & (t >>>= 7) | (t > 127 ? 128 : 0), t <= 127 || (this.buf[this.pos++] = t >>> 7 & 127))));
      },
      writeSVarint: function writeSVarint(t) {
        this.writeVarint(t < 0 ? 2 * -t - 1 : 2 * t);
      },
      writeBoolean: function writeBoolean(t) {
        this.writeVarint(Boolean(t));
      },
      writeString: function writeString(t) {
        t = String(t), this.realloc(4 * t.length), this.pos++;
        var e = this.pos;

        this.pos = function (t, e, r) {
          for (var i, n, s = 0; s < e.length; s++) {
            if ((i = e.charCodeAt(s)) > 55295 && i < 57344) {
              if (!n) {
                i > 56319 || s + 1 === e.length ? (t[r++] = 239, t[r++] = 191, t[r++] = 189) : n = i;
                continue;
              }

              if (i < 56320) {
                t[r++] = 239, t[r++] = 191, t[r++] = 189, n = i;
                continue;
              }

              i = n - 55296 << 10 | i - 56320 | 65536, n = null;
            } else n && (t[r++] = 239, t[r++] = 191, t[r++] = 189, n = null);

            i < 128 ? t[r++] = i : (i < 2048 ? t[r++] = i >> 6 | 192 : (i < 65536 ? t[r++] = i >> 12 | 224 : (t[r++] = i >> 18 | 240, t[r++] = i >> 12 & 63 | 128), t[r++] = i >> 6 & 63 | 128), t[r++] = 63 & i | 128);
          }

          return r;
        }(this.buf, t, this.pos);

        var r = this.pos - e;
        r >= 128 && Pl(e, r, this), this.pos = e - 1, this.writeVarint(r), this.pos += r;
      },
      writeFloat: function writeFloat(t) {
        this.realloc(4), zl(this.buf, t, this.pos, !0, 23, 4), this.pos += 4;
      },
      writeDouble: function writeDouble(t) {
        this.realloc(8), zl(this.buf, t, this.pos, !0, 52, 8), this.pos += 8;
      },
      writeBytes: function writeBytes(t) {
        var e = t.length;
        this.writeVarint(e), this.realloc(e);

        for (var r = 0; r < e; r++) {
          this.buf[this.pos++] = t[r];
        }
      },
      writeRawMessage: function writeRawMessage(t, e) {
        this.pos++;
        var r = this.pos;
        t(e, this);
        var i = this.pos - r;
        i >= 128 && Pl(r, i, this), this.pos = r - 1, this.writeVarint(i), this.pos += i;
      },
      writeMessage: function writeMessage(t, e, r) {
        this.writeTag(t, Cl.Bytes), this.writeRawMessage(e, r);
      },
      writePackedVarint: function writePackedVarint(t, e) {
        e.length && this.writeMessage(t, Vl, e);
      },
      writePackedSVarint: function writePackedSVarint(t, e) {
        e.length && this.writeMessage(t, Fl, e);
      },
      writePackedBoolean: function writePackedBoolean(t, e) {
        e.length && this.writeMessage(t, Ul, e);
      },
      writePackedFloat: function writePackedFloat(t, e) {
        e.length && this.writeMessage(t, Rl, e);
      },
      writePackedDouble: function writePackedDouble(t, e) {
        e.length && this.writeMessage(t, Ll, e);
      },
      writePackedFixed32: function writePackedFixed32(t, e) {
        e.length && this.writeMessage(t, Ol, e);
      },
      writePackedSFixed32: function writePackedSFixed32(t, e) {
        e.length && this.writeMessage(t, $l, e);
      },
      writePackedFixed64: function writePackedFixed64(t, e) {
        e.length && this.writeMessage(t, ql, e);
      },
      writePackedSFixed64: function writePackedSFixed64(t, e) {
        e.length && this.writeMessage(t, Nl, e);
      },
      writeBytesField: function writeBytesField(t, e) {
        this.writeTag(t, Cl.Bytes), this.writeBytes(e);
      },
      writeFixed32Field: function writeFixed32Field(t, e) {
        this.writeTag(t, Cl.Fixed32), this.writeFixed32(e);
      },
      writeSFixed32Field: function writeSFixed32Field(t, e) {
        this.writeTag(t, Cl.Fixed32), this.writeSFixed32(e);
      },
      writeFixed64Field: function writeFixed64Field(t, e) {
        this.writeTag(t, Cl.Fixed64), this.writeFixed64(e);
      },
      writeSFixed64Field: function writeSFixed64Field(t, e) {
        this.writeTag(t, Cl.Fixed64), this.writeSFixed64(e);
      },
      writeVarintField: function writeVarintField(t, e) {
        this.writeTag(t, Cl.Varint), this.writeVarint(e);
      },
      writeSVarintField: function writeSVarintField(t, e) {
        this.writeTag(t, Cl.Varint), this.writeSVarint(e);
      },
      writeStringField: function writeStringField(t, e) {
        this.writeTag(t, Cl.Bytes), this.writeString(e);
      },
      writeFloatField: function writeFloatField(t, e) {
        this.writeTag(t, Cl.Fixed32), this.writeFloat(e);
      },
      writeDoubleField: function writeDoubleField(t, e) {
        this.writeTag(t, Cl.Fixed64), this.writeDouble(e);
      },
      writeBooleanField: function writeBooleanField(t, e) {
        this.writeVarintField(t, Boolean(e));
      }
    };

    var Yl = /*#__PURE__*/function () {
      function Yl(t, _ref151) {
        var e = _ref151.pixelRatio,
            r = _ref151.version,
            i = _ref151.stretchX,
            n = _ref151.stretchY,
            s = _ref151.content;

        _classCallCheck(this, Yl);

        this.paddedRect = t, this.pixelRatio = e, this.stretchX = i, this.stretchY = n, this.content = s, this.version = r;
      }

      _createClass(Yl, [{
        key: "tl",
        get: function get() {
          return [this.paddedRect.x + 1, this.paddedRect.y + 1];
        }
      }, {
        key: "br",
        get: function get() {
          return [this.paddedRect.x + this.paddedRect.w - 1, this.paddedRect.y + this.paddedRect.h - 1];
        }
      }, {
        key: "tlbr",
        get: function get() {
          return this.tl.concat(this.br);
        }
      }, {
        key: "displaySize",
        get: function get() {
          return [(this.paddedRect.w - 2) / this.pixelRatio, (this.paddedRect.h - 2) / this.pixelRatio];
        }
      }]);

      return Yl;
    }();

    var Wl = /*#__PURE__*/function () {
      function Wl(t, e) {
        _classCallCheck(this, Wl);

        var r = {},
            i = {};
        this.haveRenderCallbacks = [];
        var n = [];
        this.addImages(t, r, n), this.addImages(e, i, n);

        var _Jl = Jl(n),
            s = _Jl.w,
            a = _Jl.h,
            o = new Za({
          width: s || 1,
          height: a || 1
        });

        for (var _e100 in t) {
          var _i86 = t[_e100],
              _n61 = r[_e100].paddedRect;
          Za.copy(_i86.data, o, {
            x: 0,
            y: 0
          }, {
            x: _n61.x + 1,
            y: _n61.y + 1
          }, _i86.data);
        }

        for (var _t103 in e) {
          var _r109 = e[_t103],
              _n62 = i[_t103].paddedRect,
              _s49 = _n62.x + 1,
              _a50 = _n62.y + 1,
              _l20 = _r109.data.width,
              _u17 = _r109.data.height;

          Za.copy(_r109.data, o, {
            x: 0,
            y: 0
          }, {
            x: _s49,
            y: _a50
          }, _r109.data), Za.copy(_r109.data, o, {
            x: 0,
            y: _u17 - 1
          }, {
            x: _s49,
            y: _a50 - 1
          }, {
            width: _l20,
            height: 1
          }), Za.copy(_r109.data, o, {
            x: 0,
            y: 0
          }, {
            x: _s49,
            y: _a50 + _u17
          }, {
            width: _l20,
            height: 1
          }), Za.copy(_r109.data, o, {
            x: _l20 - 1,
            y: 0
          }, {
            x: _s49 - 1,
            y: _a50
          }, {
            width: 1,
            height: _u17
          }), Za.copy(_r109.data, o, {
            x: 0,
            y: 0
          }, {
            x: _s49 + _l20,
            y: _a50
          }, {
            width: 1,
            height: _u17
          });
        }

        this.image = o, this.iconPositions = r, this.patternPositions = i;
      }

      _createClass(Wl, [{
        key: "addImages",
        value: function addImages(t, e, r) {
          for (var _i87 in t) {
            var _n63 = t[_i87],
                _s50 = {
              x: 0,
              y: 0,
              w: _n63.data.width + 2,
              h: _n63.data.height + 2
            };
            r.push(_s50), e[_i87] = new Yl(_s50, _n63), _n63.hasRenderCallback && this.haveRenderCallbacks.push(_i87);
          }
        }
      }, {
        key: "patchUpdatedImages",
        value: function patchUpdatedImages(t, e) {
          t.dispatchRenderCallbacks(this.haveRenderCallbacks);

          for (var _r110 in t.updatedImages) {
            this.patchUpdatedImage(this.iconPositions[_r110], t.getImage(_r110), e), this.patchUpdatedImage(this.patternPositions[_r110], t.getImage(_r110), e);
          }
        }
      }, {
        key: "patchUpdatedImage",
        value: function patchUpdatedImage(t, e, r) {
          if (!t || !e) return;
          if (t.version === e.version) return;
          t.version = e.version;

          var _t$tl = _slicedToArray(t.tl, 2),
              i = _t$tl[0],
              n = _t$tl[1];

          r.update(e.data, void 0, {
            x: i,
            y: n
          });
        }
      }]);

      return Wl;
    }();

    ji("ImagePosition", Yl), ji("ImageAtlas", Wl);
    var Ql = {
      horizontal: 1,
      vertical: 2,
      horizontalOnly: 3
    };

    var tu = /*#__PURE__*/function () {
      function tu() {
        _classCallCheck(this, tu);

        this.scale = 1, this.fontStack = "", this.imageName = null;
      }

      _createClass(tu, null, [{
        key: "forText",
        value: function forText(t, e) {
          var r = new tu();
          return r.scale = t || 1, r.fontStack = e, r;
        }
      }, {
        key: "forImage",
        value: function forImage(t) {
          var e = new tu();
          return e.imageName = t, e;
        }
      }]);

      return tu;
    }();

    var eu = /*#__PURE__*/function () {
      function eu() {
        _classCallCheck(this, eu);

        this.text = "", this.sectionIndex = [], this.sections = [], this.imageSectionID = null;
      }

      _createClass(eu, [{
        key: "length",
        value: function length() {
          return this.text.length;
        }
      }, {
        key: "getSection",
        value: function getSection(t) {
          return this.sections[this.sectionIndex[t]];
        }
      }, {
        key: "getSectionIndex",
        value: function getSectionIndex(t) {
          return this.sectionIndex[t];
        }
      }, {
        key: "getCharCode",
        value: function getCharCode(t) {
          return this.text.charCodeAt(t);
        }
      }, {
        key: "verticalizePunctuation",
        value: function verticalizePunctuation() {
          this.text = function (t) {
            var e = "";

            for (var _r111 = 0; _r111 < t.length; _r111++) {
              var _i88 = t.charCodeAt(_r111 + 1) || null,
                  _n64 = t.charCodeAt(_r111 - 1) || null;

              e += _i88 && en(_i88) && !Il[t[_r111 + 1]] || _n64 && en(_n64) && !Il[t[_r111 - 1]] || !Il[t[_r111]] ? t[_r111] : Il[t[_r111]];
            }

            return e;
          }(this.text);
        }
      }, {
        key: "trim",
        value: function trim() {
          var t = 0;

          for (var _e101 = 0; _e101 < this.text.length && iu[this.text.charCodeAt(_e101)]; _e101++) {
            t++;
          }

          var e = this.text.length;

          for (var _r112 = this.text.length - 1; _r112 >= 0 && _r112 >= t && iu[this.text.charCodeAt(_r112)]; _r112--) {
            e--;
          }

          this.text = this.text.substring(t, e), this.sectionIndex = this.sectionIndex.slice(t, e);
        }
      }, {
        key: "substring",
        value: function substring(t, e) {
          var r = new eu();
          return r.text = this.text.substring(t, e), r.sectionIndex = this.sectionIndex.slice(t, e), r.sections = this.sections, r;
        }
      }, {
        key: "toString",
        value: function toString() {
          return this.text;
        }
      }, {
        key: "getMaxScale",
        value: function getMaxScale() {
          var _this18 = this;

          return this.sectionIndex.reduce(function (t, e) {
            return Math.max(t, _this18.sections[e].scale);
          }, 0);
        }
      }, {
        key: "addTextSection",
        value: function addTextSection(t, e) {
          this.text += t.text, this.sections.push(tu.forText(t.scale, t.fontStack || e));
          var r = this.sections.length - 1;

          for (var _e102 = 0; _e102 < t.text.length; ++_e102) {
            this.sectionIndex.push(r);
          }
        }
      }, {
        key: "addImageSection",
        value: function addImageSection(t) {
          var e = t.image ? t.image.name : "";
          if (0 === e.length) return void z("Can't add FormattedSection with an empty image.");
          var r = this.getNextImageSectionCharCode();
          r ? (this.text += String.fromCharCode(r), this.sections.push(tu.forImage(e)), this.sectionIndex.push(this.sections.length - 1)) : z("Reached maximum number of images 6401");
        }
      }, {
        key: "getNextImageSectionCharCode",
        value: function getNextImageSectionCharCode() {
          return this.imageSectionID ? this.imageSectionID >= 63743 ? null : ++this.imageSectionID : (this.imageSectionID = 57344, this.imageSectionID);
        }
      }], [{
        key: "fromFeature",
        value: function fromFeature(t, e) {
          var r = new eu();

          for (var _i89 = 0; _i89 < t.sections.length; _i89++) {
            var _n65 = t.sections[_i89];
            _n65.image ? r.addImageSection(_n65) : r.addTextSection(_n65, e);
          }

          return r;
        }
      }]);

      return eu;
    }();

    function ru(t, e, r, i, n, s, a, o, l, u, c, h, p, d, f, y) {
      var m = eu.fromFeature(t, n);
      var g;
      h === Ql.vertical && m.verticalizePunctuation();
      var x = fn.processBidirectionalText,
          v = fn.processStyledBidirectionalText;

      if (x && 1 === m.sections.length) {
        g = [];

        var _t104 = x(m.toString(), uu(m, u, s, e, i, d, f));

        var _iterator78 = _createForOfIteratorHelper(_t104),
            _step78;

        try {
          for (_iterator78.s(); !(_step78 = _iterator78.n()).done;) {
            var _e103 = _step78.value;

            var _t105 = new eu();

            _t105.text = _e103, _t105.sections = m.sections;

            for (var _r113 = 0; _r113 < _e103.length; _r113++) {
              _t105.sectionIndex.push(0);
            }

            g.push(_t105);
          }
        } catch (err) {
          _iterator78.e(err);
        } finally {
          _iterator78.f();
        }
      } else if (v) {
        g = [];

        var _t106 = v(m.text, m.sectionIndex, uu(m, u, s, e, i, d, f));

        var _iterator79 = _createForOfIteratorHelper(_t106),
            _step79;

        try {
          for (_iterator79.s(); !(_step79 = _iterator79.n()).done;) {
            var _e104 = _step79.value;

            var _t107 = new eu();

            _t107.text = _e104[0], _t107.sectionIndex = _e104[1], _t107.sections = m.sections, g.push(_t107);
          }
        } catch (err) {
          _iterator79.e(err);
        } finally {
          _iterator79.f();
        }
      } else g = function (t, e) {
        var r = [],
            i = t.text;
        var n = 0;

        var _iterator80 = _createForOfIteratorHelper(e),
            _step80;

        try {
          for (_iterator80.s(); !(_step80 = _iterator80.n()).done;) {
            var _i90 = _step80.value;
            r.push(t.substring(n, _i90)), n = _i90;
          }
        } catch (err) {
          _iterator80.e(err);
        } finally {
          _iterator80.f();
        }

        return n < i.length && r.push(t.substring(n, i.length)), r;
      }(m, uu(m, u, s, e, i, d, f));

      var b = [],
          w = {
        positionedLines: b,
        text: m.toString(),
        top: c[1],
        bottom: c[1],
        left: c[0],
        right: c[0],
        writingMode: h,
        iconsInText: !1,
        verticalizable: !1
      };
      return function (t, e, r, i, n, s, a, o, l, u, c, h) {
        var p = 0,
            d = -17,
            f = 0,
            y = 0;
        var m = "right" === o ? 1 : "left" === o ? 0 : .5;
        var g = 0;

        var _iterator81 = _createForOfIteratorHelper(n),
            _step81;

        try {
          for (_iterator81.s(); !(_step81 = _iterator81.n()).done;) {
            var _a51 = _step81.value;

            _a51.trim();

            var _n66 = _a51.getMaxScale(),
                _o25 = 24 * (_n66 - 1),
                _v2 = {
              positionedGlyphs: [],
              lineOffset: 0
            };

            t.positionedLines[g] = _v2;
            var _b2 = _v2.positionedGlyphs;
            var _w2 = 0;

            if (!_a51.length()) {
              d += s, ++g;
              continue;
            }

            for (var _s51 = 0; _s51 < _a51.length(); _s51++) {
              var _f2 = _a51.getSection(_s51),
                  _y2 = _a51.getSectionIndex(_s51),
                  _m3 = _a51.getCharCode(_s51);

              var _g3 = 0,
                  _v3 = null,
                  _4 = null,
                  _A2 = null,
                  _k2 = 24;

              var _S = !(l === Ql.horizontal || !c && !tn(_m3) || c && (iu[_m3] || (x = _m3, Ji.Arabic(x) || Ji["Arabic Supplement"](x) || Ji["Arabic Extended-A"](x) || Ji["Arabic Presentation Forms-A"](x) || Ji["Arabic Presentation Forms-B"](x))));

              if (_f2.imageName) {
                var _e106 = i[_f2.imageName];
                if (!_e106) continue;
                _A2 = _f2.imageName, t.iconsInText = t.iconsInText || !0, _4 = _e106.paddedRect;
                var _r114 = _e106.displaySize;
                _f2.scale = 24 * _f2.scale / h, _v3 = {
                  width: _r114[0],
                  height: _r114[1],
                  left: 1,
                  top: -3,
                  advance: _S ? _r114[1] : _r114[0]
                }, _g3 = _o25 + (24 - _r114[1] * _f2.scale), _k2 = _v3.advance;

                var _s52 = _S ? _r114[0] * _f2.scale - 24 * _n66 : _r114[1] * _f2.scale - 24 * _n66;

                _s52 > 0 && _s52 > _w2 && (_w2 = _s52);
              } else {
                var _t109 = r[_f2.fontStack],
                    _i91 = _t109 && _t109[_m3];

                if (_i91 && _i91.rect) _4 = _i91.rect, _v3 = _i91.metrics;else {
                  var _t110 = e[_f2.fontStack],
                      _r115 = _t110 && _t110[_m3];

                  if (!_r115) continue;
                  _v3 = _r115.metrics;
                }
                _g3 = 24 * (_n66 - _f2.scale);
              }

              _S ? (t.verticalizable = !0, _b2.push({
                glyph: _m3,
                imageName: _A2,
                x: p,
                y: d + _g3,
                vertical: _S,
                scale: _f2.scale,
                fontStack: _f2.fontStack,
                sectionIndex: _y2,
                metrics: _v3,
                rect: _4
              }), p += _k2 * _f2.scale + u) : (_b2.push({
                glyph: _m3,
                imageName: _A2,
                x: p,
                y: d + _g3,
                vertical: _S,
                scale: _f2.scale,
                fontStack: _f2.fontStack,
                sectionIndex: _y2,
                metrics: _v3,
                rect: _4
              }), p += _v3.advance * _f2.scale + u);
            }

            0 !== _b2.length && (f = Math.max(p - u, f), hu(_b2, 0, _b2.length - 1, m, _w2)), p = 0;

            var _3 = s * _n66 + _w2;

            _v2.lineOffset = Math.max(_w2, _o25), d += _3, y = Math.max(_3, y), ++g;
          }
        } catch (err) {
          _iterator81.e(err);
        } finally {
          _iterator81.f();
        }

        var x;

        var v = d - -17,
            _cu = cu(a),
            b = _cu.horizontalAlign,
            w = _cu.verticalAlign;

        (function (t, e, r, i, n, s, a, o, l) {
          var u = (e - r) * n;
          var c = 0;
          c = s !== a ? -o * i - -17 : (-i * l + .5) * a;

          var _iterator82 = _createForOfIteratorHelper(t),
              _step82;

          try {
            for (_iterator82.s(); !(_step82 = _iterator82.n()).done;) {
              var _e105 = _step82.value;

              var _iterator83 = _createForOfIteratorHelper(_e105.positionedGlyphs),
                  _step83;

              try {
                for (_iterator83.s(); !(_step83 = _iterator83.n()).done;) {
                  var _t108 = _step83.value;
                  _t108.x += u, _t108.y += c;
                }
              } catch (err) {
                _iterator83.e(err);
              } finally {
                _iterator83.f();
              }
            }
          } catch (err) {
            _iterator82.e(err);
          } finally {
            _iterator82.f();
          }
        })(t.positionedLines, m, b, w, f, y, s, v, n.length), t.top += -w * v, t.bottom = t.top + v, t.left += -b * f, t.right = t.left + f;
      }(w, e, r, i, g, a, o, l, h, u, p, y), !function (t) {
        var _iterator84 = _createForOfIteratorHelper(t),
            _step84;

        try {
          for (_iterator84.s(); !(_step84 = _iterator84.n()).done;) {
            var _e107 = _step84.value;
            if (0 !== _e107.positionedGlyphs.length) return !1;
          }
        } catch (err) {
          _iterator84.e(err);
        } finally {
          _iterator84.f();
        }

        return !0;
      }(b) && w;
    }

    var iu = {
      9: !0,
      10: !0,
      11: !0,
      12: !0,
      13: !0,
      32: !0
    },
        nu = {
      10: !0,
      32: !0,
      38: !0,
      40: !0,
      41: !0,
      43: !0,
      45: !0,
      47: !0,
      173: !0,
      183: !0,
      8203: !0,
      8208: !0,
      8211: !0,
      8231: !0
    };

    function su(t, e, r, i, n, s) {
      if (e.imageName) {
        var _t111 = i[e.imageName];
        return _t111 ? _t111.displaySize[0] * e.scale * 24 / s + n : 0;
      }

      {
        var _i92 = r[e.fontStack],
            _s53 = _i92 && _i92[t];

        return _s53 ? _s53.metrics.advance * e.scale + n : 0;
      }
    }

    function au(t, e, r, i) {
      var n = Math.pow(t - e, 2);
      return i ? t < e ? n / 2 : 2 * n : n + Math.abs(r) * r;
    }

    function ou(t, e, r) {
      var i = 0;
      return 10 === t && (i -= 1e4), r && (i += 150), 40 !== t && 65288 !== t || (i += 50), 41 !== e && 65289 !== e || (i += 50), i;
    }

    function lu(t, e, r, i, n, s) {
      var a = null,
          o = au(e, r, n, s);

      var _iterator85 = _createForOfIteratorHelper(i),
          _step85;

      try {
        for (_iterator85.s(); !(_step85 = _iterator85.n()).done;) {
          var _t112 = _step85.value;

          var _i93 = au(e - _t112.x, r, n, s) + _t112.badness;

          _i93 <= o && (a = _t112, o = _i93);
        }
      } catch (err) {
        _iterator85.e(err);
      } finally {
        _iterator85.f();
      }

      return {
        index: t,
        x: e,
        priorBreak: a,
        badness: o
      };
    }

    function uu(t, e, r, i, n, s, a) {
      if ("point" !== s) return [];
      if (!t) return [];

      var o = [],
          l = function (t, e, r, i, n, s) {
        var a = 0;

        for (var _r116 = 0; _r116 < t.length(); _r116++) {
          var _o26 = t.getSection(_r116);

          a += su(t.getCharCode(_r116), _o26, i, n, e, s);
        }

        return a / Math.max(1, Math.ceil(a / r));
      }(t, e, r, i, n, a),
          u = t.text.indexOf("â€‹") >= 0;

      var c = 0;

      for (var _r117 = 0; _r117 < t.length(); _r117++) {
        var _s54 = t.getSection(_r117),
            _p2 = t.getCharCode(_r117);

        if (iu[_p2] || (c += su(_p2, _s54, i, n, e, a)), _r117 < t.length() - 1) {
          var _e108 = !((h = _p2) < 11904 || !(Ji["Bopomofo Extended"](h) || Ji.Bopomofo(h) || Ji["CJK Compatibility Forms"](h) || Ji["CJK Compatibility Ideographs"](h) || Ji["CJK Compatibility"](h) || Ji["CJK Radicals Supplement"](h) || Ji["CJK Strokes"](h) || Ji["CJK Symbols and Punctuation"](h) || Ji["CJK Unified Ideographs Extension A"](h) || Ji["CJK Unified Ideographs"](h) || Ji["Enclosed CJK Letters and Months"](h) || Ji["Halfwidth and Fullwidth Forms"](h) || Ji.Hiragana(h) || Ji["Ideographic Description Characters"](h) || Ji["Kangxi Radicals"](h) || Ji["Katakana Phonetic Extensions"](h) || Ji.Katakana(h) || Ji["Vertical Forms"](h) || Ji["Yi Radicals"](h) || Ji["Yi Syllables"](h)));

          (nu[_p2] || _e108 || _s54.imageName) && o.push(lu(_r117 + 1, c, l, o, ou(_p2, t.getCharCode(_r117 + 1), _e108 && u), !1));
        }
      }

      var h;
      return function t(e) {
        return e ? t(e.priorBreak).concat(e.index) : [];
      }(lu(t.length(), c, l, o, 0, !0));
    }

    function cu(t) {
      var e = .5,
          r = .5;

      switch (t) {
        case "right":
        case "top-right":
        case "bottom-right":
          e = 1;
          break;

        case "left":
        case "top-left":
        case "bottom-left":
          e = 0;
      }

      switch (t) {
        case "bottom":
        case "bottom-right":
        case "bottom-left":
          r = 1;
          break;

        case "top":
        case "top-right":
        case "top-left":
          r = 0;
      }

      return {
        horizontalAlign: e,
        verticalAlign: r
      };
    }

    function hu(t, e, r, i, n) {
      if (!i && !n) return;
      var s = t[r],
          a = (t[r].x + s.metrics.advance * s.scale) * i;

      for (var _i94 = e; _i94 <= r; _i94++) {
        t[_i94].x -= a, t[_i94].y += n;
      }
    }

    function pu(t, e, r) {
      var _cu2 = cu(r),
          i = _cu2.horizontalAlign,
          n = _cu2.verticalAlign,
          s = e[0] - t.displaySize[0] * i,
          a = e[1] - t.displaySize[1] * n;

      return {
        image: t,
        top: a,
        bottom: a + t.displaySize[1],
        left: s,
        right: s + t.displaySize[0]
      };
    }

    function du(t, e, r, i, n, s) {
      var a = t.image;
      var o;

      if (a.content) {
        var _t113 = a.content,
            _e109 = a.pixelRatio || 1;

        o = [_t113[0] / _e109, _t113[1] / _e109, a.displaySize[0] - _t113[2] / _e109, a.displaySize[1] - _t113[3] / _e109];
      }

      var l = e.left * s,
          u = e.right * s;
      var c, h, p, d;
      "width" === r || "both" === r ? (d = n[0] + l - i[3], h = n[0] + u + i[1]) : (d = n[0] + (l + u - a.displaySize[0]) / 2, h = d + a.displaySize[0]);
      var f = e.top * s,
          y = e.bottom * s;
      return "height" === r || "both" === r ? (c = n[1] + f - i[0], p = n[1] + y + i[2]) : (c = n[1] + (f + y - a.displaySize[1]) / 2, p = c + a.displaySize[1]), {
        image: a,
        top: c,
        right: h,
        bottom: p,
        left: d,
        collisionPadding: o
      };
    }

    var fu = /*#__PURE__*/function (_i95) {
      _inherits(fu, _i95);

      var _super45 = _createSuper(fu);

      function fu(t, e, r, i) {
        var _this19;

        _classCallCheck(this, fu);

        _this19 = _super45.call(this, t, e), _this19.angle = r, void 0 !== i && (_this19.segment = i);
        return _this19;
      }

      _createClass(fu, [{
        key: "clone",
        value: function clone() {
          return new fu(this.x, this.y, this.angle, this.segment);
        }
      }]);

      return fu;
    }(i);

    function yu(t, e, r, i, n) {
      if (void 0 === e.segment) return !0;
      var s = e,
          a = e.segment + 1,
          o = 0;

      for (; o > -r / 2;) {
        if (a--, a < 0) return !1;
        o -= t[a].dist(s), s = t[a];
      }

      o += t[a].dist(t[a + 1]), a++;
      var l = [];
      var u = 0;

      for (; o < r / 2;) {
        var _e110 = t[a],
            _r118 = t[a + 1];
        if (!_r118) return !1;

        var _s55 = t[a - 1].angleTo(_e110) - _e110.angleTo(_r118);

        for (_s55 = Math.abs((_s55 + 3 * Math.PI) % (2 * Math.PI) - Math.PI), l.push({
          distance: o,
          angleDelta: _s55
        }), u += _s55; o - l[0].distance > i;) {
          u -= l.shift().angleDelta;
        }

        if (u > n) return !1;
        a++, o += _e110.dist(_r118);
      }

      return !0;
    }

    function mu(t) {
      var e = 0;

      for (var _r119 = 0; _r119 < t.length - 1; _r119++) {
        e += t[_r119].dist(t[_r119 + 1]);
      }

      return e;
    }

    function gu(t, e, r) {
      return t ? .6 * e * r : 0;
    }

    function xu(t, e) {
      return Math.max(t ? t.right - t.left : 0, e ? e.right - e.left : 0);
    }

    function vu(t, e, r, i, n, s) {
      var a = gu(r, n, s),
          o = xu(r, i) * s;
      var l = 0;
      var u = mu(t) / 2;

      for (var _r120 = 0; _r120 < t.length - 1; _r120++) {
        var _i96 = t[_r120],
            _n67 = t[_r120 + 1],
            _s56 = _i96.dist(_n67);

        if (l + _s56 > u) {
          var _c10 = (u - l) / _s56,
              _h5 = Ye(_i96.x, _n67.x, _c10),
              _p3 = Ye(_i96.y, _n67.y, _c10),
              _d3 = new fu(_h5, _p3, _n67.angleTo(_i96), _r120);

          return _d3._round(), !a || yu(t, _d3, o, a, e) ? _d3 : void 0;
        }

        l += _s56;
      }
    }

    function bu(t, e, r, i, n, s, a, o, l) {
      var u = gu(i, s, a),
          c = xu(i, n),
          h = c * a,
          p = 0 === t[0].x || t[0].x === l || 0 === t[0].y || t[0].y === l;
      return e - h < e / 4 && (e = h + e / 4), function t(e, r, i, n, s, a, o, l, u) {
        var c = a / 2,
            h = mu(e);
        var p = 0,
            d = r - i,
            f = [];

        for (var _t114 = 0; _t114 < e.length - 1; _t114++) {
          var _r121 = e[_t114],
              _o27 = e[_t114 + 1],
              _l21 = _r121.dist(_o27),
              _y3 = _o27.angleTo(_r121);

          for (; d + i < p + _l21;) {
            d += i;

            var _m4 = (d - p) / _l21,
                _g4 = Ye(_r121.x, _o27.x, _m4),
                _x3 = Ye(_r121.y, _o27.y, _m4);

            if (_g4 >= 0 && _g4 < u && _x3 >= 0 && _x3 < u && d - c >= 0 && d + c <= h) {
              var _r122 = new fu(_g4, _x3, _y3, _t114);

              _r122._round(), n && !yu(e, _r122, a, n, s) || f.push(_r122);
            }
          }

          p += _l21;
        }

        return l || f.length || o || (f = t(e, p / 2, i, n, s, a, o, !0, u)), f;
      }(t, p ? e / 2 * o % e : (c / 2 + 2 * s) * a * o % e, e, u, r, h, p, !1, l);
    }

    function wu(t, e, r, n, s) {
      var a = [];

      for (var _o28 = 0; _o28 < t.length; _o28++) {
        var _l22 = t[_o28];

        var _u18 = void 0;

        for (var _t115 = 0; _t115 < _l22.length - 1; _t115++) {
          var _o29 = _l22[_t115],
              _c11 = _l22[_t115 + 1];
          _o29.x < e && _c11.x < e || (_o29.x < e ? _o29 = new i(e, _o29.y + (e - _o29.x) / (_c11.x - _o29.x) * (_c11.y - _o29.y))._round() : _c11.x < e && (_c11 = new i(e, _o29.y + (e - _o29.x) / (_c11.x - _o29.x) * (_c11.y - _o29.y))._round()), _o29.y < r && _c11.y < r || (_o29.y < r ? _o29 = new i(_o29.x + (r - _o29.y) / (_c11.y - _o29.y) * (_c11.x - _o29.x), r)._round() : _c11.y < r && (_c11 = new i(_o29.x + (r - _o29.y) / (_c11.y - _o29.y) * (_c11.x - _o29.x), r)._round()), _o29.x >= n && _c11.x >= n || (_o29.x >= n ? _o29 = new i(n, _o29.y + (n - _o29.x) / (_c11.x - _o29.x) * (_c11.y - _o29.y))._round() : _c11.x >= n && (_c11 = new i(n, _o29.y + (n - _o29.x) / (_c11.x - _o29.x) * (_c11.y - _o29.y))._round()), _o29.y >= s && _c11.y >= s || (_o29.y >= s ? _o29 = new i(_o29.x + (s - _o29.y) / (_c11.y - _o29.y) * (_c11.x - _o29.x), s)._round() : _c11.y >= s && (_c11 = new i(_o29.x + (s - _o29.y) / (_c11.y - _o29.y) * (_c11.x - _o29.x), s)._round()), _u18 && _o29.equals(_u18[_u18.length - 1]) || (_u18 = [_o29], a.push(_u18)), _u18.push(_c11)))));
        }
      }

      return a;
    }

    function _u(t, e, r, n) {
      var s = [],
          a = t.image,
          o = a.pixelRatio,
          l = a.paddedRect.w - 2,
          u = a.paddedRect.h - 2,
          c = t.right - t.left,
          h = t.bottom - t.top,
          p = a.stretchX || [[0, l]],
          d = a.stretchY || [[0, u]],
          f = function f(t, e) {
        return t + e[1] - e[0];
      },
          y = p.reduce(f, 0),
          m = d.reduce(f, 0),
          g = l - y,
          x = u - m;

      var v = 0,
          b = y,
          w = 0,
          _ = m,
          A = 0,
          k = g,
          S = 0,
          I = x;

      if (a.content && n) {
        var _t116 = a.content;
        v = Au(p, 0, _t116[0]), w = Au(d, 0, _t116[1]), b = Au(p, _t116[0], _t116[2]), _ = Au(d, _t116[1], _t116[3]), A = _t116[0] - v, S = _t116[1] - w, k = _t116[2] - _t116[0] - b, I = _t116[3] - _t116[1] - _;
      }

      var T = function T(n, s, l, u) {
        var p = Su(n.stretch - v, b, c, t.left),
            d = Iu(n.fixed - A, k, n.stretch, y),
            f = Su(s.stretch - w, _, h, t.top),
            g = Iu(s.fixed - S, I, s.stretch, m),
            x = Su(l.stretch - v, b, c, t.left),
            T = Iu(l.fixed - A, k, l.stretch, y),
            z = Su(u.stretch - w, _, h, t.top),
            E = Iu(u.fixed - S, I, u.stretch, m),
            C = new i(p, f),
            M = new i(x, f),
            B = new i(x, z),
            D = new i(p, z),
            P = new i(d / o, g / o),
            V = new i(T / o, E / o),
            F = e * Math.PI / 180;

        if (F) {
          var _t117 = Math.sin(F),
              _e111 = Math.cos(F),
              _r123 = [_e111, -_t117, _t117, _e111];

          C._matMult(_r123), M._matMult(_r123), D._matMult(_r123), B._matMult(_r123);
        }

        var R = n.stretch + n.fixed,
            L = s.stretch + s.fixed;
        return {
          tl: C,
          tr: M,
          bl: D,
          br: B,
          tex: {
            x: a.paddedRect.x + 1 + R,
            y: a.paddedRect.y + 1 + L,
            w: l.stretch + l.fixed - R,
            h: u.stretch + u.fixed - L
          },
          writingMode: void 0,
          glyphOffset: [0, 0],
          sectionIndex: 0,
          pixelOffsetTL: P,
          pixelOffsetBR: V,
          minFontScaleX: k / o / c,
          minFontScaleY: I / o / h,
          isSDF: r
        };
      };

      if (n && (a.stretchX || a.stretchY)) {
        var _t118 = ku(p, g, y),
            _e112 = ku(d, x, m);

        for (var _r124 = 0; _r124 < _t118.length - 1; _r124++) {
          var _i97 = _t118[_r124],
              _n68 = _t118[_r124 + 1];

          for (var _t119 = 0; _t119 < _e112.length - 1; _t119++) {
            s.push(T(_i97, _e112[_t119], _n68, _e112[_t119 + 1]));
          }
        }
      } else s.push(T({
        fixed: 0,
        stretch: -1
      }, {
        fixed: 0,
        stretch: -1
      }, {
        fixed: 0,
        stretch: l + 1
      }, {
        fixed: 0,
        stretch: u + 1
      }));

      return s;
    }

    function Au(t, e, r) {
      var i = 0;

      var _iterator86 = _createForOfIteratorHelper(t),
          _step86;

      try {
        for (_iterator86.s(); !(_step86 = _iterator86.n()).done;) {
          var _n69 = _step86.value;
          i += Math.max(e, Math.min(r, _n69[1])) - Math.max(e, Math.min(r, _n69[0]));
        }
      } catch (err) {
        _iterator86.e(err);
      } finally {
        _iterator86.f();
      }

      return i;
    }

    function ku(t, e, r) {
      var i = [{
        fixed: -1,
        stretch: 0
      }];

      var _iterator87 = _createForOfIteratorHelper(t),
          _step87;

      try {
        for (_iterator87.s(); !(_step87 = _iterator87.n()).done;) {
          var _ref154 = _step87.value;

          var _ref153 = _slicedToArray(_ref154, 2);

          var _e113 = _ref153[0];
          var _r125 = _ref153[1];
          var _t120 = i[i.length - 1];
          i.push({
            fixed: _e113 - _t120.stretch,
            stretch: _t120.stretch
          }), i.push({
            fixed: _e113 - _t120.stretch,
            stretch: _t120.stretch + (_r125 - _e113)
          });
        }
      } catch (err) {
        _iterator87.e(err);
      } finally {
        _iterator87.f();
      }

      return i.push({
        fixed: e + 1,
        stretch: r
      }), i;
    }

    function Su(t, e, r, i) {
      return t / e * r + i;
    }

    function Iu(t, e, r, i) {
      return t - e * r / i;
    }

    ji("Anchor", fu);

    var Tu = /*#__PURE__*/function () {
      function Tu() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : zu;

        _classCallCheck(this, Tu);

        if (this.data = t, this.length = this.data.length, this.compare = e, this.length > 0) for (var _t121 = (this.length >> 1) - 1; _t121 >= 0; _t121--) {
          this._down(_t121);
        }
      }

      _createClass(Tu, [{
        key: "push",
        value: function push(t) {
          this.data.push(t), this.length++, this._up(this.length - 1);
        }
      }, {
        key: "pop",
        value: function pop() {
          if (0 === this.length) return;
          var t = this.data[0],
              e = this.data.pop();
          return this.length--, this.length > 0 && (this.data[0] = e, this._down(0)), t;
        }
      }, {
        key: "peek",
        value: function peek() {
          return this.data[0];
        }
      }, {
        key: "_up",
        value: function _up(t) {
          var e = this.data,
              r = this.compare,
              i = e[t];

          for (; t > 0;) {
            var _n70 = t - 1 >> 1,
                _s57 = e[_n70];

            if (r(i, _s57) >= 0) break;
            e[t] = _s57, t = _n70;
          }

          e[t] = i;
        }
      }, {
        key: "_down",
        value: function _down(t) {
          var e = this.data,
              r = this.compare,
              i = this.length >> 1,
              n = e[t];

          for (; t < i;) {
            var _i98 = 1 + (t << 1),
                _s58 = e[_i98];

            var _a52 = _i98 + 1;

            if (_a52 < this.length && r(e[_a52], _s58) < 0 && (_i98 = _a52, _s58 = e[_a52]), r(_s58, n) >= 0) break;
            e[t] = _s58, t = _i98;
          }

          e[t] = n;
        }
      }]);

      return Tu;
    }();

    function zu(t, e) {
      return t < e ? -1 : t > e ? 1 : 0;
    }

    function Eu(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
      var n = 1 / 0,
          s = 1 / 0,
          a = -1 / 0,
          o = -1 / 0;
      var l = t[0];

      for (var _t122 = 0; _t122 < l.length; _t122++) {
        var _e114 = l[_t122];
        (!_t122 || _e114.x < n) && (n = _e114.x), (!_t122 || _e114.y < s) && (s = _e114.y), (!_t122 || _e114.x > a) && (a = _e114.x), (!_t122 || _e114.y > o) && (o = _e114.y);
      }

      var u = Math.min(a - n, o - s);
      var c = u / 2;
      var h = new Tu([], Cu);
      if (0 === u) return new i(n, s);

      for (var _e115 = n; _e115 < a; _e115 += u) {
        for (var _r126 = s; _r126 < o; _r126 += u) {
          h.push(new Mu(_e115 + c, _r126 + c, c, t));
        }
      }

      var p = function (t) {
        var e = 0,
            r = 0,
            i = 0;
        var n = t[0];

        for (var _t123 = 0, _s59 = n.length, _a53 = _s59 - 1; _t123 < _s59; _a53 = _t123++) {
          var _s60 = n[_t123],
              _o30 = n[_a53],
              _l23 = _s60.x * _o30.y - _o30.x * _s60.y;

          r += (_s60.x + _o30.x) * _l23, i += (_s60.y + _o30.y) * _l23, e += 3 * _l23;
        }

        return new Mu(r / e, i / e, 0, t);
      }(t),
          d = h.length;

      for (; h.length;) {
        var _i99 = h.pop();

        (_i99.d > p.d || !p.d) && (p = _i99, r && console.log("found best %d after %d probes", Math.round(1e4 * _i99.d) / 1e4, d)), _i99.max - p.d <= e || (c = _i99.h / 2, h.push(new Mu(_i99.p.x - c, _i99.p.y - c, c, t)), h.push(new Mu(_i99.p.x + c, _i99.p.y - c, c, t)), h.push(new Mu(_i99.p.x - c, _i99.p.y + c, c, t)), h.push(new Mu(_i99.p.x + c, _i99.p.y + c, c, t)), d += 4);
      }

      return r && (console.log("num probes: ".concat(d)), console.log("best distance: ".concat(p.d))), p.p;
    }

    function Cu(t, e) {
      return e.max - t.max;
    }

    function Mu(t, e, r, n) {
      this.p = new i(t, e), this.h = r, this.d = function (t, e) {
        var r = !1,
            i = 1 / 0;

        for (var _n71 = 0; _n71 < e.length; _n71++) {
          var _s61 = e[_n71];

          for (var _e116 = 0, _n72 = _s61.length, _a54 = _n72 - 1; _e116 < _n72; _a54 = _e116++) {
            var _n73 = _s61[_e116],
                _o31 = _s61[_a54];
            _n73.y > t.y != _o31.y > t.y && t.x < (_o31.x - _n73.x) * (t.y - _n73.y) / (_o31.y - _n73.y) + _n73.x && (r = !r), i = Math.min(i, ta(t, _n73, _o31));
          }
        }

        return (r ? 1 : -1) * Math.sqrt(i);
      }(this.p, n), this.max = this.d + this.h * Math.SQRT2;
    }

    var Bu = Number.POSITIVE_INFINITY;

    function Du(t, e) {
      return e[1] !== Bu ? function (t, e, r) {
        var i = 0,
            n = 0;

        switch (e = Math.abs(e), r = Math.abs(r), t) {
          case "top-right":
          case "top-left":
          case "top":
            n = r - 7;
            break;

          case "bottom-right":
          case "bottom-left":
          case "bottom":
            n = 7 - r;
        }

        switch (t) {
          case "top-right":
          case "bottom-right":
          case "right":
            i = -e;
            break;

          case "top-left":
          case "bottom-left":
          case "left":
            i = e;
        }

        return [i, n];
      }(t, e[0], e[1]) : function (t, e) {
        var r = 0,
            i = 0;
        e < 0 && (e = 0);
        var n = e / Math.sqrt(2);

        switch (t) {
          case "top-right":
          case "top-left":
            i = n - 7;
            break;

          case "bottom-right":
          case "bottom-left":
            i = 7 - n;
            break;

          case "bottom":
            i = 7 - e;
            break;

          case "top":
            i = e - 7;
        }

        switch (t) {
          case "top-right":
          case "bottom-right":
            r = -n;
            break;

          case "top-left":
          case "bottom-left":
            r = n;
            break;

          case "left":
            r = e;
            break;

          case "right":
            r = -e;
        }

        return [r, i];
      }(t, e[0]);
    }

    function Pu(t, e, r, i, n, s, a, o) {
      t.createArrays(), t.tilePixelRatio = 8192 / (512 * t.overscaling), t.compareText = {}, t.iconsNeedLinear = !1;
      var l = t.layers[0].layout,
          u = t.layers[0]._unevaluatedLayout._values,
          c = {};

      if ("composite" === t.textSizeData.kind) {
        var _t$textSizeData = t.textSizeData,
            _e117 = _t$textSizeData.minZoom,
            _r127 = _t$textSizeData.maxZoom;
        c.compositeTextSizes = [u["text-size"].possiblyEvaluate(new yn(_e117), a), u["text-size"].possiblyEvaluate(new yn(_r127), a)];
      }

      if ("composite" === t.iconSizeData.kind) {
        var _t$iconSizeData = t.iconSizeData,
            _e118 = _t$iconSizeData.minZoom,
            _r128 = _t$iconSizeData.maxZoom;
        c.compositeIconSizes = [u["icon-size"].possiblyEvaluate(new yn(_e118), a), u["icon-size"].possiblyEvaluate(new yn(_r128), a)];
      }

      c.layoutTextSize = u["text-size"].possiblyEvaluate(new yn(o + 1), a), c.layoutIconSize = u["icon-size"].possiblyEvaluate(new yn(o + 1), a), c.textMaxSize = u["text-size"].possiblyEvaluate(new yn(18), a);
      var h = 24 * l.get("text-line-height"),
          p = "map" === l.get("text-rotation-alignment") && "point" !== l.get("symbol-placement"),
          d = l.get("text-keep-upright"),
          f = l.get("text-size");

      var _iterator88 = _createForOfIteratorHelper(t.features),
          _step88;

      try {
        var _loop2 = function _loop2() {
          var s = _step88.value;
          var o = l.get("text-font").evaluate(s, {}, a).join(","),
              u = f.evaluate(s, {}, a),
              y = c.layoutTextSize.evaluate(s, {}, a),
              m = (c.layoutIconSize.evaluate(s, {}, a), {
            horizontal: {},
            vertical: void 0
          }),
              g = s.text;
          var x = void 0,
              v = [0, 0];

          if (g) {
            var _i100 = g.toString(),
                _c12 = 24 * l.get("text-letter-spacing").evaluate(s, {}, a),
                _f3 = Wi(_i100) ? _c12 : 0,
                _x4 = l.get("text-anchor").evaluate(s, {}, a),
                _b3 = l.get("text-variable-anchor");

            if (!_b3) {
              var _t124 = l.get("text-radial-offset").evaluate(s, {}, a);

              v = _t124 ? Du(_x4, [24 * _t124, Bu]) : l.get("text-offset").evaluate(s, {}, a).map(function (t) {
                return 24 * t;
              });
            }

            var _w3 = p ? "center" : l.get("text-justify").evaluate(s, {}, a);

            var _5 = l.get("symbol-placement"),
                _A3 = "point" === _5 ? 24 * l.get("text-max-width").evaluate(s, {}, a) : 0,
                _k3 = function _k3() {
              t.allowVerticalPlacement && Yi(_i100) && (m.vertical = ru(g, e, r, n, o, _A3, h, _x4, "left", _f3, v, Ql.vertical, !0, _5, y, u));
            };

            if (!p && _b3) {
              var _t125 = "auto" === _w3 ? _b3.map(function (t) {
                return Vu(t);
              }) : [_w3];

              var _i101 = !1;

              for (var _s62 = 0; _s62 < _t125.length; _s62++) {
                var _a55 = _t125[_s62];
                if (!m.horizontal[_a55]) if (_i101) m.horizontal[_a55] = m.horizontal[0];else {
                  var _t126 = ru(g, e, r, n, o, _A3, h, "center", _a55, _f3, v, Ql.horizontal, !1, _5, y, u);

                  _t126 && (m.horizontal[_a55] = _t126, _i101 = 1 === _t126.positionedLines.length);
                }
              }

              _k3();
            } else {
              "auto" === _w3 && (_w3 = Vu(_x4));

              var _t127 = ru(g, e, r, n, o, _A3, h, _x4, _w3, _f3, v, Ql.horizontal, !1, _5, y, u);

              _t127 && (m.horizontal[_w3] = _t127), _k3(), Yi(_i100) && p && d && (m.vertical = ru(g, e, r, n, o, _A3, h, _x4, _w3, _f3, v, Ql.vertical, !1, _5, y, u));
            }
          }

          var b = !1;

          if (s.icon && s.icon.name) {
            var _e119 = i[s.icon.name];
            _e119 && (x = pu(n[s.icon.name], l.get("icon-offset").evaluate(s, {}, a), l.get("icon-anchor").evaluate(s, {}, a)), b = _e119.sdf, void 0 === t.sdfIcons ? t.sdfIcons = _e119.sdf : t.sdfIcons !== _e119.sdf && z("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"), (_e119.pixelRatio !== t.pixelRatio || 0 !== l.get("icon-rotate").constantOr(1)) && (t.iconsNeedLinear = !0));
          }

          var w = Lu(m.horizontal) || m.vertical;
          t.iconsInText = !!w && w.iconsInText, (w || x) && Fu(t, s, m, x, i, c, y, 0, v, b, a);
        };

        for (_iterator88.s(); !(_step88 = _iterator88.n()).done;) {
          _loop2();
        }
      } catch (err) {
        _iterator88.e(err);
      } finally {
        _iterator88.f();
      }

      s && t.generateCollisionDebugBuffers(o, t.collisionBoxArray);
    }

    function Vu(t) {
      switch (t) {
        case "right":
        case "top-right":
        case "bottom-right":
          return "right";

        case "left":
        case "top-left":
        case "bottom-left":
          return "left";
      }

      return "center";
    }

    function Fu(t, e, r, i, n, s, a, o, l, u, h) {
      var p = s.textMaxSize.evaluate(e, {}, h);
      void 0 === p && (p = a);

      var d = t.layers[0].layout,
          f = d.get("icon-offset").evaluate(e, {}, h),
          y = Lu(r.horizontal),
          m = a / 24,
          g = t.tilePixelRatio * m,
          x = t.tilePixelRatio * p / 24,
          v = t.tilePixelRatio * d.get("symbol-spacing"),
          b = d.get("text-padding") * t.tilePixelRatio,
          w = d.get("icon-padding") * t.tilePixelRatio,
          _ = c(d.get("text-max-angle")),
          A = "map" === d.get("text-rotation-alignment") && "point" !== d.get("symbol-placement"),
          k = "map" === d.get("icon-rotation-alignment") && "point" !== d.get("symbol-placement"),
          S = d.get("symbol-placement"),
          I = v / 2,
          T = d.get("icon-text-fit");

      var E;
      i && "none" !== T && (t.allowVerticalPlacement && r.vertical && (E = du(i, r.vertical, T, d.get("icon-text-fit-padding"), f, m)), y && (i = du(i, y, T, d.get("icon-text-fit-padding"), f, m)));

      var C = function C(o, c) {
        c.x < 0 || c.x >= 8192 || c.y < 0 || c.y >= 8192 || function (t, e, r, i, n, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b, w, _, A, k) {
          var _o$layout$get$evaluat, _o$layout$get$evaluat2;

          var S = t.addToLineVertexArray(e, r);
          var I,
              T,
              E,
              C,
              M,
              B,
              D,
              P = 0,
              V = 0,
              F = 0,
              R = 0,
              L = -1,
              U = -1;
          var O = {};
          var $ = ms(""),
              q = 0,
              N = 0;

          if (void 0 === o._unevaluatedLayout.getValue("text-radial-offset") ? (_o$layout$get$evaluat = o.layout.get("text-offset").evaluate(b, {}, A).map(function (t) {
            return 24 * t;
          }), _o$layout$get$evaluat2 = _slicedToArray(_o$layout$get$evaluat, 2), q = _o$layout$get$evaluat2[0], N = _o$layout$get$evaluat2[1], _o$layout$get$evaluat) : (q = 24 * o.layout.get("text-radial-offset").evaluate(b, {}, A), N = Bu), t.allowVerticalPlacement && i.vertical) {
            var _t128 = i.vertical;
            if (f) B = Ou(_t128), a && (D = Ou(a));else {
              var _r129 = o.layout.get("text-rotate").evaluate(b, {}, A) + 90;

              E = Uu(l, e, u, c, h, _t128, 0, d, _r129), a && (C = Uu(l, e, u, c, h, a, 0, g, _r129));
            }
          }

          if (n) {
            var _r130 = o.layout.get("icon-rotate").evaluate(b, {}, A),
                _i102 = "none" !== o.layout.get("icon-text-fit"),
                _s63 = _u(n, _r130, _, _i102),
                _p4 = a ? _u(a, _r130, _, _i102) : void 0;

            T = Uu(l, e, u, c, h, n, 0, g, _r130), P = 4 * _s63.length;
            var _d4 = t.iconSizeData;
            var _f4 = null;
            "source" === _d4.kind ? (_f4 = [128 * o.layout.get("icon-size").evaluate(b, {}, A)], _f4[0] > 32640 && z("".concat(t.layerIds[0], ": Value for \"icon-size\" is >= 255. Reduce your \"icon-size\"."))) : "composite" === _d4.kind && (_f4 = [128 * w.compositeIconSizes[0].evaluate(b, {}, A), 128 * w.compositeIconSizes[1].evaluate(b, {}, A)], (_f4[0] > 32640 || _f4[1] > 32640) && z("".concat(t.layerIds[0], ": Value for \"icon-size\" is >= 255. Reduce your \"icon-size\"."))), t.addSymbols(t.icon, _s63, _f4, v, x, b, !1, e, S.lineStartIndex, S.lineLength, -1, A), L = t.icon.placedSymbolArray.length - 1, _p4 && (V = 4 * _p4.length, t.addSymbols(t.icon, _p4, _f4, v, x, b, Ql.vertical, e, S.lineStartIndex, S.lineLength, -1, A), U = t.icon.placedSymbolArray.length - 1);
          }

          for (var _r131 in i.horizontal) {
            var _n74 = i.horizontal[_r131];
            I || ($ = ms(_n74.text), f ? M = Ou(_n74) : I = Uu(l, e, u, c, h, _n74, 0, d, o.layout.get("text-rotate").evaluate(b, {}, A)));

            var _a56 = 1 === _n74.positionedLines.length;

            if (F += Ru(t, e, _n74, s, o, f, b, y, S, i.vertical ? Ql.horizontal : Ql.horizontalOnly, _a56 ? Object.keys(i.horizontal) : [_r131], O, L, w, A), _a56) break;
          }

          i.vertical && (R += Ru(t, e, i.vertical, s, o, f, b, y, S, Ql.vertical, ["vertical"], O, U, w, A));
          var j = -1;

          var K = function K(t, e) {
            return t ? Math.max(t, e) : e;
          };

          j = K(M, j), j = K(B, j), j = K(D, j);
          var Z = j > -1 ? 1 : 0;
          Z && (j *= k / 24), t.glyphOffsetArray.length >= Hu.MAX_GLYPHS && z("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"), void 0 !== b.sortKey && t.addToSortKeyRanges(t.symbolInstances.length, b.sortKey), t.symbolInstances.emplaceBack(e.x, e.y, O.right >= 0 ? O.right : -1, O.center >= 0 ? O.center : -1, O.left >= 0 ? O.left : -1, O.vertical || -1, L, U, $, void 0 !== I ? I : t.collisionBoxArray.length, void 0 !== I ? I + 1 : t.collisionBoxArray.length, void 0 !== E ? E : t.collisionBoxArray.length, void 0 !== E ? E + 1 : t.collisionBoxArray.length, void 0 !== T ? T : t.collisionBoxArray.length, void 0 !== T ? T + 1 : t.collisionBoxArray.length, C || t.collisionBoxArray.length, C ? C + 1 : t.collisionBoxArray.length, u, F, R, P, V, Z, 0, p, q, N, j);
        }(t, c, o, r, i, n, E, t.layers[0], t.collisionBoxArray, e.index, e.sourceLayerIndex, t.index, g, b, A, l, 0, w, k, f, e, s, u, h, a);
      };

      if ("line" === S) {
        var _iterator89 = _createForOfIteratorHelper(wu(e.geometry, 0, 0, 8192, 8192)),
            _step89;

        try {
          for (_iterator89.s(); !(_step89 = _iterator89.n()).done;) {
            var _n75 = _step89.value;

            var _e120 = bu(_n75, v, _, r.vertical || y, i, 24, x, t.overscaling, 8192);

            var _iterator90 = _createForOfIteratorHelper(_e120),
                _step90;

            try {
              for (_iterator90.s(); !(_step90 = _iterator90.n()).done;) {
                var _r132 = _step90.value;
                var _e121 = y;
                _e121 && $u(t, _e121.text, I, _r132) || C(_n75, _r132);
              }
            } catch (err) {
              _iterator90.e(err);
            } finally {
              _iterator90.f();
            }
          }
        } catch (err) {
          _iterator89.e(err);
        } finally {
          _iterator89.f();
        }
      } else if ("line-center" === S) {
        var _iterator91 = _createForOfIteratorHelper(e.geometry),
            _step91;

        try {
          for (_iterator91.s(); !(_step91 = _iterator91.n()).done;) {
            var _t129 = _step91.value;

            if (_t129.length > 1) {
              var _e122 = vu(_t129, _, r.vertical || y, i, 24, x);

              _e122 && C(_t129, _e122);
            }
          }
        } catch (err) {
          _iterator91.e(err);
        } finally {
          _iterator91.f();
        }
      } else if ("Polygon" === e.type) {
        var _iterator92 = _createForOfIteratorHelper(Co(e.geometry, 0)),
            _step92;

        try {
          for (_iterator92.s(); !(_step92 = _iterator92.n()).done;) {
            var _t130 = _step92.value;

            var _e123 = Eu(_t130, 16);

            C(_t130[0], new fu(_e123.x, _e123.y, 0));
          }
        } catch (err) {
          _iterator92.e(err);
        } finally {
          _iterator92.f();
        }
      } else if ("LineString" === e.type) {
        var _iterator93 = _createForOfIteratorHelper(e.geometry),
            _step93;

        try {
          for (_iterator93.s(); !(_step93 = _iterator93.n()).done;) {
            var _t131 = _step93.value;
            C(_t131, new fu(_t131[0].x, _t131[0].y, 0));
          }
        } catch (err) {
          _iterator93.e(err);
        } finally {
          _iterator93.f();
        }
      } else if ("Point" === e.type) {
        var _iterator94 = _createForOfIteratorHelper(e.geometry),
            _step94;

        try {
          for (_iterator94.s(); !(_step94 = _iterator94.n()).done;) {
            var _t132 = _step94.value;

            var _iterator95 = _createForOfIteratorHelper(_t132),
                _step95;

            try {
              for (_iterator95.s(); !(_step95 = _iterator95.n()).done;) {
                var _e124 = _step95.value;
                C([_e124], new fu(_e124.x, _e124.y, 0));
              }
            } catch (err) {
              _iterator95.e(err);
            } finally {
              _iterator95.f();
            }
          }
        } catch (err) {
          _iterator94.e(err);
        } finally {
          _iterator94.f();
        }
      }
    }

    function Ru(t, e, r, n, s, a, o, l, u, c, h, p, d, f, y) {
      var m = function (t, e, r, n, s, a, o, l) {
        var u = n.layout.get("text-rotate").evaluate(a, {}) * Math.PI / 180,
            c = [];

        var _iterator96 = _createForOfIteratorHelper(e.positionedLines),
            _step96;

        try {
          for (_iterator96.s(); !(_step96 = _iterator96.n()).done;) {
            var _t133 = _step96.value;

            var _iterator97 = _createForOfIteratorHelper(_t133.positionedGlyphs),
                _step97;

            try {
              for (_iterator97.s(); !(_step97 = _iterator97.n()).done;) {
                var _n76 = _step97.value;
                if (!_n76.rect) continue;

                var _a57 = _n76.rect || {};

                var _h6 = 4,
                    _p5 = !0,
                    _d5 = 1,
                    _f5 = 0;

                var _y4 = (s || l) && _n76.vertical,
                    _m5 = _n76.metrics.advance * _n76.scale / 2;

                if (l && e.verticalizable) {
                  var _e125 = 24 * (_n76.scale - 1),
                      _r133 = (24 - _n76.metrics.width * _n76.scale) / 2;

                  _f5 = _t133.lineOffset / 2 - (_n76.imageName ? -_r133 : _e125);
                }

                if (_n76.imageName) {
                  var _t134 = o[_n76.imageName];
                  _p5 = _t134.sdf, _d5 = _t134.pixelRatio, _h6 = 1 / _d5;
                }

                var _g5 = s ? [_n76.x + _m5, _n76.y] : [0, 0];

                var _x5 = s ? [0, 0] : [_n76.x + _m5 + r[0], _n76.y + r[1] - _f5],
                    _v4 = [0, 0];

                _y4 && (_v4 = _x5, _x5 = [0, 0]);

                var _b4 = (_n76.metrics.left - _h6) * _n76.scale - _m5 + _x5[0],
                    _w4 = (-_n76.metrics.top - _h6) * _n76.scale + _x5[1],
                    _6 = _b4 + _a57.w * _n76.scale / _d5,
                    _A4 = _w4 + _a57.h * _n76.scale / _d5,
                    _k4 = new i(_b4, _w4),
                    _S2 = new i(_6, _w4),
                    _I = new i(_b4, _A4),
                    _T = new i(_6, _A4);

                if (_y4) {
                  var _t135 = new i(-_m5, _m5 - -17),
                      _e126 = -Math.PI / 2,
                      _r134 = 12 - _m5,
                      _s64 = new i(22 - _r134, -(_n76.imageName ? _r134 : 0)),
                      _a58 = _construct(i, _toConsumableArray(_v4));

                  _k4._rotateAround(_e126, _t135)._add(_s64)._add(_a58), _S2._rotateAround(_e126, _t135)._add(_s64)._add(_a58), _I._rotateAround(_e126, _t135)._add(_s64)._add(_a58), _T._rotateAround(_e126, _t135)._add(_s64)._add(_a58);
                }

                if (u) {
                  var _t136 = Math.sin(u),
                      _e127 = Math.cos(u),
                      _r135 = [_e127, -_t136, _t136, _e127];

                  _k4._matMult(_r135), _S2._matMult(_r135), _I._matMult(_r135), _T._matMult(_r135);
                }

                var _z = new i(0, 0),
                    _E = new i(0, 0);

                c.push({
                  tl: _k4,
                  tr: _S2,
                  bl: _I,
                  br: _T,
                  tex: _a57,
                  writingMode: e.writingMode,
                  glyphOffset: _g5,
                  sectionIndex: _n76.sectionIndex,
                  isSDF: _p5,
                  pixelOffsetTL: _z,
                  pixelOffsetBR: _E,
                  minFontScaleX: 0,
                  minFontScaleY: 0
                });
              }
            } catch (err) {
              _iterator97.e(err);
            } finally {
              _iterator97.f();
            }
          }
        } catch (err) {
          _iterator96.e(err);
        } finally {
          _iterator96.f();
        }

        return c;
      }(0, r, l, s, a, o, n, t.allowVerticalPlacement),
          g = t.textSizeData;

      var x = null;
      "source" === g.kind ? (x = [128 * s.layout.get("text-size").evaluate(o, {}, y)], x[0] > 32640 && z("".concat(t.layerIds[0], ": Value for \"text-size\" is >= 255. Reduce your \"text-size\"."))) : "composite" === g.kind && (x = [128 * f.compositeTextSizes[0].evaluate(o, {}, y), 128 * f.compositeTextSizes[1].evaluate(o, {}, y)], (x[0] > 32640 || x[1] > 32640) && z("".concat(t.layerIds[0], ": Value for \"text-size\" is >= 255. Reduce your \"text-size\"."))), t.addSymbols(t.text, m, x, l, a, o, c, e, u.lineStartIndex, u.lineLength, d, y);

      var _iterator98 = _createForOfIteratorHelper(h),
          _step98;

      try {
        for (_iterator98.s(); !(_step98 = _iterator98.n()).done;) {
          var _e128 = _step98.value;
          p[_e128] = t.text.placedSymbolArray.length - 1;
        }
      } catch (err) {
        _iterator98.e(err);
      } finally {
        _iterator98.f();
      }

      return 4 * m.length;
    }

    function Lu(t) {
      for (var _e129 in t) {
        return t[_e129];
      }

      return null;
    }

    function Uu(t, e, r, n, s, a, o, l, u) {
      var h = a.top,
          p = a.bottom,
          d = a.left,
          f = a.right;
      var y = a.collisionPadding;

      if (y && (d -= y[0], h -= y[1], f += y[2], p += y[3]), u) {
        var _t137 = new i(d, h),
            _e130 = new i(f, h),
            _r136 = new i(d, p),
            _n77 = new i(f, p),
            _s65 = c(u);

        _t137._rotate(_s65), _e130._rotate(_s65), _r136._rotate(_s65), _n77._rotate(_s65), d = Math.min(_t137.x, _e130.x, _r136.x, _n77.x), f = Math.max(_t137.x, _e130.x, _r136.x, _n77.x), h = Math.min(_t137.y, _e130.y, _r136.y, _n77.y), p = Math.max(_t137.y, _e130.y, _r136.y, _n77.y);
      }

      return t.emplaceBack(e.x, e.y, d, h, f, p, l, r, n, s), t.length - 1;
    }

    function Ou(t) {
      t.collisionPadding && (t.top -= t.collisionPadding[1], t.bottom += t.collisionPadding[3]);
      var e = t.bottom - t.top;
      return e > 0 ? Math.max(10, e) : null;
    }

    function $u(t, e, r, i) {
      var n = t.compareText;

      if (e in n) {
        var _t138 = n[e];

        for (var _e131 = _t138.length - 1; _e131 >= 0; _e131--) {
          if (i.dist(_t138[_e131]) < r) return !0;
        }
      } else n[e] = [];

      return n[e].push(i), !1;
    }

    var qu = Go.VectorTileFeature.types,
        Nu = [{
      name: "a_fade_opacity",
      components: 1,
      type: "Uint8",
      offset: 0
    }];

    function ju(t, e, r, i, n, s, a, o, l, u, c, h, p) {
      var d = o ? Math.min(32640, Math.round(o[0])) : 0,
          f = o ? Math.min(32640, Math.round(o[1])) : 0;
      t.emplaceBack(e, r, Math.round(32 * i), Math.round(32 * n), s, a, (d << 1) + (l ? 1 : 0), f, 16 * u, 16 * c, 256 * h, 256 * p);
    }

    function Ku(t, e, r) {
      t.emplaceBack(e.x, e.y, r), t.emplaceBack(e.x, e.y, r), t.emplaceBack(e.x, e.y, r), t.emplaceBack(e.x, e.y, r);
    }

    function Zu(t) {
      var _iterator99 = _createForOfIteratorHelper(t.sections),
          _step99;

      try {
        for (_iterator99.s(); !(_step99 = _iterator99.n()).done;) {
          var _e132 = _step99.value;
          if (sn(_e132.text)) return !0;
        }
      } catch (err) {
        _iterator99.e(err);
      } finally {
        _iterator99.f();
      }

      return !1;
    }

    var Xu = /*#__PURE__*/function () {
      function Xu(t) {
        _classCallCheck(this, Xu);

        this.layoutVertexArray = new $n(), this.indexArray = new Gn(), this.programConfigurations = t, this.segments = new Os(), this.dynamicLayoutVertexArray = new qn(), this.opacityVertexArray = new Nn(), this.placedSymbolArray = new as();
      }

      _createClass(Xu, [{
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length && 0 === this.indexArray.length && 0 === this.dynamicLayoutVertexArray.length && 0 === this.opacityVertexArray.length;
        }
      }, {
        key: "upload",
        value: function upload(t, e, r, i) {
          this.isEmpty() || (r && (this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, yl.members), this.indexBuffer = t.createIndexBuffer(this.indexArray, e), this.dynamicLayoutVertexBuffer = t.createVertexBuffer(this.dynamicLayoutVertexArray, ml.members, !0), this.opacityVertexBuffer = t.createVertexBuffer(this.opacityVertexArray, Nu, !0), this.opacityVertexBuffer.itemSize = 1), (r || i) && this.programConfigurations.upload(t));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.programConfigurations.destroy(), this.segments.destroy(), this.dynamicLayoutVertexBuffer.destroy(), this.opacityVertexBuffer.destroy());
        }
      }]);

      return Xu;
    }();

    ji("SymbolBuffers", Xu);

    var Gu = /*#__PURE__*/function () {
      function Gu(t, e, r) {
        _classCallCheck(this, Gu);

        this.layoutVertexArray = new t(), this.layoutAttributes = e, this.indexArray = new r(), this.segments = new Os(), this.collisionVertexArray = new Xn(), this.collisionVertexArrayExt = new qn();
      }

      _createClass(Gu, [{
        key: "upload",
        value: function upload(t) {
          this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, this.layoutAttributes), this.indexBuffer = t.createIndexBuffer(this.indexArray), this.collisionVertexBuffer = t.createVertexBuffer(this.collisionVertexArray, gl.members, !0), this.collisionVertexBufferExt = t.createVertexBuffer(this.collisionVertexArrayExt, xl.members, !0);
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.segments.destroy(), this.collisionVertexBuffer.destroy(), this.collisionVertexBufferExt.destroy());
        }
      }]);

      return Gu;
    }();

    ji("CollisionBuffers", Gu);

    var Hu = /*#__PURE__*/function () {
      function Hu(t) {
        _classCallCheck(this, Hu);

        this.collisionBoxArray = t.collisionBoxArray, this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.pixelRatio = t.pixelRatio, this.sourceLayerIndex = t.sourceLayerIndex, this.hasPattern = !1, this.hasRTLText = !1, this.sortKeyRanges = [], this.collisionCircleArray = [], this.placementInvProjMatrix = da([]), this.placementViewportMatrix = da([]);
        var e = this.layers[0]._unevaluatedLayout._values;
        this.textSizeData = wl(this.zoom, e["text-size"]), this.iconSizeData = wl(this.zoom, e["icon-size"]);
        var r = this.layers[0].layout,
            i = r.get("symbol-sort-key"),
            n = r.get("symbol-z-order");
        this.canOverlap = r.get("text-allow-overlap") || r.get("icon-allow-overlap") || r.get("text-ignore-placement") || r.get("icon-ignore-placement"), this.sortFeaturesByKey = "viewport-y" !== n && void 0 !== i.constantOr(1), this.sortFeaturesByY = ("viewport-y" === n || "auto" === n && !this.sortFeaturesByKey) && this.canOverlap, "point" === r.get("symbol-placement") && (this.writingModes = r.get("text-writing-mode").map(function (t) {
          return Ql[t];
        })), this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        }), this.sourceID = t.sourceID;
      }

      _createClass(Hu, [{
        key: "createArrays",
        value: function createArrays() {
          this.text = new Xu(new Ps(this.layers, this.zoom, function (t) {
            return /^text/.test(t);
          })), this.icon = new Xu(new Ps(this.layers, this.zoom, function (t) {
            return /^icon/.test(t);
          })), this.glyphOffsetArray = new us(), this.lineVertexArray = new cs(), this.symbolInstances = new ls();
        }
      }, {
        key: "calculateGlyphDependencies",
        value: function calculateGlyphDependencies(t, e, r, i, n) {
          for (var _s66 = 0; _s66 < t.length; _s66++) {
            if (e[t.charCodeAt(_s66)] = !0, (r || i) && n) {
              var _r137 = Il[t.charAt(_s66)];
              _r137 && (e[_r137.charCodeAt(0)] = !0);
            }
          }
        }
      }, {
        key: "populate",
        value: function populate(t, e, r) {
          var i = this.layers[0],
              n = i.layout,
              s = n.get("text-font"),
              a = n.get("text-field"),
              o = n.get("icon-image"),
              l = ("constant" !== a.value.kind || a.value.value instanceof ce && !a.value.value.isEmpty() || a.value.value.toString().length > 0) && ("constant" !== s.value.kind || s.value.value.length > 0),
              u = "constant" !== o.value.kind || !!o.value.value || Object.keys(o.parameters).length > 0,
              c = n.get("symbol-sort-key");
          if (this.features = [], !l && !u) return;
          var h = e.iconDependencies,
              p = e.glyphDependencies,
              d = e.availableImages,
              f = new yn(this.zoom);

          var _iterator100 = _createForOfIteratorHelper(t),
              _step100;

          try {
            for (_iterator100.s(); !(_step100 = _iterator100.n()).done;) {
              var _ref156 = _step100.value;
              var _e133 = _ref156.feature;
              var _a59 = _ref156.id;
              var _o32 = _ref156.index;
              var _y5 = _ref156.sourceLayerIndex;

              var _t140 = i._featureFilter.needGeometry,
                  _m6 = js(_e133, _t140);

              if (!i._featureFilter.filter(f, _m6, r)) continue;

              var _g6 = void 0,
                  _x6 = void 0;

              if (_t140 || (_m6.geometry = Ns(_e133)), l) {
                var _t141 = i.getValueAndResolveTokens("text-field", _m6, r, d),
                    _e134 = ce.factory(_t141);

                Zu(_e134) && (this.hasRTLText = !0), (!this.hasRTLText || "unavailable" === pn() || this.hasRTLText && fn.isParsed()) && (_g6 = Sl(_e134, i, _m6));
              }

              if (u) {
                var _t142 = i.getValueAndResolveTokens("icon-image", _m6, r, d);

                _x6 = _t142 instanceof he ? _t142 : he.fromString(_t142);
              }

              if (!_g6 && !_x6) continue;

              var _v5 = this.sortFeaturesByKey ? c.evaluate(_m6, {}, r) : void 0;

              if (this.features.push({
                id: _a59,
                text: _g6,
                icon: _x6,
                index: _o32,
                sourceLayerIndex: _y5,
                geometry: _m6.geometry,
                properties: _e133.properties,
                type: qu[_e133.type],
                sortKey: _v5
              }), _x6 && (h[_x6.name] = !0), _g6) {
                var _t143 = s.evaluate(_m6, {}, r).join(","),
                    _e135 = "map" === n.get("text-rotation-alignment") && "point" !== n.get("symbol-placement");

                this.allowVerticalPlacement = this.writingModes && this.writingModes.indexOf(Ql.vertical) >= 0;

                var _iterator101 = _createForOfIteratorHelper(_g6.sections),
                    _step101;

                try {
                  for (_iterator101.s(); !(_step101 = _iterator101.n()).done;) {
                    var _r138 = _step101.value;
                    if (_r138.image) h[_r138.image.name] = !0;else {
                      var _i103 = Yi(_g6.toString()),
                          _n79 = _r138.fontStack || _t143,
                          _s67 = p[_n79] = p[_n79] || {};

                      this.calculateGlyphDependencies(_r138.text, _s67, _e135, this.allowVerticalPlacement, _i103);
                    }
                  }
                } catch (err) {
                  _iterator101.e(err);
                } finally {
                  _iterator101.f();
                }
              }
            }
          } catch (err) {
            _iterator100.e(err);
          } finally {
            _iterator100.f();
          }

          "line" === n.get("symbol-placement") && (this.features = function (t) {
            var e = {},
                r = {},
                i = [];
            var n = 0;

            function s(e) {
              i.push(t[e]), n++;
            }

            function a(t, e, n) {
              var s = r[t];
              return delete r[t], r[e] = s, i[s].geometry[0].pop(), i[s].geometry[0] = i[s].geometry[0].concat(n[0]), s;
            }

            function o(t, r, n) {
              var s = e[r];
              return delete e[r], e[t] = s, i[s].geometry[0].shift(), i[s].geometry[0] = n[0].concat(i[s].geometry[0]), s;
            }

            function l(t, e, r) {
              var i = r ? e[0][e[0].length - 1] : e[0][0];
              return "".concat(t, ":").concat(i.x, ":").concat(i.y);
            }

            for (var _u19 = 0; _u19 < t.length; _u19++) {
              var _c13 = t[_u19],
                  _h7 = _c13.geometry,
                  _p6 = _c13.text ? _c13.text.toString() : null;

              if (!_p6) {
                s(_u19);
                continue;
              }

              var _d6 = l(_p6, _h7),
                  _f6 = l(_p6, _h7, !0);

              if (_d6 in r && _f6 in e && r[_d6] !== e[_f6]) {
                var _t139 = o(_d6, _f6, _h7),
                    _n78 = a(_d6, _f6, i[_t139].geometry);

                delete e[_d6], delete r[_f6], r[l(_p6, i[_n78].geometry, !0)] = _n78, i[_t139].geometry = null;
              } else _d6 in r ? a(_d6, _f6, _h7) : _f6 in e ? o(_d6, _f6, _h7) : (s(_u19), e[_d6] = n - 1, r[_f6] = n - 1);
            }

            return i.filter(function (t) {
              return t.geometry;
            });
          }(this.features)), this.sortFeaturesByKey && this.features.sort(function (t, e) {
            return t.sortKey - e.sortKey;
          });
        }
      }, {
        key: "update",
        value: function update(t, e, r) {
          this.stateDependentLayers.length && (this.text.programConfigurations.updatePaintArrays(t, e, this.layers, r), this.icon.programConfigurations.updatePaintArrays(t, e, this.layers, r));
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.symbolInstances.length && !this.hasRTLText;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.text.programConfigurations.needsUpload || this.icon.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          !this.uploaded && this.hasDebugData() && (this.textCollisionBox.upload(t), this.iconCollisionBox.upload(t)), this.text.upload(t, this.sortFeaturesByY, !this.uploaded, this.text.programConfigurations.needsUpload), this.icon.upload(t, this.sortFeaturesByY, !this.uploaded, this.icon.programConfigurations.needsUpload), this.uploaded = !0;
        }
      }, {
        key: "destroyDebugData",
        value: function destroyDebugData() {
          this.textCollisionBox.destroy(), this.iconCollisionBox.destroy();
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.text.destroy(), this.icon.destroy(), this.hasDebugData() && this.destroyDebugData();
        }
      }, {
        key: "addToLineVertexArray",
        value: function addToLineVertexArray(t, e) {
          var r = this.lineVertexArray.length;

          if (void 0 !== t.segment) {
            var _r139 = t.dist(e[t.segment + 1]),
                _i104 = t.dist(e[t.segment]);

            var _n80 = {};

            for (var _i105 = t.segment + 1; _i105 < e.length; _i105++) {
              _n80[_i105] = {
                x: e[_i105].x,
                y: e[_i105].y,
                tileUnitDistanceFromAnchor: _r139
              }, _i105 < e.length - 1 && (_r139 += e[_i105 + 1].dist(e[_i105]));
            }

            for (var _r140 = t.segment || 0; _r140 >= 0; _r140--) {
              _n80[_r140] = {
                x: e[_r140].x,
                y: e[_r140].y,
                tileUnitDistanceFromAnchor: _i104
              }, _r140 > 0 && (_i104 += e[_r140 - 1].dist(e[_r140]));
            }

            for (var _t144 = 0; _t144 < e.length; _t144++) {
              var _e136 = _n80[_t144];
              this.lineVertexArray.emplaceBack(_e136.x, _e136.y, _e136.tileUnitDistanceFromAnchor);
            }
          }

          return {
            lineStartIndex: r,
            lineLength: this.lineVertexArray.length - r
          };
        }
      }, {
        key: "addSymbols",
        value: function addSymbols(t, e, r, i, n, s, a, o, l, u, c, h) {
          var p = t.indexArray,
              d = t.layoutVertexArray,
              f = t.segments.prepareSegment(4 * e.length, d, p, this.canOverlap ? s.sortKey : void 0),
              y = this.glyphOffsetArray.length,
              m = f.vertexLength,
              g = this.allowVerticalPlacement && a === Ql.vertical ? Math.PI / 2 : 0,
              x = s.text && s.text.sections;

          for (var _i106 = 0; _i106 < e.length; _i106++) {
            var _e$_i = e[_i106],
                _n81 = _e$_i.tl,
                _a60 = _e$_i.tr,
                _l24 = _e$_i.bl,
                _u20 = _e$_i.br,
                _c14 = _e$_i.tex,
                _y6 = _e$_i.pixelOffsetTL,
                _m7 = _e$_i.pixelOffsetBR,
                _v6 = _e$_i.minFontScaleX,
                _b5 = _e$_i.minFontScaleY,
                _w5 = _e$_i.glyphOffset,
                _7 = _e$_i.isSDF,
                _A5 = _e$_i.sectionIndex,
                _k5 = f.vertexLength,
                _S3 = _w5[1];
            ju(d, o.x, o.y, _n81.x, _S3 + _n81.y, _c14.x, _c14.y, r, _7, _y6.x, _y6.y, _v6, _b5), ju(d, o.x, o.y, _a60.x, _S3 + _a60.y, _c14.x + _c14.w, _c14.y, r, _7, _m7.x, _y6.y, _v6, _b5), ju(d, o.x, o.y, _l24.x, _S3 + _l24.y, _c14.x, _c14.y + _c14.h, r, _7, _y6.x, _m7.y, _v6, _b5), ju(d, o.x, o.y, _u20.x, _S3 + _u20.y, _c14.x + _c14.w, _c14.y + _c14.h, r, _7, _m7.x, _m7.y, _v6, _b5), Ku(t.dynamicLayoutVertexArray, o, g), p.emplaceBack(_k5, _k5 + 1, _k5 + 2), p.emplaceBack(_k5 + 1, _k5 + 2, _k5 + 3), f.vertexLength += 4, f.primitiveLength += 2, this.glyphOffsetArray.emplaceBack(_w5[0]), _i106 !== e.length - 1 && _A5 === e[_i106 + 1].sectionIndex || t.programConfigurations.populatePaintArrays(d.length, s, s.index, {}, h, x && x[_A5]);
          }

          t.placedSymbolArray.emplaceBack(o.x, o.y, y, this.glyphOffsetArray.length - y, m, l, u, o.segment, r ? r[0] : 0, r ? r[1] : 0, i[0], i[1], a, 0, !1, 0, c);
        }
      }, {
        key: "_commitLayoutVertex",
        value: function _commitLayoutVertex(t, e, r, i, n) {
          t.emplaceBack(e.x, e.y, r, i, Math.round(n.x), Math.round(n.y));
        }
      }, {
        key: "_addCollisionDebugVertices",
        value: function _addCollisionDebugVertices(t, e, r, n, s) {
          var a = r.segments.prepareSegment(4, r.layoutVertexArray, r.indexArray),
              o = a.vertexLength,
              l = s.anchorX,
              u = s.anchorY;

          for (var _t145 = 0; _t145 < 4; _t145++) {
            r.collisionVertexArray.emplaceBack(0, 0, 0, 0);
          }

          r.collisionVertexArrayExt.emplaceBack(e, -t.padding, -t.padding), r.collisionVertexArrayExt.emplaceBack(e, t.padding, -t.padding), r.collisionVertexArrayExt.emplaceBack(e, t.padding, t.padding), r.collisionVertexArrayExt.emplaceBack(e, -t.padding, t.padding), this._commitLayoutVertex(r.layoutVertexArray, n, l, u, new i(t.x1, t.y1)), this._commitLayoutVertex(r.layoutVertexArray, n, l, u, new i(t.x2, t.y1)), this._commitLayoutVertex(r.layoutVertexArray, n, l, u, new i(t.x2, t.y2)), this._commitLayoutVertex(r.layoutVertexArray, n, l, u, new i(t.x1, t.y2)), a.vertexLength += 4;
          var c = r.indexArray;
          c.emplaceBack(o, o + 1), c.emplaceBack(o + 1, o + 2), c.emplaceBack(o + 2, o + 3), c.emplaceBack(o + 3, o), a.primitiveLength += 4;
        }
      }, {
        key: "_addTextDebugCollisionBoxes",
        value: function _addTextDebugCollisionBoxes(t, e, r, i, n, s) {
          for (var _a61 = i; _a61 < n; _a61++) {
            var _i107 = r.get(_a61),
                _n82 = this.getSymbolInstanceTextSize(t, s, e, _a61);

            this._addCollisionDebugVertices(_i107, _n82, this.textCollisionBox, _i107.anchorPoint, s);
          }
        }
      }, {
        key: "_addIconDebugCollisionBoxes",
        value: function _addIconDebugCollisionBoxes(t, e, r, i, n, s) {
          for (var _a62 = i; _a62 < n; _a62++) {
            var _i108 = r.get(_a62),
                _n83 = this.getSymbolInstanceIconSize(t, e, _a62);

            this._addCollisionDebugVertices(_i108, _n83, this.iconCollisionBox, _i108.anchorPoint, s);
          }
        }
      }, {
        key: "generateCollisionDebugBuffers",
        value: function generateCollisionDebugBuffers(t, e) {
          this.hasDebugData() && this.destroyDebugData(), this.textCollisionBox = new Gu(Kn, vl.members, ts), this.iconCollisionBox = new Gu(Kn, vl.members, ts);
          var r = Al(this.iconSizeData, t),
              i = Al(this.textSizeData, t);

          for (var _n84 = 0; _n84 < this.symbolInstances.length; _n84++) {
            var _s68 = this.symbolInstances.get(_n84);

            this._addTextDebugCollisionBoxes(i, t, e, _s68.textBoxStartIndex, _s68.textBoxEndIndex, _s68), this._addTextDebugCollisionBoxes(i, t, e, _s68.verticalTextBoxStartIndex, _s68.verticalTextBoxEndIndex, _s68), this._addIconDebugCollisionBoxes(r, t, e, _s68.iconBoxStartIndex, _s68.iconBoxEndIndex, _s68), this._addIconDebugCollisionBoxes(r, t, e, _s68.verticalIconBoxStartIndex, _s68.verticalIconBoxEndIndex, _s68);
          }
        }
      }, {
        key: "getSymbolInstanceTextSize",
        value: function getSymbolInstanceTextSize(t, e, r, i) {
          var n = this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex >= 0 ? e.rightJustifiedTextSymbolIndex : e.centerJustifiedTextSymbolIndex >= 0 ? e.centerJustifiedTextSymbolIndex : e.leftJustifiedTextSymbolIndex >= 0 ? e.leftJustifiedTextSymbolIndex : e.verticalPlacedTextSymbolIndex >= 0 ? e.verticalPlacedTextSymbolIndex : i),
              s = _l(this.textSizeData, t, n) / 24;
          return this.tilePixelRatio * s;
        }
      }, {
        key: "getSymbolInstanceIconSize",
        value: function getSymbolInstanceIconSize(t, e, r) {
          var i = this.icon.placedSymbolArray.get(r),
              n = _l(this.iconSizeData, t, i);

          return this.tilePixelRatio * n;
        }
      }, {
        key: "_commitDebugCollisionVertexUpdate",
        value: function _commitDebugCollisionVertexUpdate(t, e, r) {
          t.emplaceBack(e, -r, -r), t.emplaceBack(e, r, -r), t.emplaceBack(e, r, r), t.emplaceBack(e, -r, r);
        }
      }, {
        key: "_updateTextDebugCollisionBoxes",
        value: function _updateTextDebugCollisionBoxes(t, e, r, i, n, s) {
          for (var _a63 = i; _a63 < n; _a63++) {
            var _i109 = r.get(_a63),
                _n85 = this.getSymbolInstanceTextSize(t, s, e, _a63);

            this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt, _n85, _i109.padding);
          }
        }
      }, {
        key: "_updateIconDebugCollisionBoxes",
        value: function _updateIconDebugCollisionBoxes(t, e, r, i, n) {
          for (var _s69 = i; _s69 < n; _s69++) {
            var _i110 = r.get(_s69),
                _n86 = this.getSymbolInstanceIconSize(t, e, _s69);

            this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt, _n86, _i110.padding);
          }
        }
      }, {
        key: "updateCollisionDebugBuffers",
        value: function updateCollisionDebugBuffers(t, e) {
          if (!this.hasDebugData()) return;
          this.hasTextCollisionBoxData() && this.textCollisionBox.collisionVertexArrayExt.clear(), this.hasIconCollisionBoxData() && this.iconCollisionBox.collisionVertexArrayExt.clear();
          var r = Al(this.iconSizeData, t),
              i = Al(this.textSizeData, t);

          for (var _n87 = 0; _n87 < this.symbolInstances.length; _n87++) {
            var _s70 = this.symbolInstances.get(_n87);

            this._updateTextDebugCollisionBoxes(i, t, e, _s70.textBoxStartIndex, _s70.textBoxEndIndex, _s70), this._updateTextDebugCollisionBoxes(i, t, e, _s70.verticalTextBoxStartIndex, _s70.verticalTextBoxEndIndex, _s70), this._updateIconDebugCollisionBoxes(r, t, e, _s70.iconBoxStartIndex, _s70.iconBoxEndIndex), this._updateIconDebugCollisionBoxes(r, t, e, _s70.verticalIconBoxStartIndex, _s70.verticalIconBoxEndIndex);
          }

          this.hasTextCollisionBoxData() && this.textCollisionBox.collisionVertexBufferExt && this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt), this.hasIconCollisionBoxData() && this.iconCollisionBox.collisionVertexBufferExt && this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt);
        }
      }, {
        key: "_deserializeCollisionBoxesForSymbol",
        value: function _deserializeCollisionBoxesForSymbol(t, e, r, i, n, s, a, o, l) {
          var u = {};

          for (var _i111 = e; _i111 < r; _i111++) {
            var _e137 = t.get(_i111);

            u.textBox = {
              x1: _e137.x1,
              y1: _e137.y1,
              x2: _e137.x2,
              y2: _e137.y2,
              padding: _e137.padding,
              anchorPointX: _e137.anchorPointX,
              anchorPointY: _e137.anchorPointY
            }, u.textFeatureIndex = _e137.featureIndex;
            break;
          }

          for (var _e138 = i; _e138 < n; _e138++) {
            var _r141 = t.get(_e138);

            u.verticalTextBox = {
              x1: _r141.x1,
              y1: _r141.y1,
              x2: _r141.x2,
              y2: _r141.y2,
              padding: _r141.padding,
              anchorPointX: _r141.anchorPointX,
              anchorPointY: _r141.anchorPointY
            }, u.verticalTextFeatureIndex = _r141.featureIndex;
            break;
          }

          for (var _e139 = s; _e139 < a; _e139++) {
            var _r142 = t.get(_e139);

            u.iconBox = {
              x1: _r142.x1,
              y1: _r142.y1,
              x2: _r142.x2,
              y2: _r142.y2,
              padding: _r142.padding,
              anchorPointX: _r142.anchorPointX,
              anchorPointY: _r142.anchorPointY
            }, u.iconFeatureIndex = _r142.featureIndex;
            break;
          }

          for (var _e140 = o; _e140 < l; _e140++) {
            var _r143 = t.get(_e140);

            u.verticalIconBox = {
              x1: _r143.x1,
              y1: _r143.y1,
              x2: _r143.x2,
              y2: _r143.y2,
              padding: _r143.padding,
              anchorPointX: _r143.anchorPointX,
              anchorPointY: _r143.anchorPointY
            }, u.verticalIconFeatureIndex = _r143.featureIndex;
            break;
          }

          return u;
        }
      }, {
        key: "deserializeCollisionBoxes",
        value: function deserializeCollisionBoxes(t) {
          this.collisionArrays = [];

          for (var _e141 = 0; _e141 < this.symbolInstances.length; _e141++) {
            var _r144 = this.symbolInstances.get(_e141);

            this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t, _r144.textBoxStartIndex, _r144.textBoxEndIndex, _r144.verticalTextBoxStartIndex, _r144.verticalTextBoxEndIndex, _r144.iconBoxStartIndex, _r144.iconBoxEndIndex, _r144.verticalIconBoxStartIndex, _r144.verticalIconBoxEndIndex));
          }
        }
      }, {
        key: "hasTextData",
        value: function hasTextData() {
          return this.text.segments.get().length > 0;
        }
      }, {
        key: "hasIconData",
        value: function hasIconData() {
          return this.icon.segments.get().length > 0;
        }
      }, {
        key: "hasDebugData",
        value: function hasDebugData() {
          return this.textCollisionBox && this.iconCollisionBox;
        }
      }, {
        key: "hasTextCollisionBoxData",
        value: function hasTextCollisionBoxData() {
          return this.hasDebugData() && this.textCollisionBox.segments.get().length > 0;
        }
      }, {
        key: "hasIconCollisionBoxData",
        value: function hasIconCollisionBoxData() {
          return this.hasDebugData() && this.iconCollisionBox.segments.get().length > 0;
        }
      }, {
        key: "addIndicesForPlacedSymbol",
        value: function addIndicesForPlacedSymbol(t, e) {
          var r = t.placedSymbolArray.get(e),
              i = r.vertexStartIndex + 4 * r.numGlyphs;

          for (var _e142 = r.vertexStartIndex; _e142 < i; _e142 += 4) {
            t.indexArray.emplaceBack(_e142, _e142 + 1, _e142 + 2), t.indexArray.emplaceBack(_e142 + 1, _e142 + 2, _e142 + 3);
          }
        }
      }, {
        key: "getSortedSymbolIndexes",
        value: function getSortedSymbolIndexes(t) {
          if (this.sortedAngle === t && void 0 !== this.symbolInstanceIndexes) return this.symbolInstanceIndexes;
          var e = Math.sin(t),
              r = Math.cos(t),
              i = [],
              n = [],
              s = [];

          for (var _t146 = 0; _t146 < this.symbolInstances.length; ++_t146) {
            s.push(_t146);

            var _a64 = this.symbolInstances.get(_t146);

            i.push(0 | Math.round(e * _a64.anchorX + r * _a64.anchorY)), n.push(_a64.featureIndex);
          }

          return s.sort(function (t, e) {
            return i[t] - i[e] || n[e] - n[t];
          }), s;
        }
      }, {
        key: "addToSortKeyRanges",
        value: function addToSortKeyRanges(t, e) {
          var r = this.sortKeyRanges[this.sortKeyRanges.length - 1];
          r && r.sortKey === e ? r.symbolInstanceEnd = t + 1 : this.sortKeyRanges.push({
            sortKey: e,
            symbolInstanceStart: t,
            symbolInstanceEnd: t + 1
          });
        }
      }, {
        key: "sortFeatures",
        value: function sortFeatures(t) {
          var _this20 = this;

          if (this.sortFeaturesByY && this.sortedAngle !== t && !(this.text.segments.get().length > 1 || this.icon.segments.get().length > 1)) {
            this.symbolInstanceIndexes = this.getSortedSymbolIndexes(t), this.sortedAngle = t, this.text.indexArray.clear(), this.icon.indexArray.clear(), this.featureSortOrder = [];

            var _iterator102 = _createForOfIteratorHelper(this.symbolInstanceIndexes),
                _step102;

            try {
              for (_iterator102.s(); !(_step102 = _iterator102.n()).done;) {
                var _t147 = _step102.value;

                var _e143 = this.symbolInstances.get(_t147);

                this.featureSortOrder.push(_e143.featureIndex), [_e143.rightJustifiedTextSymbolIndex, _e143.centerJustifiedTextSymbolIndex, _e143.leftJustifiedTextSymbolIndex].forEach(function (t, e, r) {
                  t >= 0 && r.indexOf(t) === e && _this20.addIndicesForPlacedSymbol(_this20.text, t);
                }), _e143.verticalPlacedTextSymbolIndex >= 0 && this.addIndicesForPlacedSymbol(this.text, _e143.verticalPlacedTextSymbolIndex), _e143.placedIconSymbolIndex >= 0 && this.addIndicesForPlacedSymbol(this.icon, _e143.placedIconSymbolIndex), _e143.verticalPlacedIconSymbolIndex >= 0 && this.addIndicesForPlacedSymbol(this.icon, _e143.verticalPlacedIconSymbolIndex);
              }
            } catch (err) {
              _iterator102.e(err);
            } finally {
              _iterator102.f();
            }

            this.text.indexBuffer && this.text.indexBuffer.updateData(this.text.indexArray), this.icon.indexBuffer && this.icon.indexBuffer.updateData(this.icon.indexArray);
          }
        }
      }]);

      return Hu;
    }();

    ji("SymbolBucket", Hu, {
      omit: ["layers", "collisionBoxArray", "features", "compareText"]
    }), Hu.MAX_GLYPHS = 65535, Hu.addDynamicAttributes = Ku;
    var Ju = new En({
      "symbol-placement": new kn(Vt.layout_symbol["symbol-placement"]),
      "symbol-spacing": new kn(Vt.layout_symbol["symbol-spacing"]),
      "symbol-avoid-edges": new kn(Vt.layout_symbol["symbol-avoid-edges"]),
      "symbol-sort-key": new Sn(Vt.layout_symbol["symbol-sort-key"]),
      "symbol-z-order": new kn(Vt.layout_symbol["symbol-z-order"]),
      "icon-allow-overlap": new kn(Vt.layout_symbol["icon-allow-overlap"]),
      "icon-ignore-placement": new kn(Vt.layout_symbol["icon-ignore-placement"]),
      "icon-optional": new kn(Vt.layout_symbol["icon-optional"]),
      "icon-rotation-alignment": new kn(Vt.layout_symbol["icon-rotation-alignment"]),
      "icon-size": new Sn(Vt.layout_symbol["icon-size"]),
      "icon-text-fit": new kn(Vt.layout_symbol["icon-text-fit"]),
      "icon-text-fit-padding": new kn(Vt.layout_symbol["icon-text-fit-padding"]),
      "icon-image": new Sn(Vt.layout_symbol["icon-image"]),
      "icon-rotate": new Sn(Vt.layout_symbol["icon-rotate"]),
      "icon-padding": new kn(Vt.layout_symbol["icon-padding"]),
      "icon-keep-upright": new kn(Vt.layout_symbol["icon-keep-upright"]),
      "icon-offset": new Sn(Vt.layout_symbol["icon-offset"]),
      "icon-anchor": new Sn(Vt.layout_symbol["icon-anchor"]),
      "icon-pitch-alignment": new kn(Vt.layout_symbol["icon-pitch-alignment"]),
      "text-pitch-alignment": new kn(Vt.layout_symbol["text-pitch-alignment"]),
      "text-rotation-alignment": new kn(Vt.layout_symbol["text-rotation-alignment"]),
      "text-field": new Sn(Vt.layout_symbol["text-field"]),
      "text-font": new Sn(Vt.layout_symbol["text-font"]),
      "text-size": new Sn(Vt.layout_symbol["text-size"]),
      "text-max-width": new Sn(Vt.layout_symbol["text-max-width"]),
      "text-line-height": new kn(Vt.layout_symbol["text-line-height"]),
      "text-letter-spacing": new Sn(Vt.layout_symbol["text-letter-spacing"]),
      "text-justify": new Sn(Vt.layout_symbol["text-justify"]),
      "text-radial-offset": new Sn(Vt.layout_symbol["text-radial-offset"]),
      "text-variable-anchor": new kn(Vt.layout_symbol["text-variable-anchor"]),
      "text-anchor": new Sn(Vt.layout_symbol["text-anchor"]),
      "text-max-angle": new kn(Vt.layout_symbol["text-max-angle"]),
      "text-writing-mode": new kn(Vt.layout_symbol["text-writing-mode"]),
      "text-rotate": new Sn(Vt.layout_symbol["text-rotate"]),
      "text-padding": new kn(Vt.layout_symbol["text-padding"]),
      "text-keep-upright": new kn(Vt.layout_symbol["text-keep-upright"]),
      "text-transform": new Sn(Vt.layout_symbol["text-transform"]),
      "text-offset": new Sn(Vt.layout_symbol["text-offset"]),
      "text-allow-overlap": new kn(Vt.layout_symbol["text-allow-overlap"]),
      "text-ignore-placement": new kn(Vt.layout_symbol["text-ignore-placement"]),
      "text-optional": new kn(Vt.layout_symbol["text-optional"])
    });
    var Yu = {
      paint: new En({
        "icon-opacity": new Sn(Vt.paint_symbol["icon-opacity"]),
        "icon-color": new Sn(Vt.paint_symbol["icon-color"]),
        "icon-halo-color": new Sn(Vt.paint_symbol["icon-halo-color"]),
        "icon-halo-width": new Sn(Vt.paint_symbol["icon-halo-width"]),
        "icon-halo-blur": new Sn(Vt.paint_symbol["icon-halo-blur"]),
        "icon-translate": new kn(Vt.paint_symbol["icon-translate"]),
        "icon-translate-anchor": new kn(Vt.paint_symbol["icon-translate-anchor"]),
        "text-opacity": new Sn(Vt.paint_symbol["text-opacity"]),
        "text-color": new Sn(Vt.paint_symbol["text-color"], {
          runtimeType: Xt,
          getOverride: function getOverride(t) {
            return t.textColor;
          },
          hasOverride: function hasOverride(t) {
            return !!t.textColor;
          }
        }),
        "text-halo-color": new Sn(Vt.paint_symbol["text-halo-color"]),
        "text-halo-width": new Sn(Vt.paint_symbol["text-halo-width"]),
        "text-halo-blur": new Sn(Vt.paint_symbol["text-halo-blur"]),
        "text-translate": new kn(Vt.paint_symbol["text-translate"]),
        "text-translate-anchor": new kn(Vt.paint_symbol["text-translate-anchor"])
      }),
      layout: Ju
    };

    var Wu = /*#__PURE__*/function () {
      function Wu(t) {
        _classCallCheck(this, Wu);

        this.type = t.property.overrides ? t.property.overrides.runtimeType : Nt, this.defaultValue = t;
      }

      _createClass(Wu, [{
        key: "evaluate",
        value: function evaluate(t) {
          if (t.formattedSection) {
            var _e144 = this.defaultValue.property.overrides;
            if (_e144 && _e144.hasOverride(t.formattedSection)) return _e144.getOverride(t.formattedSection);
          }

          return t.feature && t.featureState ? this.defaultValue.evaluate(t.feature, t.featureState) : this.defaultValue.property.specification["default"];
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.defaultValue.isConstant() || t(this.defaultValue.value._styleExpression.expression);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return null;
        }
      }]);

      return Wu;
    }();

    ji("FormatSectionOverride", Wu, {
      omit: ["defaultValue"]
    });

    var Qu = /*#__PURE__*/function (_Rs) {
      _inherits(Qu, _Rs);

      var _super46 = _createSuper(Qu);

      function Qu(t) {
        _classCallCheck(this, Qu);

        return _super46.call(this, t, Yu);
      }

      _createClass(Qu, [{
        key: "recalculate",
        value: function recalculate(t, e) {
          if (_get(_getPrototypeOf(Qu.prototype), "recalculate", this).call(this, t, e), "auto" === this.layout.get("icon-rotation-alignment") && (this.layout._values["icon-rotation-alignment"] = "point" !== this.layout.get("symbol-placement") ? "map" : "viewport"), "auto" === this.layout.get("text-rotation-alignment") && (this.layout._values["text-rotation-alignment"] = "point" !== this.layout.get("symbol-placement") ? "map" : "viewport"), "auto" === this.layout.get("text-pitch-alignment") && (this.layout._values["text-pitch-alignment"] = this.layout.get("text-rotation-alignment")), "auto" === this.layout.get("icon-pitch-alignment") && (this.layout._values["icon-pitch-alignment"] = this.layout.get("icon-rotation-alignment")), "point" === this.layout.get("symbol-placement")) {
            var _t148 = this.layout.get("text-writing-mode");

            if (_t148) {
              var _e145 = [];

              var _iterator103 = _createForOfIteratorHelper(_t148),
                  _step103;

              try {
                for (_iterator103.s(); !(_step103 = _iterator103.n()).done;) {
                  var _r145 = _step103.value;
                  _e145.indexOf(_r145) < 0 && _e145.push(_r145);
                }
              } catch (err) {
                _iterator103.e(err);
              } finally {
                _iterator103.f();
              }

              this.layout._values["text-writing-mode"] = _e145;
            } else this.layout._values["text-writing-mode"] = ["horizontal"];
          }

          this._setPaintOverrides();
        }
      }, {
        key: "getValueAndResolveTokens",
        value: function getValueAndResolveTokens(t, e, r, i) {
          var n = this.layout.get(t).evaluate(e, {}, r, i),
              s = this._unevaluatedLayout._values[t];
          return s.isDataDriven() || Yr(s.value) || !n ? n : function (t, e) {
            return e.replace(/{([^{}]+)}/g, function (e, r) {
              return r in t ? String(t[r]) : "";
            });
          }(e.properties, n);
        }
      }, {
        key: "createBucket",
        value: function createBucket(t) {
          return new Hu(t);
        }
      }, {
        key: "queryRadius",
        value: function queryRadius() {
          return 0;
        }
      }, {
        key: "queryIntersectsFeature",
        value: function queryIntersectsFeature() {
          return !1;
        }
      }, {
        key: "_setPaintOverrides",
        value: function _setPaintOverrides() {
          var _iterator104 = _createForOfIteratorHelper(Yu.paint.overridableProperties),
              _step104;

          try {
            for (_iterator104.s(); !(_step104 = _iterator104.n()).done;) {
              var _t149 = _step104.value;
              if (!Qu.hasPaintOverride(this.layout, _t149)) continue;

              var _e146 = this.paint.get(_t149),
                  _r146 = new Wu(_e146),
                  _i112 = new Jr(_r146, _e146.property.specification);

              var _n88 = null;
              _n88 = "constant" === _e146.value.kind || "source" === _e146.value.kind ? new Qr("source", _i112) : new ti("composite", _i112, _e146.value.zoomStops, _e146.value._interpolationType), this.paint._values[_t149] = new _n(_e146.property, _n88, _e146.parameters);
            }
          } catch (err) {
            _iterator104.e(err);
          } finally {
            _iterator104.f();
          }
        }
      }, {
        key: "_handleOverridablePaintPropertyUpdate",
        value: function _handleOverridablePaintPropertyUpdate(t, e, r) {
          return !(!this.layout || e.isDataDriven() || r.isDataDriven()) && Qu.hasPaintOverride(this.layout, t);
        }
      }, {
        key: "getProgramConfiguration",
        value: function getProgramConfiguration(t) {
          return new Ds(this, t);
        }
      }], [{
        key: "hasPaintOverride",
        value: function hasPaintOverride(t, e) {
          var r = t.get("text-field"),
              i = Yu.paint.properties[e];
          var n = !1;

          var s = function s(t) {
            var _iterator105 = _createForOfIteratorHelper(t),
                _step105;

            try {
              for (_iterator105.s(); !(_step105 = _iterator105.n()).done;) {
                var _e147 = _step105.value;
                if (i.overrides && i.overrides.hasOverride(_e147)) return void (n = !0);
              }
            } catch (err) {
              _iterator105.e(err);
            } finally {
              _iterator105.f();
            }
          };

          if ("constant" === r.value.kind && r.value.value instanceof ce) s(r.value.value.sections);else if ("source" === r.value.kind) {
            var _t150 = function _t150(e) {
              n || (e instanceof me && fe(e.value) === Yt ? s(e.value.sections) : e instanceof be ? s(e.sections) : e.eachChild(_t150));
            },
                _e148 = r.value;

            _e148._styleExpression && _t150(_e148._styleExpression.expression);
          }
          return n;
        }
      }]);

      return Qu;
    }(Rs);

    var tc = {
      paint: new En({
        "background-color": new kn(Vt.paint_background["background-color"]),
        "background-pattern": new Tn(Vt.paint_background["background-pattern"]),
        "background-opacity": new kn(Vt.paint_background["background-opacity"])
      })
    },
        ec = {
      paint: new En({
        "raster-opacity": new kn(Vt.paint_raster["raster-opacity"]),
        "raster-hue-rotate": new kn(Vt.paint_raster["raster-hue-rotate"]),
        "raster-brightness-min": new kn(Vt.paint_raster["raster-brightness-min"]),
        "raster-brightness-max": new kn(Vt.paint_raster["raster-brightness-max"]),
        "raster-saturation": new kn(Vt.paint_raster["raster-saturation"]),
        "raster-contrast": new kn(Vt.paint_raster["raster-contrast"]),
        "raster-resampling": new kn(Vt.paint_raster["raster-resampling"]),
        "raster-fade-duration": new kn(Vt.paint_raster["raster-fade-duration"])
      })
    };

    var rc = /*#__PURE__*/function (_Rs2) {
      _inherits(rc, _Rs2);

      var _super47 = _createSuper(rc);

      function rc(t) {
        var _this21;

        _classCallCheck(this, rc);

        _this21 = _super47.call(this, t, {}), _this21.implementation = t;
        return _this21;
      }

      _createClass(rc, [{
        key: "is3D",
        value: function is3D() {
          return "3d" === this.implementation.renderingMode;
        }
      }, {
        key: "hasOffscreenPass",
        value: function hasOffscreenPass() {
          return void 0 !== this.implementation.prerender;
        }
      }, {
        key: "recalculate",
        value: function recalculate() {}
      }, {
        key: "updateTransitions",
        value: function updateTransitions() {}
      }, {
        key: "hasTransition",
        value: function hasTransition() {}
      }, {
        key: "serialize",
        value: function serialize() {}
      }, {
        key: "onAdd",
        value: function onAdd(t) {
          this.implementation.onAdd && this.implementation.onAdd(t, t.painter.context.gl);
        }
      }, {
        key: "onRemove",
        value: function onRemove(t) {
          this.implementation.onRemove && this.implementation.onRemove(t, t.painter.context.gl);
        }
      }]);

      return rc;
    }(Rs);

    var ic = {
      paint: new En({
        "sky-type": new kn(Vt.paint_sky["sky-type"]),
        "sky-atmosphere-sun": new kn(Vt.paint_sky["sky-atmosphere-sun"]),
        "sky-atmosphere-sun-intensity": new kn(Vt.paint_sky["sky-atmosphere-sun-intensity"]),
        "sky-gradient-center": new kn(Vt.paint_sky["sky-gradient-center"]),
        "sky-gradient-radius": new kn(Vt.paint_sky["sky-gradient-radius"]),
        "sky-gradient": new zn(Vt.paint_sky["sky-gradient"]),
        "sky-atmosphere-halo-color": new kn(Vt.paint_sky["sky-atmosphere-halo-color"]),
        "sky-atmosphere-color": new kn(Vt.paint_sky["sky-atmosphere-color"]),
        "sky-opacity": new kn(Vt.paint_sky["sky-opacity"])
      })
    };

    function nc(t, e, r) {
      var i = va(0, 0, 1),
          n = Da(Ba());
      return function (t, e, r) {
        r *= .5;
        var i = e[0],
            n = e[1],
            s = e[2],
            a = e[3],
            o = Math.sin(r),
            l = Math.cos(r);
        t[0] = i * l - s * o, t[1] = n * l + a * o, t[2] = s * l + i * o, t[3] = a * l - n * o;
      }(n, n, r ? -c(t) + Math.PI : c(t)), Pa(n, n, -c(e)), Ta(i, i, n), ka(i, i);
    }

    var sc = {
      circle: /*#__PURE__*/function (_Rs3) {
        _inherits(circle, _Rs3);

        var _super48 = _createSuper(circle);

        function circle(t) {
          _classCallCheck(this, circle);

          return _super48.call(this, t, ca);
        }

        _createClass(circle, [{
          key: "createBucket",
          value: function createBucket(t) {
            return new Zs(t);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius(t) {
            var e = t;
            return sa("circle-radius", this, e) + sa("circle-stroke-width", this, e) + aa(this.paint.get("circle-translate"));
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature(t, e, r, i, n, s, a, o) {
            var _this22 = this;

            var l = "map" === this.paint.get("circle-pitch-alignment");
            if (l && t.queryGeometry.isAboveHorizon) return !1;
            var u = la(this.paint.get("circle-translate"), this.paint.get("circle-translate-anchor"), s.angle, t.pixelToTileUnitsFactor),
                c = this.paint.get("circle-radius").evaluate(e, r) + this.paint.get("circle-stroke-width").evaluate(e, r),
                h = l ? c * t.pixelToTileUnitsFactor : c;

            var _iterator106 = _createForOfIteratorHelper(i),
                _step106;

            try {
              for (_iterator106.s(); !(_step106 = _iterator106.n()).done;) {
                var _e149 = _step106.value;

                var _iterator107 = _createForOfIteratorHelper(_e149),
                    _step107;

                try {
                  var _loop3 = function _loop3() {
                    var r = _step107.value;
                    var e = r.add(u),
                        i = o && s.elevation ? s.elevation.exaggeration() * o.getElevationAt(e.x, e.y, !0) : 0,
                        n = l ? e : Ra(e, i, a),
                        c = l ? t.tilespaceRays.map(function (t) {
                      return Oa(t, i);
                    }) : t.queryGeometry.screenGeometry;
                    var p = h;
                    var d = Ma([], [r.x, r.y, i, 1], a);
                    if ("viewport" === _this22.paint.get("circle-pitch-scale") && "map" === _this22.paint.get("circle-pitch-alignment") ? p *= d[3] / s.cameraToCenterDistance : "map" === _this22.paint.get("circle-pitch-scale") && "viewport" === _this22.paint.get("circle-pitch-alignment") && (p *= s.cameraToCenterDistance / d[3]), Gs(c, n, p)) return {
                      v: !0
                    };
                  };

                  for (_iterator107.s(); !(_step107 = _iterator107.n()).done;) {
                    var _ret = _loop3();

                    if (_typeof(_ret) === "object") return _ret.v;
                  }
                } catch (err) {
                  _iterator107.e(err);
                } finally {
                  _iterator107.f();
                }
              }
            } catch (err) {
              _iterator106.e(err);
            } finally {
              _iterator106.f();
            }

            return !1;
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            return ["circle"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new Ds(this, t);
          }
        }]);

        return circle;
      }(Rs),
      heatmap: /*#__PURE__*/function (_Rs4) {
        _inherits(heatmap, _Rs4);

        var _super49 = _createSuper(heatmap);

        _createClass(heatmap, [{
          key: "createBucket",
          value: function createBucket(t) {
            return new $a(t);
          }
        }]);

        function heatmap(t) {
          var _this23;

          _classCallCheck(this, heatmap);

          _this23 = _super49.call(this, t, Xa), _this23._updateColorRamp();
          return _this23;
        }

        _createClass(heatmap, [{
          key: "_handleSpecialPaintPropertyUpdate",
          value: function _handleSpecialPaintPropertyUpdate(t) {
            "heatmap-color" === t && this._updateColorRamp();
          }
        }, {
          key: "_updateColorRamp",
          value: function _updateColorRamp() {
            this.colorRamp = Ga({
              expression: this._transitionablePaint._values["heatmap-color"].value.expression,
              evaluationKey: "heatmapDensity",
              image: this.colorRamp
            }), this.colorRampTexture = null;
          }
        }, {
          key: "resize",
          value: function resize() {
            this.heatmapFbo && (this.heatmapFbo.destroy(), this.heatmapFbo = null);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius() {
            return 0;
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature() {
            return !1;
          }
        }, {
          key: "hasOffscreenPass",
          value: function hasOffscreenPass() {
            return 0 !== this.paint.get("heatmap-opacity") && "none" !== this.visibility;
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            return ["heatmap", "heatmapTexture"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new Ds(this, t);
          }
        }]);

        return heatmap;
      }(Rs),
      hillshade: /*#__PURE__*/function (_Rs5) {
        _inherits(hillshade, _Rs5);

        var _super50 = _createSuper(hillshade);

        function hillshade(t) {
          _classCallCheck(this, hillshade);

          return _super50.call(this, t, Ha);
        }

        _createClass(hillshade, [{
          key: "hasOffscreenPass",
          value: function hasOffscreenPass() {
            return 0 !== this.paint.get("hillshade-exaggeration") && "none" !== this.visibility;
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            return ["hillshade", "hillshadePrepare"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new Ds(this, t);
          }
        }]);

        return hillshade;
      }(Rs),
      fill: /*#__PURE__*/function (_Rs6) {
        _inherits(fill, _Rs6);

        var _super51 = _createSuper(fill);

        function fill(t) {
          _classCallCheck(this, fill);

          return _super51.call(this, t, Fo);
        }

        _createClass(fill, [{
          key: "getProgramIds",
          value: function getProgramIds() {
            var t = this.paint.get("fill-pattern"),
                e = t && t.constantOr(1),
                r = [e ? "fillPattern" : "fill"];
            return this.paint.get("fill-antialias") && r.push(e && !this.getPaintProperty("fill-outline-color") ? "fillOutlinePattern" : "fillOutline"), r;
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new Ds(this, t);
          }
        }, {
          key: "recalculate",
          value: function recalculate(t, e) {
            _get(_getPrototypeOf(fill.prototype), "recalculate", this).call(this, t, e);

            var r = this.paint._values["fill-outline-color"];
            "constant" === r.value.kind && void 0 === r.value.value && (this.paint._values["fill-outline-color"] = this.paint._values["fill-color"]);
          }
        }, {
          key: "createBucket",
          value: function createBucket(t) {
            return new Po(t);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius() {
            return aa(this.paint.get("fill-translate"));
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature(t, e, r, i, n, s) {
            return !t.queryGeometry.isAboveHorizon && Hs(oa(t.tilespaceGeometry, this.paint.get("fill-translate"), this.paint.get("fill-translate-anchor"), s.angle, t.pixelToTileUnitsFactor), i);
          }
        }, {
          key: "isTileClipped",
          value: function isTileClipped() {
            return !0;
          }
        }]);

        return fill;
      }(Rs),
      "fill-extrusion": /*#__PURE__*/function (_Rs7) {
        _inherits(fillExtrusion, _Rs7);

        var _super52 = _createSuper(fillExtrusion);

        function fillExtrusion(t) {
          _classCallCheck(this, fillExtrusion);

          return _super52.call(this, t, el);
        }

        _createClass(fillExtrusion, [{
          key: "createBucket",
          value: function createBucket(t) {
            return new Qo(t);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius() {
            return aa(this.paint.get("fill-extrusion-translate"));
          }
        }, {
          key: "is3D",
          value: function is3D() {
            return !0;
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            return [this.paint.get("fill-extrusion-pattern").constantOr(1) ? "fillExtrusionPattern" : "fillExtrusion"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new Ds(this, t);
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature(t, e, r, n, s, a, o) {
            var l = la(this.paint.get("fill-extrusion-translate"), this.paint.get("fill-extrusion-translate-anchor"), a.angle, t.pixelToTileUnitsFactor),
                u = this.paint.get("fill-extrusion-height").evaluate(e, r),
                c = this.paint.get("fill-extrusion-base").evaluate(e, r),
                h = t.queryGeometry.screenGeometry,
                p = function (t, e, r, n, s) {
              var a = [],
                  o = [],
                  l = s[8] * e,
                  u = s[9] * e,
                  c = s[10] * e,
                  h = s[11] * e,
                  p = s[8] * r,
                  d = s[9] * r,
                  f = s[10] * r,
                  y = s[11] * r;

              var _iterator108 = _createForOfIteratorHelper(t),
                  _step108;

              try {
                for (_iterator108.s(); !(_step108 = _iterator108.n()).done;) {
                  var _e150 = _step108.value;
                  var _t151 = [],
                      _r147 = [];

                  var _iterator109 = _createForOfIteratorHelper(_e150),
                      _step109;

                  try {
                    for (_iterator109.s(); !(_step109 = _iterator109.n()).done;) {
                      var _a65 = _step109.value;

                      var _e151 = _a65.x + n.x,
                          _o33 = _a65.y + n.y,
                          _m8 = s[0] * _e151 + s[4] * _o33 + s[12],
                          _g7 = s[1] * _e151 + s[5] * _o33 + s[13],
                          _x7 = s[2] * _e151 + s[6] * _o33 + s[14],
                          _v7 = s[3] * _e151 + s[7] * _o33 + s[15],
                          _b6 = _x7 + c,
                          _w6 = _v7 + h,
                          _8 = _m8 + p,
                          _A6 = _g7 + d,
                          _k6 = _x7 + f,
                          _S4 = _v7 + y,
                          _I2 = new i((_m8 + l) / _w6, (_g7 + u) / _w6);

                      _I2.z = _b6 / _w6, _t151.push(_I2);

                      var _T2 = new i(_8 / _S4, _A6 / _S4);

                      _T2.z = _k6 / _S4, _r147.push(_T2);
                    }
                  } catch (err) {
                    _iterator109.e(err);
                  } finally {
                    _iterator109.f();
                  }

                  a.push(_t151), o.push(_r147);
                }
              } catch (err) {
                _iterator108.e(err);
              } finally {
                _iterator108.f();
              }

              return [a, o];
            }(n, c, u, l, o);

            return function (t, e, r) {
              var i = 1 / 0;
              Hs(r, e) && (i = il(r, e[0]));

              for (var _n89 = 0; _n89 < e.length; _n89++) {
                var _s71 = e[_n89],
                    _a66 = t[_n89];

                for (var _t152 = 0; _t152 < _s71.length - 1; _t152++) {
                  var _e152 = _s71[_t152],
                      _n90 = [_e152, _s71[_t152 + 1], _a66[_t152 + 1], _a66[_t152], _e152];
                  Xs(r, _n90) && (i = Math.min(i, il(r, _n90)));
                }
              }

              return i !== 1 / 0 && i;
            }(p[0], p[1], h);
          }
        }]);

        return fillExtrusion;
      }(Rs),
      line: /*#__PURE__*/function (_Rs8) {
        _inherits(line, _Rs8);

        var _super53 = _createSuper(line);

        function line(t) {
          var _this24;

          _classCallCheck(this, line);

          _this24 = _super53.call(this, t, pl), _this24.gradientVersion = 0;
          return _this24;
        }

        _createClass(line, [{
          key: "_handleSpecialPaintPropertyUpdate",
          value: function _handleSpecialPaintPropertyUpdate(t) {
            "line-gradient" === t && (this.stepInterpolant = this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Je, this.gradientVersion = (this.gradientVersion + 1) % o);
          }
        }, {
          key: "gradientExpression",
          value: function gradientExpression() {
            return this._transitionablePaint._values["line-gradient"].value.expression;
          }
        }, {
          key: "recalculate",
          value: function recalculate(t, e) {
            _get(_getPrototypeOf(line.prototype), "recalculate", this).call(this, t, e), this.paint._values["line-floorwidth"] = dl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value, t);
          }
        }, {
          key: "createBucket",
          value: function createBucket(t) {
            return new cl(t);
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            var t = this.paint.get("line-dasharray"),
                e = this.paint.get("line-pattern").constantOr(1),
                r = this.paint.get("line-gradient");
            return [e ? "linePattern" : t ? "lineSDF" : r ? "lineGradient" : "line"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new Ds(this, t);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius(t) {
            var e = t,
                r = fl(sa("line-width", this, e), sa("line-gap-width", this, e)),
                i = sa("line-offset", this, e);
            return r / 2 + Math.abs(i) + aa(this.paint.get("line-translate"));
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature(t, e, r, n, s, a) {
            if (t.queryGeometry.isAboveHorizon) return !1;
            var o = oa(t.tilespaceGeometry, this.paint.get("line-translate"), this.paint.get("line-translate-anchor"), a.angle, t.pixelToTileUnitsFactor),
                l = t.pixelToTileUnitsFactor / 2 * fl(this.paint.get("line-width").evaluate(e, r), this.paint.get("line-gap-width").evaluate(e, r)),
                u = this.paint.get("line-offset").evaluate(e, r);
            return u && (n = function (t, e) {
              var r = [],
                  n = new i(0, 0);

              for (var _i113 = 0; _i113 < t.length; _i113++) {
                var _s72 = t[_i113],
                    _a67 = [];

                for (var _t153 = 0; _t153 < _s72.length; _t153++) {
                  var _r148 = _s72[_t153 - 1],
                      _i114 = _s72[_t153],
                      _o34 = _s72[_t153 + 1],
                      _l25 = 0 === _t153 ? n : _i114.sub(_r148)._unit()._perp(),
                      _u21 = _t153 === _s72.length - 1 ? n : _o34.sub(_i114)._unit()._perp(),
                      _c15 = _l25._add(_u21)._unit();

                  _c15._mult(1 / (_c15.x * _u21.x + _c15.y * _u21.y)), _a67.push(_c15._mult(e)._add(_i114));
                }

                r.push(_a67);
              }

              return r;
            }(n, u * t.pixelToTileUnitsFactor)), function (t, e, r) {
              for (var _i115 = 0; _i115 < e.length; _i115++) {
                var _n91 = e[_i115];
                if (t.length >= 3) for (var _e153 = 0; _e153 < _n91.length; _e153++) {
                  if (ra(t, _n91[_e153])) return !0;
                }
                if (Js(t, _n91, r)) return !0;
              }

              return !1;
            }(o, n, l);
          }
        }, {
          key: "isTileClipped",
          value: function isTileClipped() {
            return !0;
          }
        }]);

        return line;
      }(Rs),
      symbol: Qu,
      background: /*#__PURE__*/function (_Rs9) {
        _inherits(background, _Rs9);

        var _super54 = _createSuper(background);

        function background(t) {
          _classCallCheck(this, background);

          return _super54.call(this, t, tc);
        }

        _createClass(background, [{
          key: "getProgramIds",
          value: function getProgramIds() {
            return [this.paint.get("background-pattern") ? "backgroundPattern" : "background"];
          }
        }]);

        return background;
      }(Rs),
      raster: /*#__PURE__*/function (_Rs10) {
        _inherits(raster, _Rs10);

        var _super55 = _createSuper(raster);

        function raster(t) {
          _classCallCheck(this, raster);

          return _super55.call(this, t, ec);
        }

        _createClass(raster, [{
          key: "getProgramIds",
          value: function getProgramIds() {
            return ["raster"];
          }
        }]);

        return raster;
      }(Rs),
      sky: /*#__PURE__*/function (_Rs11) {
        _inherits(sky, _Rs11);

        var _super56 = _createSuper(sky);

        function sky(t) {
          var _this25;

          _classCallCheck(this, sky);

          _this25 = _super56.call(this, t, ic), _this25._updateColorRamp();
          return _this25;
        }

        _createClass(sky, [{
          key: "_handleSpecialPaintPropertyUpdate",
          value: function _handleSpecialPaintPropertyUpdate(t) {
            "sky-gradient" === t ? this._updateColorRamp() : "sky-atmosphere-sun" !== t && "sky-atmosphere-halo-color" !== t && "sky-atmosphere-color" !== t && "sky-atmosphere-sun-intensity" !== t || (this._skyboxInvalidated = !0);
          }
        }, {
          key: "_updateColorRamp",
          value: function _updateColorRamp() {
            this.colorRamp = Ga({
              expression: this._transitionablePaint._values["sky-gradient"].value.expression,
              evaluationKey: "skyRadialProgress"
            }), this.colorRampTexture && (this.colorRampTexture.destroy(), this.colorRampTexture = null);
          }
        }, {
          key: "needsSkyboxCapture",
          value: function needsSkyboxCapture(t) {
            if (this._skyboxInvalidated || !this.skyboxTexture || !this.skyboxGeometry) return !0;

            if (!this.paint.get("sky-atmosphere-sun")) {
              var _e154 = t.style.light.properties.get("position");

              return this._lightPosition.azimuthal !== _e154.azimuthal || this._lightPosition.polar !== _e154.polar;
            }
          }
        }, {
          key: "getCenter",
          value: function getCenter(t, e) {
            var r = this.paint.get("sky-type");

            if ("atmosphere" === r) {
              var _r149 = this.paint.get("sky-atmosphere-sun"),
                  _i116 = !_r149,
                  _n92 = t.style.light,
                  _s73 = _n92.properties.get("position");

              return _i116 && "viewport" === _n92.properties.get("anchor") && z("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."), _i116 ? nc(_s73.azimuthal, 90 - _s73.polar, e) : nc(_r149[0], 90 - _r149[1], e);
            }

            if ("gradient" === r) {
              var _t154 = this.paint.get("sky-gradient-center");

              return nc(_t154[0], 90 - _t154[1], e);
            }
          }
        }, {
          key: "is3D",
          value: function is3D() {
            return !1;
          }
        }, {
          key: "isSky",
          value: function isSky() {
            return !0;
          }
        }, {
          key: "markSkyboxValid",
          value: function markSkyboxValid(t) {
            this._skyboxInvalidated = !1, this._lightPosition = t.style.light.properties.get("position");
          }
        }, {
          key: "hasOffscreenPass",
          value: function hasOffscreenPass() {
            return !0;
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            var t = this.paint.get("sky-type");
            return "atmosphere" === t ? ["skyboxCapture", "skybox"] : "gradient" === t ? ["skyboxGradient"] : null;
          }
        }]);

        return sky;
      }(Rs)
    },
        ac = s.HTMLImageElement,
        oc = s.HTMLCanvasElement,
        lc = s.HTMLVideoElement,
        uc = s.ImageData,
        cc = s.ImageBitmap;

    var hc = /*#__PURE__*/function () {
      function hc(t, e, r, i) {
        _classCallCheck(this, hc);

        this.context = t, this.format = r, this.texture = t.gl.createTexture(), this.update(e, i);
      }

      _createClass(hc, [{
        key: "update",
        value: function update(t, e, r) {
          var i = t.width,
              n = t.height,
              s = !(this.size && this.size[0] === i && this.size[1] === n || r),
              a = this.context,
              o = a.gl;
          if (this.useMipmap = Boolean(e && e.useMipmap), o.bindTexture(o.TEXTURE_2D, this.texture), a.pixelStoreUnpackFlipY.set(!1), a.pixelStoreUnpack.set(1), a.pixelStoreUnpackPremultiplyAlpha.set(this.format === o.RGBA && (!e || !1 !== e.premultiply)), s) this.size = [i, n], t instanceof ac || t instanceof oc || t instanceof lc || t instanceof uc || cc && t instanceof cc ? o.texImage2D(o.TEXTURE_2D, 0, this.format, this.format, o.UNSIGNED_BYTE, t) : o.texImage2D(o.TEXTURE_2D, 0, this.format, i, n, 0, this.format, o.UNSIGNED_BYTE, t.data);else {
            var _ref157 = r || {
              x: 0,
              y: 0
            },
                _e155 = _ref157.x,
                _s74 = _ref157.y;

            t instanceof ac || t instanceof oc || t instanceof lc || t instanceof uc || cc && t instanceof cc ? o.texSubImage2D(o.TEXTURE_2D, 0, _e155, _s74, o.RGBA, o.UNSIGNED_BYTE, t) : o.texSubImage2D(o.TEXTURE_2D, 0, _e155, _s74, i, n, o.RGBA, o.UNSIGNED_BYTE, t.data);
          }
          this.useMipmap && this.isSizePowerOfTwo() && o.generateMipmap(o.TEXTURE_2D);
        }
      }, {
        key: "bind",
        value: function bind(t, e, r) {
          var i = this.context,
              n = i.gl;
          n.bindTexture(n.TEXTURE_2D, this.texture), r !== n.LINEAR_MIPMAP_NEAREST || this.isSizePowerOfTwo() || (r = n.LINEAR), t !== this.filter && (n.texParameteri(n.TEXTURE_2D, n.TEXTURE_MAG_FILTER, t), n.texParameteri(n.TEXTURE_2D, n.TEXTURE_MIN_FILTER, r || t), this.filter = t), e !== this.wrap && (n.texParameteri(n.TEXTURE_2D, n.TEXTURE_WRAP_S, e), n.texParameteri(n.TEXTURE_2D, n.TEXTURE_WRAP_T, e), this.wrap = e);
        }
      }, {
        key: "isSizePowerOfTwo",
        value: function isSizePowerOfTwo() {
          return this.size[0] === this.size[1] && Math.log(this.size[0]) / Math.LN2 % 1 == 0;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          var t = this.context.gl;
          t.deleteTexture(this.texture), this.texture = null;
        }
      }]);

      return hc;
    }();

    var pc = /*#__PURE__*/function () {
      function pc(t) {
        var _this26 = this;

        _classCallCheck(this, pc);

        this._callback = t, this._triggered = !1, "undefined" != typeof MessageChannel && (this._channel = new MessageChannel(), this._channel.port2.onmessage = function () {
          _this26._triggered = !1, _this26._callback();
        });
      }

      _createClass(pc, [{
        key: "trigger",
        value: function trigger() {
          var _this27 = this;

          this._triggered || (this._triggered = !0, this._channel ? this._channel.port1.postMessage(!0) : setTimeout(function () {
            _this27._triggered = !1, _this27._callback();
          }, 0));
        }
      }, {
        key: "remove",
        value: function remove() {
          delete this._channel, this._callback = function () {};
        }
      }]);

      return pc;
    }();

    var dc = s.performance;

    var fc = /*#__PURE__*/function () {
      function fc(t) {
        _classCallCheck(this, fc);

        this._marks = {
          start: [t.url, "start"].join("#"),
          end: [t.url, "end"].join("#"),
          measure: t.url.toString()
        }, dc.mark(this._marks.start);
      }

      _createClass(fc, [{
        key: "finish",
        value: function finish() {
          dc.mark(this._marks.end);
          var t = dc.getEntriesByName(this._marks.measure);
          return 0 === t.length && (dc.measure(this._marks.measure, this._marks.start, this._marks.end), t = dc.getEntriesByName(this._marks.measure), dc.clearMarks(this._marks.start), dc.clearMarks(this._marks.end), dc.clearMeasures(this._marks.measure)), t;
        }
      }]);

      return fc;
    }();

    var yc = /*#__PURE__*/function () {
      function yc() {
        _classCallCheck(this, yc);

        this.tasks = {}, this.taskQueue = [], _(["process"], this), this.invoker = new pc(this.process), this.nextId = 0;
      }

      _createClass(yc, [{
        key: "add",
        value: function add(t, e) {
          var _this28 = this;

          var r = this.nextId++;
          return this.tasks[r] = {
            fn: t,
            metadata: e,
            priority: mc(e),
            id: r
          }, this.taskQueue.push(r), this.invoker.trigger(), {
            cancel: function cancel() {
              delete _this28.tasks[r];
            }
          };
        }
      }, {
        key: "process",
        value: function process() {
          var _this29 = this;

          M();

          try {
            if (this.taskQueue = this.taskQueue.filter(function (t) {
              return !!_this29.tasks[t];
            }), !this.taskQueue.length) return;

            var _t155 = this.pick();

            if (null === _t155) return;
            var _e156 = this.tasks[_t155];
            if (delete this.tasks[_t155], this.taskQueue.length && this.invoker.trigger(), !_e156) return;

            _e156.fn();
          } finally {}
        }
      }, {
        key: "pick",
        value: function pick() {
          var t = null,
              e = 1 / 0;

          for (var _r150 = 0; _r150 < this.taskQueue.length; _r150++) {
            var _i117 = this.tasks[this.taskQueue[_r150]];
            _i117.priority < e && (e = _i117.priority, t = _r150);
          }

          if (null === t) return null;
          var r = this.taskQueue[t];
          return this.taskQueue.splice(t, 1), r;
        }
      }, {
        key: "remove",
        value: function remove() {
          this.invoker.remove();
        }
      }]);

      return yc;
    }();

    function mc(_ref158) {
      var t = _ref158.type,
          e = _ref158.isSymbolTile,
          r = _ref158.zoom;
      return r = r || 0, "message" === t ? 0 : "maybePrepare" !== t || e ? "parseTile" !== t || e ? "parseTile" === t && e ? 300 - r : "maybePrepare" === t && e ? 400 - r : 500 : 200 - r : 100 - r;
    }

    var gc = /*#__PURE__*/function () {
      function gc(t, e) {
        _classCallCheck(this, gc);

        t && (e ? this.setSouthWest(t).setNorthEast(e) : 4 === t.length ? this.setSouthWest([t[0], t[1]]).setNorthEast([t[2], t[3]]) : this.setSouthWest(t[0]).setNorthEast(t[1]));
      }

      _createClass(gc, [{
        key: "setNorthEast",
        value: function setNorthEast(t) {
          return this._ne = t instanceof xc ? new xc(t.lng, t.lat) : xc.convert(t), this;
        }
      }, {
        key: "setSouthWest",
        value: function setSouthWest(t) {
          return this._sw = t instanceof xc ? new xc(t.lng, t.lat) : xc.convert(t), this;
        }
      }, {
        key: "extend",
        value: function extend(t) {
          var e = this._sw,
              r = this._ne;
          var i, n;
          if (t instanceof xc) i = t, n = t;else {
            if (!(t instanceof gc)) return Array.isArray(t) ? 4 === t.length || t.every(Array.isArray) ? this.extend(gc.convert(t)) : this.extend(xc.convert(t)) : this;
            if (i = t._sw, n = t._ne, !i || !n) return this;
          }
          return e || r ? (e.lng = Math.min(i.lng, e.lng), e.lat = Math.min(i.lat, e.lat), r.lng = Math.max(n.lng, r.lng), r.lat = Math.max(n.lat, r.lat)) : (this._sw = new xc(i.lng, i.lat), this._ne = new xc(n.lng, n.lat)), this;
        }
      }, {
        key: "getCenter",
        value: function getCenter() {
          return new xc((this._sw.lng + this._ne.lng) / 2, (this._sw.lat + this._ne.lat) / 2);
        }
      }, {
        key: "getSouthWest",
        value: function getSouthWest() {
          return this._sw;
        }
      }, {
        key: "getNorthEast",
        value: function getNorthEast() {
          return this._ne;
        }
      }, {
        key: "getNorthWest",
        value: function getNorthWest() {
          return new xc(this.getWest(), this.getNorth());
        }
      }, {
        key: "getSouthEast",
        value: function getSouthEast() {
          return new xc(this.getEast(), this.getSouth());
        }
      }, {
        key: "getWest",
        value: function getWest() {
          return this._sw.lng;
        }
      }, {
        key: "getSouth",
        value: function getSouth() {
          return this._sw.lat;
        }
      }, {
        key: "getEast",
        value: function getEast() {
          return this._ne.lng;
        }
      }, {
        key: "getNorth",
        value: function getNorth() {
          return this._ne.lat;
        }
      }, {
        key: "toArray",
        value: function toArray() {
          return [this._sw.toArray(), this._ne.toArray()];
        }
      }, {
        key: "toString",
        value: function toString() {
          return "LngLatBounds(".concat(this._sw.toString(), ", ").concat(this._ne.toString(), ")");
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return !(this._sw && this._ne);
        }
      }, {
        key: "contains",
        value: function contains(t) {
          var _xc$convert = xc.convert(t),
              e = _xc$convert.lng,
              r = _xc$convert.lat;

          var i = this._sw.lng <= e && e <= this._ne.lng;
          return this._sw.lng > this._ne.lng && (i = this._sw.lng >= e && e >= this._ne.lng), this._sw.lat <= r && r <= this._ne.lat && i;
        }
      }], [{
        key: "convert",
        value: function convert(t) {
          return !t || t instanceof gc ? t : new gc(t);
        }
      }]);

      return gc;
    }();

    var xc = /*#__PURE__*/function () {
      function xc(t, e) {
        _classCallCheck(this, xc);

        if (isNaN(t) || isNaN(e)) throw new Error("Invalid LngLat object: (".concat(t, ", ").concat(e, ")"));
        if (this.lng = +t, this.lat = +e, this.lat > 90 || this.lat < -90) throw new Error("Invalid LngLat latitude value: must be between -90 and 90");
      }

      _createClass(xc, [{
        key: "wrap",
        value: function wrap() {
          return new xc(y(this.lng, -180, 180), this.lat);
        }
      }, {
        key: "toArray",
        value: function toArray() {
          return [this.lng, this.lat];
        }
      }, {
        key: "toString",
        value: function toString() {
          return "LngLat(".concat(this.lng, ", ").concat(this.lat, ")");
        }
      }, {
        key: "distanceTo",
        value: function distanceTo(t) {
          var e = Math.PI / 180,
              r = this.lat * e,
              i = t.lat * e,
              n = Math.sin(r) * Math.sin(i) + Math.cos(r) * Math.cos(i) * Math.cos((t.lng - this.lng) * e);
          return 6371008.8 * Math.acos(Math.min(n, 1));
        }
      }, {
        key: "toBounds",
        value: function toBounds() {
          var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
          var e = 360 * t / 40075017,
              r = e / Math.cos(Math.PI / 180 * this.lat);
          return new gc(new xc(this.lng - r, this.lat - e), new xc(this.lng + r, this.lat + e));
        }
      }], [{
        key: "convert",
        value: function convert(t) {
          if (t instanceof xc) return t;
          if (Array.isArray(t) && (2 === t.length || 3 === t.length)) return new xc(Number(t[0]), Number(t[1]));
          if (!Array.isArray(t) && "object" == _typeof(t) && null !== t) return new xc(Number("lng" in t ? t.lng : t.lon), Number(t.lat));
          throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]");
        }
      }]);

      return xc;
    }();

    var vc = 2 * Math.PI * 6371008.8;

    function bc(t) {
      return vc * Math.cos(t * Math.PI / 180);
    }

    function wc(t) {
      return (180 + t) / 360;
    }

    function _c(t) {
      return (180 - 180 / Math.PI * Math.log(Math.tan(Math.PI / 4 + t * Math.PI / 360))) / 360;
    }

    function Ac(t, e) {
      return t / bc(e);
    }

    function kc(t) {
      return 360 / Math.PI * Math.atan(Math.exp((180 - 360 * t) * Math.PI / 180)) - 90;
    }

    function Sc(t, e) {
      return t * bc(kc(e));
    }

    var Ic = /*#__PURE__*/function () {
      function Ic(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;

        _classCallCheck(this, Ic);

        this.x = +t, this.y = +e, this.z = +r;
      }

      _createClass(Ic, [{
        key: "toLngLat",
        value: function toLngLat() {
          return new xc(360 * this.x - 180, kc(this.y));
        }
      }, {
        key: "toAltitude",
        value: function toAltitude() {
          return Sc(this.z, this.y);
        }
      }, {
        key: "meterInMercatorCoordinateUnits",
        value: function meterInMercatorCoordinateUnits() {
          return 1 / vc * (t = kc(this.y), 1 / Math.cos(t * Math.PI / 180));
          var t;
        }
      }], [{
        key: "fromLngLat",
        value: function fromLngLat(t) {
          var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          var r = xc.convert(t);
          return new Ic(wc(r.lng), _c(r.lat), Ac(e, r.lat));
        }
      }]);

      return Ic;
    }();

    function Tc(t, e, r) {
      var i = 2 * Math.PI * 6378137 / 256 / Math.pow(2, r);
      return [t * i - 2 * Math.PI * 6378137 / 2, e * i - 2 * Math.PI * 6378137 / 2];
    }

    var zc = /*#__PURE__*/function () {
      function zc(t, e, r) {
        _classCallCheck(this, zc);

        this.z = t, this.x = e, this.y = r, this.key = Mc(0, t, t, e, r);
      }

      _createClass(zc, [{
        key: "equals",
        value: function equals(t) {
          return this.z === t.z && this.x === t.x && this.y === t.y;
        }
      }, {
        key: "url",
        value: function url(t, e) {
          var r = (n = this.y, s = this.z, a = Tc(256 * (i = this.x), 256 * (n = Math.pow(2, s) - n - 1), s), o = Tc(256 * (i + 1), 256 * (n + 1), s), a[0] + "," + a[1] + "," + o[0] + "," + o[1]);
          var i, n, s, a, o;

          var l = function (t, e, r) {
            var i,
                n = "";

            for (var _s75 = t; _s75 > 0; _s75--) {
              i = 1 << _s75 - 1, n += (e & i ? 1 : 0) + (r & i ? 2 : 0);
            }

            return n;
          }(this.z, this.x, this.y);

          return t[(this.x + this.y) % t.length].replace("{prefix}", (this.x % 16).toString(16) + (this.y % 16).toString(16)).replace("{z}", String(this.z)).replace("{x}", String(this.x)).replace("{y}", String("tms" === e ? Math.pow(2, this.z) - this.y - 1 : this.y)).replace("{quadkey}", l).replace("{bbox-epsg-3857}", r);
        }
      }, {
        key: "getTilePoint",
        value: function getTilePoint(t) {
          var e = Math.pow(2, this.z);
          return new i(8192 * (t.x * e - this.x), 8192 * (t.y * e - this.y));
        }
      }, {
        key: "getTileVec3",
        value: function getTileVec3(t) {
          var e = Math.pow(2, this.z);
          return va(8192 * (t.x * e - this.x), 8192 * (t.y * e - this.y), Sc(t.z, t.y));
        }
      }, {
        key: "toString",
        value: function toString() {
          return "".concat(this.z, "/").concat(this.x, "/").concat(this.y);
        }
      }]);

      return zc;
    }();

    var Ec = function Ec(t, e) {
      _classCallCheck(this, Ec);

      this.wrap = t, this.canonical = e, this.key = Mc(t, e.z, e.z, e.x, e.y);
    };

    var Cc = /*#__PURE__*/function () {
      function Cc(t, e, r, i, n) {
        _classCallCheck(this, Cc);

        this.overscaledZ = t, this.wrap = e, this.canonical = new zc(r, +i, +n), this.key = 0 === e && t === r ? this.canonical.key : Mc(e, t, r, i, n);
      }

      _createClass(Cc, [{
        key: "equals",
        value: function equals(t) {
          return this.overscaledZ === t.overscaledZ && this.wrap === t.wrap && this.canonical.equals(t.canonical);
        }
      }, {
        key: "scaledTo",
        value: function scaledTo(t) {
          var e = this.canonical.z - t;
          return t > this.canonical.z ? new Cc(t, this.wrap, this.canonical.z, this.canonical.x, this.canonical.y) : new Cc(t, this.wrap, t, this.canonical.x >> e, this.canonical.y >> e);
        }
      }, {
        key: "calculateScaledKey",
        value: function calculateScaledKey(t) {
          var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
          if (this.overscaledZ === t && e) return this.key;
          if (t > this.canonical.z) return Mc(this.wrap * +e, t, this.canonical.z, this.canonical.x, this.canonical.y);
          {
            var _r151 = this.canonical.z - t;

            return Mc(this.wrap * +e, t, t, this.canonical.x >> _r151, this.canonical.y >> _r151);
          }
        }
      }, {
        key: "isChildOf",
        value: function isChildOf(t) {
          if (t.wrap !== this.wrap) return !1;
          var e = this.canonical.z - t.canonical.z;
          return 0 === t.overscaledZ || t.overscaledZ < this.overscaledZ && t.canonical.x === this.canonical.x >> e && t.canonical.y === this.canonical.y >> e;
        }
      }, {
        key: "children",
        value: function children(t) {
          if (this.overscaledZ >= t) return [new Cc(this.overscaledZ + 1, this.wrap, this.canonical.z, this.canonical.x, this.canonical.y)];
          var e = this.canonical.z + 1,
              r = 2 * this.canonical.x,
              i = 2 * this.canonical.y;
          return [new Cc(e, this.wrap, e, r, i), new Cc(e, this.wrap, e, r + 1, i), new Cc(e, this.wrap, e, r, i + 1), new Cc(e, this.wrap, e, r + 1, i + 1)];
        }
      }, {
        key: "isLessThan",
        value: function isLessThan(t) {
          return this.wrap < t.wrap || !(this.wrap > t.wrap) && (this.overscaledZ < t.overscaledZ || !(this.overscaledZ > t.overscaledZ) && (this.canonical.x < t.canonical.x || !(this.canonical.x > t.canonical.x) && this.canonical.y < t.canonical.y));
        }
      }, {
        key: "wrapped",
        value: function wrapped() {
          return new Cc(this.overscaledZ, 0, this.canonical.z, this.canonical.x, this.canonical.y);
        }
      }, {
        key: "unwrapTo",
        value: function unwrapTo(t) {
          return new Cc(this.overscaledZ, t, this.canonical.z, this.canonical.x, this.canonical.y);
        }
      }, {
        key: "overscaleFactor",
        value: function overscaleFactor() {
          return Math.pow(2, this.overscaledZ - this.canonical.z);
        }
      }, {
        key: "toUnwrapped",
        value: function toUnwrapped() {
          return new Ec(this.wrap, this.canonical);
        }
      }, {
        key: "toString",
        value: function toString() {
          return "".concat(this.overscaledZ, "/").concat(this.canonical.x, "/").concat(this.canonical.y);
        }
      }, {
        key: "getTilePoint",
        value: function getTilePoint(t) {
          return this.canonical.getTilePoint(new Ic(t.x - this.wrap, t.y));
        }
      }, {
        key: "getTileVec3",
        value: function getTileVec3(t) {
          return this.canonical.getTileVec3(new Ic(t.x - this.wrap, t.y, t.z));
        }
      }]);

      return Cc;
    }();

    function Mc(t, e, r, i, n) {
      var s = 1 << Math.min(r, 22);
      var a = s * (n % s) + i % s;
      return t && r < 22 && (a += s * s * ((t < 0 ? -2 * t - 1 : 2 * t) % (1 << 2 * (22 - r)))), 16 * (32 * a + r) + (e - r);
    }

    ji("CanonicalTileID", zc), ji("OverscaledTileID", Cc, {
      omit: ["posMatrix"]
    });

    var Bc = /*#__PURE__*/function () {
      function Bc(t) {
        _classCallCheck(this, Bc);

        this._stringToNumber = {}, this._numberToString = [];

        for (var _e157 = 0; _e157 < t.length; _e157++) {
          var _r152 = t[_e157];
          this._stringToNumber[_r152] = _e157, this._numberToString[_e157] = _r152;
        }
      }

      _createClass(Bc, [{
        key: "encode",
        value: function encode(t) {
          return this._stringToNumber[t];
        }
      }, {
        key: "decode",
        value: function decode(t) {
          return this._numberToString[t];
        }
      }]);

      return Bc;
    }();

    var Dc = /*#__PURE__*/function () {
      function Dc(t, e, r, i, n) {
        _classCallCheck(this, Dc);

        this.type = "Feature", this._vectorTileFeature = t, t._z = e, t._x = r, t._y = i, this.properties = t.properties, this.id = n;
      }

      _createClass(Dc, [{
        key: "toJSON",
        value: function toJSON() {
          var t = {
            geometry: this.geometry
          };

          for (var _e158 in this) {
            "_geometry" !== _e158 && "_vectorTileFeature" !== _e158 && (t[_e158] = this[_e158]);
          }

          return t;
        }
      }, {
        key: "geometry",
        get: function get() {
          return void 0 === this._geometry && (this._geometry = this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x, this._vectorTileFeature._y, this._vectorTileFeature._z).geometry), this._geometry;
        },
        set: function set(t) {
          this._geometry = t;
        }
      }]);

      return Dc;
    }();

    var Pc = Pn([{
      name: "a_pos",
      type: "Int16",
      components: 2
    }]);

    var Vc = /*#__PURE__*/function () {
      function Vc(t, e, r) {
        _classCallCheck(this, Vc);

        this.tileID = t, this.uid = v(), this.uses = 0, this.tileSize = e, this.tileZoom = r, this.buckets = {}, this.expirationTime = null, this.queryPadding = 0, this.hasSymbolBuckets = !1, this.hasRTLText = !1, this.dependencies = {}, this.expiredRequestCount = 0, this.state = "loading";
      }

      _createClass(Vc, [{
        key: "registerFadeDuration",
        value: function registerFadeDuration(t) {
          var e = t + this.timeAdded;
          e < O.now() || this.fadeEndTime && e < this.fadeEndTime || (this.fadeEndTime = e);
        }
      }, {
        key: "wasRequested",
        value: function wasRequested() {
          return "errored" === this.state || "loaded" === this.state || "reloading" === this.state;
        }
      }, {
        key: "loadVectorData",
        value: function loadVectorData(t, e, r) {
          if (this.hasData() && this.unloadVectorData(), this.state = "loaded", t) {
            t.featureIndex && (this.latestFeatureIndex = t.featureIndex, t.rawTileData ? (this.latestRawTileData = t.rawTileData, this.latestFeatureIndex.rawTileData = t.rawTileData) : this.latestRawTileData && (this.latestFeatureIndex.rawTileData = this.latestRawTileData)), this.collisionBoxArray = t.collisionBoxArray, this.buckets = function (t, e) {
              var r = {};
              if (!e) return r;

              var _iterator110 = _createForOfIteratorHelper(t),
                  _step110;

              try {
                var _loop4 = function _loop4() {
                  var i = _step110.value;
                  var t = i.layerIds.map(function (t) {
                    return e.getLayer(t);
                  }).filter(Boolean);

                  if (0 !== t.length) {
                    i.layers = t, i.stateDependentLayerIds && (i.stateDependentLayers = i.stateDependentLayerIds.map(function (e) {
                      return t.filter(function (t) {
                        return t.id === e;
                      })[0];
                    }));

                    var _iterator111 = _createForOfIteratorHelper(t),
                        _step111;

                    try {
                      for (_iterator111.s(); !(_step111 = _iterator111.n()).done;) {
                        var _e159 = _step111.value;
                        r[_e159.id] = i;
                      }
                    } catch (err) {
                      _iterator111.e(err);
                    } finally {
                      _iterator111.f();
                    }
                  }
                };

                for (_iterator110.s(); !(_step110 = _iterator110.n()).done;) {
                  _loop4();
                }
              } catch (err) {
                _iterator110.e(err);
              } finally {
                _iterator110.f();
              }

              return r;
            }(t.buckets, e.style), this.hasSymbolBuckets = !1;

            for (var _t156 in this.buckets) {
              var _e160 = this.buckets[_t156];

              if (_e160 instanceof Hu) {
                if (this.hasSymbolBuckets = !0, !r) break;
                _e160.justReloaded = !0;
              }
            }

            if (this.hasRTLText = !1, this.hasSymbolBuckets) for (var _t157 in this.buckets) {
              var _e161 = this.buckets[_t157];

              if (_e161 instanceof Hu && _e161.hasRTLText) {
                this.hasRTLText = !0, fn.isLoading() || fn.isLoaded() || "deferred" !== pn() || dn();
                break;
              }
            }
            this.queryPadding = 0;

            for (var _t158 in this.buckets) {
              var _r153 = this.buckets[_t158];
              this.queryPadding = Math.max(this.queryPadding, e.style.getLayer(_t158).queryRadius(_r153));
            }

            t.imageAtlas && (this.imageAtlas = t.imageAtlas), t.glyphAtlasImage && (this.glyphAtlasImage = t.glyphAtlasImage);
          } else this.collisionBoxArray = new ns();
        }
      }, {
        key: "unloadVectorData",
        value: function unloadVectorData() {
          for (var _t159 in this.buckets) {
            this.buckets[_t159].destroy();
          }

          this.buckets = {}, this.imageAtlasTexture && this.imageAtlasTexture.destroy(), this.imageAtlas && (this.imageAtlas = null), this.glyphAtlasTexture && this.glyphAtlasTexture.destroy(), this.latestFeatureIndex = null, this.state = "unloaded";
        }
      }, {
        key: "getBucket",
        value: function getBucket(t) {
          return this.buckets[t.id];
        }
      }, {
        key: "upload",
        value: function upload(t) {
          for (var _e162 in this.buckets) {
            var _r154 = this.buckets[_e162];
            _r154.uploadPending() && _r154.upload(t);
          }

          var e = t.gl;
          this.imageAtlas && !this.imageAtlas.uploaded && (this.imageAtlasTexture = new hc(t, this.imageAtlas.image, e.RGBA), this.imageAtlas.uploaded = !0), this.glyphAtlasImage && (this.glyphAtlasTexture = new hc(t, this.glyphAtlasImage, e.ALPHA), this.glyphAtlasImage = null);
        }
      }, {
        key: "prepare",
        value: function prepare(t) {
          this.imageAtlas && this.imageAtlas.patchUpdatedImages(t, this.imageAtlasTexture);
        }
      }, {
        key: "queryRenderedFeatures",
        value: function queryRenderedFeatures(t, e, r, i, n, s, a, o) {
          return this.latestFeatureIndex && this.latestFeatureIndex.rawTileData ? this.latestFeatureIndex.query({
            tileResult: i,
            pixelPosMatrix: a,
            transform: s,
            params: n
          }, t, e, r) : {};
        }
      }, {
        key: "querySourceFeatures",
        value: function querySourceFeatures(t, e) {
          var r = this.latestFeatureIndex;
          if (!r || !r.rawTileData) return;
          var i = r.loadVTLayers(),
              n = e ? e.sourceLayer : "",
              s = i._geojsonTileLayer || i[n];
          if (!s) return;
          var a = hi(e && e.filter),
              _this$tileID$canonica = this.tileID.canonical,
              o = _this$tileID$canonica.z,
              l = _this$tileID$canonica.x,
              u = _this$tileID$canonica.y,
              c = {
            z: o,
            x: l,
            y: u
          };

          for (var _e163 = 0; _e163 < s.length; _e163++) {
            var _i118 = s.feature(_e163);

            if (a.needGeometry) {
              var _t160 = js(_i118, !0);

              if (!a.filter(new yn(this.tileID.overscaledZ), _t160, this.tileID.canonical)) continue;
            } else if (!a.filter(new yn(this.tileID.overscaledZ), _i118)) continue;

            var _h8 = r.getId(_i118, n),
                _p7 = new Dc(_i118, o, l, u, _h8);

            _p7.tile = c, t.push(_p7);
          }
        }
      }, {
        key: "hasData",
        value: function hasData() {
          return "loaded" === this.state || "reloading" === this.state || "expired" === this.state;
        }
      }, {
        key: "patternsLoaded",
        value: function patternsLoaded() {
          return this.imageAtlas && !!Object.keys(this.imageAtlas.patternPositions).length;
        }
      }, {
        key: "setExpiryData",
        value: function setExpiryData(t) {
          var e = this.expirationTime;

          if (t.cacheControl) {
            var _e164 = B(t.cacheControl);

            _e164["max-age"] && (this.expirationTime = Date.now() + 1e3 * _e164["max-age"]);
          } else t.expires && (this.expirationTime = new Date(t.expires).getTime());

          if (this.expirationTime) {
            var _t161 = Date.now();

            var _r155 = !1;

            if (this.expirationTime > _t161) _r155 = !1;else if (e) {
              if (this.expirationTime < e) _r155 = !0;else {
                var _i119 = this.expirationTime - e;

                _i119 ? this.expirationTime = _t161 + Math.max(_i119, 3e4) : _r155 = !0;
              }
            } else _r155 = !0;
            _r155 ? (this.expiredRequestCount++, this.state = "expired") : this.expiredRequestCount = 0;
          }
        }
      }, {
        key: "getExpiryTimeout",
        value: function getExpiryTimeout() {
          if (this.expirationTime) return this.expiredRequestCount ? 1e3 * (1 << Math.min(this.expiredRequestCount - 1, 31)) : Math.min(this.expirationTime - new Date().getTime(), Math.pow(2, 31) - 1);
        }
      }, {
        key: "setFeatureState",
        value: function setFeatureState(t, e) {
          if (!this.latestFeatureIndex || !this.latestFeatureIndex.rawTileData || 0 === Object.keys(t).length) return;
          var r = this.latestFeatureIndex.loadVTLayers();

          for (var _i120 in this.buckets) {
            if (!e.style.hasLayer(_i120)) continue;

            var _n93 = this.buckets[_i120],
                _s76 = _n93.layers[0].sourceLayer || "_geojsonTileLayer",
                _a68 = r[_s76],
                _o35 = t[_s76];

            if (!_a68 || !_o35 || 0 === Object.keys(_o35).length) continue;

            _n93.update(_o35, _a68, this.imageAtlas && this.imageAtlas.patternPositions || {});

            var _l26 = e && e.style && e.style.getLayer(_i120);

            _l26 && (this.queryPadding = Math.max(this.queryPadding, _l26.queryRadius(_n93)));
          }
        }
      }, {
        key: "holdingForFade",
        value: function holdingForFade() {
          return void 0 !== this.symbolFadeHoldUntil;
        }
      }, {
        key: "symbolFadeFinished",
        value: function symbolFadeFinished() {
          return !this.symbolFadeHoldUntil || this.symbolFadeHoldUntil < O.now();
        }
      }, {
        key: "clearFadeHold",
        value: function clearFadeHold() {
          this.symbolFadeHoldUntil = void 0;
        }
      }, {
        key: "setHoldDuration",
        value: function setHoldDuration(t) {
          this.symbolFadeHoldUntil = O.now() + t;
        }
      }, {
        key: "setDependencies",
        value: function setDependencies(t, e) {
          var r = {};

          var _iterator112 = _createForOfIteratorHelper(e),
              _step112;

          try {
            for (_iterator112.s(); !(_step112 = _iterator112.n()).done;) {
              var _t162 = _step112.value;
              r[_t162] = !0;
            }
          } catch (err) {
            _iterator112.e(err);
          } finally {
            _iterator112.f();
          }

          this.dependencies[t] = r;
        }
      }, {
        key: "hasDependency",
        value: function hasDependency(t, e) {
          var _iterator113 = _createForOfIteratorHelper(t),
              _step113;

          try {
            for (_iterator113.s(); !(_step113 = _iterator113.n()).done;) {
              var _r156 = _step113.value;
              var _t163 = this.dependencies[_r156];

              if (_t163) {
                var _iterator114 = _createForOfIteratorHelper(e),
                    _step114;

                try {
                  for (_iterator114.s(); !(_step114 = _iterator114.n()).done;) {
                    var _r157 = _step114.value;
                    if (_t163[_r157]) return !0;
                  }
                } catch (err) {
                  _iterator114.e(err);
                } finally {
                  _iterator114.f();
                }
              }
            }
          } catch (err) {
            _iterator113.e(err);
          } finally {
            _iterator113.f();
          }

          return !1;
        }
      }, {
        key: "clearQueryDebugViz",
        value: function clearQueryDebugViz() {}
      }]);

      return Vc;
    }();

    var Fc = /*#__PURE__*/function () {
      function Fc() {
        _classCallCheck(this, Fc);

        this.state = {}, this.stateChanges = {}, this.deletedStates = {};
      }

      _createClass(Fc, [{
        key: "updateState",
        value: function updateState(t, e, r) {
          var i = String(e);

          if (this.stateChanges[t] = this.stateChanges[t] || {}, this.stateChanges[t][i] = this.stateChanges[t][i] || {}, g(this.stateChanges[t][i], r), null === this.deletedStates[t]) {
            this.deletedStates[t] = {};

            for (var _e165 in this.state[t]) {
              _e165 !== i && (this.deletedStates[t][_e165] = null);
            }
          } else if (this.deletedStates[t] && null === this.deletedStates[t][i]) {
            this.deletedStates[t][i] = {};

            for (var _e166 in this.state[t][i]) {
              r[_e166] || (this.deletedStates[t][i][_e166] = null);
            }
          } else for (var _e167 in r) {
            this.deletedStates[t] && this.deletedStates[t][i] && null === this.deletedStates[t][i][_e167] && delete this.deletedStates[t][i][_e167];
          }
        }
      }, {
        key: "removeFeatureState",
        value: function removeFeatureState(t, e, r) {
          if (null === this.deletedStates[t]) return;
          var i = String(e);
          if (this.deletedStates[t] = this.deletedStates[t] || {}, r && void 0 !== e) null !== this.deletedStates[t][i] && (this.deletedStates[t][i] = this.deletedStates[t][i] || {}, this.deletedStates[t][i][r] = null);else if (void 0 !== e) {
            if (this.stateChanges[t] && this.stateChanges[t][i]) for (r in this.deletedStates[t][i] = {}, this.stateChanges[t][i]) {
              this.deletedStates[t][i][r] = null;
            } else this.deletedStates[t][i] = null;
          } else this.deletedStates[t] = null;
        }
      }, {
        key: "getState",
        value: function getState(t, e) {
          var r = String(e),
              i = g({}, (this.state[t] || {})[r], (this.stateChanges[t] || {})[r]);
          if (null === this.deletedStates[t]) return {};

          if (this.deletedStates[t]) {
            var _r158 = this.deletedStates[t][e];
            if (null === _r158) return {};

            for (var _t164 in _r158) {
              delete i[_t164];
            }
          }

          return i;
        }
      }, {
        key: "initializeTileState",
        value: function initializeTileState(t, e) {
          t.setFeatureState(this.state, e);
        }
      }, {
        key: "coalesceChanges",
        value: function coalesceChanges(t, e) {
          var r = {};

          for (var _t165 in this.stateChanges) {
            this.state[_t165] = this.state[_t165] || {};
            var _e168 = {};

            for (var _r159 in this.stateChanges[_t165]) {
              this.state[_t165][_r159] || (this.state[_t165][_r159] = {}), g(this.state[_t165][_r159], this.stateChanges[_t165][_r159]), _e168[_r159] = this.state[_t165][_r159];
            }

            r[_t165] = _e168;
          }

          for (var _t166 in this.deletedStates) {
            this.state[_t166] = this.state[_t166] || {};
            var _e169 = {};
            if (null === this.deletedStates[_t166]) for (var _r160 in this.state[_t166]) {
              _e169[_r160] = {}, this.state[_t166][_r160] = {};
            } else for (var _r161 in this.deletedStates[_t166]) {
              if (null === this.deletedStates[_t166][_r161]) this.state[_t166][_r161] = {};else for (var _i121 = 0, _Object$keys9 = Object.keys(this.deletedStates[_t166][_r161]); _i121 < _Object$keys9.length; _i121++) {
                var _e170 = _Object$keys9[_i121];
                delete this.state[_t166][_r161][_e170];
              }
              _e169[_r161] = this.state[_t166][_r161];
            }
            r[_t166] = r[_t166] || {}, g(r[_t166], _e169);
          }

          if (this.stateChanges = {}, this.deletedStates = {}, 0 !== Object.keys(r).length) for (var _i122 in t) {
            t[_i122].setFeatureState(r, e);
          }
        }
      }]);

      return Fc;
    }();

    var Rc = /*#__PURE__*/function () {
      function Rc(t) {
        _classCallCheck(this, Rc);

        this.size = t, this.minimums = [], this.maximums = [], this.leaves = [];
      }

      _createClass(Rc, [{
        key: "getElevation",
        value: function getElevation(t, e) {
          var r = this.toIdx(t, e);
          return {
            min: this.minimums[r],
            max: this.maximums[r]
          };
        }
      }, {
        key: "isLeaf",
        value: function isLeaf(t, e) {
          return this.leaves[this.toIdx(t, e)];
        }
      }, {
        key: "toIdx",
        value: function toIdx(t, e) {
          return e * this.size + t;
        }
      }]);

      return Rc;
    }();

    function Lc(t, e, r, i) {
      var n = 0,
          s = Number.MAX_VALUE;

      for (var _a69 = 0; _a69 < 3; _a69++) {
        if (Math.abs(i[_a69]) < 1e-15) {
          if (r[_a69] < t[_a69] || r[_a69] > e[_a69]) return null;
        } else {
          var _o36 = 1 / i[_a69];

          var _l27 = (t[_a69] - r[_a69]) * _o36,
              _u22 = (e[_a69] - r[_a69]) * _o36;

          if (_l27 > _u22) {
            var _t167 = _l27;
            _l27 = _u22, _u22 = _t167;
          }

          if (_l27 > n && (n = _l27), _u22 < s && (s = _u22), n > s) return null;
        }
      }

      return n;
    }

    function Uc(t, e, r, i, n, s, a, o, l, u, c) {
      var h = i - t,
          p = n - e,
          d = s - r,
          f = a - t,
          y = o - e,
          m = l - r,
          g = c[1] * m - c[2] * y,
          x = c[2] * f - c[0] * m,
          v = c[0] * y - c[1] * f,
          b = h * g + p * x + d * v;
      if (Math.abs(b) < 1e-15) return null;

      var w = 1 / b,
          _ = u[0] - t,
          A = u[1] - e,
          k = u[2] - r,
          S = (_ * g + A * x + k * v) * w;

      if (S < 0 || S > 1) return null;
      var I = A * d - k * p,
          T = k * h - _ * d,
          z = _ * p - A * h,
          E = (c[0] * I + c[1] * T + c[2] * z) * w;
      return E < 0 || S + E > 1 ? null : (f * I + y * T + m * z) * w;
    }

    function Oc(t, e, r) {
      return (t - e) / (r - e);
    }

    function $c(t, e, r, i, n, s, a, o, l) {
      var u = 1 << r,
          c = s - i,
          h = a - n,
          p = (t + 1) / u * c + i,
          d = (e + 0) / u * h + n,
          f = (e + 1) / u * h + n;
      o[0] = (t + 0) / u * c + i, o[1] = d, l[0] = p, l[1] = f;
    }

    var qc = /*#__PURE__*/function () {
      function qc(t) {
        _classCallCheck(this, qc);

        if (this.maximums = [], this.minimums = [], this.leaves = [], this.childOffsets = [], this.nodeCount = 0, this.dem = t, this._siblingOffset = [[0, 0], [1, 0], [0, 1], [1, 1]], !this.dem) return;

        var e = function (t) {
          var e = Math.ceil(Math.log2(t.dim / 8)),
              r = [];
          var i = Math.ceil(Math.pow(2, e));

          var n = 1 / i,
              s = function s(t, e, r, i, n) {
            var s = i ? 1 : 0,
                a = (t + 1) * r - s,
                o = e * r,
                l = (e + 1) * r - s;
            n[0] = t * r, n[1] = o, n[2] = a, n[3] = l;
          };

          var a = new Rc(i);
          var o = [];

          for (var _e171 = 0; _e171 < i * i; _e171++) {
            s(_e171 % i, Math.floor(_e171 / i), n, !1, o);

            var _r162 = jc(o[0], o[1], t),
                _l28 = jc(o[2], o[1], t),
                _u23 = jc(o[2], o[3], t),
                _c16 = jc(o[0], o[3], t);

            a.minimums.push(Math.min(_r162, _l28, _u23, _c16)), a.maximums.push(Math.max(_r162, _l28, _u23, _c16)), a.leaves.push(1);
          }

          for (r.push(a), i /= 2; i >= 1; i /= 2) {
            var _t168 = r[r.length - 1];
            a = new Rc(i);

            for (var _e172 = 0; _e172 < i * i; _e172++) {
              s(_e172 % i, Math.floor(_e172 / i), 2, !0, o);

              var _r163 = _t168.getElevation(o[0], o[1]),
                  _n94 = _t168.getElevation(o[2], o[1]),
                  _l29 = _t168.getElevation(o[2], o[3]),
                  _u24 = _t168.getElevation(o[0], o[3]),
                  _c17 = _t168.isLeaf(o[0], o[1]),
                  _h9 = _t168.isLeaf(o[2], o[1]),
                  _p8 = _t168.isLeaf(o[2], o[3]),
                  _d7 = _t168.isLeaf(o[0], o[3]),
                  _f7 = Math.min(_r163.min, _n94.min, _l29.min, _u24.min),
                  _y7 = Math.max(_r163.max, _n94.max, _l29.max, _u24.max),
                  _m9 = _c17 && _h9 && _p8 && _d7;

              a.maximums.push(_y7), a.minimums.push(_f7), a.leaves.push(_y7 - _f7 <= 5 && _m9 ? 1 : 0);
            }

            r.push(a);
          }

          return r;
        }(this.dem),
            r = e.length - 1,
            i = e[r];

        this._addNode(i.minimums[0], i.maximums[0], i.leaves[0]), this._construct(e, 0, 0, r, 0);
      }

      _createClass(qc, [{
        key: "raycastRoot",
        value: function raycastRoot(t, e, r, i, n, s) {
          var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 1;
          return Lc([t, e, -100], [r, i, this.maximums[0] * a], n, s);
        }
      }, {
        key: "raycast",
        value: function raycast(t, e, r, i, n, s) {
          var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 1;
          if (!this.nodeCount) return null;
          var o = this.raycastRoot(t, e, r, i, n, s, a);
          if (null == o) return null;
          var l = [],
              u = [],
              c = [],
              h = [],
              p = [{
            idx: 0,
            t: o,
            nodex: 0,
            nodey: 0,
            depth: 0
          }];

          for (; p.length > 0;) {
            var _p$pop = p.pop(),
                _o37 = _p$pop.idx,
                _d8 = _p$pop.t,
                _f8 = _p$pop.nodex,
                _y8 = _p$pop.nodey,
                _m10 = _p$pop.depth;

            if (this.leaves[_o37]) {
              $c(_f8, _y8, _m10, t, e, r, i, c, h);

              var _o38 = 1 << _m10,
                  _l30 = (_f8 + 0) / _o38,
                  _u25 = (_f8 + 1) / _o38,
                  _p9 = (_y8 + 0) / _o38,
                  _g9 = (_y8 + 1) / _o38,
                  _x8 = jc(_l30, _p9, this.dem) * a,
                  _v8 = jc(_u25, _p9, this.dem) * a,
                  _b7 = jc(_u25, _g9, this.dem) * a,
                  _w7 = jc(_l30, _g9, this.dem) * a,
                  _9 = Uc(c[0], c[1], _x8, h[0], c[1], _v8, h[0], h[1], _b7, n, s),
                  _A7 = Uc(h[0], h[1], _b7, c[0], h[1], _w7, c[0], c[1], _x8, n, s),
                  _k7 = Math.min(null !== _9 ? _9 : Number.MAX_VALUE, null !== _A7 ? _A7 : Number.MAX_VALUE);

              if (_k7 !== Number.MAX_VALUE) return _k7;
              {
                var _t169 = Aa([], n, s, _d8);

                if (Nc(_x8, _v8, _w7, _b7, Oc(_t169[0], c[0], h[0]), Oc(_t169[1], c[1], h[1])) >= _t169[2]) return _d8;
              }
              continue;
            }

            var _g8 = 0;

            for (var _p10 = 0; _p10 < this._siblingOffset.length; _p10++) {
              $c((_f8 << 1) + this._siblingOffset[_p10][0], (_y8 << 1) + this._siblingOffset[_p10][1], _m10 + 1, t, e, r, i, c, h), c[2] = -100, h[2] = this.maximums[this.childOffsets[_o37] + _p10] * a;

              var _d9 = Lc(c, h, n, s);

              if (null != _d9) {
                var _t170 = _d9;
                l[_p10] = _t170;

                var _e173 = !1;

                for (var _r164 = 0; _r164 < _g8 && !_e173; _r164++) {
                  _t170 >= l[u[_r164]] && (u.splice(_r164, 0, _p10), _e173 = !0);
                }

                _e173 || (u[_g8] = _p10), _g8++;
              }
            }

            for (var _t171 = 0; _t171 < _g8; _t171++) {
              var _e174 = u[_t171];
              p.push({
                idx: this.childOffsets[_o37] + _e174,
                t: l[_e174],
                nodex: (_f8 << 1) + this._siblingOffset[_e174][0],
                nodey: (_y8 << 1) + this._siblingOffset[_e174][1],
                depth: _m10 + 1
              });
            }
          }

          return null;
        }
      }, {
        key: "_addNode",
        value: function _addNode(t, e, r) {
          return this.minimums.push(t), this.maximums.push(e), this.leaves.push(r), this.childOffsets.push(0), this.nodeCount++;
        }
      }, {
        key: "_construct",
        value: function _construct(t, e, r, i, n) {
          if (1 === t[i].isLeaf(e, r)) return;
          this.childOffsets[n] || (this.childOffsets[n] = this.nodeCount);
          var s = i - 1,
              a = t[s];
          var o,
              l = 0;

          for (var _t172 = 0; _t172 < this._siblingOffset.length; _t172++) {
            var _i123 = 2 * e + this._siblingOffset[_t172][0],
                _n95 = 2 * r + this._siblingOffset[_t172][1],
                _s77 = a.getElevation(_i123, _n95),
                _u26 = a.isLeaf(_i123, _n95),
                _c18 = this._addNode(_s77.min, _s77.max, _u26);

            _u26 && (l |= 1 << _t172), o || (o = _c18);
          }

          for (var _i124 = 0; _i124 < this._siblingOffset.length; _i124++) {
            l & 1 << _i124 || this._construct(t, 2 * e + this._siblingOffset[_i124][0], 2 * r + this._siblingOffset[_i124][1], s, o + _i124);
          }
        }
      }]);

      return qc;
    }();

    function Nc(t, e, r, i, n, s) {
      return Ye(Ye(t, r, s), Ye(e, i, s), n);
    }

    function jc(t, e, r) {
      var i = r.dim,
          n = f(t * i - .5, 0, i - 1),
          s = f(e * i - .5, 0, i - 1),
          a = Math.floor(n),
          o = Math.floor(s),
          l = Math.min(a + 1, i - 1),
          u = Math.min(o + 1, i - 1);
      return Nc(r.get(a, o), r.get(l, o), r.get(a, u), r.get(l, u), n - a, s - o);
    }

    var Kc = {
      mapbox: [6553.6, 25.6, .1, 1e4],
      terrarium: [256, 1, 1 / 256, 32768]
    };

    var Zc = /*#__PURE__*/function () {
      _createClass(Zc, [{
        key: "tree",
        get: function get() {
          return this._tree || this._buildQuadTree(), this._tree;
        }
      }]);

      function Zc(t, e, r) {
        var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;
        var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;

        _classCallCheck(this, Zc);

        if (this.uid = t, e.height !== e.width) throw new RangeError("DEM tiles must be square");
        if (r && "mapbox" !== r && "terrarium" !== r) return z("\"".concat(r, "\" is not a valid encoding type. Valid types include \"mapbox\" and \"terrarium\"."));
        this.stride = e.height;
        var s = this.dim = e.height - 2;

        if (this.data = new Uint32Array(e.data.buffer), this.encoding = r || "mapbox", this.borderReady = i, !i) {
          for (var _t173 = 0; _t173 < s; _t173++) {
            this.data[this._idx(-1, _t173)] = this.data[this._idx(0, _t173)], this.data[this._idx(s, _t173)] = this.data[this._idx(s - 1, _t173)], this.data[this._idx(_t173, -1)] = this.data[this._idx(_t173, 0)], this.data[this._idx(_t173, s)] = this.data[this._idx(_t173, s - 1)];
          }

          this.data[this._idx(-1, -1)] = this.data[this._idx(0, 0)], this.data[this._idx(s, -1)] = this.data[this._idx(s - 1, 0)], this.data[this._idx(-1, s)] = this.data[this._idx(0, s - 1)], this.data[this._idx(s, s)] = this.data[this._idx(s - 1, s - 1)], n && this._buildQuadTree();
        }
      }

      _createClass(Zc, [{
        key: "_buildQuadTree",
        value: function _buildQuadTree() {
          this._tree = new qc(this);
        }
      }, {
        key: "get",
        value: function get(t, e) {
          var r = new Uint8Array(this.data.buffer),
              i = 4 * this._idx(t, e);

          return ("terrarium" === this.encoding ? this._unpackTerrarium : this._unpackMapbox)(r[i], r[i + 1], r[i + 2]);
        }
      }, {
        key: "_idx",
        value: function _idx(t, e) {
          if (t < -1 || t >= this.dim + 1 || e < -1 || e >= this.dim + 1) throw new RangeError("out of range source coordinates for DEM data");
          return (e + 1) * this.stride + (t + 1);
        }
      }, {
        key: "_unpackMapbox",
        value: function _unpackMapbox(t, e, r) {
          return (256 * t * 256 + 256 * e + r) / 10 - 1e4;
        }
      }, {
        key: "_unpackTerrarium",
        value: function _unpackTerrarium(t, e, r) {
          return 256 * t + e + r / 256 - 32768;
        }
      }, {
        key: "getPixels",
        value: function getPixels() {
          return new Za({
            width: this.stride,
            height: this.stride
          }, new Uint8Array(this.data.buffer));
        }
      }, {
        key: "backfillBorder",
        value: function backfillBorder(t, e, r) {
          if (this.dim !== t.dim) throw new Error("dem dimension mismatch");
          var i = e * this.dim,
              n = e * this.dim + this.dim,
              s = r * this.dim,
              a = r * this.dim + this.dim;

          switch (e) {
            case -1:
              i = n - 1;
              break;

            case 1:
              n = i + 1;
          }

          switch (r) {
            case -1:
              s = a - 1;
              break;

            case 1:
              a = s + 1;
          }

          var o = -e * this.dim,
              l = -r * this.dim;

          for (var _e175 = s; _e175 < a; _e175++) {
            for (var _r165 = i; _r165 < n; _r165++) {
              this.data[this._idx(_r165, _e175)] = t.data[this._idx(_r165 + o, _e175 + l)];
            }
          }
        }
      }, {
        key: "onDeserialize",
        value: function onDeserialize() {
          this._tree && (this._tree.dem = this);
        }
      }, {
        key: "unpackVector",
        get: function get() {
          return Kc[this.encoding];
        }
      }], [{
        key: "getUnpackVector",
        value: function getUnpackVector(t) {
          return Kc[t];
        }
      }, {
        key: "pack",
        value: function pack(t, e) {
          var r = [0, 0, 0, 0],
              i = Zc.getUnpackVector(e);
          var n = Math.floor((t + i[3]) / i[2]);
          return r[2] = n % 256, n = Math.floor(n / 256), r[1] = n % 256, n = Math.floor(n / 256), r[0] = n, r;
        }
      }]);

      return Zc;
    }();

    ji("DEMData", Zc), ji("DemMinMaxQuadTree", qc, {
      omit: ["dem"]
    });

    var Xc = /*#__PURE__*/function () {
      function Xc(t, e) {
        _classCallCheck(this, Xc);

        this.max = t, this.onRemove = e, this.reset();
      }

      _createClass(Xc, [{
        key: "reset",
        value: function reset() {
          for (var _t174 in this.data) {
            var _iterator115 = _createForOfIteratorHelper(this.data[_t174]),
                _step115;

            try {
              for (_iterator115.s(); !(_step115 = _iterator115.n()).done;) {
                var _e176 = _step115.value;
                _e176.timeout && clearTimeout(_e176.timeout), this.onRemove(_e176.value);
              }
            } catch (err) {
              _iterator115.e(err);
            } finally {
              _iterator115.f();
            }
          }

          return this.data = {}, this.order = [], this;
        }
      }, {
        key: "add",
        value: function add(t, e, r) {
          var _this30 = this;

          var i = t.wrapped().key;
          void 0 === this.data[i] && (this.data[i] = []);
          var n = {
            value: e,
            timeout: void 0
          };

          if (void 0 !== r && (n.timeout = setTimeout(function () {
            _this30.remove(t, n);
          }, r)), this.data[i].push(n), this.order.push(i), this.order.length > this.max) {
            var _t175 = this._getAndRemoveByKey(this.order[0]);

            _t175 && this.onRemove(_t175);
          }

          return this;
        }
      }, {
        key: "has",
        value: function has(t) {
          return t.wrapped().key in this.data;
        }
      }, {
        key: "getAndRemove",
        value: function getAndRemove(t) {
          return this.has(t) ? this._getAndRemoveByKey(t.wrapped().key) : null;
        }
      }, {
        key: "_getAndRemoveByKey",
        value: function _getAndRemoveByKey(t) {
          var e = this.data[t].shift();
          return e.timeout && clearTimeout(e.timeout), 0 === this.data[t].length && delete this.data[t], this.order.splice(this.order.indexOf(t), 1), e.value;
        }
      }, {
        key: "getByKey",
        value: function getByKey(t) {
          var e = this.data[t];
          return e ? e[0].value : null;
        }
      }, {
        key: "get",
        value: function get(t) {
          return this.has(t) ? this.data[t.wrapped().key][0].value : null;
        }
      }, {
        key: "remove",
        value: function remove(t, e) {
          if (!this.has(t)) return this;
          var r = t.wrapped().key,
              i = void 0 === e ? 0 : this.data[r].indexOf(e),
              n = this.data[r][i];
          return this.data[r].splice(i, 1), n.timeout && clearTimeout(n.timeout), 0 === this.data[r].length && delete this.data[r], this.onRemove(n.value), this.order.splice(this.order.indexOf(r), 1), this;
        }
      }, {
        key: "setMaxSize",
        value: function setMaxSize(t) {
          for (this.max = t; this.order.length > this.max;) {
            var _t176 = this._getAndRemoveByKey(this.order[0]);

            _t176 && this.onRemove(_t176);
          }

          return this;
        }
      }, {
        key: "filter",
        value: function filter(t) {
          var e = [];

          for (var _r166 in this.data) {
            var _iterator116 = _createForOfIteratorHelper(this.data[_r166]),
                _step116;

            try {
              for (_iterator116.s(); !(_step116 = _iterator116.n()).done;) {
                var _i125 = _step116.value;
                t(_i125.value) || e.push(_i125);
              }
            } catch (err) {
              _iterator116.e(err);
            } finally {
              _iterator116.f();
            }
          }

          for (var _i126 = 0, _e177 = e; _i126 < _e177.length; _i126++) {
            var _t177 = _e177[_i126];
            this.remove(_t177.value.tileID, _t177);
          }
        }
      }]);

      return Xc;
    }();

    var Gc = /*#__PURE__*/function () {
      function Gc(t, e, r) {
        _classCallCheck(this, Gc);

        this.context = t;
        var i = t.gl;
        this.buffer = i.createBuffer(), this.dynamicDraw = Boolean(r), this.context.unbindVAO(), t.bindElementBuffer.set(this.buffer), i.bufferData(i.ELEMENT_ARRAY_BUFFER, e.arrayBuffer, this.dynamicDraw ? i.DYNAMIC_DRAW : i.STATIC_DRAW), this.dynamicDraw || delete e.arrayBuffer;
      }

      _createClass(Gc, [{
        key: "bind",
        value: function bind() {
          this.context.bindElementBuffer.set(this.buffer);
        }
      }, {
        key: "updateData",
        value: function updateData(t) {
          var e = this.context.gl;
          this.context.unbindVAO(), this.bind(), e.bufferSubData(e.ELEMENT_ARRAY_BUFFER, 0, t.arrayBuffer);
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.buffer && (this.context.gl.deleteBuffer(this.buffer), delete this.buffer);
        }
      }]);

      return Gc;
    }();

    var Hc = {
      Int8: "BYTE",
      Uint8: "UNSIGNED_BYTE",
      Int16: "SHORT",
      Uint16: "UNSIGNED_SHORT",
      Int32: "INT",
      Uint32: "UNSIGNED_INT",
      Float32: "FLOAT"
    };

    var Jc = /*#__PURE__*/function () {
      function Jc(t, e, r, i) {
        _classCallCheck(this, Jc);

        this.length = e.length, this.attributes = r, this.itemSize = e.bytesPerElement, this.dynamicDraw = i, this.context = t;
        var n = t.gl;
        this.buffer = n.createBuffer(), t.bindVertexBuffer.set(this.buffer), n.bufferData(n.ARRAY_BUFFER, e.arrayBuffer, this.dynamicDraw ? n.DYNAMIC_DRAW : n.STATIC_DRAW), this.dynamicDraw || delete e.arrayBuffer;
      }

      _createClass(Jc, [{
        key: "bind",
        value: function bind() {
          this.context.bindVertexBuffer.set(this.buffer);
        }
      }, {
        key: "updateData",
        value: function updateData(t) {
          var e = this.context.gl;
          this.bind(), e.bufferSubData(e.ARRAY_BUFFER, 0, t.arrayBuffer);
        }
      }, {
        key: "enableAttributes",
        value: function enableAttributes(t, e) {
          for (var _r167 = 0; _r167 < this.attributes.length; _r167++) {
            var _i127 = e.attributes[this.attributes[_r167].name];
            void 0 !== _i127 && t.enableVertexAttribArray(_i127);
          }
        }
      }, {
        key: "setVertexAttribPointers",
        value: function setVertexAttribPointers(t, e, r) {
          for (var _i128 = 0; _i128 < this.attributes.length; _i128++) {
            var _n96 = this.attributes[_i128],
                _s78 = e.attributes[_n96.name];
            void 0 !== _s78 && t.vertexAttribPointer(_s78, _n96.components, t[Hc[_n96.type]], !1, this.itemSize, _n96.offset + this.itemSize * (r || 0));
          }
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.buffer && (this.context.gl.deleteBuffer(this.buffer), delete this.buffer);
        }
      }]);

      return Jc;
    }();

    var Yc = /*#__PURE__*/function () {
      function Yc(t) {
        _classCallCheck(this, Yc);

        this.gl = t.gl, this["default"] = this.getDefault(), this.current = this["default"], this.dirty = !1;
      }

      _createClass(Yc, [{
        key: "get",
        value: function get() {
          return this.current;
        }
      }, {
        key: "set",
        value: function set(t) {}
      }, {
        key: "getDefault",
        value: function getDefault() {
          return this["default"];
        }
      }, {
        key: "setDefault",
        value: function setDefault() {
          this.set(this["default"]);
        }
      }]);

      return Yc;
    }();

    var Wc = /*#__PURE__*/function (_Yc) {
      _inherits(Wc, _Yc);

      var _super57 = _createSuper(Wc);

      function Wc() {
        _classCallCheck(this, Wc);

        return _super57.apply(this, arguments);
      }

      _createClass(Wc, [{
        key: "getDefault",
        value: function getDefault() {
          return oe.transparent;
        }
      }, {
        key: "set",
        value: function set(t) {
          var e = this.current;
          (t.r !== e.r || t.g !== e.g || t.b !== e.b || t.a !== e.a || this.dirty) && (this.gl.clearColor(t.r, t.g, t.b, t.a), this.current = t, this.dirty = !1);
        }
      }]);

      return Wc;
    }(Yc);

    var Qc = /*#__PURE__*/function (_Yc2) {
      _inherits(Qc, _Yc2);

      var _super58 = _createSuper(Qc);

      function Qc() {
        _classCallCheck(this, Qc);

        return _super58.apply(this, arguments);
      }

      _createClass(Qc, [{
        key: "getDefault",
        value: function getDefault() {
          return 1;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.clearDepth(t), this.current = t, this.dirty = !1);
        }
      }]);

      return Qc;
    }(Yc);

    var th = /*#__PURE__*/function (_Yc3) {
      _inherits(th, _Yc3);

      var _super59 = _createSuper(th);

      function th() {
        _classCallCheck(this, th);

        return _super59.apply(this, arguments);
      }

      _createClass(th, [{
        key: "getDefault",
        value: function getDefault() {
          return 0;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.clearStencil(t), this.current = t, this.dirty = !1);
        }
      }]);

      return th;
    }(Yc);

    var eh = /*#__PURE__*/function (_Yc4) {
      _inherits(eh, _Yc4);

      var _super60 = _createSuper(eh);

      function eh() {
        _classCallCheck(this, eh);

        return _super60.apply(this, arguments);
      }

      _createClass(eh, [{
        key: "getDefault",
        value: function getDefault() {
          return [!0, !0, !0, !0];
        }
      }, {
        key: "set",
        value: function set(t) {
          var e = this.current;
          (t[0] !== e[0] || t[1] !== e[1] || t[2] !== e[2] || t[3] !== e[3] || this.dirty) && (this.gl.colorMask(t[0], t[1], t[2], t[3]), this.current = t, this.dirty = !1);
        }
      }]);

      return eh;
    }(Yc);

    var rh = /*#__PURE__*/function (_Yc5) {
      _inherits(rh, _Yc5);

      var _super61 = _createSuper(rh);

      function rh() {
        _classCallCheck(this, rh);

        return _super61.apply(this, arguments);
      }

      _createClass(rh, [{
        key: "getDefault",
        value: function getDefault() {
          return !0;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.depthMask(t), this.current = t, this.dirty = !1);
        }
      }]);

      return rh;
    }(Yc);

    var ih = /*#__PURE__*/function (_Yc6) {
      _inherits(ih, _Yc6);

      var _super62 = _createSuper(ih);

      function ih() {
        _classCallCheck(this, ih);

        return _super62.apply(this, arguments);
      }

      _createClass(ih, [{
        key: "getDefault",
        value: function getDefault() {
          return 255;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.stencilMask(t), this.current = t, this.dirty = !1);
        }
      }]);

      return ih;
    }(Yc);

    var nh = /*#__PURE__*/function (_Yc7) {
      _inherits(nh, _Yc7);

      var _super63 = _createSuper(nh);

      function nh() {
        _classCallCheck(this, nh);

        return _super63.apply(this, arguments);
      }

      _createClass(nh, [{
        key: "getDefault",
        value: function getDefault() {
          return {
            func: this.gl.ALWAYS,
            ref: 0,
            mask: 255
          };
        }
      }, {
        key: "set",
        value: function set(t) {
          var e = this.current;
          (t.func !== e.func || t.ref !== e.ref || t.mask !== e.mask || this.dirty) && (this.gl.stencilFunc(t.func, t.ref, t.mask), this.current = t, this.dirty = !1);
        }
      }]);

      return nh;
    }(Yc);

    var sh = /*#__PURE__*/function (_Yc8) {
      _inherits(sh, _Yc8);

      var _super64 = _createSuper(sh);

      function sh() {
        _classCallCheck(this, sh);

        return _super64.apply(this, arguments);
      }

      _createClass(sh, [{
        key: "getDefault",
        value: function getDefault() {
          var t = this.gl;
          return [t.KEEP, t.KEEP, t.KEEP];
        }
      }, {
        key: "set",
        value: function set(t) {
          var e = this.current;
          (t[0] !== e[0] || t[1] !== e[1] || t[2] !== e[2] || this.dirty) && (this.gl.stencilOp(t[0], t[1], t[2]), this.current = t, this.dirty = !1);
        }
      }]);

      return sh;
    }(Yc);

    var ah = /*#__PURE__*/function (_Yc9) {
      _inherits(ah, _Yc9);

      var _super65 = _createSuper(ah);

      function ah() {
        _classCallCheck(this, ah);

        return _super65.apply(this, arguments);
      }

      _createClass(ah, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          t ? e.enable(e.STENCIL_TEST) : e.disable(e.STENCIL_TEST), this.current = t, this.dirty = !1;
        }
      }]);

      return ah;
    }(Yc);

    var oh = /*#__PURE__*/function (_Yc10) {
      _inherits(oh, _Yc10);

      var _super66 = _createSuper(oh);

      function oh() {
        _classCallCheck(this, oh);

        return _super66.apply(this, arguments);
      }

      _createClass(oh, [{
        key: "getDefault",
        value: function getDefault() {
          return [0, 1];
        }
      }, {
        key: "set",
        value: function set(t) {
          var e = this.current;
          (t[0] !== e[0] || t[1] !== e[1] || this.dirty) && (this.gl.depthRange(t[0], t[1]), this.current = t, this.dirty = !1);
        }
      }]);

      return oh;
    }(Yc);

    var lh = /*#__PURE__*/function (_Yc11) {
      _inherits(lh, _Yc11);

      var _super67 = _createSuper(lh);

      function lh() {
        _classCallCheck(this, lh);

        return _super67.apply(this, arguments);
      }

      _createClass(lh, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          t ? e.enable(e.DEPTH_TEST) : e.disable(e.DEPTH_TEST), this.current = t, this.dirty = !1;
        }
      }]);

      return lh;
    }(Yc);

    var uh = /*#__PURE__*/function (_Yc12) {
      _inherits(uh, _Yc12);

      var _super68 = _createSuper(uh);

      function uh() {
        _classCallCheck(this, uh);

        return _super68.apply(this, arguments);
      }

      _createClass(uh, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.LESS;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.depthFunc(t), this.current = t, this.dirty = !1);
        }
      }]);

      return uh;
    }(Yc);

    var ch = /*#__PURE__*/function (_Yc13) {
      _inherits(ch, _Yc13);

      var _super69 = _createSuper(ch);

      function ch() {
        _classCallCheck(this, ch);

        return _super69.apply(this, arguments);
      }

      _createClass(ch, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          t ? e.enable(e.BLEND) : e.disable(e.BLEND), this.current = t, this.dirty = !1;
        }
      }]);

      return ch;
    }(Yc);

    var hh = /*#__PURE__*/function (_Yc14) {
      _inherits(hh, _Yc14);

      var _super70 = _createSuper(hh);

      function hh() {
        _classCallCheck(this, hh);

        return _super70.apply(this, arguments);
      }

      _createClass(hh, [{
        key: "getDefault",
        value: function getDefault() {
          var t = this.gl;
          return [t.ONE, t.ZERO];
        }
      }, {
        key: "set",
        value: function set(t) {
          var e = this.current;
          (t[0] !== e[0] || t[1] !== e[1] || this.dirty) && (this.gl.blendFunc(t[0], t[1]), this.current = t, this.dirty = !1);
        }
      }]);

      return hh;
    }(Yc);

    var ph = /*#__PURE__*/function (_Yc15) {
      _inherits(ph, _Yc15);

      var _super71 = _createSuper(ph);

      function ph() {
        _classCallCheck(this, ph);

        return _super71.apply(this, arguments);
      }

      _createClass(ph, [{
        key: "getDefault",
        value: function getDefault() {
          return oe.transparent;
        }
      }, {
        key: "set",
        value: function set(t) {
          var e = this.current;
          (t.r !== e.r || t.g !== e.g || t.b !== e.b || t.a !== e.a || this.dirty) && (this.gl.blendColor(t.r, t.g, t.b, t.a), this.current = t, this.dirty = !1);
        }
      }]);

      return ph;
    }(Yc);

    var dh = /*#__PURE__*/function (_Yc16) {
      _inherits(dh, _Yc16);

      var _super72 = _createSuper(dh);

      function dh() {
        _classCallCheck(this, dh);

        return _super72.apply(this, arguments);
      }

      _createClass(dh, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.FUNC_ADD;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.blendEquation(t), this.current = t, this.dirty = !1);
        }
      }]);

      return dh;
    }(Yc);

    var fh = /*#__PURE__*/function (_Yc17) {
      _inherits(fh, _Yc17);

      var _super73 = _createSuper(fh);

      function fh() {
        _classCallCheck(this, fh);

        return _super73.apply(this, arguments);
      }

      _createClass(fh, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          t ? e.enable(e.CULL_FACE) : e.disable(e.CULL_FACE), this.current = t, this.dirty = !1;
        }
      }]);

      return fh;
    }(Yc);

    var yh = /*#__PURE__*/function (_Yc18) {
      _inherits(yh, _Yc18);

      var _super74 = _createSuper(yh);

      function yh() {
        _classCallCheck(this, yh);

        return _super74.apply(this, arguments);
      }

      _createClass(yh, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.BACK;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.cullFace(t), this.current = t, this.dirty = !1);
        }
      }]);

      return yh;
    }(Yc);

    var mh = /*#__PURE__*/function (_Yc19) {
      _inherits(mh, _Yc19);

      var _super75 = _createSuper(mh);

      function mh() {
        _classCallCheck(this, mh);

        return _super75.apply(this, arguments);
      }

      _createClass(mh, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.CCW;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.frontFace(t), this.current = t, this.dirty = !1);
        }
      }]);

      return mh;
    }(Yc);

    var gh = /*#__PURE__*/function (_Yc20) {
      _inherits(gh, _Yc20);

      var _super76 = _createSuper(gh);

      function gh() {
        _classCallCheck(this, gh);

        return _super76.apply(this, arguments);
      }

      _createClass(gh, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.useProgram(t), this.current = t, this.dirty = !1);
        }
      }]);

      return gh;
    }(Yc);

    var xh = /*#__PURE__*/function (_Yc21) {
      _inherits(xh, _Yc21);

      var _super77 = _createSuper(xh);

      function xh() {
        _classCallCheck(this, xh);

        return _super77.apply(this, arguments);
      }

      _createClass(xh, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.TEXTURE0;
        }
      }, {
        key: "set",
        value: function set(t) {
          (t !== this.current || this.dirty) && (this.gl.activeTexture(t), this.current = t, this.dirty = !1);
        }
      }]);

      return xh;
    }(Yc);

    var vh = /*#__PURE__*/function (_Yc22) {
      _inherits(vh, _Yc22);

      var _super78 = _createSuper(vh);

      function vh() {
        _classCallCheck(this, vh);

        return _super78.apply(this, arguments);
      }

      _createClass(vh, [{
        key: "getDefault",
        value: function getDefault() {
          var t = this.gl;
          return [0, 0, t.drawingBufferWidth, t.drawingBufferHeight];
        }
      }, {
        key: "set",
        value: function set(t) {
          var e = this.current;
          (t[0] !== e[0] || t[1] !== e[1] || t[2] !== e[2] || t[3] !== e[3] || this.dirty) && (this.gl.viewport(t[0], t[1], t[2], t[3]), this.current = t, this.dirty = !1);
        }
      }]);

      return vh;
    }(Yc);

    var bh = /*#__PURE__*/function (_Yc23) {
      _inherits(bh, _Yc23);

      var _super79 = _createSuper(bh);

      function bh() {
        _classCallCheck(this, bh);

        return _super79.apply(this, arguments);
      }

      _createClass(bh, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          e.bindFramebuffer(e.FRAMEBUFFER, t), this.current = t, this.dirty = !1;
        }
      }]);

      return bh;
    }(Yc);

    var wh = /*#__PURE__*/function (_Yc24) {
      _inherits(wh, _Yc24);

      var _super80 = _createSuper(wh);

      function wh() {
        _classCallCheck(this, wh);

        return _super80.apply(this, arguments);
      }

      _createClass(wh, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          e.bindRenderbuffer(e.RENDERBUFFER, t), this.current = t, this.dirty = !1;
        }
      }]);

      return wh;
    }(Yc);

    var _h = /*#__PURE__*/function (_Yc25) {
      _inherits(_h, _Yc25);

      var _super81 = _createSuper(_h);

      function _h() {
        _classCallCheck(this, _h);

        return _super81.apply(this, arguments);
      }

      _createClass(_h, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          e.bindTexture(e.TEXTURE_2D, t), this.current = t, this.dirty = !1;
        }
      }]);

      return _h;
    }(Yc);

    var Ah = /*#__PURE__*/function (_Yc26) {
      _inherits(Ah, _Yc26);

      var _super82 = _createSuper(Ah);

      function Ah() {
        _classCallCheck(this, Ah);

        return _super82.apply(this, arguments);
      }

      _createClass(Ah, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          e.bindBuffer(e.ARRAY_BUFFER, t), this.current = t, this.dirty = !1;
        }
      }]);

      return Ah;
    }(Yc);

    var kh = /*#__PURE__*/function (_Yc27) {
      _inherits(kh, _Yc27);

      var _super83 = _createSuper(kh);

      function kh() {
        _classCallCheck(this, kh);

        return _super83.apply(this, arguments);
      }

      _createClass(kh, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(t) {
          var e = this.gl;
          e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, t), this.current = t, this.dirty = !1;
        }
      }]);

      return kh;
    }(Yc);

    var Sh = /*#__PURE__*/function (_Yc28) {
      _inherits(Sh, _Yc28);

      var _super84 = _createSuper(Sh);

      function Sh(t) {
        var _this31;

        _classCallCheck(this, Sh);

        _this31 = _super84.call(this, t), _this31.vao = t.extVertexArrayObject;
        return _this31;
      }

      _createClass(Sh, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(t) {
          this.vao && (t !== this.current || this.dirty) && (this.vao.bindVertexArrayOES(t), this.current = t, this.dirty = !1);
        }
      }]);

      return Sh;
    }(Yc);

    var Ih = /*#__PURE__*/function (_Yc29) {
      _inherits(Ih, _Yc29);

      var _super85 = _createSuper(Ih);

      function Ih() {
        _classCallCheck(this, Ih);

        return _super85.apply(this, arguments);
      }

      _createClass(Ih, [{
        key: "getDefault",
        value: function getDefault() {
          return 4;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          e.pixelStorei(e.UNPACK_ALIGNMENT, t), this.current = t, this.dirty = !1;
        }
      }]);

      return Ih;
    }(Yc);

    var Th = /*#__PURE__*/function (_Yc30) {
      _inherits(Th, _Yc30);

      var _super86 = _createSuper(Th);

      function Th() {
        _classCallCheck(this, Th);

        return _super86.apply(this, arguments);
      }

      _createClass(Th, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL, t), this.current = t, this.dirty = !1;
        }
      }]);

      return Th;
    }(Yc);

    var zh = /*#__PURE__*/function (_Yc31) {
      _inherits(zh, _Yc31);

      var _super87 = _createSuper(zh);

      function zh() {
        _classCallCheck(this, zh);

        return _super87.apply(this, arguments);
      }

      _createClass(zh, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          var e = this.gl;
          e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL, t), this.current = t, this.dirty = !1;
        }
      }]);

      return zh;
    }(Yc);

    var Eh = /*#__PURE__*/function (_Yc32) {
      _inherits(Eh, _Yc32);

      var _super88 = _createSuper(Eh);

      function Eh(t, e) {
        var _this32;

        _classCallCheck(this, Eh);

        _this32 = _super88.call(this, t), _this32.context = t, _this32.parent = e;
        return _this32;
      }

      _createClass(Eh, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }]);

      return Eh;
    }(Yc);

    var Ch = /*#__PURE__*/function (_Eh) {
      _inherits(Ch, _Eh);

      var _super89 = _createSuper(Ch);

      function Ch() {
        _classCallCheck(this, Ch);

        return _super89.apply(this, arguments);
      }

      _createClass(Ch, [{
        key: "setDirty",
        value: function setDirty() {
          this.dirty = !0;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          this.context.bindFramebuffer.set(this.parent);
          var e = this.gl;
          e.framebufferTexture2D(e.FRAMEBUFFER, e.COLOR_ATTACHMENT0, e.TEXTURE_2D, t, 0), this.current = t, this.dirty = !1;
        }
      }]);

      return Ch;
    }(Eh);

    var Mh = /*#__PURE__*/function (_Eh2) {
      _inherits(Mh, _Eh2);

      var _super90 = _createSuper(Mh);

      function Mh() {
        _classCallCheck(this, Mh);

        return _super90.apply(this, arguments);
      }

      _createClass(Mh, [{
        key: "attachment",
        value: function attachment() {
          return this.gl.DEPTH_ATTACHMENT;
        }
      }, {
        key: "set",
        value: function set(t) {
          if (t === this.current && !this.dirty) return;
          this.context.bindFramebuffer.set(this.parent);
          var e = this.gl;
          e.framebufferRenderbuffer(e.FRAMEBUFFER, this.attachment(), e.RENDERBUFFER, t), this.current = t, this.dirty = !1;
        }
      }]);

      return Mh;
    }(Eh);

    var Bh = /*#__PURE__*/function () {
      function Bh(t, e, r, i) {
        _classCallCheck(this, Bh);

        this.context = t, this.width = e, this.height = r;
        var n = this.framebuffer = t.gl.createFramebuffer();
        this.colorAttachment = new Ch(t, n), i && (this.depthAttachment = new Mh(t, n));
      }

      _createClass(Bh, [{
        key: "destroy",
        value: function destroy() {
          var t = this.context.gl,
              e = this.colorAttachment.get();

          if (e && t.deleteTexture(e), this.depthAttachment) {
            var _e178 = this.depthAttachment.get();

            _e178 && t.deleteRenderbuffer(_e178);
          }

          t.deleteFramebuffer(this.framebuffer);
        }
      }]);

      return Bh;
    }();

    var Dh = function Dh(t, e, r) {
      _classCallCheck(this, Dh);

      this.func = t, this.mask = e, this.range = r;
    };

    Dh.ReadOnly = !1, Dh.ReadWrite = !0, Dh.disabled = new Dh(519, Dh.ReadOnly, [0, 1]);

    var Ph = function Ph(t, e, r, i, n, s) {
      _classCallCheck(this, Ph);

      this.test = t, this.ref = e, this.mask = r, this.fail = i, this.depthFail = n, this.pass = s;
    };

    Ph.disabled = new Ph({
      func: 519,
      mask: 0
    }, 0, 0, 7680, 7680, 7680);

    var Vh = function Vh(t, e, r) {
      _classCallCheck(this, Vh);

      this.blendFunction = t, this.blendColor = e, this.mask = r;
    };

    Vh.Replace = [1, 0], Vh.disabled = new Vh(Vh.Replace, oe.transparent, [!1, !1, !1, !1]), Vh.unblended = new Vh(Vh.Replace, oe.transparent, [!0, !0, !0, !0]), Vh.alphaBlended = new Vh([1, 771], oe.transparent, [!0, !0, !0, !0]);

    var Fh = function Fh(t, e, r) {
      _classCallCheck(this, Fh);

      this.enable = t, this.mode = e, this.frontFace = r;
    };

    Fh.disabled = new Fh(!1, 1029, 2305), Fh.backCCW = new Fh(!0, 1029, 2305), Fh.backCW = new Fh(!0, 1029, 2304), Fh.frontCW = new Fh(!0, 1028, 2304), Fh.frontCCW = new Fh(!0, 1028, 2305);

    var Rh = /*#__PURE__*/function (_Pt2) {
      _inherits(Rh, _Pt2);

      var _super91 = _createSuper(Rh);

      function Rh(t, e, r) {
        var _this33;

        _classCallCheck(this, Rh);

        _this33 = _super91.call(this), _this33.id = t, _this33._onlySymbols = r, e.on("data", function (t) {
          "source" === t.dataType && "metadata" === t.sourceDataType && (_this33._sourceLoaded = !0), _this33._sourceLoaded && !_this33._paused && "source" === t.dataType && "content" === t.sourceDataType && (_this33.reload(), _this33.transform && _this33.update(_this33.transform));
        }), e.on("error", function () {
          _this33._sourceErrored = !0;
        }), _this33._source = e, _this33._tiles = {}, _this33._cache = new Xc(0, _this33._unloadTile.bind(_assertThisInitialized(_this33))), _this33._timers = {}, _this33._cacheTimers = {}, _this33._maxTileCacheSize = null, _this33._loadedParentTiles = {}, _this33._coveredTiles = {}, _this33._state = new Fc();
        return _this33;
      }

      _createClass(Rh, [{
        key: "onAdd",
        value: function onAdd(t) {
          this.map = t, this._maxTileCacheSize = t ? t._maxTileCacheSize : null;
        }
      }, {
        key: "loaded",
        value: function loaded() {
          if (this._sourceErrored) return !0;
          if (!this._sourceLoaded) return !1;
          if (!this._source.loaded()) return !1;

          for (var _t178 in this._tiles) {
            var _e179 = this._tiles[_t178];
            if ("loaded" !== _e179.state && "errored" !== _e179.state) return !1;
          }

          return !0;
        }
      }, {
        key: "getSource",
        value: function getSource() {
          return this._source;
        }
      }, {
        key: "pause",
        value: function pause() {
          this._paused = !0;
        }
      }, {
        key: "resume",
        value: function resume() {
          if (!this._paused) return;
          var t = this._shouldReloadOnResume;
          this._paused = !1, this._shouldReloadOnResume = !1, t && this.reload(), this.transform && this.update(this.transform);
        }
      }, {
        key: "_loadTile",
        value: function _loadTile(t, e) {
          return t.isSymbolTile = this._onlySymbols, this._source.loadTile(t, e);
        }
      }, {
        key: "_unloadTile",
        value: function _unloadTile(t) {
          if (this._source.unloadTile) return this._source.unloadTile(t, function () {});
        }
      }, {
        key: "_abortTile",
        value: function _abortTile(t) {
          if (this._source.abortTile) return this._source.abortTile(t, function () {});
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return this._source.serialize();
        }
      }, {
        key: "prepare",
        value: function prepare(t) {
          this._source.prepare && this._source.prepare(), this._state.coalesceChanges(this._tiles, this.map ? this.map.painter : null);

          for (var _e180 in this._tiles) {
            var _r168 = this._tiles[_e180];
            _r168.upload(t), _r168.prepare(this.map.style.imageManager);
          }
        }
      }, {
        key: "getIds",
        value: function getIds() {
          return m(this._tiles).map(function (t) {
            return t.tileID;
          }).sort(Lh).map(function (t) {
            return t.key;
          });
        }
      }, {
        key: "getRenderableIds",
        value: function getRenderableIds(t) {
          var _this34 = this;

          var e = [];

          for (var _r169 in this._tiles) {
            this._isIdRenderable(+_r169, t) && e.push(this._tiles[_r169]);
          }

          return t ? e.sort(function (t, e) {
            var r = t.tileID,
                n = e.tileID,
                s = new i(r.canonical.x, r.canonical.y)._rotate(_this34.transform.angle),
                a = new i(n.canonical.x, n.canonical.y)._rotate(_this34.transform.angle);

            return r.overscaledZ - n.overscaledZ || a.y - s.y || a.x - s.x;
          }).map(function (t) {
            return t.tileID.key;
          }) : e.map(function (t) {
            return t.tileID;
          }).sort(Lh).map(function (t) {
            return t.key;
          });
        }
      }, {
        key: "hasRenderableParent",
        value: function hasRenderableParent(t) {
          var e = this.findLoadedParent(t, 0);
          return !!e && this._isIdRenderable(e.tileID.key);
        }
      }, {
        key: "_isIdRenderable",
        value: function _isIdRenderable(t, e) {
          return this._tiles[t] && this._tiles[t].hasData() && !this._coveredTiles[t] && (e || !this._tiles[t].holdingForFade());
        }
      }, {
        key: "reload",
        value: function reload() {
          if (this._paused) this._shouldReloadOnResume = !0;else {
            this._cache.reset();

            for (var _t179 in this._tiles) {
              "errored" !== this._tiles[_t179].state && this._reloadTile(+_t179, "reloading");
            }
          }
        }
      }, {
        key: "_reloadTile",
        value: function _reloadTile(t, e) {
          var r = this._tiles[t];
          r && ("loading" !== r.state && (r.state = e), this._loadTile(r, this._tileLoaded.bind(this, r, t, e)));
        }
      }, {
        key: "_tileLoaded",
        value: function _tileLoaded(t, e, r, i) {
          if (i) return t.state = "errored", void (404 !== i.status ? this._source.fire(new Dt(i, {
            tile: t
          })) : this.update(this.transform));
          t.timeAdded = O.now(), "expired" === r && (t.refreshedUponExpiration = !0), this._setTileReloadTimer(e, t), "raster-dem" === this.getSource().type && t.dem && this._backfillDEM(t), this._state.initializeTileState(t, this.map ? this.map.painter : null), this._source.fire(new Bt("data", {
            dataType: "source",
            tile: t,
            coord: t.tileID,
            sourceCacheId: this.id
          }));
        }
      }, {
        key: "_backfillDEM",
        value: function _backfillDEM(t) {
          var e = this.getRenderableIds();

          for (var _i129 = 0; _i129 < e.length; _i129++) {
            var _n97 = e[_i129];

            if (t.neighboringTiles && t.neighboringTiles[_n97]) {
              var _e181 = this.getTileByID(_n97);

              r(t, _e181), r(_e181, t);
            }
          }

          function r(t, e) {
            if (!t.dem || t.dem.borderReady) return;
            t.needsHillshadePrepare = !0, t.needsDEMTextureUpload = !0;
            var r = e.tileID.canonical.x - t.tileID.canonical.x;
            var i = e.tileID.canonical.y - t.tileID.canonical.y,
                n = Math.pow(2, t.tileID.canonical.z),
                s = e.tileID.key;
            0 === r && 0 === i || Math.abs(i) > 1 || (Math.abs(r) > 1 && (1 === Math.abs(r + n) ? r += n : 1 === Math.abs(r - n) && (r -= n)), e.dem && t.dem && (t.dem.backfillBorder(e.dem, r, i), t.neighboringTiles && t.neighboringTiles[s] && (t.neighboringTiles[s].backfilled = !0)));
          }
        }
      }, {
        key: "getTile",
        value: function getTile(t) {
          return this.getTileByID(t.key);
        }
      }, {
        key: "getTileByID",
        value: function getTileByID(t) {
          return this._tiles[t];
        }
      }, {
        key: "_retainLoadedChildren",
        value: function _retainLoadedChildren(t, e, r, i) {
          for (var _n98 in this._tiles) {
            var _s79 = this._tiles[_n98];
            if (i[_n98] || !_s79.hasData() || _s79.tileID.overscaledZ <= e || _s79.tileID.overscaledZ > r) continue;
            var _a70 = _s79.tileID;

            for (; _s79 && _s79.tileID.overscaledZ > e + 1;) {
              var _t180 = _s79.tileID.scaledTo(_s79.tileID.overscaledZ - 1);

              _s79 = this._tiles[_t180.key], _s79 && _s79.hasData() && (_a70 = _t180);
            }

            var _o39 = _a70;

            for (; _o39.overscaledZ > e;) {
              if (_o39 = _o39.scaledTo(_o39.overscaledZ - 1), t[_o39.key]) {
                i[_a70.key] = _a70;
                break;
              }
            }
          }
        }
      }, {
        key: "findLoadedParent",
        value: function findLoadedParent(t, e) {
          if (t.key in this._loadedParentTiles) {
            var _r170 = this._loadedParentTiles[t.key];
            return _r170 && _r170.tileID.overscaledZ >= e ? _r170 : null;
          }

          for (var _r171 = t.overscaledZ - 1; _r171 >= e; _r171--) {
            var _e182 = t.scaledTo(_r171),
                _i130 = this._getLoadedTile(_e182);

            if (_i130) return _i130;
          }
        }
      }, {
        key: "_getLoadedTile",
        value: function _getLoadedTile(t) {
          var e = this._tiles[t.key];
          return e && e.hasData() ? e : this._cache.getByKey(this._source.reparseOverscaled ? t.wrapped().key : t.canonical.key);
        }
      }, {
        key: "updateCacheSize",
        value: function updateCacheSize(t, e) {
          e = e || this._source.tileSize;
          var r = Math.ceil(t.width / e) + 1,
              i = Math.ceil(t.height / e) + 1,
              n = Math.floor(r * i * 5),
              s = "number" == typeof this._maxTileCacheSize ? Math.min(this._maxTileCacheSize, n) : n;

          this._cache.setMaxSize(s);
        }
      }, {
        key: "handleWrapJump",
        value: function handleWrapJump(t) {
          var e = Math.round((t - (void 0 === this._prevLng ? t : this._prevLng)) / 360);

          if (this._prevLng = t, e) {
            var _t181 = {};

            for (var _r172 in this._tiles) {
              var _i131 = this._tiles[_r172];
              _i131.tileID = _i131.tileID.unwrapTo(_i131.tileID.wrap + e), _t181[_i131.tileID.key] = _i131;
            }

            this._tiles = _t181;

            for (var _t182 in this._timers) {
              clearTimeout(this._timers[_t182]), delete this._timers[_t182];
            }

            for (var _t183 in this._tiles) {
              this._setTileReloadTimer(+_t183, this._tiles[_t183]);
            }
          }
        }
      }, {
        key: "update",
        value: function update(t, e, r) {
          var _this35 = this;

          if (this.transform = t, !this._sourceLoaded || this._paused || this.transform.freezeTileCoverage) return;
          if (this.usedForTerrain && !r) return;
          var i;
          this.updateCacheSize(t, e), this.handleWrapJump(this.transform.center.lng), this._coveredTiles = {}, this.used || this.usedForTerrain ? this._source.tileID ? i = t.getVisibleUnwrappedCoordinates(this._source.tileID).map(function (t) {
            return new Cc(t.canonical.z, t.wrap, t.canonical.z, t.canonical.x, t.canonical.y);
          }) : (i = t.coveringTiles({
            tileSize: e || this._source.tileSize,
            minzoom: this._source.minzoom,
            maxzoom: this._source.maxzoom,
            roundZoom: this._source.roundZoom && !r,
            reparseOverscaled: this._source.reparseOverscaled,
            useElevationData: !!this.transform.elevation && !this.usedForTerrain
          }), this._source.hasTile && (i = i.filter(function (t) {
            return _this35._source.hasTile(t);
          }))) : i = [];

          var n = this._updateRetainedTiles(i);

          if (Uh(this._source.type) && 0 !== i.length) {
            var _t184 = {},
                _e183 = {},
                _r173 = Object.keys(n);

            for (var _i132 = 0, _r174 = _r173; _i132 < _r174.length; _i132++) {
              var _i133 = _r174[_i132];
              var _r175 = n[_i133],
                  _s81 = this._tiles[_i133];
              if (!_s81 || _s81.fadeEndTime && _s81.fadeEndTime <= O.now()) continue;

              var _a71 = this.findLoadedParent(_r175, Math.max(_r175.overscaledZ - Rh.maxOverzooming, this._source.minzoom));

              _a71 && (this._addTile(_a71.tileID), _t184[_a71.tileID.key] = _a71.tileID), _e183[_i133] = _r175;
            }

            var _s80 = i[i.length - 1].overscaledZ;

            for (var _t185 in this._tiles) {
              var _r176 = this._tiles[_t185];
              if (n[_t185] || !_r176.hasData()) continue;
              var _i134 = _r176.tileID;

              for (; _i134.overscaledZ > _s80;) {
                _i134 = _i134.scaledTo(_i134.overscaledZ - 1);
                var _s82 = this._tiles[_i134.key];

                if (_s82 && _s82.hasData() && _e183[_i134.key]) {
                  n[_t185] = _r176.tileID;
                  break;
                }
              }
            }

            for (var _e184 in _t184) {
              n[_e184] || (this._coveredTiles[_e184] = !0, n[_e184] = _t184[_e184]);
            }
          }

          for (var _t186 in n) {
            this._tiles[_t186].clearFadeHold();
          }

          var s = function (t, e) {
            var r = [];

            for (var _i135 in t) {
              _i135 in e || r.push(_i135);
            }

            return r;
          }(this._tiles, n);

          var _iterator117 = _createForOfIteratorHelper(s),
              _step117;

          try {
            for (_iterator117.s(); !(_step117 = _iterator117.n()).done;) {
              var _t187 = _step117.value;
              var _e185 = this._tiles[_t187];
              _e185.hasSymbolBuckets && !_e185.holdingForFade() ? _e185.setHoldDuration(this.map._fadeDuration) : _e185.hasSymbolBuckets && !_e185.symbolFadeFinished() || this._removeTile(+_t187);
            }
          } catch (err) {
            _iterator117.e(err);
          } finally {
            _iterator117.f();
          }

          this._updateLoadedParentTileCache(), this._onlySymbols && this._source.afterUpdate && this._source.afterUpdate();
        }
      }, {
        key: "releaseSymbolFadeTiles",
        value: function releaseSymbolFadeTiles() {
          for (var _t188 in this._tiles) {
            this._tiles[_t188].holdingForFade() && this._removeTile(+_t188);
          }
        }
      }, {
        key: "_updateRetainedTiles",
        value: function _updateRetainedTiles(t) {
          var e = {};
          if (0 === t.length) return e;
          var r = {},
              i = t[t.length - 1].overscaledZ,
              n = t[0].overscaledZ,
              s = Math.max(n - Rh.maxOverzooming, this._source.minzoom),
              a = Math.max(n + Rh.maxUnderzooming, this._source.minzoom),
              o = {};

          var _iterator118 = _createForOfIteratorHelper(t),
              _step118;

          try {
            for (_iterator118.s(); !(_step118 = _iterator118.n()).done;) {
              var _r177 = _step118.value;

              var _t189 = this._addTile(_r177);

              e[_r177.key] = _r177, _t189.hasData() || i < this._source.maxzoom && (o[_r177.key] = _r177);
            }
          } catch (err) {
            _iterator118.e(err);
          } finally {
            _iterator118.f();
          }

          this._retainLoadedChildren(o, i, a, e);

          var _iterator119 = _createForOfIteratorHelper(t),
              _step119;

          try {
            for (_iterator119.s(); !(_step119 = _iterator119.n()).done;) {
              var _i136 = _step119.value;
              var _t190 = this._tiles[_i136.key];
              if (_t190.hasData()) continue;

              if (_i136.canonical.z >= this._source.maxzoom) {
                var _t191 = _i136.children(this._source.maxzoom)[0],
                    _r178 = this.getTile(_t191);

                if (_r178 && _r178.hasData()) {
                  e[_t191.key] = _t191;
                  continue;
                }
              } else {
                var _t192 = _i136.children(this._source.maxzoom);

                if (e[_t192[0].key] && e[_t192[1].key] && e[_t192[2].key] && e[_t192[3].key]) continue;
              }

              var _n99 = _t190.wasRequested();

              for (var _a72 = _i136.overscaledZ - 1; _a72 >= s; --_a72) {
                var _s83 = _i136.scaledTo(_a72);

                if (r[_s83.key]) break;
                if (r[_s83.key] = !0, _t190 = this.getTile(_s83), !_t190 && _n99 && (_t190 = this._addTile(_s83)), _t190 && (e[_s83.key] = _s83, _n99 = _t190.wasRequested(), _t190.hasData())) break;
              }
            }
          } catch (err) {
            _iterator119.e(err);
          } finally {
            _iterator119.f();
          }

          return e;
        }
      }, {
        key: "_updateLoadedParentTileCache",
        value: function _updateLoadedParentTileCache() {
          this._loadedParentTiles = {};

          for (var _t193 in this._tiles) {
            var _e186 = [];

            var _r179 = void 0,
                _i137 = this._tiles[_t193].tileID;

            for (; _i137.overscaledZ > 0;) {
              if (_i137.key in this._loadedParentTiles) {
                _r179 = this._loadedParentTiles[_i137.key];
                break;
              }

              _e186.push(_i137.key);

              var _t194 = _i137.scaledTo(_i137.overscaledZ - 1);

              if (_r179 = this._getLoadedTile(_t194), _r179) break;
              _i137 = _t194;
            }

            for (var _i138 = 0, _e187 = _e186; _i138 < _e187.length; _i138++) {
              var _t195 = _e187[_i138];
              this._loadedParentTiles[_t195] = _r179;
            }
          }
        }
      }, {
        key: "_addTile",
        value: function _addTile(t) {
          var e = this._tiles[t.key];
          if (e) return e;
          e = this._cache.getAndRemove(t), e && (this._setTileReloadTimer(t.key, e), e.tileID = t, this._state.initializeTileState(e, this.map ? this.map.painter : null), this._cacheTimers[t.key] && (clearTimeout(this._cacheTimers[t.key]), delete this._cacheTimers[t.key], this._setTileReloadTimer(t.key, e)));
          var r = Boolean(e);
          return r || (e = new Vc(t, this._source.tileSize * t.overscaleFactor(), this.transform.tileZoom), this._loadTile(e, this._tileLoaded.bind(this, e, t.key, e.state))), e ? (e.uses++, this._tiles[t.key] = e, r || this._source.fire(new Bt("dataloading", {
            tile: e,
            coord: e.tileID,
            dataType: "source"
          })), e) : null;
        }
      }, {
        key: "_setTileReloadTimer",
        value: function _setTileReloadTimer(t, e) {
          var _this36 = this;

          t in this._timers && (clearTimeout(this._timers[t]), delete this._timers[t]);
          var r = e.getExpiryTimeout();
          r && (this._timers[t] = setTimeout(function () {
            _this36._reloadTile(t, "expired"), delete _this36._timers[t];
          }, r));
        }
      }, {
        key: "_removeTile",
        value: function _removeTile(t) {
          var e = this._tiles[t];
          e && (e.uses--, delete this._tiles[t], this._timers[t] && (clearTimeout(this._timers[t]), delete this._timers[t]), e.uses > 0 || (e.hasData() && "reloading" !== e.state ? this._cache.add(e.tileID, e, e.getExpiryTimeout()) : (e.aborted = !0, this._abortTile(e), this._unloadTile(e))));
        }
      }, {
        key: "clearTiles",
        value: function clearTiles() {
          this._shouldReloadOnResume = !1, this._paused = !1;

          for (var _t196 in this._tiles) {
            this._removeTile(+_t196);
          }

          this._cache.reset();
        }
      }, {
        key: "tilesIn",
        value: function tilesIn(t, e, r) {
          var i = [],
              n = this.transform;
          if (!n) return i;

          for (var _s84 in this._tiles) {
            var _a73 = this._tiles[_s84];
            if (r && _a73.clearQueryDebugViz(), _a73.holdingForFade()) continue;

            var _o40 = t.containsTile(_a73, n, e);

            _o40 && i.push(_o40);
          }

          return i;
        }
      }, {
        key: "getVisibleCoordinates",
        value: function getVisibleCoordinates(t) {
          var _this37 = this;

          var e = this.getRenderableIds(t).map(function (t) {
            return _this37._tiles[t].tileID;
          });

          var _iterator120 = _createForOfIteratorHelper(e),
              _step120;

          try {
            for (_iterator120.s(); !(_step120 = _iterator120.n()).done;) {
              var _t197 = _step120.value;
              _t197.posMatrix = this.transform.calculatePosMatrix(_t197.toUnwrapped());
            }
          } catch (err) {
            _iterator120.e(err);
          } finally {
            _iterator120.f();
          }

          return e;
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          if (this._source.hasTransition()) return !0;
          if (Uh(this._source.type)) for (var _t198 in this._tiles) {
            var _e188 = this._tiles[_t198];
            if (void 0 !== _e188.fadeEndTime && _e188.fadeEndTime >= O.now()) return !0;
          }
          return !1;
        }
      }, {
        key: "setFeatureState",
        value: function setFeatureState(t, e, r) {
          this._state.updateState(t = t || "_geojsonTileLayer", e, r);
        }
      }, {
        key: "removeFeatureState",
        value: function removeFeatureState(t, e, r) {
          this._state.removeFeatureState(t = t || "_geojsonTileLayer", e, r);
        }
      }, {
        key: "getFeatureState",
        value: function getFeatureState(t, e) {
          return this._state.getState(t = t || "_geojsonTileLayer", e);
        }
      }, {
        key: "setDependencies",
        value: function setDependencies(t, e, r) {
          var i = this._tiles[t];
          i && i.setDependencies(e, r);
        }
      }, {
        key: "reloadTilesForDependencies",
        value: function reloadTilesForDependencies(t, e) {
          for (var _r180 in this._tiles) {
            this._tiles[_r180].hasDependency(t, e) && this._reloadTile(+_r180, "reloading");
          }

          this._cache.filter(function (r) {
            return !r.hasDependency(t, e);
          });
        }
      }]);

      return Rh;
    }(Pt);

    function Lh(t, e) {
      var r = Math.abs(2 * t.wrap) - +(t.wrap < 0),
          i = Math.abs(2 * e.wrap) - +(e.wrap < 0);
      return t.overscaledZ - e.overscaledZ || i - r || e.canonical.y - t.canonical.y || e.canonical.x - t.canonical.x;
    }

    function Uh(t) {
      return "raster" === t || "image" === t || "video" === t;
    }

    Rh.maxOverzooming = 10, Rh.maxUnderzooming = 3;

    var Oh = /*#__PURE__*/function () {
      function Oh(t, e, r) {
        _classCallCheck(this, Oh);

        this._dem = t, this._scale = e, this._offset = r;
      }

      _createClass(Oh, [{
        key: "getElevationAt",
        value: function getElevationAt(t, e, r) {
          var i = t * this._scale + this._offset[0],
              n = e * this._scale + this._offset[1],
              s = Math.floor(i),
              a = Math.floor(n),
              o = this._dem;
          return r ? Ye(Ye(o.get(s, a), o.get(s, a + 1), n - a), Ye(o.get(s + 1, a), o.get(s + 1, a + 1), n - a), i - s) : o.get(s, a);
        }
      }], [{
        key: "create",
        value: function create(t, e, r) {
          var i = r || t.findDEMTileFor(e);
          if (!i || !i.dem) return;
          var n = i.dem,
              s = i.tileID,
              a = 1 << e.canonical.z - s.canonical.z;
          return new Oh(n, i.tileSize / 8192 / a, [(e.canonical.x / a - s.canonical.x) * n.dim, (e.canonical.y / a - s.canonical.y) * n.dim]);
        }
      }]);

      return Oh;
    }();

    var $h = /*#__PURE__*/function () {
      function $h(t, e) {
        _classCallCheck(this, $h);

        this.tileID = t, this.x = t.canonical.x, this.y = t.canonical.y, this.z = t.canonical.z, this.grid = new Ui(8192, 16, 0), this.featureIndexArray = new ps(), this.promoteId = e;
      }

      _createClass($h, [{
        key: "insert",
        value: function insert(t, e, r, i, n) {
          var s = this.featureIndexArray.length;
          this.featureIndexArray.emplaceBack(r, i, n);
          var a = this.grid;

          for (var _t199 = 0; _t199 < e.length; _t199++) {
            var _r181 = e[_t199],
                _i139 = [1 / 0, 1 / 0, -1 / 0, -1 / 0];

            for (var _t200 = 0; _t200 < _r181.length; _t200++) {
              var _e189 = _r181[_t200];
              _i139[0] = Math.min(_i139[0], _e189.x), _i139[1] = Math.min(_i139[1], _e189.y), _i139[2] = Math.max(_i139[2], _e189.x), _i139[3] = Math.max(_i139[3], _e189.y);
            }

            _i139[0] < 8192 && _i139[1] < 8192 && _i139[2] >= 0 && _i139[3] >= 0 && a.insert(s, _i139[0], _i139[1], _i139[2], _i139[3]);
          }
        }
      }, {
        key: "loadVTLayers",
        value: function loadVTLayers() {
          return this.vtLayers || (this.vtLayers = new Go.VectorTile(new El(this.rawTileData)).layers, this.sourceLayerCoder = new Bc(this.vtLayers ? Object.keys(this.vtLayers).sort() : ["_geojsonTileLayer"])), this.vtLayers;
        }
      }, {
        key: "query",
        value: function query(t, e, r, i) {
          var _this38 = this;

          this.loadVTLayers();
          var n = t.params || {},
              s = hi(n.filter),
              a = t.tileResult,
              o = t.transform,
              l = a.bufferedTilespaceBounds,
              u = this.grid.query(l.min.x, l.min.y, l.max.x, l.max.y, function (t, e, r, i) {
            return ia(a.bufferedTilespaceGeometry, t, e, r, i);
          });
          u.sort(Nh);
          var c = null;
          o.elevation && u.length > 0 && (c = Oh.create(o.elevation, this.tileID));
          var h = {};
          var p;

          var _loop5 = function _loop5(_o41) {
            var l = u[_o41];
            if (l === p) return "continue";
            p = l;

            var d = _this38.featureIndexArray.get(l);

            var f = null;

            _this38.loadMatchingFeature(h, d.bucketIndex, d.sourceLayerIndex, d.featureIndex, s, n.layers, n.availableImages, e, r, i, function (e, r, i) {
              return f || (f = Ns(e)), r.queryIntersectsFeature(a, e, i, f, _this38.z, t.transform, t.pixelPosMatrix, c);
            });
          };

          for (var _o41 = 0; _o41 < u.length; _o41++) {
            var _ret2 = _loop5(_o41);

            if (_ret2 === "continue") continue;
          }

          return h;
        }
      }, {
        key: "loadMatchingFeature",
        value: function loadMatchingFeature(t, e, r, i, n, s, a, o, l, u, c) {
          var h = this.bucketLayerIDs[e];
          if (s && !function (t, e) {
            for (var _r182 = 0; _r182 < t.length; _r182++) {
              if (e.indexOf(t[_r182]) >= 0) return !0;
            }

            return !1;
          }(s, h)) return;
          var p = this.sourceLayerCoder.decode(r),
              d = this.vtLayers[p].feature(i);

          if (n.needGeometry) {
            var _t201 = js(d, !0);

            if (!n.filter(new yn(this.tileID.overscaledZ), _t201, this.tileID.canonical)) return;
          } else if (!n.filter(new yn(this.tileID.overscaledZ), d)) return;

          var f = this.getId(d, p);

          for (var _e190 = 0; _e190 < h.length; _e190++) {
            var _r183 = h[_e190];
            if (s && s.indexOf(_r183) < 0) continue;
            var _n100 = o[_r183];
            if (!_n100) continue;
            var _p11 = {};
            void 0 !== f && u && (_p11 = u.getState(_n100.sourceLayer || "_geojsonTileLayer", f));

            var _y9 = g({}, l[_r183]);

            _y9.paint = qh(_y9.paint, _n100.paint, d, _p11, a), _y9.layout = qh(_y9.layout, _n100.layout, d, _p11, a);

            var _m11 = !c || c(d, _n100, _p11);

            if (!_m11) continue;

            var _x9 = new Dc(d, this.z, this.x, this.y, f);

            _x9.layer = _y9;
            var _v9 = t[_r183];
            void 0 === _v9 && (_v9 = t[_r183] = []), _v9.push({
              featureIndex: i,
              feature: _x9,
              intersectionZ: _m11
            });
          }
        }
      }, {
        key: "lookupSymbolFeatures",
        value: function lookupSymbolFeatures(t, e, r, i, n, s, a, o) {
          var l = {};
          this.loadVTLayers();
          var u = hi(n);

          var _iterator121 = _createForOfIteratorHelper(t),
              _step121;

          try {
            for (_iterator121.s(); !(_step121 = _iterator121.n()).done;) {
              var _n101 = _step121.value;
              this.loadMatchingFeature(l, r, i, _n101, u, s, a, o, e);
            }
          } catch (err) {
            _iterator121.e(err);
          } finally {
            _iterator121.f();
          }

          return l;
        }
      }, {
        key: "hasLayer",
        value: function hasLayer(t) {
          var _iterator122 = _createForOfIteratorHelper(this.bucketLayerIDs),
              _step122;

          try {
            for (_iterator122.s(); !(_step122 = _iterator122.n()).done;) {
              var _e191 = _step122.value;

              var _iterator123 = _createForOfIteratorHelper(_e191),
                  _step123;

              try {
                for (_iterator123.s(); !(_step123 = _iterator123.n()).done;) {
                  var _r184 = _step123.value;
                  if (t === _r184) return !0;
                }
              } catch (err) {
                _iterator123.e(err);
              } finally {
                _iterator123.f();
              }
            }
          } catch (err) {
            _iterator122.e(err);
          } finally {
            _iterator122.f();
          }

          return !1;
        }
      }, {
        key: "getId",
        value: function getId(t, e) {
          var r = t.id;
          return this.promoteId && (r = t.properties["string" == typeof this.promoteId ? this.promoteId : this.promoteId[e]], "boolean" == typeof r && (r = Number(r))), r;
        }
      }]);

      return $h;
    }();

    function qh(t, e, r, i, n) {
      return k(t, function (t, s) {
        var a = e instanceof An ? e.get(s) : null;
        return a && a.evaluate ? a.evaluate(r, i, n) : a;
      });
    }

    function Nh(t, e) {
      return e - t;
    }

    ji("FeatureIndex", $h, {
      omit: ["rawTileData", "sourceLayerCoder"]
    });

    var jh = function jh(t) {
      _classCallCheck(this, jh);

      var e = {},
          r = [];

      for (var _i140 in t) {
        var _n102 = t[_i140],
            _s85 = e[_i140] = {};

        for (var _t202 in _n102) {
          var _e192 = _n102[+_t202];
          if (!_e192 || 0 === _e192.bitmap.width || 0 === _e192.bitmap.height) continue;
          var _i141 = {
            x: 0,
            y: 0,
            w: _e192.bitmap.width + 2,
            h: _e192.bitmap.height + 2
          };
          r.push(_i141), _s85[_t202] = {
            rect: _i141,
            metrics: _e192.metrics
          };
        }
      }

      var _Jl2 = Jl(r),
          i = _Jl2.w,
          n = _Jl2.h,
          s = new Ka({
        width: i || 1,
        height: n || 1
      });

      for (var _r185 in t) {
        var _i142 = t[_r185];

        for (var _t203 in _i142) {
          var _n103 = _i142[+_t203];
          if (!_n103 || 0 === _n103.bitmap.width || 0 === _n103.bitmap.height) continue;
          var _a74 = e[_r185][_t203].rect;
          Ka.copy(_n103.bitmap, s, {
            x: 0,
            y: 0
          }, {
            x: _a74.x + 1,
            y: _a74.y + 1
          }, _n103.bitmap);
        }
      }

      this.image = s, this.positions = e;
    };

    ji("GlyphAtlas", jh);

    var Kh = /*#__PURE__*/function () {
      function Kh(t) {
        _classCallCheck(this, Kh);

        this.tileID = new Cc(t.tileID.overscaledZ, t.tileID.wrap, t.tileID.canonical.z, t.tileID.canonical.x, t.tileID.canonical.y), this.tileZoom = t.tileZoom, this.uid = t.uid, this.zoom = t.zoom, this.pixelRatio = t.pixelRatio, this.tileSize = t.tileSize, this.source = t.source, this.overscaling = this.tileID.overscaleFactor(), this.showCollisionBoxes = t.showCollisionBoxes, this.collectResourceTiming = !!t.collectResourceTiming, this.returnDependencies = !!t.returnDependencies, this.promoteId = t.promoteId, this.enableTerrain = !!t.enableTerrain, this.isSymbolTile = t.isSymbolTile;
      }

      _createClass(Kh, [{
        key: "parse",
        value: function parse(t, e, r, i, n) {
          var _this39 = this;

          this.status = "parsing", this.data = t, this.collisionBoxArray = new ns();
          var s = new Bc(Object.keys(t.layers).sort()),
              a = new $h(this.tileID, this.promoteId);
          a.bucketLayerIDs = [];
          var o = {},
              l = {
            featureIndex: a,
            iconDependencies: {},
            patternDependencies: {},
            glyphDependencies: {},
            availableImages: r
          },
              u = e.familiesBySource[this.source];

          for (var _e193 in u) {
            var _i143 = t.layers[_e193];
            if (!_i143) continue;

            var _n104 = !1,
                _c19 = !1;

            var _iterator124 = _createForOfIteratorHelper(u[_e193]),
                _step124;

            try {
              for (_iterator124.s(); !(_step124 = _iterator124.n()).done;) {
                var _t205 = _step124.value;
                "symbol" === _t205[0].type ? _n104 = !0 : _c19 = !0;
              }
            } catch (err) {
              _iterator124.e(err);
            } finally {
              _iterator124.f();
            }

            if (!0 === this.isSymbolTile && !_n104) continue;
            if (!1 === this.isSymbolTile && !_c19) continue;
            1 === _i143.version && z("Vector tile source \"".concat(this.source, "\" layer \"").concat(_e193, "\" ") + "does not use vector tile spec v2 and therefore may have some rendering errors.");

            var _h10 = s.encode(_e193),
                _p12 = [];

            for (var _t204 = 0; _t204 < _i143.length; _t204++) {
              var _r186 = _i143.feature(_t204),
                  _n105 = a.getId(_r186, _e193);

              _p12.push({
                feature: _r186,
                id: _n105,
                index: _t204,
                sourceLayerIndex: _h10
              });
            }

            var _iterator125 = _createForOfIteratorHelper(u[_e193]),
                _step125;

            try {
              for (_iterator125.s(); !(_step125 = _iterator125.n()).done;) {
                var _t206 = _step125.value;
                var _e194 = _t206[0];
                void 0 !== this.isSymbolTile && "symbol" === _e194.type !== this.isSymbolTile || _e194.minzoom && this.zoom < Math.floor(_e194.minzoom) || _e194.maxzoom && this.zoom >= _e194.maxzoom || "none" !== _e194.visibility && (Zh(_t206, this.zoom, r), (o[_e194.id] = _e194.createBucket({
                  index: a.bucketLayerIDs.length,
                  layers: _t206,
                  zoom: this.zoom,
                  pixelRatio: this.pixelRatio,
                  overscaling: this.overscaling,
                  collisionBoxArray: this.collisionBoxArray,
                  sourceLayerIndex: _h10,
                  sourceID: this.source,
                  enableTerrain: this.enableTerrain
                })).populate(_p12, l, this.tileID.canonical), a.bucketLayerIDs.push(_t206.map(function (t) {
                  return t.id;
                })));
              }
            } catch (err) {
              _iterator125.e(err);
            } finally {
              _iterator125.f();
            }
          }

          var c, h, p, d;
          var f = {
            type: "maybePrepare",
            isSymbolTile: this.isSymbolTile,
            zoom: this.zoom
          },
              y = k(l.glyphDependencies, function (t) {
            return Object.keys(t).map(Number);
          });
          Object.keys(y).length ? i.send("getGlyphs", {
            uid: this.uid,
            stacks: y
          }, function (t, e) {
            c || (c = t, h = e, v.call(_this39));
          }, void 0, void 0, f) : h = {};
          var g = Object.keys(l.iconDependencies);
          g.length ? i.send("getImages", {
            icons: g,
            source: this.source,
            tileID: this.tileID,
            type: "icons"
          }, function (t, e) {
            c || (c = t, p = e, v.call(_this39));
          }, void 0, void 0, f) : p = {};
          var x = Object.keys(l.patternDependencies);

          function v() {
            if (c) return n(c);

            if (h && p && d) {
              var _t207 = new jh(h),
                  _e195 = new Wl(p, d);

              for (var _i144 in o) {
                var _n106 = o[_i144];
                _n106 instanceof Hu ? (Zh(_n106.layers, this.zoom, r), Pu(_n106, h, _t207.positions, p, _e195.iconPositions, this.showCollisionBoxes, this.tileID.canonical, this.tileZoom)) : _n106.hasPattern && (_n106 instanceof cl || _n106 instanceof Po || _n106 instanceof Qo) && (Zh(_n106.layers, this.zoom, r), _n106.addFeatures(l, this.tileID.canonical, _e195.patternPositions));
              }

              this.status = "done", n(null, {
                buckets: m(o).filter(function (t) {
                  return !t.isEmpty();
                }),
                featureIndex: a,
                collisionBoxArray: this.collisionBoxArray,
                glyphAtlasImage: _t207.image,
                imageAtlas: _e195,
                glyphMap: this.returnDependencies ? h : null,
                iconMap: this.returnDependencies ? p : null,
                glyphPositions: this.returnDependencies ? _t207.positions : null
              });
            }
          }

          x.length ? i.send("getImages", {
            icons: x,
            source: this.source,
            tileID: this.tileID,
            type: "patterns"
          }, function (t, e) {
            c || (c = t, d = e, v.call(_this39));
          }, void 0, void 0, f) : d = {}, v.call(this);
        }
      }]);

      return Kh;
    }();

    function Zh(t, e, r) {
      var i = new yn(e);

      var _iterator126 = _createForOfIteratorHelper(t),
          _step126;

      try {
        for (_iterator126.s(); !(_step126 = _iterator126.n()).done;) {
          var _e196 = _step126.value;

          _e196.recalculate(i, r);
        }
      } catch (err) {
        _iterator126.e(err);
      } finally {
        _iterator126.f();
      }
    }

    var Xh = /*#__PURE__*/function () {
      function Xh(t) {
        _classCallCheck(this, Xh);

        this.entries = {}, this.scheduler = t;
      }

      _createClass(Xh, [{
        key: "request",
        value: function request(t, e, r, i) {
          var _this40 = this;

          var n = this.entries[t] = this.entries[t] || {
            callbacks: []
          };

          if (n.result) {
            var _n$result = _slicedToArray(n.result, 2),
                _t208 = _n$result[0],
                _r187 = _n$result[1];

            return this.scheduler ? this.scheduler.add(function () {
              i(_t208, _r187);
            }, e) : i(_t208, _r187), function () {};
          }

          return n.callbacks.push(i), n.cancel || (n.cancel = r(function (r, i) {
            n.result = [r, i];

            var _iterator127 = _createForOfIteratorHelper(n.callbacks),
                _step127;

            try {
              var _loop6 = function _loop6() {
                var t = _step127.value;
                _this40.scheduler ? _this40.scheduler.add(function () {
                  t(r, i);
                }, e) : t(r, i);
              };

              for (_iterator127.s(); !(_step127 = _iterator127.n()).done;) {
                _loop6();
              }
            } catch (err) {
              _iterator127.e(err);
            } finally {
              _iterator127.f();
            }

            setTimeout(function () {
              return delete _this40.entries[t];
            }, 3e3);
          })), function () {
            n.result || (n.callbacks = n.callbacks.filter(function (t) {
              return t !== i;
            }), n.callbacks.length || (n.cancel(), delete _this40.entries[t]));
          };
        }
      }]);

      return Xh;
    }();

    function Gh(t, e, r) {
      var i = JSON.stringify(t.request);
      return t.data && (this.deduped.entries[i] = {
        result: [null, t.data]
      }), this.deduped.request(i, {
        type: "parseTile",
        isSymbolTile: t.isSymbolTile,
        zoom: t.tileZoom
      }, function (e) {
        var i = _t(t.request, function (t, i, n, s) {
          t ? e(t) : i && e(null, {
            vectorTile: r ? void 0 : new Go.VectorTile(new El(i)),
            rawData: i,
            cacheControl: n,
            expires: s
          });
        });

        return function () {
          i.cancel(), e();
        };
      }, e);
    }

    t.AUTH_ERR_MSG = "NO_ACCESS_TOKEN", t.Aabb = Fa, t.Actor = /*#__PURE__*/function () {
      function _class5(t, e, r) {
        _classCallCheck(this, _class5);

        this.target = t, this.parent = e, this.mapId = r, this.callbacks = {}, this.cancelCallbacks = {}, _(["receive"], this), this.target.addEventListener("message", this.receive, !1), this.globalScope = M() ? t : s, this.scheduler = new yc();
      }

      _createClass(_class5, [{
        key: "send",
        value: function send(t, e, r, i) {
          var _this41 = this;

          var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
          var s = arguments.length > 5 ? arguments[5] : undefined;
          var a = Math.round(1e18 * Math.random()).toString(36).substring(0, 10);
          r && (r.metadata = s, this.callbacks[a] = r);
          var o = F(this.globalScope) ? void 0 : [];
          return this.target.postMessage({
            id: a,
            type: t,
            hasCallback: !!r,
            targetMapId: i,
            mustQueue: n,
            sourceMapId: this.mapId,
            data: Xi(e, o)
          }, o), {
            cancel: function cancel() {
              r && delete _this41.callbacks[a], _this41.target.postMessage({
                id: a,
                type: "<cancel>",
                targetMapId: i,
                sourceMapId: _this41.mapId
              });
            }
          };
        }
      }, {
        key: "receive",
        value: function receive(t) {
          var _this42 = this;

          var e = t.data,
              r = e.id;
          if (r && (!e.targetMapId || this.mapId === e.targetMapId)) if ("<cancel>" === e.type) {
            var _t209 = this.cancelCallbacks[r];
            delete this.cancelCallbacks[r], _t209 && _t209.cancel();
          } else if (M() || e.mustQueue) {
            var _t210 = this.callbacks[r];
            this.cancelCallbacks[r] = this.scheduler.add(function () {
              return _this42.processTask(r, e);
            }, _t210 && _t210.metadata || {
              type: "message"
            });
          } else this.processTask(r, e);
        }
      }, {
        key: "processTask",
        value: function processTask(t, e) {
          var _this43 = this;

          if ("<response>" === e.type) {
            var _r188 = this.callbacks[t];
            delete this.callbacks[t], _r188 && (e.error ? _r188(Gi(e.error)) : _r188(null, Gi(e.data)));
          } else {
            var _r189 = F(this.globalScope) ? void 0 : [],
                _i145 = e.hasCallback ? function (e, i) {
              delete _this43.cancelCallbacks[t], _this43.target.postMessage({
                id: t,
                type: "<response>",
                sourceMapId: _this43.mapId,
                error: e ? Xi(e) : null,
                data: Xi(i, _r189)
              }, _r189);
            } : function (t) {},
                _n107 = Gi(e.data);

            if (this.parent[e.type]) this.parent[e.type](e.sourceMapId, _n107, _i145);else if (this.parent.getWorkerSource) {
              var _t211 = e.type.split(".");

              this.parent.getWorkerSource(e.sourceMapId, _t211[0], _n107.source)[_t211[1]](_n107, _i145);
            } else _i145(new Error("Could not find function ".concat(e.type)));
          }
        }
      }, {
        key: "remove",
        value: function remove() {
          this.scheduler.remove(), this.target.removeEventListener("message", this.receive, !1);
        }
      }]);

      return _class5;
    }(), t.AlphaImage = Ka, t.CanonicalTileID = zc, t.Color = oe, t.ColorMode = Vh, t.Context = /*#__PURE__*/function () {
      function _class6(t) {
        _classCallCheck(this, _class6);

        this.gl = t, this.extVertexArrayObject = this.gl.getExtension("OES_vertex_array_object"), this.clearColor = new Wc(this), this.clearDepth = new Qc(this), this.clearStencil = new th(this), this.colorMask = new eh(this), this.depthMask = new rh(this), this.stencilMask = new ih(this), this.stencilFunc = new nh(this), this.stencilOp = new sh(this), this.stencilTest = new ah(this), this.depthRange = new oh(this), this.depthTest = new lh(this), this.depthFunc = new uh(this), this.blend = new ch(this), this.blendFunc = new hh(this), this.blendColor = new ph(this), this.blendEquation = new dh(this), this.cullFace = new fh(this), this.cullFaceSide = new yh(this), this.frontFace = new mh(this), this.program = new gh(this), this.activeTexture = new xh(this), this.viewport = new vh(this), this.bindFramebuffer = new bh(this), this.bindRenderbuffer = new wh(this), this.bindTexture = new _h(this), this.bindVertexBuffer = new Ah(this), this.bindElementBuffer = new kh(this), this.bindVertexArrayOES = this.extVertexArrayObject && new Sh(this), this.pixelStoreUnpack = new Ih(this), this.pixelStoreUnpackPremultiplyAlpha = new Th(this), this.pixelStoreUnpackFlipY = new zh(this), this.extTextureFilterAnisotropic = t.getExtension("EXT_texture_filter_anisotropic") || t.getExtension("MOZ_EXT_texture_filter_anisotropic") || t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"), this.extTextureFilterAnisotropic && (this.extTextureFilterAnisotropicMax = t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)), this.extTextureFilterAnisotropicForceOff = !1, this.extTextureHalfFloat = t.getExtension("OES_texture_half_float"), this.extTextureHalfFloat && (t.getExtension("OES_texture_half_float_linear"), this.extRenderToTextureHalfFloat = t.getExtension("EXT_color_buffer_half_float")), this.extTimerQuery = t.getExtension("EXT_disjoint_timer_query"), this.maxTextureSize = t.getParameter(t.MAX_TEXTURE_SIZE);
      }

      _createClass(_class6, [{
        key: "setDefault",
        value: function setDefault() {
          this.unbindVAO(), this.clearColor.setDefault(), this.clearDepth.setDefault(), this.clearStencil.setDefault(), this.colorMask.setDefault(), this.depthMask.setDefault(), this.stencilMask.setDefault(), this.stencilFunc.setDefault(), this.stencilOp.setDefault(), this.stencilTest.setDefault(), this.depthRange.setDefault(), this.depthTest.setDefault(), this.depthFunc.setDefault(), this.blend.setDefault(), this.blendFunc.setDefault(), this.blendColor.setDefault(), this.blendEquation.setDefault(), this.cullFace.setDefault(), this.cullFaceSide.setDefault(), this.frontFace.setDefault(), this.program.setDefault(), this.activeTexture.setDefault(), this.bindFramebuffer.setDefault(), this.pixelStoreUnpack.setDefault(), this.pixelStoreUnpackPremultiplyAlpha.setDefault(), this.pixelStoreUnpackFlipY.setDefault();
        }
      }, {
        key: "setDirty",
        value: function setDirty() {
          this.clearColor.dirty = !0, this.clearDepth.dirty = !0, this.clearStencil.dirty = !0, this.colorMask.dirty = !0, this.depthMask.dirty = !0, this.stencilMask.dirty = !0, this.stencilFunc.dirty = !0, this.stencilOp.dirty = !0, this.stencilTest.dirty = !0, this.depthRange.dirty = !0, this.depthTest.dirty = !0, this.depthFunc.dirty = !0, this.blend.dirty = !0, this.blendFunc.dirty = !0, this.blendColor.dirty = !0, this.blendEquation.dirty = !0, this.cullFace.dirty = !0, this.cullFaceSide.dirty = !0, this.frontFace.dirty = !0, this.program.dirty = !0, this.activeTexture.dirty = !0, this.viewport.dirty = !0, this.bindFramebuffer.dirty = !0, this.bindRenderbuffer.dirty = !0, this.bindTexture.dirty = !0, this.bindVertexBuffer.dirty = !0, this.bindElementBuffer.dirty = !0, this.extVertexArrayObject && (this.bindVertexArrayOES.dirty = !0), this.pixelStoreUnpack.dirty = !0, this.pixelStoreUnpackPremultiplyAlpha.dirty = !0, this.pixelStoreUnpackFlipY.dirty = !0;
        }
      }, {
        key: "createIndexBuffer",
        value: function createIndexBuffer(t, e) {
          return new Gc(this, t, e);
        }
      }, {
        key: "createVertexBuffer",
        value: function createVertexBuffer(t, e, r) {
          return new Jc(this, t, e, r);
        }
      }, {
        key: "createRenderbuffer",
        value: function createRenderbuffer(t, e, r) {
          var i = this.gl,
              n = i.createRenderbuffer();
          return this.bindRenderbuffer.set(n), i.renderbufferStorage(i.RENDERBUFFER, t, e, r), this.bindRenderbuffer.set(null), n;
        }
      }, {
        key: "createFramebuffer",
        value: function createFramebuffer(t, e, r) {
          return new Bh(this, t, e, r);
        }
      }, {
        key: "clear",
        value: function clear(_ref159) {
          var t = _ref159.color,
              e = _ref159.depth,
              r = _ref159.stencil;
          var i = this.gl;
          var n = 0;
          t && (n |= i.COLOR_BUFFER_BIT, this.clearColor.set(t), this.colorMask.set([!0, !0, !0, !0])), void 0 !== e && (n |= i.DEPTH_BUFFER_BIT, this.depthRange.set([0, 1]), this.clearDepth.set(e), this.depthMask.set(!0)), void 0 !== r && (n |= i.STENCIL_BUFFER_BIT, this.clearStencil.set(r), this.stencilMask.set(255)), i.clear(n);
        }
      }, {
        key: "setCullFace",
        value: function setCullFace(t) {
          !1 === t.enable ? this.cullFace.set(!1) : (this.cullFace.set(!0), this.cullFaceSide.set(t.mode), this.frontFace.set(t.frontFace));
        }
      }, {
        key: "setDepthMode",
        value: function setDepthMode(t) {
          t.func !== this.gl.ALWAYS || t.mask ? (this.depthTest.set(!0), this.depthFunc.set(t.func), this.depthMask.set(t.mask), this.depthRange.set(t.range)) : this.depthTest.set(!1);
        }
      }, {
        key: "setStencilMode",
        value: function setStencilMode(t) {
          t.test.func !== this.gl.ALWAYS || t.mask ? (this.stencilTest.set(!0), this.stencilMask.set(t.mask), this.stencilOp.set([t.fail, t.depthFail, t.pass]), this.stencilFunc.set({
            func: t.test.func,
            ref: t.ref,
            mask: t.test.mask
          })) : this.stencilTest.set(!1);
        }
      }, {
        key: "setColorMode",
        value: function setColorMode(t) {
          a(t.blendFunction, Vh.Replace) ? this.blend.set(!1) : (this.blend.set(!0), this.blendFunc.set(t.blendFunction), this.blendColor.set(t.blendColor)), this.colorMask.set(t.mask);
        }
      }, {
        key: "unbindVAO",
        value: function unbindVAO() {
          this.extVertexArrayObject && this.bindVertexArrayOES.set(null);
        }
      }]);

      return _class6;
    }(), t.CullFaceMode = Fh, t.DEMData = Zc, t.DataConstantProperty = kn, t.DedupedRequest = Xh, t.DepthMode = Dh, t.DepthStencilAttachment = /*#__PURE__*/function (_Mh) {
      _inherits(_class7, _Mh);

      var _super92 = _createSuper(_class7);

      function _class7() {
        _classCallCheck(this, _class7);

        return _super92.apply(this, arguments);
      }

      _createClass(_class7, [{
        key: "attachment",
        value: function attachment() {
          return this.gl.DEPTH_STENCIL_ATTACHMENT;
        }
      }]);

      return _class7;
    }(Mh), t.EXTENT = 8192, t.Elevation = /*#__PURE__*/function () {
      function _class8() {
        _classCallCheck(this, _class8);
      }

      _createClass(_class8, [{
        key: "getAtPoint",
        value: function getAtPoint(t) {
          var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;

          var r = this._source();

          if (!r) return e;
          if (t.y < 0 || t.y > 1) return e;
          var i = r.getSource().maxzoom,
              n = 1 << i,
              s = Math.floor(t.x),
              a = t.x - s,
              o = new Cc(i, s, i, Math.floor(a * n), Math.floor(t.y * n)),
              l = this.findDEMTileFor(o);
          if (!l || !l.dem) return e;
          var u = l.dem,
              c = 1 << l.tileID.canonical.z,
              h = (a * c - l.tileID.canonical.x) * u.dim,
              p = (t.y * c - l.tileID.canonical.y) * u.dim,
              d = Math.floor(h),
              f = Math.floor(p);
          return this.exaggeration() * Ye(Ye(u.get(d, f), u.get(d, f + 1), p - f), Ye(u.get(d + 1, f), u.get(d + 1, f + 1), p - f), h - d);
        }
      }, {
        key: "getAtTileOffset",
        value: function getAtTileOffset(t, e, r) {
          var i = 1 << t.canonical.z;
          return this.getAtPoint(new Ic(t.wrap + (t.canonical.x + e / 8192) / i, (t.canonical.y + r / 8192) / i));
        }
      }, {
        key: "getForTilePoints",
        value: function getForTilePoints(t, e, r, i) {
          var _this44 = this;

          var n = Oh.create(this, t, i);
          return !!n && (e.forEach(function (t) {
            t[2] = _this44.exaggeration() * n.getElevationAt(t[0], t[1], r);
          }), !0);
        }
      }, {
        key: "getMinMaxForTile",
        value: function getMinMaxForTile(t) {
          var e = this.findDEMTileFor(t);
          if (!e || !e.dem) return null;
          var r = e.dem.tree,
              i = e.tileID,
              n = 1 << t.canonical.z - i.canonical.z;
          var s = t.canonical.x / n - i.canonical.x,
              a = t.canonical.y / n - i.canonical.y,
              o = 0;

          for (var _e197 = 0; _e197 < t.canonical.z - i.canonical.z && !r.leaves[o]; _e197++) {
            s *= 2, a *= 2;

            var _t212 = 2 * Math.floor(a) + Math.floor(s);

            o = r.childOffsets[o] + _t212, s %= 1, a %= 1;
          }

          return {
            min: this.exaggeration() * r.minimums[o],
            max: this.exaggeration() * r.maximums[o]
          };
        }
      }, {
        key: "raycast",
        value: function raycast(t, e, r) {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "pointCoordinate",
        value: function pointCoordinate(t) {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "_source",
        value: function _source() {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "exaggeration",
        value: function exaggeration() {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "findDEMTileFor",
        value: function findDEMTileFor(t) {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "visibleDemTiles",
        get: function get() {
          throw new Error("Getter must be implemented in subclass.");
        }
      }]);

      return _class8;
    }(), t.ErrorEvent = Dt, t.EvaluationParameters = yn, t.Event = Bt, t.Evented = Pt, t.Frustum = Va, t.ImagePosition = Yl, t.LngLat = xc, t.LngLatBounds = gc, t.MAX_SAFE_INTEGER = o, t.MercatorCoordinate = Ic, t.ONE_EM = 24, t.OverscaledTileID = Cc, t.Point = i, t.Point$1 = i, t.Properties = En, t.RGBAImage = Za, t.Ray = /*#__PURE__*/function () {
      function _class9(t, e) {
        _classCallCheck(this, _class9);

        this.pos = t, this.dir = e;
      }

      _createClass(_class9, [{
        key: "intersectsPlane",
        value: function intersectsPlane(t, e, r) {
          var i = Sa(e, this.dir);
          if (Math.abs(i) < 1e-6) return !1;
          var n = Sa(Ea(ma(), t, this.pos), e) / i;
          return function (t, e) {
            t[0] = e[0], t[1] = e[1], t[2] = e[2];
          }(r, Aa(ma(), this.pos, this.dir, n)), !0;
        }
      }]);

      return _class9;
    }(), t.RequestManager = /*#__PURE__*/function () {
      function _class10(t, e) {
        _classCallCheck(this, _class10);

        this._transformRequestFn = t, this._customAccessToken = e, this._createSkuToken();
      }

      _createClass(_class10, [{
        key: "_createSkuToken",
        value: function _createSkuToken() {
          var t = function () {
            var t = "";

            for (var _e198 = 0; _e198 < 10; _e198++) {
              t += "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62 * Math.random())];
            }

            return {
              token: ["1", H, t].join(""),
              tokenExpiresAt: Date.now() + 432e5
            };
          }();

          this._skuToken = t.token, this._skuTokenExpiresAt = t.tokenExpiresAt;
        }
      }, {
        key: "_isSkuTokenExpired",
        value: function _isSkuTokenExpired() {
          return Date.now() > this._skuTokenExpiresAt;
        }
      }, {
        key: "transformRequest",
        value: function transformRequest(t, e) {
          return this._transformRequestFn && this._transformRequestFn(t, e) || {
            url: t
          };
        }
      }, {
        key: "normalizeStyleURL",
        value: function normalizeStyleURL(t, e) {
          if (!J(t)) return t;
          var r = Q(t);
          return r.path = "/styles/v1".concat(r.path), this._makeAPIURL(r, this._customAccessToken || e);
        }
      }, {
        key: "normalizeGlyphsURL",
        value: function normalizeGlyphsURL(t, e) {
          if (!J(t)) return t;
          var r = Q(t);
          return r.path = "/fonts/v1".concat(r.path), this._makeAPIURL(r, this._customAccessToken || e);
        }
      }, {
        key: "normalizeSourceURL",
        value: function normalizeSourceURL(t, e) {
          if (!J(t)) return t;
          var r = Q(t);
          return r.path = "/v4/".concat(r.authority, ".json"), r.params.push("secure"), this._makeAPIURL(r, this._customAccessToken || e);
        }
      }, {
        key: "normalizeSpriteURL",
        value: function normalizeSpriteURL(t, e, r, i) {
          var n = Q(t);
          return J(t) ? (n.path = "/styles/v1".concat(n.path, "/sprite").concat(e).concat(r), this._makeAPIURL(n, this._customAccessToken || i)) : (n.path += "".concat(e).concat(r), tt(n));
        }
      }, {
        key: "normalizeTileURL",
        value: function normalizeTileURL(t, e, r) {
          if (this._isSkuTokenExpired() && this._createSkuToken(), t && !J(t)) return t;
          var i = Q(t);
          i.path = i.path.replace(/(\.(png|jpg)\d*)(?=$)/, "".concat(e || r && "raster" !== i.authority && 512 === r ? "@2x" : "").concat(N.supported ? ".webp" : "$1")), "raster" === i.authority ? i.path = "/".concat(q.RASTER_URL_PREFIX).concat(i.path) : (i.path = i.path.replace(/^.+\/v4\//, "/"), i.path = "/".concat(q.TILE_URL_VERSION).concat(i.path));

          var n = this._customAccessToken || function (t) {
            var _iterator128 = _createForOfIteratorHelper(t),
                _step128;

            try {
              for (_iterator128.s(); !(_step128 = _iterator128.n()).done;) {
                var _e199 = _step128.value;

                var _t213 = _e199.match(/^access_token=(.*)$/);

                if (_t213) return _t213[1];
              }
            } catch (err) {
              _iterator128.e(err);
            } finally {
              _iterator128.f();
            }

            return null;
          }(i.params) || q.ACCESS_TOKEN;

          return q.REQUIRE_ACCESS_TOKEN && n && this._skuToken && i.params.push("sku=".concat(this._skuToken)), this._makeAPIURL(i, n);
        }
      }, {
        key: "canonicalizeTileURL",
        value: function canonicalizeTileURL(t, e) {
          var r = Q(t);
          if (!r.path.match(/^(\/v4\/|\/raster\/v1\/)/) || !r.path.match(/\.[\w]+$/)) return t;
          var i = "mapbox://";
          r.path.match(/^\/raster\/v1\//) ? i += "raster/".concat(r.path.replace("/".concat(q.RASTER_URL_PREFIX, "/"), "")) : i += "tiles/".concat(r.path.replace("/".concat(q.TILE_URL_VERSION, "/"), ""));
          var n = r.params;
          return e && (n = n.filter(function (t) {
            return !t.match(/^access_token=/);
          })), n.length && (i += "?".concat(n.join("&"))), i;
        }
      }, {
        key: "canonicalizeTileset",
        value: function canonicalizeTileset(t, e) {
          var r = !!e && J(e),
              i = [];

          var _iterator129 = _createForOfIteratorHelper(t.tiles || []),
              _step129;

          try {
            for (_iterator129.s(); !(_step129 = _iterator129.n()).done;) {
              var _e200 = _step129.value;
              Y(_e200) ? i.push(this.canonicalizeTileURL(_e200, r)) : i.push(_e200);
            }
          } catch (err) {
            _iterator129.e(err);
          } finally {
            _iterator129.f();
          }

          return i;
        }
      }, {
        key: "_makeAPIURL",
        value: function _makeAPIURL(t, e) {
          var r = "See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",
              i = Q(q.API_URL);

          if (t.protocol = i.protocol, t.authority = i.authority, "http" === t.protocol) {
            var _e201 = t.params.indexOf("secure");

            _e201 >= 0 && t.params.splice(_e201, 1);
          }

          if ("/" !== i.path && (t.path = "".concat(i.path).concat(t.path)), !q.REQUIRE_ACCESS_TOKEN) return tt(t);
          if (!(e = e || q.ACCESS_TOKEN)) throw new Error("An API access token is required to use Mapbox GL. ".concat(r));
          if ("s" === e[0]) throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(r));
          return t.params = t.params.filter(function (t) {
            return -1 === t.indexOf("access_token");
          }), t.params.push("access_token=".concat(e)), tt(t);
        }
      }]);

      return _class10;
    }(), t.RequestPerformance = fc, t.ResourceType = xt, t.SegmentVector = Os, t.SourceCache = Rh, t.StencilMode = Ph, t.StructArrayLayout1ui2 = es, t.StructArrayLayout2f1f2i16 = Zn, t.StructArrayLayout2i4 = Fn, t.StructArrayLayout3f12 = qn, t.StructArrayLayout3ui6 = Gn, t.StructArrayLayout4i8 = Rn, t.Texture = hc, t.Tile = Vc, t.Transitionable = xn, t.Uniform1f = _s, t.Uniform1i = /*#__PURE__*/function (_ws4) {
      _inherits(_class11, _ws4);

      var _super93 = _createSuper(_class11);

      function _class11(t, e) {
        var _this45;

        _classCallCheck(this, _class11);

        _this45 = _super93.call(this, t, e), _this45.current = 0;
        return _this45;
      }

      _createClass(_class11, [{
        key: "set",
        value: function set(t) {
          this.current !== t && (this.current = t, this.gl.uniform1i(this.location, t));
        }
      }]);

      return _class11;
    }(ws), t.Uniform2f = /*#__PURE__*/function (_ws5) {
      _inherits(_class12, _ws5);

      var _super94 = _createSuper(_class12);

      function _class12(t, e) {
        var _this46;

        _classCallCheck(this, _class12);

        _this46 = _super94.call(this, t, e), _this46.current = [0, 0];
        return _this46;
      }

      _createClass(_class12, [{
        key: "set",
        value: function set(t) {
          t[0] === this.current[0] && t[1] === this.current[1] || (this.current = t, this.gl.uniform2f(this.location, t[0], t[1]));
        }
      }]);

      return _class12;
    }(ws), t.Uniform3f = /*#__PURE__*/function (_ws6) {
      _inherits(_class13, _ws6);

      var _super95 = _createSuper(_class13);

      function _class13(t, e) {
        var _this47;

        _classCallCheck(this, _class13);

        _this47 = _super95.call(this, t, e), _this47.current = [0, 0, 0];
        return _this47;
      }

      _createClass(_class13, [{
        key: "set",
        value: function set(t) {
          t[0] === this.current[0] && t[1] === this.current[1] && t[2] === this.current[2] || (this.current = t, this.gl.uniform3f(this.location, t[0], t[1], t[2]));
        }
      }]);

      return _class13;
    }(ws), t.Uniform4f = As, t.UniformColor = ks, t.UniformMatrix3f = /*#__PURE__*/function (_ws7) {
      _inherits(_class14, _ws7);

      var _super96 = _createSuper(_class14);

      function _class14(t, e) {
        var _this48;

        _classCallCheck(this, _class14);

        _this48 = _super96.call(this, t, e), _this48.current = Is;
        return _this48;
      }

      _createClass(_class14, [{
        key: "set",
        value: function set(t) {
          for (var _e202 = 0; _e202 < 9; _e202++) {
            if (t[_e202] !== this.current[_e202]) {
              this.current = t, this.gl.uniformMatrix3fv(this.location, !1, t);
              break;
            }
          }
        }
      }]);

      return _class14;
    }(ws), t.UniformMatrix4f = /*#__PURE__*/function (_ws8) {
      _inherits(_class15, _ws8);

      var _super97 = _createSuper(_class15);

      function _class15(t, e) {
        var _this49;

        _classCallCheck(this, _class15);

        _this49 = _super97.call(this, t, e), _this49.current = Ss;
        return _this49;
      }

      _createClass(_class15, [{
        key: "set",
        value: function set(t) {
          if (t[12] !== this.current[12] || t[0] !== this.current[0]) return this.current = t, void this.gl.uniformMatrix4fv(this.location, !1, t);

          for (var _e203 = 1; _e203 < 16; _e203++) {
            if (t[_e203] !== this.current[_e203]) {
              this.current = t, this.gl.uniformMatrix4fv(this.location, !1, t);
              break;
            }
          }
        }
      }]);

      return _class15;
    }(ws), t.UnwrappedTileID = Ec, t.ValidationError = Ft, t.VectorTileWorkerSource = /*#__PURE__*/function () {
      function _class16(t, e, r, i) {
        _classCallCheck(this, _class16);

        this.actor = t, this.layerIndex = e, this.availableImages = r, this.loadVectorData = i || Gh, this.loading = {}, this.loaded = {}, this.deduped = new Xh(t.scheduler);
      }

      _createClass(_class16, [{
        key: "loadTile",
        value: function loadTile(t, e) {
          var _this50 = this;

          var r = t.uid,
              i = !!(t && t.request && t.request.collectResourceTiming) && new fc(t.request),
              n = this.loading[r] = new Kh(t);
          n.abort = this.loadVectorData(t, function (t, s) {
            var a = !_this50.loading[r];
            if (delete _this50.loading[r], a || t || !s) return n.status = "done", a || (_this50.loaded[r] = n), e(t);
            var o = s.rawData,
                l = {};
            s.expires && (l.expires = s.expires), s.cacheControl && (l.cacheControl = s.cacheControl);
            var u = {};

            if (i) {
              var _t214 = i.finish();

              _t214 && (u.resourceTiming = JSON.parse(JSON.stringify(_t214)));
            }

            n.vectorTile = s.vectorTile || new Go.VectorTile(new El(o)), n.parse(n.vectorTile, _this50.layerIndex, _this50.availableImages, _this50.actor, function (t, r) {
              if (t || !r) return e(t);
              e(null, g({
                rawTileData: o.slice(0)
              }, r, l, u));
            }), _this50.loaded = _this50.loaded || {}, _this50.loaded[r] = n;
          });
        }
      }, {
        key: "reloadTile",
        value: function reloadTile(t, e) {
          var _this51 = this;

          var r = this.loaded,
              i = t.uid,
              n = this;

          if (r && r[i]) {
            var _s86 = r[i];
            _s86.showCollisionBoxes = t.showCollisionBoxes, _s86.enableTerrain = !!t.enableTerrain;

            var _a75 = function _a75(t, r) {
              var i = _s86.reloadCallback;
              i && (delete _s86.reloadCallback, _s86.parse(_s86.vectorTile, n.layerIndex, _this51.availableImages, n.actor, i)), e(t, r);
            };

            "parsing" === _s86.status ? _s86.reloadCallback = _a75 : "done" === _s86.status && (_s86.vectorTile ? _s86.parse(_s86.vectorTile, this.layerIndex, this.availableImages, this.actor, _a75) : _a75());
          }
        }
      }, {
        key: "abortTile",
        value: function abortTile(t, e) {
          var r = t.uid,
              i = this.loading[r];
          i && (i.abort && i.abort(), delete this.loading[r]), e();
        }
      }, {
        key: "removeTile",
        value: function removeTile(t, e) {
          var r = this.loaded,
              i = t.uid;
          r && r[i] && delete r[i], e();
        }
      }]);

      return _class16;
    }(), t.WritingMode = Ql, t.ZoomHistory = Hi, t.add = ba, t.addDynamicAttributes = Ku, t.altitudeFromMercatorZ = Sc, t.asyncAll = function (t, e, r) {
      if (!t.length) return r(null, []);
      var i = t.length;
      var n = new Array(t.length);
      var s = null;
      t.forEach(function (t, a) {
        e(t, function (t, e) {
          t && (s = t), n[a] = e, 0 == --i && r(s, n);
        });
      });
    }, t.bezier = p, t.bindAll = _, t.browser = O, t.bufferConvexPolygon = function (t, e) {
      var r = [];

      for (var _i146 = 0; _i146 < t.length; _i146++) {
        var _n108 = y(_i146 - 1, -1, t.length - 1),
            _s87 = y(_i146 + 1, -1, t.length - 1),
            _a76 = t[_i146],
            _o42 = t[_s87],
            _l31 = t[_n108].sub(_a76).unit(),
            _u27 = _o42.sub(_a76).unit(),
            _c20 = _u27.angleWithSep(_l31.x, _l31.y),
            _h11 = _l31.add(_u27).unit().mult(-1 * e / Math.sin(_c20 / 2));

        r.push(_a76.add(_h11));
      }

      return r;
    }, t.cacheEntryPossiblyAdded = function (t) {
      mt++, mt > pt && (t.getActor().send("enforceCacheSizeLimit", ht), mt = 0);
    }, t.clamp = f, t.clearTileCache = function (t) {
      var e = s.caches["delete"]("mapbox-tiles");
      t && e["catch"](t).then(function () {
        return t();
      });
    }, t.clipLine = wu, t.clone = function (t) {
      var e = new ha(16);
      return e[0] = t[0], e[1] = t[1], e[2] = t[2], e[3] = t[3], e[4] = t[4], e[5] = t[5], e[6] = t[6], e[7] = t[7], e[8] = t[8], e[9] = t[9], e[10] = t[10], e[11] = t[11], e[12] = t[12], e[13] = t[13], e[14] = t[14], e[15] = t[15], e;
    }, t.clone$1 = I, t.collisionCircleLayout = bl, t.config = q, t.conjugate = function (t, e) {
      return t[0] = -e[0], t[1] = -e[1], t[2] = -e[2], t[3] = e[3], t;
    }, t.create = function () {
      var t = new ha(16);
      return ha != Float32Array && (t[1] = 0, t[2] = 0, t[3] = 0, t[4] = 0, t[6] = 0, t[7] = 0, t[8] = 0, t[9] = 0, t[11] = 0, t[12] = 0, t[13] = 0, t[14] = 0), t[0] = 1, t[5] = 1, t[10] = 1, t[15] = 1, t;
    }, t.create$1 = pa, t.create$2 = function () {
      var t = new ha(4);
      return ha != Float32Array && (t[1] = 0, t[2] = 0), t[0] = 1, t[3] = 1, t;
    }, t.createExpression = Wr, t.createLayout = Pn, t.createStyleLayer = function (t) {
      return "custom" === t.type ? new rc(t) : new sc[t.type](t);
    }, t.cross = Ia, t.deepEqual = a, t.degToRad = c, t.div = function (t, e, r) {
      return t[0] = e[0] / r[0], t[1] = e[1] / r[1], t[2] = e[2] / r[2], t;
    }, t.dot = Sa, t.ease = d, t.easeCubicInOut = h, t.emitValidationErrors = Li, t.endsWith = A, t.enforceCacheSizeLimit = function (t) {
      dt(), ut && ut.then(function (e) {
        e.keys().then(function (r) {
          for (var _i147 = 0; _i147 < r.length - t; _i147++) {
            e["delete"](r[_i147]);
          }
        });
      });
    }, t.evaluateSizeForFeature = _l, t.evaluateSizeForZoom = Al, t.evaluateVariableOffset = Du, t.evented = hn, t.exactEquals = function (t, e) {
      return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3];
    }, t.exactEquals$1 = function (t, e) {
      return t[0] === e[0] && t[1] === e[1] && t[2] === e[2];
    }, t.extend = g, t.featureFilter = hi, t.filterObject = S, t.fromMat4 = function (t, e) {
      return t[0] = e[0], t[1] = e[1], t[2] = e[2], t[3] = e[4], t[4] = e[5], t[5] = e[6], t[6] = e[8], t[7] = e[9], t[8] = e[10], t;
    }, t.fromQuat = function (t, e) {
      var r = e[0],
          i = e[1],
          n = e[2],
          s = e[3],
          a = r + r,
          o = i + i,
          l = n + n,
          u = r * a,
          c = i * a,
          h = i * o,
          p = n * a,
          d = n * o,
          f = n * l,
          y = s * a,
          m = s * o,
          g = s * l;
      return t[0] = 1 - h - f, t[1] = c + g, t[2] = p - m, t[3] = 0, t[4] = c - g, t[5] = 1 - u - f, t[6] = d + y, t[7] = 0, t[8] = p + m, t[9] = d - y, t[10] = 1 - u - h, t[11] = 0, t[12] = 0, t[13] = 0, t[14] = 0, t[15] = 1, t;
    }, t.fromRotation = function (t, e) {
      var r = Math.sin(e),
          i = Math.cos(e);
      return t[0] = i, t[1] = r, t[2] = 0, t[3] = -r, t[4] = i, t[5] = 0, t[6] = 0, t[7] = 0, t[8] = 1, t;
    }, t.getAnchorAlignment = cu, t.getAnchorJustification = Vu, t.getArrayBuffer = _t, t.getBounds = function (t) {
      var e = 1 / 0,
          r = 1 / 0,
          n = -1 / 0,
          s = -1 / 0;

      var _iterator130 = _createForOfIteratorHelper(t),
          _step130;

      try {
        for (_iterator130.s(); !(_step130 = _iterator130.n()).done;) {
          var _i148 = _step130.value;
          e = Math.min(e, _i148.x), r = Math.min(r, _i148.y), n = Math.max(n, _i148.x), s = Math.max(s, _i148.y);
        }
      } catch (err) {
        _iterator130.e(err);
      } finally {
        _iterator130.f();
      }

      return {
        min: new i(e, r),
        max: new i(n, s)
      };
    }, t.getImage = Et, t.getJSON = function (t, e) {
      return wt(g(t, {
        type: "json"
      }), e);
    }, t.getMapSessionAPI = lt, t.getRTLTextPluginStatus = pn, t.getReferrer = bt, t.getVideo = function (t, e) {
      var r = s.document.createElement("video");
      r.muted = !0, r.onloadstart = function () {
        e(null, r);
      };

      for (var _e204 = 0; _e204 < t.length; _e204++) {
        var _i149 = s.document.createElement("source");

        St(t[_e204]) || (r.crossOrigin = "Anonymous"), _i149.src = t[_e204], r.appendChild(_i149);
      }

      return {
        cancel: function cancel() {}
      };
    }, t.identity = da, t.identity$1 = Da, t.invert = function (t, e) {
      var r = e[0],
          i = e[1],
          n = e[2],
          s = e[3],
          a = e[4],
          o = e[5],
          l = e[6],
          u = e[7],
          c = e[8],
          h = e[9],
          p = e[10],
          d = e[11],
          f = e[12],
          y = e[13],
          m = e[14],
          g = e[15],
          x = r * o - i * a,
          v = r * l - n * a,
          b = r * u - s * a,
          w = i * l - n * o,
          _ = i * u - s * o,
          A = n * u - s * l,
          k = c * y - h * f,
          S = c * m - p * f,
          I = c * g - d * f,
          T = h * m - p * y,
          z = h * g - d * y,
          E = p * g - d * m,
          C = x * E - v * z + b * T + w * I - _ * S + A * k;

      return C ? (t[0] = (o * E - l * z + u * T) * (C = 1 / C), t[1] = (n * z - i * E - s * T) * C, t[2] = (y * A - m * _ + g * w) * C, t[3] = (p * _ - h * A - d * w) * C, t[4] = (l * I - a * E - u * S) * C, t[5] = (r * E - n * I + s * S) * C, t[6] = (m * b - f * A - g * v) * C, t[7] = (c * A - p * b + d * v) * C, t[8] = (a * z - o * I + u * k) * C, t[9] = (i * I - r * z - s * k) * C, t[10] = (f * _ - y * b + g * x) * C, t[11] = (h * b - c * _ - d * x) * C, t[12] = (o * S - a * T - l * k) * C, t[13] = (r * T - i * S + n * k) * C, t[14] = (y * v - f * w - m * x) * C, t[15] = (c * w - h * v + p * x) * C, t) : null;
    }, t.isChar = Ji, t.isMapboxURL = J, t.latFromMercatorY = kc, t.len = Ca, t.length = xa, t.length$1 = function (t) {
      return Math.hypot(t[0], t[1], t[2], t[3]);
    }, t.loadVectorTile = Gh, t.makeRequest = wt, t.mercatorXfromLng = wc, t.mercatorYfromLat = _c, t.mercatorZfromAltitude = Ac, t.mul = ya, t.mul$1 = function (t, e, r) {
      return t[0] = e[0] * r[0], t[1] = e[1] * r[1], t[2] = e[2] * r[2], t;
    }, t.multiply = fa, t.mvt = Go, t.nextPowerOfTwo = function (t) {
      return t <= 1 ? 1 : Math.pow(2, Math.ceil(Math.log(t) / Math.LN2));
    }, t.normalize = ka, t.normalize$1 = function (t, e) {
      var r = e[0],
          i = e[1],
          n = e[2],
          s = e[3],
          a = r * r + i * i + n * n + s * s;
      return a > 0 && (a = 1 / Math.sqrt(a)), t[0] = r * a, t[1] = i * a, t[2] = n * a, t[3] = s * a, t;
    }, t.number = Ye, t.offscreenCanvasSupported = gt, t.ortho = function (t, e, r, i, n, s, a) {
      var o = 1 / (e - r),
          l = 1 / (i - n),
          u = 1 / (s - a);
      return t[0] = -2 * o, t[1] = 0, t[2] = 0, t[3] = 0, t[4] = 0, t[5] = -2 * l, t[6] = 0, t[7] = 0, t[8] = 0, t[9] = 0, t[10] = 2 * u, t[11] = 0, t[12] = (e + r) * o, t[13] = (n + i) * l, t[14] = (a + s) * u, t[15] = 1, t;
    }, t.parseGlyphPBF = function (t) {
      return new El(t).readFields(Xl, []);
    }, t.pbf = El, t.perspective = function (t, e, r, i, n) {
      var s,
          a = 1 / Math.tan(e / 2);
      return t[0] = a / r, t[1] = 0, t[2] = 0, t[3] = 0, t[4] = 0, t[5] = a, t[6] = 0, t[7] = 0, t[8] = 0, t[9] = 0, t[11] = -1, t[12] = 0, t[13] = 0, t[15] = 0, null != n && n !== 1 / 0 ? (t[10] = (n + i) * (s = 1 / (i - n)), t[14] = 2 * n * i * s) : (t[10] = -1, t[14] = -2 * i), t;
    }, t.pick = function (t, e) {
      var r = {};

      for (var _i150 = 0; _i150 < e.length; _i150++) {
        var _n109 = e[_i150];
        _n109 in t && (r[_n109] = t[_n109]);
      }

      return r;
    }, t.plugin = fn, t.polygonIntersectsBox = ia, t.polygonIntersectsPolygon = Xs, t.polygonizeBounds = function (t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var n = new i(r, r),
          s = t.sub(n),
          a = e.add(n);
      return [s, new i(a.x, s.y), a, new i(s.x, a.y), s];
    }, t.posAttributes = Pc, t.postMapLoadEvent = at, t.postTurnstileEvent = nt, t.potpack = Jl, t.prevPowerOfTwo = function (t) {
      return t <= 1 ? 1 : Math.pow(2, Math.floor(Math.log(t) / Math.LN2));
    }, t.radToDeg = function (t) {
      return t * u;
    }, t.refProperties = ["type", "source", "source-layer", "minzoom", "maxzoom", "filter", "layout"], t.registerForPluginStateChange = function (t) {
      return t({
        pluginStatus: on,
        pluginURL: ln
      }), hn.on("pluginStateChange", t), t;
    }, t.renderColorRamp = Ga, t.rotate = function (t, e, r) {
      var i = e[0],
          n = e[1],
          s = e[2],
          a = e[3],
          o = Math.sin(r),
          l = Math.cos(r);
      return t[0] = i * l + s * o, t[1] = n * l + a * o, t[2] = i * -o + s * l, t[3] = n * -o + a * l, t;
    }, t.rotateX = function (t, e, r) {
      var i = Math.sin(r),
          n = Math.cos(r),
          s = e[4],
          a = e[5],
          o = e[6],
          l = e[7],
          u = e[8],
          c = e[9],
          h = e[10],
          p = e[11];
      return e !== t && (t[0] = e[0], t[1] = e[1], t[2] = e[2], t[3] = e[3], t[12] = e[12], t[13] = e[13], t[14] = e[14], t[15] = e[15]), t[4] = s * n + u * i, t[5] = a * n + c * i, t[6] = o * n + h * i, t[7] = l * n + p * i, t[8] = u * n - s * i, t[9] = c * n - a * i, t[10] = h * n - o * i, t[11] = p * n - l * i, t;
    }, t.rotateX$1 = Pa, t.rotateY = function (t, e, r) {
      var i = Math.sin(r),
          n = Math.cos(r),
          s = e[0],
          a = e[1],
          o = e[2],
          l = e[3],
          u = e[8],
          c = e[9],
          h = e[10],
          p = e[11];
      return e !== t && (t[4] = e[4], t[5] = e[5], t[6] = e[6], t[7] = e[7], t[12] = e[12], t[13] = e[13], t[14] = e[14], t[15] = e[15]), t[0] = s * n - u * i, t[1] = a * n - c * i, t[2] = o * n - h * i, t[3] = l * n - p * i, t[8] = s * i + u * n, t[9] = a * i + c * n, t[10] = o * i + h * n, t[11] = l * i + p * n, t;
    }, t.rotateZ = function (t, e, r) {
      var i = Math.sin(r),
          n = Math.cos(r),
          s = e[0],
          a = e[1],
          o = e[2],
          l = e[3],
          u = e[4],
          c = e[5],
          h = e[6],
          p = e[7];
      return e !== t && (t[8] = e[8], t[9] = e[9], t[10] = e[10], t[11] = e[11], t[12] = e[12], t[13] = e[13], t[14] = e[14], t[15] = e[15]), t[0] = s * n + u * i, t[1] = a * n + c * i, t[2] = o * n + h * i, t[3] = l * n + p * i, t[4] = u * n - s * i, t[5] = c * n - a * i, t[6] = h * n - o * i, t[7] = p * n - l * i, t;
    }, t.rotateZ$1 = function (t, e, r) {
      r *= .5;
      var i = e[0],
          n = e[1],
          s = e[2],
          a = e[3],
          o = Math.sin(r),
          l = Math.cos(r);
      return t[0] = i * l + n * o, t[1] = n * l - i * o, t[2] = s * l + a * o, t[3] = a * l - s * o, t;
    }, t.scale = function (t, e, r) {
      var i = r[0],
          n = r[1],
          s = r[2];
      return t[0] = e[0] * i, t[1] = e[1] * i, t[2] = e[2] * i, t[3] = e[3] * i, t[4] = e[4] * n, t[5] = e[5] * n, t[6] = e[6] * n, t[7] = e[7] * n, t[8] = e[8] * s, t[9] = e[9] * s, t[10] = e[10] * s, t[11] = e[11] * s, t[12] = e[12], t[13] = e[13], t[14] = e[14], t[15] = e[15], t;
    }, t.scale$1 = function (t, e, r) {
      return t[0] = e[0] * r, t[1] = e[1] * r, t[2] = e[2] * r, t[3] = e[3] * r, t;
    }, t.scale$2 = _a, t.scaleAndAdd = Aa, t.setCacheLimits = function (t, e) {
      ht = t, pt = e;
    }, t.setRTLTextPlugin = function (t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
      if ("deferred" === on || "loading" === on || "loaded" === on) throw new Error("setRTLTextPlugin cannot be called multiple times.");
      ln = O.resolveURL(t), on = "deferred", an = e, cn(), r || dn();
    }, t.styleSpec = Vt, t.sub = Ea, t.subtract = wa, t.symbolSize = kl, t.transformMat3 = function (t, e, r) {
      var i = e[0],
          n = e[1],
          s = e[2];
      return t[0] = i * r[0] + n * r[3] + s * r[6], t[1] = i * r[1] + n * r[4] + s * r[7], t[2] = i * r[2] + n * r[5] + s * r[8], t;
    }, t.transformMat4 = Ma, t.transformQuat = Ta, t.translate = function (t, e, r) {
      var i,
          n,
          s,
          a,
          o,
          l,
          u,
          c,
          h,
          p,
          d,
          f,
          y = r[0],
          m = r[1],
          g = r[2];
      return e === t ? (t[12] = e[0] * y + e[4] * m + e[8] * g + e[12], t[13] = e[1] * y + e[5] * m + e[9] * g + e[13], t[14] = e[2] * y + e[6] * m + e[10] * g + e[14], t[15] = e[3] * y + e[7] * m + e[11] * g + e[15]) : (n = e[1], s = e[2], a = e[3], o = e[4], l = e[5], u = e[6], c = e[7], h = e[8], p = e[9], d = e[10], f = e[11], t[0] = i = e[0], t[1] = n, t[2] = s, t[3] = a, t[4] = o, t[5] = l, t[6] = u, t[7] = c, t[8] = h, t[9] = p, t[10] = d, t[11] = f, t[12] = i * y + o * m + h * g + e[12], t[13] = n * y + l * m + p * g + e[13], t[14] = s * y + u * m + d * g + e[14], t[15] = a * y + c * m + f * g + e[15]), t;
    }, t.triggerPluginCompletionEvent = un, t.uniqueId = v, t.validateCustomStyleLayer = function (t) {
      var e = [],
          r = t.id;
      return void 0 === r && e.push({
        message: "layers.".concat(r, ": missing required property \"id\"")
      }), void 0 === t.render && e.push({
        message: "layers.".concat(r, ": missing required method \"render\"")
      }), t.renderingMode && "2d" !== t.renderingMode && "3d" !== t.renderingMode && e.push({
        message: "layers.".concat(r, ": property \"renderingMode\" must be either \"2d\" or \"3d\"")
      }), e;
    }, t.validateLight = Vi, t.validateStyle = Pi, t.values = m, t.vectorTile = Go, t.version = "2.0.1", t.warnOnce = z, t.webpSupported = N, t.window = s, t.wrap = y;
  });
  define(["./shared"], function (e) {
    "use strict";

    function t(e) {
      var r = _typeof(e);

      if ("number" === r || "boolean" === r || "string" === r || null == e) return JSON.stringify(e);

      if (Array.isArray(e)) {
        var _r190 = "[";

        var _iterator131 = _createForOfIteratorHelper(e),
            _step131;

        try {
          for (_iterator131.s(); !(_step131 = _iterator131.n()).done;) {
            var _n110 = _step131.value;
            _r190 += "".concat(t(_n110), ",");
          }
        } catch (err) {
          _iterator131.e(err);
        } finally {
          _iterator131.f();
        }

        return "".concat(_r190, "]");
      }

      var n = Object.keys(e).sort();
      var o = "{";

      for (var _r191 = 0; _r191 < n.length; _r191++) {
        o += "".concat(JSON.stringify(n[_r191]), ":").concat(t(e[n[_r191]]), ",");
      }

      return "".concat(o, "}");
    }

    function r(r) {
      var n = "";

      var _iterator132 = _createForOfIteratorHelper(e.refProperties),
          _step132;

      try {
        for (_iterator132.s(); !(_step132 = _iterator132.n()).done;) {
          var _o43 = _step132.value;
          n += "/".concat(t(r[_o43]));
        }
      } catch (err) {
        _iterator132.e(err);
      } finally {
        _iterator132.f();
      }

      return n;
    }

    var n = /*#__PURE__*/function () {
      function n(e) {
        _classCallCheck(this, n);

        this.keyCache = {}, e && this.replace(e);
      }

      _createClass(n, [{
        key: "replace",
        value: function replace(e) {
          this._layerConfigs = {}, this._layers = {}, this.update(e, []);
        }
      }, {
        key: "update",
        value: function update(t, n) {
          var _this52 = this;

          var _iterator133 = _createForOfIteratorHelper(t),
              _step133;

          try {
            for (_iterator133.s(); !(_step133 = _iterator133.n()).done;) {
              var _r192 = _step133.value;
              this._layerConfigs[_r192.id] = _r192;

              var _t215 = this._layers[_r192.id] = e.createStyleLayer(_r192);

              _t215._featureFilter = e.featureFilter(_t215.filter), this.keyCache[_r192.id] && delete this.keyCache[_r192.id];
            }
          } catch (err) {
            _iterator133.e(err);
          } finally {
            _iterator133.f();
          }

          var _iterator134 = _createForOfIteratorHelper(n),
              _step134;

          try {
            for (_iterator134.s(); !(_step134 = _iterator134.n()).done;) {
              var _e206 = _step134.value;
              delete this.keyCache[_e206], delete this._layerConfigs[_e206], delete this._layers[_e206];
            }
          } catch (err) {
            _iterator134.e(err);
          } finally {
            _iterator134.f();
          }

          this.familiesBySource = {};

          var o = function (e, t) {
            var n = {};

            for (var _o44 = 0; _o44 < e.length; _o44++) {
              var _i151 = t && t[e[_o44].id] || r(e[_o44]);

              t && (t[e[_o44].id] = _i151);
              var _s88 = n[_i151];
              _s88 || (_s88 = n[_i151] = []), _s88.push(e[_o44]);
            }

            var o = [];

            for (var _e205 in n) {
              o.push(n[_e205]);
            }

            return o;
          }(e.values(this._layerConfigs), this.keyCache);

          var _iterator135 = _createForOfIteratorHelper(o),
              _step135;

          try {
            for (_iterator135.s(); !(_step135 = _iterator135.n()).done;) {
              var _e207 = _step135.value;

              var _t216 = _e207.map(function (e) {
                return _this52._layers[e.id];
              }),
                  _r193 = _t216[0];

              if ("none" === _r193.visibility) continue;

              var _n111 = _r193.source || "";

              var _o45 = this.familiesBySource[_n111];
              _o45 || (_o45 = this.familiesBySource[_n111] = {});

              var _i152 = _r193.sourceLayer || "_geojsonTileLayer";

              var _s89 = _o45[_i152];
              _s89 || (_s89 = _o45[_i152] = []), _s89.push(_t216);
            }
          } catch (err) {
            _iterator135.e(err);
          } finally {
            _iterator135.f();
          }
        }
      }]);

      return n;
    }();

    var o = e.window.ImageBitmap;

    var i = /*#__PURE__*/function () {
      function i() {
        _classCallCheck(this, i);
      }

      _createClass(i, [{
        key: "loadTile",
        value: function loadTile(t, r) {
          var n = t.uid,
              i = t.encoding,
              s = t.rawImageData,
              a = t.padding,
              l = t.buildQuadTree,
              u = o && s instanceof o ? this.getImageData(s, a) : s;
          r(null, new e.DEMData(n, u, i, a < 1, l));
        }
      }, {
        key: "getImageData",
        value: function getImageData(t, r) {
          this.offscreenCanvas && this.offscreenCanvasContext || (this.offscreenCanvas = new OffscreenCanvas(t.width, t.height), this.offscreenCanvasContext = this.offscreenCanvas.getContext("2d")), this.offscreenCanvas.width = t.width, this.offscreenCanvas.height = t.height, this.offscreenCanvasContext.drawImage(t, 0, 0, t.width, t.height);
          var n = this.offscreenCanvasContext.getImageData(-r, -r, t.width + 2 * r, t.height + 2 * r);
          return this.offscreenCanvasContext.clearRect(0, 0, this.offscreenCanvas.width, this.offscreenCanvas.height), new e.RGBAImage({
            width: n.width,
            height: n.height
          }, n.data);
        }
      }]);

      return i;
    }();

    function s(e, t) {
      if (0 !== e.length) {
        a(e[0], t);

        for (var r = 1; r < e.length; r++) {
          a(e[r], !t);
        }
      }
    }

    function a(e, t) {
      for (var r = 0, n = 0, o = e.length, i = o - 1; n < o; i = n++) {
        r += (e[n][0] - e[i][0]) * (e[i][1] + e[n][1]);
      }

      r >= 0 != !!t && e.reverse();
    }

    var l = e.vectorTile.VectorTileFeature.prototype.toGeoJSON;

    var u = /*#__PURE__*/function () {
      function u(t) {
        _classCallCheck(this, u);

        this._feature = t, this.extent = e.EXTENT, this.type = t.type, this.properties = t.tags, "id" in t && !isNaN(t.id) && (this.id = parseInt(t.id, 10));
      }

      _createClass(u, [{
        key: "loadGeometry",
        value: function loadGeometry() {
          if (1 === this._feature.type) {
            var _t217 = [];

            var _iterator136 = _createForOfIteratorHelper(this._feature.geometry),
                _step136;

            try {
              for (_iterator136.s(); !(_step136 = _iterator136.n()).done;) {
                var _r194 = _step136.value;

                _t217.push([new e.Point$1(_r194[0], _r194[1])]);
              }
            } catch (err) {
              _iterator136.e(err);
            } finally {
              _iterator136.f();
            }

            return _t217;
          }

          {
            var _t218 = [];

            var _iterator137 = _createForOfIteratorHelper(this._feature.geometry),
                _step137;

            try {
              for (_iterator137.s(); !(_step137 = _iterator137.n()).done;) {
                var _r195 = _step137.value;
                var _n112 = [];

                var _iterator138 = _createForOfIteratorHelper(_r195),
                    _step138;

                try {
                  for (_iterator138.s(); !(_step138 = _iterator138.n()).done;) {
                    var _t219 = _step138.value;

                    _n112.push(new e.Point$1(_t219[0], _t219[1]));
                  }
                } catch (err) {
                  _iterator138.e(err);
                } finally {
                  _iterator138.f();
                }

                _t218.push(_n112);
              }
            } catch (err) {
              _iterator137.e(err);
            } finally {
              _iterator137.f();
            }

            return _t218;
          }
        }
      }, {
        key: "toGeoJSON",
        value: function toGeoJSON(e, t, r) {
          return l.call(this, e, t, r);
        }
      }]);

      return u;
    }();

    var h = /*#__PURE__*/function () {
      function h(t) {
        _classCallCheck(this, h);

        this.layers = {
          _geojsonTileLayer: this
        }, this.name = "_geojsonTileLayer", this.extent = e.EXTENT, this.length = t.length, this._features = t;
      }

      _createClass(h, [{
        key: "feature",
        value: function feature(e) {
          return new u(this._features[e]);
        }
      }]);

      return h;
    }();

    var c = e.vectorTile.VectorTileFeature,
        f = p;

    function p(e, t) {
      this.options = t || {}, this.features = e, this.length = e.length;
    }

    function g(e, t) {
      this.id = "number" == typeof e.id ? e.id : void 0, this.type = e.type, this.rawGeometry = 1 === e.type ? [e.geometry] : e.geometry, this.properties = e.tags, this.extent = t || 4096;
    }

    p.prototype.feature = function (e) {
      return new g(this.features[e], this.options.extent);
    }, g.prototype.loadGeometry = function () {
      var t = this.rawGeometry;
      this.geometry = [];

      for (var r = 0; r < t.length; r++) {
        for (var n = t[r], o = [], i = 0; i < n.length; i++) {
          o.push(new e.Point$1(n[i][0], n[i][1]));
        }

        this.geometry.push(o);
      }

      return this.geometry;
    }, g.prototype.bbox = function () {
      this.geometry || this.loadGeometry();

      for (var e = this.geometry, t = 1 / 0, r = -1 / 0, n = 1 / 0, o = -1 / 0, i = 0; i < e.length; i++) {
        for (var s = e[i], a = 0; a < s.length; a++) {
          var l = s[a];
          t = Math.min(t, l.x), r = Math.max(r, l.x), n = Math.min(n, l.y), o = Math.max(o, l.y);
        }
      }

      return [t, n, r, o];
    }, g.prototype.toGeoJSON = c.prototype.toGeoJSON;
    var d = y,
        m = f;

    function y(t) {
      var r = new e.pbf();
      return function (e, t) {
        for (var r in e.layers) {
          t.writeMessage(3, v, e.layers[r]);
        }
      }(t, r), r.finish();
    }

    function v(e, t) {
      var r;
      t.writeVarintField(15, e.version || 1), t.writeStringField(1, e.name || ""), t.writeVarintField(5, e.extent || 4096);
      var n = {
        keys: [],
        values: [],
        keycache: {},
        valuecache: {}
      };

      for (r = 0; r < e.length; r++) {
        n.feature = e.feature(r), t.writeMessage(2, x, n);
      }

      var o = n.keys;

      for (r = 0; r < o.length; r++) {
        t.writeStringField(3, o[r]);
      }

      var i = n.values;

      for (r = 0; r < i.length; r++) {
        t.writeMessage(4, P, i[r]);
      }
    }

    function x(e, t) {
      var r = e.feature;
      void 0 !== r.id && t.writeVarintField(1, r.id), t.writeMessage(2, w, e), t.writeVarintField(3, r.type), t.writeMessage(4, _, r);
    }

    function w(e, t) {
      var r = e.feature,
          n = e.keys,
          o = e.values,
          i = e.keycache,
          s = e.valuecache;

      for (var a in r.properties) {
        var l = i[a];
        void 0 === l && (n.push(a), i[a] = l = n.length - 1), t.writeVarint(l);

        var u = r.properties[a],
            h = _typeof(u);

        "string" !== h && "boolean" !== h && "number" !== h && (u = JSON.stringify(u));
        var c = h + ":" + u,
            f = s[c];
        void 0 === f && (o.push(u), s[c] = f = o.length - 1), t.writeVarint(f);
      }
    }

    function S(e, t) {
      return (t << 3) + (7 & e);
    }

    function M(e) {
      return e << 1 ^ e >> 31;
    }

    function _(e, t) {
      for (var r = e.loadGeometry(), n = e.type, o = 0, i = 0, s = r.length, a = 0; a < s; a++) {
        var l = r[a],
            u = 1;
        1 === n && (u = l.length), t.writeVarint(S(1, u));

        for (var h = 3 === n ? l.length - 1 : l.length, c = 0; c < h; c++) {
          1 === c && 1 !== n && t.writeVarint(S(2, h - 1));
          var f = l[c].x - o,
              p = l[c].y - i;
          t.writeVarint(M(f)), t.writeVarint(M(p)), o += f, i += p;
        }

        3 === n && t.writeVarint(S(7, 1));
      }
    }

    function P(e, t) {
      var r = _typeof(e);

      "string" === r ? t.writeStringField(1, e) : "boolean" === r ? t.writeBooleanField(7, e) : "number" === r && (e % 1 != 0 ? t.writeDoubleField(3, e) : e < 0 ? t.writeSVarintField(6, e) : t.writeVarintField(5, e));
    }

    function b(e, t, r, n) {
      k(e, r, n), k(t, 2 * r, 2 * n), k(t, 2 * r + 1, 2 * n + 1);
    }

    function k(e, t, r) {
      var n = e[t];
      e[t] = e[r], e[r] = n;
    }

    function I(e, t, r, n) {
      var o = e - r,
          i = t - n;
      return o * o + i * i;
    }

    d.fromVectorTileJs = y, d.fromGeojsonVt = function (e, t) {
      t = t || {};
      var r = {};

      for (var n in e) {
        r[n] = new f(e[n].features, t), r[n].name = n, r[n].version = t.version, r[n].extent = t.extent;
      }

      return y({
        layers: r
      });
    }, d.GeoJSONWrapper = m;

    var T = function T(e) {
      return e[0];
    },
        C = function C(e) {
      return e[1];
    };

    var L = /*#__PURE__*/function () {
      function L(e) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : T;
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : C;
        var n = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 64;
        var o = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : Float64Array;

        _classCallCheck(this, L);

        this.nodeSize = n, this.points = e;
        var i = e.length < 65536 ? Uint16Array : Uint32Array,
            s = this.ids = new i(e.length),
            a = this.coords = new o(2 * e.length);

        for (var _n113 = 0; _n113 < e.length; _n113++) {
          s[_n113] = _n113, a[2 * _n113] = t(e[_n113]), a[2 * _n113 + 1] = r(e[_n113]);
        }

        !function e(t, r, n, o, i, s) {
          if (i - o <= n) return;
          var a = o + i >> 1;
          !function e(t, r, n, o, i, s) {
            for (; i > o;) {
              if (i - o > 600) {
                var _a78 = i - o + 1,
                    _l33 = n - o + 1,
                    _u29 = Math.log(_a78),
                    _h12 = .5 * Math.exp(2 * _u29 / 3),
                    _c21 = .5 * Math.sqrt(_u29 * _h12 * (_a78 - _h12) / _a78) * (_l33 - _a78 / 2 < 0 ? -1 : 1);

                e(t, r, n, Math.max(o, Math.floor(n - _l33 * _h12 / _a78 + _c21)), Math.min(i, Math.floor(n + (_a78 - _l33) * _h12 / _a78 + _c21)), s);
              }

              var _a77 = r[2 * n + s];
              var _l32 = o,
                  _u28 = i;

              for (b(t, r, o, n), r[2 * i + s] > _a77 && b(t, r, o, i); _l32 < _u28;) {
                for (b(t, r, _l32, _u28), _l32++, _u28--; r[2 * _l32 + s] < _a77;) {
                  _l32++;
                }

                for (; r[2 * _u28 + s] > _a77;) {
                  _u28--;
                }
              }

              r[2 * o + s] === _a77 ? b(t, r, o, _u28) : (_u28++, b(t, r, _u28, i)), _u28 <= n && (o = _u28 + 1), n <= _u28 && (i = _u28 - 1);
            }
          }(t, r, a, o, i, s % 2), e(t, r, n, o, a - 1, s + 1), e(t, r, n, a + 1, i, s + 1);
        }(s, a, n, 0, s.length - 1, 0);
      }

      _createClass(L, [{
        key: "range",
        value: function range(e, t, r, n) {
          return function (e, t, r, n, o, i, s) {
            var a = [0, e.length - 1, 0],
                l = [];
            var u, h;

            for (; a.length;) {
              var _c22 = a.pop(),
                  _f9 = a.pop(),
                  _p13 = a.pop();

              if (_f9 - _p13 <= s) {
                for (var _s90 = _p13; _s90 <= _f9; _s90++) {
                  u = t[2 * _s90], h = t[2 * _s90 + 1], u >= r && u <= o && h >= n && h <= i && l.push(e[_s90]);
                }

                continue;
              }

              var _g10 = Math.floor((_p13 + _f9) / 2);

              u = t[2 * _g10], h = t[2 * _g10 + 1], u >= r && u <= o && h >= n && h <= i && l.push(e[_g10]);

              var _d10 = (_c22 + 1) % 2;

              (0 === _c22 ? r <= u : n <= h) && (a.push(_p13), a.push(_g10 - 1), a.push(_d10)), (0 === _c22 ? o >= u : i >= h) && (a.push(_g10 + 1), a.push(_f9), a.push(_d10));
            }

            return l;
          }(this.ids, this.coords, e, t, r, n, this.nodeSize);
        }
      }, {
        key: "within",
        value: function within(e, t, r) {
          return function (e, t, r, n, o, i) {
            var s = [0, e.length - 1, 0],
                a = [],
                l = o * o;

            for (; s.length;) {
              var _u30 = s.pop(),
                  _h13 = s.pop(),
                  _c23 = s.pop();

              if (_h13 - _c23 <= i) {
                for (var _o46 = _c23; _o46 <= _h13; _o46++) {
                  I(t[2 * _o46], t[2 * _o46 + 1], r, n) <= l && a.push(e[_o46]);
                }

                continue;
              }

              var _f10 = Math.floor((_c23 + _h13) / 2),
                  _p14 = t[2 * _f10],
                  _g11 = t[2 * _f10 + 1];

              I(_p14, _g11, r, n) <= l && a.push(e[_f10]);

              var _d11 = (_u30 + 1) % 2;

              (0 === _u30 ? r - o <= _p14 : n - o <= _g11) && (s.push(_c23), s.push(_f10 - 1), s.push(_d11)), (0 === _u30 ? r + o >= _p14 : n + o >= _g11) && (s.push(_f10 + 1), s.push(_h13), s.push(_d11));
            }

            return a;
          }(this.ids, this.coords, e, t, r, this.nodeSize);
        }
      }]);

      return L;
    }();

    var O = {
      minZoom: 0,
      maxZoom: 16,
      minPoints: 2,
      radius: 40,
      extent: 512,
      nodeSize: 64,
      log: !1,
      generateId: !1,
      reduce: null,
      map: function map(e) {
        return e;
      }
    };

    var z = /*#__PURE__*/function () {
      function z(e) {
        _classCallCheck(this, z);

        this.options = Y(Object.create(O), e), this.trees = new Array(this.options.maxZoom + 1);
      }

      _createClass(z, [{
        key: "load",
        value: function load(e) {
          var _this$options = this.options,
              t = _this$options.log,
              r = _this$options.minZoom,
              n = _this$options.maxZoom,
              o = _this$options.nodeSize;
          t && console.time("total time");
          var i = "prepare ".concat(e.length, " points");
          t && console.time(i), this.points = e;
          var s = [];

          for (var _t220 = 0; _t220 < e.length; _t220++) {
            e[_t220].geometry && s.push(N(e[_t220], _t220));
          }

          this.trees[n + 1] = new L(s, W, X, o, Float32Array), t && console.timeEnd(i);

          for (var _e208 = n; _e208 >= r; _e208--) {
            var _r196 = +Date.now();

            s = this._cluster(s, _e208), this.trees[_e208] = new L(s, W, X, o, Float32Array), t && console.log("z%d: %d clusters in %dms", _e208, s.length, +Date.now() - _r196);
          }

          return t && console.timeEnd("total time"), this;
        }
      }, {
        key: "getClusters",
        value: function getClusters(e, t) {
          var r = ((e[0] + 180) % 360 + 360) % 360 - 180;
          var n = Math.max(-90, Math.min(90, e[1]));
          var o = 180 === e[2] ? 180 : ((e[2] + 180) % 360 + 360) % 360 - 180;
          var i = Math.max(-90, Math.min(90, e[3]));
          if (e[2] - e[0] >= 360) r = -180, o = 180;else if (r > o) {
            var _e209 = this.getClusters([r, n, 180, i], t),
                _s91 = this.getClusters([-180, n, o, i], t);

            return _e209.concat(_s91);
          }

          var s = this.trees[this._limitZoom(t)],
              a = s.range(J(r), D(i), J(o), D(n)),
              l = [];

          var _iterator139 = _createForOfIteratorHelper(a),
              _step139;

          try {
            for (_iterator139.s(); !(_step139 = _iterator139.n()).done;) {
              var _e210 = _step139.value;
              var _t221 = s.points[_e210];
              l.push(_t221.numPoints ? F(_t221) : this.points[_t221.index]);
            }
          } catch (err) {
            _iterator139.e(err);
          } finally {
            _iterator139.f();
          }

          return l;
        }
      }, {
        key: "getChildren",
        value: function getChildren(e) {
          var t = this._getOriginId(e),
              r = this._getOriginZoom(e),
              n = "No cluster with the specified id.",
              o = this.trees[r];

          if (!o) throw new Error(n);
          var i = o.points[t];
          if (!i) throw new Error(n);
          var s = this.options.radius / (this.options.extent * Math.pow(2, r - 1)),
              a = o.within(i.x, i.y, s),
              l = [];

          var _iterator140 = _createForOfIteratorHelper(a),
              _step140;

          try {
            for (_iterator140.s(); !(_step140 = _iterator140.n()).done;) {
              var _t222 = _step140.value;
              var _r197 = o.points[_t222];
              _r197.parentId === e && l.push(_r197.numPoints ? F(_r197) : this.points[_r197.index]);
            }
          } catch (err) {
            _iterator140.e(err);
          } finally {
            _iterator140.f();
          }

          if (0 === l.length) throw new Error(n);
          return l;
        }
      }, {
        key: "getLeaves",
        value: function getLeaves(e, t, r) {
          var n = [];
          return this._appendLeaves(n, e, t = t || 10, r = r || 0, 0), n;
        }
      }, {
        key: "getTile",
        value: function getTile(e, t, r) {
          var n = this.trees[this._limitZoom(e)],
              o = Math.pow(2, e),
              _this$options2 = this.options,
              i = _this$options2.extent,
              s = _this$options2.radius,
              a = s / i,
              l = (r - a) / o,
              u = (r + 1 + a) / o,
              h = {
            features: []
          };

          return this._addTileFeatures(n.range((t - a) / o, l, (t + 1 + a) / o, u), n.points, t, r, o, h), 0 === t && this._addTileFeatures(n.range(1 - a / o, l, 1, u), n.points, o, r, o, h), t === o - 1 && this._addTileFeatures(n.range(0, l, a / o, u), n.points, -1, r, o, h), h.features.length ? h : null;
        }
      }, {
        key: "getClusterExpansionZoom",
        value: function getClusterExpansionZoom(e) {
          var t = this._getOriginZoom(e) - 1;

          for (; t <= this.options.maxZoom;) {
            var _r198 = this.getChildren(e);

            if (t++, 1 !== _r198.length) break;
            e = _r198[0].properties.cluster_id;
          }

          return t;
        }
      }, {
        key: "_appendLeaves",
        value: function _appendLeaves(e, t, r, n, o) {
          var i = this.getChildren(t);

          var _iterator141 = _createForOfIteratorHelper(i),
              _step141;

          try {
            for (_iterator141.s(); !(_step141 = _iterator141.n()).done;) {
              var _t223 = _step141.value;
              var _i153 = _t223.properties;
              if (_i153 && _i153.cluster ? o + _i153.point_count <= n ? o += _i153.point_count : o = this._appendLeaves(e, _i153.cluster_id, r, n, o) : o < n ? o++ : e.push(_t223), e.length === r) break;
            }
          } catch (err) {
            _iterator141.e(err);
          } finally {
            _iterator141.f();
          }

          return o;
        }
      }, {
        key: "_addTileFeatures",
        value: function _addTileFeatures(e, t, r, n, o, i) {
          var _iterator142 = _createForOfIteratorHelper(e),
              _step142;

          try {
            for (_iterator142.s(); !(_step142 = _iterator142.n()).done;) {
              var _s92 = _step142.value;
              var _e211 = t[_s92],
                  _a79 = _e211.numPoints,
                  _l34 = {
                type: 1,
                geometry: [[Math.round(this.options.extent * (_e211.x * o - r)), Math.round(this.options.extent * (_e211.y * o - n))]],
                tags: _a79 ? Z(_e211) : this.points[_e211.index].properties
              };

              var _u31 = void 0;

              _a79 ? _u31 = _e211.id : this.options.generateId ? _u31 = _e211.index : this.points[_e211.index].id && (_u31 = this.points[_e211.index].id), void 0 !== _u31 && (_l34.id = _u31), i.features.push(_l34);
            }
          } catch (err) {
            _iterator142.e(err);
          } finally {
            _iterator142.f();
          }
        }
      }, {
        key: "_limitZoom",
        value: function _limitZoom(e) {
          return Math.max(this.options.minZoom, Math.min(+e, this.options.maxZoom + 1));
        }
      }, {
        key: "_cluster",
        value: function _cluster(e, t) {
          var r = [],
              _this$options3 = this.options,
              n = _this$options3.radius,
              o = _this$options3.extent,
              i = _this$options3.reduce,
              s = _this$options3.minPoints,
              a = n / (o * Math.pow(2, t));

          for (var _n114 = 0; _n114 < e.length; _n114++) {
            var _o47 = e[_n114];
            if (_o47.zoom <= t) continue;
            _o47.zoom = t;

            var _l35 = this.trees[t + 1],
                _u32 = _l35.within(_o47.x, _o47.y, a),
                _h14 = _o47.numPoints || 1;

            var _c24 = _h14;

            var _iterator143 = _createForOfIteratorHelper(_u32),
                _step143;

            try {
              for (_iterator143.s(); !(_step143 = _iterator143.n()).done;) {
                var _e214 = _step143.value;
                var _r200 = _l35.points[_e214];
                _r200.zoom > t && (_c24 += _r200.numPoints || 1);
              }
            } catch (err) {
              _iterator143.e(err);
            } finally {
              _iterator143.f();
            }

            if (_c24 >= s) {
              var _e212 = _o47.x * _h14,
                  _s93 = _o47.y * _h14,
                  _a80 = i && _h14 > 1 ? this._map(_o47, !0) : null;

              var _f11 = (_n114 << 5) + (t + 1) + this.points.length;

              var _iterator144 = _createForOfIteratorHelper(_u32),
                  _step144;

              try {
                for (_iterator144.s(); !(_step144 = _iterator144.n()).done;) {
                  var _r199 = _step144.value;
                  var _n115 = _l35.points[_r199];
                  if (_n115.zoom <= t) continue;
                  _n115.zoom = t;

                  var _u33 = _n115.numPoints || 1;

                  _e212 += _n115.x * _u33, _s93 += _n115.y * _u33, _n115.parentId = _f11, i && (_a80 || (_a80 = this._map(_o47, !0)), i(_a80, this._map(_n115)));
                }
              } catch (err) {
                _iterator144.e(err);
              } finally {
                _iterator144.f();
              }

              _o47.parentId = _f11, r.push(E(_e212 / _c24, _s93 / _c24, _f11, _c24, _a80));
            } else if (r.push(_o47), _c24 > 1) {
              var _iterator145 = _createForOfIteratorHelper(_u32),
                  _step145;

              try {
                for (_iterator145.s(); !(_step145 = _iterator145.n()).done;) {
                  var _e213 = _step145.value;
                  var _n116 = _l35.points[_e213];
                  _n116.zoom <= t || (_n116.zoom = t, r.push(_n116));
                }
              } catch (err) {
                _iterator145.e(err);
              } finally {
                _iterator145.f();
              }
            }
          }

          return r;
        }
      }, {
        key: "_getOriginId",
        value: function _getOriginId(e) {
          return e - this.points.length >> 5;
        }
      }, {
        key: "_getOriginZoom",
        value: function _getOriginZoom(e) {
          return (e - this.points.length) % 32;
        }
      }, {
        key: "_map",
        value: function _map(e, t) {
          if (e.numPoints) return t ? Y({}, e.properties) : e.properties;
          var r = this.points[e.index].properties,
              n = this.options.map(r);
          return t && n === r ? Y({}, n) : n;
        }
      }]);

      return z;
    }();

    function E(e, t, r, n, o) {
      return {
        x: e,
        y: t,
        zoom: 1 / 0,
        id: r,
        parentId: -1,
        numPoints: n,
        properties: o
      };
    }

    function N(e, t) {
      var _e$geometry$coordinat = _slicedToArray(e.geometry.coordinates, 2),
          r = _e$geometry$coordinat[0],
          n = _e$geometry$coordinat[1];

      return {
        x: J(r),
        y: D(n),
        zoom: 1 / 0,
        index: t,
        parentId: -1
      };
    }

    function F(e) {
      return {
        type: "Feature",
        id: e.id,
        properties: Z(e),
        geometry: {
          type: "Point",
          coordinates: [(t = e.x, 360 * (t - .5)), G(e.y)]
        }
      };
      var t;
    }

    function Z(e) {
      var t = e.numPoints,
          r = t >= 1e4 ? "".concat(Math.round(t / 1e3), "k") : t >= 1e3 ? "".concat(Math.round(t / 100) / 10, "k") : t;
      return Y(Y({}, e.properties), {
        cluster: !0,
        cluster_id: e.id,
        point_count: t,
        point_count_abbreviated: r
      });
    }

    function J(e) {
      return e / 360 + .5;
    }

    function D(e) {
      var t = Math.sin(e * Math.PI / 180),
          r = .5 - .25 * Math.log((1 + t) / (1 - t)) / Math.PI;
      return r < 0 ? 0 : r > 1 ? 1 : r;
    }

    function G(e) {
      var t = (180 - 360 * e) * Math.PI / 180;
      return 360 * Math.atan(Math.exp(t)) / Math.PI - 90;
    }

    function Y(e, t) {
      for (var _r201 in t) {
        e[_r201] = t[_r201];
      }

      return e;
    }

    function W(e) {
      return e.x;
    }

    function X(e) {
      return e.y;
    }

    function V(e, t, r, n, o, i) {
      var s = o - r,
          a = i - n;

      if (0 !== s || 0 !== a) {
        var l = ((e - r) * s + (t - n) * a) / (s * s + a * a);
        l > 1 ? (r = o, n = i) : l > 0 && (r += s * l, n += a * l);
      }

      return (s = e - r) * s + (a = t - n) * a;
    }

    function $(e, t, r, n) {
      var o = {
        id: void 0 === e ? null : e,
        type: t,
        geometry: r,
        tags: n,
        minX: 1 / 0,
        minY: 1 / 0,
        maxX: -1 / 0,
        maxY: -1 / 0
      };
      return function (e) {
        var t = e.geometry,
            r = e.type;
        if ("Point" === r || "MultiPoint" === r || "LineString" === r) j(e, t);else if ("Polygon" === r || "MultiLineString" === r) for (var n = 0; n < t.length; n++) {
          j(e, t[n]);
        } else if ("MultiPolygon" === r) for (n = 0; n < t.length; n++) {
          for (var o = 0; o < t[n].length; o++) {
            j(e, t[n][o]);
          }
        }
      }(o), o;
    }

    function j(e, t) {
      for (var r = 0; r < t.length; r += 3) {
        e.minX = Math.min(e.minX, t[r]), e.minY = Math.min(e.minY, t[r + 1]), e.maxX = Math.max(e.maxX, t[r]), e.maxY = Math.max(e.maxY, t[r + 1]);
      }
    }

    function A(e, t, r, n) {
      if (t.geometry) {
        var o = t.geometry.coordinates,
            i = t.geometry.type,
            s = Math.pow(r.tolerance / ((1 << r.maxZoom) * r.extent), 2),
            a = [],
            l = t.id;
        if (r.promoteId ? l = t.properties[r.promoteId] : r.generateId && (l = n || 0), "Point" === i) R(o, a);else if ("MultiPoint" === i) for (var u = 0; u < o.length; u++) {
          R(o[u], a);
        } else if ("LineString" === i) B(o, a, s, !1);else if ("MultiLineString" === i) {
          if (r.lineMetrics) {
            for (u = 0; u < o.length; u++) {
              B(o[u], a = [], s, !1), e.push($(l, "LineString", a, t.properties));
            }

            return;
          }

          q(o, a, s, !1);
        } else if ("Polygon" === i) q(o, a, s, !0);else {
          if ("MultiPolygon" !== i) {
            if ("GeometryCollection" === i) {
              for (u = 0; u < t.geometry.geometries.length; u++) {
                A(e, {
                  id: l,
                  geometry: t.geometry.geometries[u],
                  properties: t.properties
                }, r, n);
              }

              return;
            }

            throw new Error("Input data is not a valid GeoJSON object.");
          }

          for (u = 0; u < o.length; u++) {
            var h = [];
            q(o[u], h, s, !0), a.push(h);
          }
        }
        e.push($(l, i, a, t.properties));
      }
    }

    function R(e, t) {
      t.push(U(e[0])), t.push(Q(e[1])), t.push(0);
    }

    function B(e, t, r, n) {
      for (var o, i, s = 0, a = 0; a < e.length; a++) {
        var l = U(e[a][0]),
            u = Q(e[a][1]);
        t.push(l), t.push(u), t.push(0), a > 0 && (s += n ? (o * u - l * i) / 2 : Math.sqrt(Math.pow(l - o, 2) + Math.pow(u - i, 2))), o = l, i = u;
      }

      var h = t.length - 3;
      t[2] = 1, function e(t, r, n, o) {
        for (var i, s = o, a = n - r >> 1, l = n - r, u = t[r], h = t[r + 1], c = t[n], f = t[n + 1], p = r + 3; p < n; p += 3) {
          var g = V(t[p], t[p + 1], u, h, c, f);
          if (g > s) i = p, s = g;else if (g === s) {
            var d = Math.abs(p - a);
            d < l && (i = p, l = d);
          }
        }

        s > o && (i - r > 3 && e(t, r, i, o), t[i + 2] = s, n - i > 3 && e(t, i, n, o));
      }(t, 0, h, r), t[h + 2] = 1, t.size = Math.abs(s), t.start = 0, t.end = t.size;
    }

    function q(e, t, r, n) {
      for (var o = 0; o < e.length; o++) {
        var i = [];
        B(e[o], i, r, n), t.push(i);
      }
    }

    function U(e) {
      return e / 360 + .5;
    }

    function Q(e) {
      var t = Math.sin(e * Math.PI / 180),
          r = .5 - .25 * Math.log((1 + t) / (1 - t)) / Math.PI;
      return r < 0 ? 0 : r > 1 ? 1 : r;
    }

    function H(e, t, r, n, o, i, s, a) {
      if (n /= t, i >= (r /= t) && s < n) return e;
      if (s < r || i >= n) return null;

      for (var l = [], u = 0; u < e.length; u++) {
        var h = e[u],
            c = h.geometry,
            f = h.type,
            p = 0 === o ? h.minX : h.minY,
            g = 0 === o ? h.maxX : h.maxY;
        if (p >= r && g < n) l.push(h);else if (!(g < r || p >= n)) {
          var d = [];
          if ("Point" === f || "MultiPoint" === f) K(c, d, r, n, o);else if ("LineString" === f) ee(c, d, r, n, o, !1, a.lineMetrics);else if ("MultiLineString" === f) re(c, d, r, n, o, !1);else if ("Polygon" === f) re(c, d, r, n, o, !0);else if ("MultiPolygon" === f) for (var m = 0; m < c.length; m++) {
            var y = [];
            re(c[m], y, r, n, o, !0), y.length && d.push(y);
          }

          if (d.length) {
            if (a.lineMetrics && "LineString" === f) {
              for (m = 0; m < d.length; m++) {
                l.push($(h.id, f, d[m], h.tags));
              }

              continue;
            }

            "LineString" !== f && "MultiLineString" !== f || (1 === d.length ? (f = "LineString", d = d[0]) : f = "MultiLineString"), "Point" !== f && "MultiPoint" !== f || (f = 3 === d.length ? "Point" : "MultiPoint"), l.push($(h.id, f, d, h.tags));
          }
        }
      }

      return l.length ? l : null;
    }

    function K(e, t, r, n, o) {
      for (var i = 0; i < e.length; i += 3) {
        var s = e[i + o];
        s >= r && s <= n && (t.push(e[i]), t.push(e[i + 1]), t.push(e[i + 2]));
      }
    }

    function ee(e, t, r, n, o, i, s) {
      for (var a, l, u = te(e), h = 0 === o ? oe : ie, c = e.start, f = 0; f < e.length - 3; f += 3) {
        var p = e[f],
            g = e[f + 1],
            d = e[f + 2],
            m = e[f + 3],
            y = e[f + 4],
            v = 0 === o ? p : g,
            x = 0 === o ? m : y,
            w = !1;
        s && (a = Math.sqrt(Math.pow(p - m, 2) + Math.pow(g - y, 2))), v < r ? x > r && (l = h(u, p, g, m, y, r), s && (u.start = c + a * l)) : v > n ? x < n && (l = h(u, p, g, m, y, n), s && (u.start = c + a * l)) : ne(u, p, g, d), x < r && v >= r && (l = h(u, p, g, m, y, r), w = !0), x > n && v <= n && (l = h(u, p, g, m, y, n), w = !0), !i && w && (s && (u.end = c + a * l), t.push(u), u = te(e)), s && (c += a);
      }

      var S = e.length - 3;
      p = e[S], g = e[S + 1], d = e[S + 2], (v = 0 === o ? p : g) >= r && v <= n && ne(u, p, g, d), S = u.length - 3, i && S >= 3 && (u[S] !== u[0] || u[S + 1] !== u[1]) && ne(u, u[0], u[1], u[2]), u.length && t.push(u);
    }

    function te(e) {
      var t = [];
      return t.size = e.size, t.start = e.start, t.end = e.end, t;
    }

    function re(e, t, r, n, o, i) {
      for (var s = 0; s < e.length; s++) {
        ee(e[s], t, r, n, o, i, !1);
      }
    }

    function ne(e, t, r, n) {
      e.push(t), e.push(r), e.push(n);
    }

    function oe(e, t, r, n, o, i) {
      var s = (i - t) / (n - t);
      return e.push(i), e.push(r + (o - r) * s), e.push(1), s;
    }

    function ie(e, t, r, n, o, i) {
      var s = (i - r) / (o - r);
      return e.push(t + (n - t) * s), e.push(i), e.push(1), s;
    }

    function se(e, t) {
      for (var r = [], n = 0; n < e.length; n++) {
        var o,
            i = e[n],
            s = i.type;
        if ("Point" === s || "MultiPoint" === s || "LineString" === s) o = ae(i.geometry, t);else if ("MultiLineString" === s || "Polygon" === s) {
          o = [];

          for (var a = 0; a < i.geometry.length; a++) {
            o.push(ae(i.geometry[a], t));
          }
        } else if ("MultiPolygon" === s) for (o = [], a = 0; a < i.geometry.length; a++) {
          for (var l = [], u = 0; u < i.geometry[a].length; u++) {
            l.push(ae(i.geometry[a][u], t));
          }

          o.push(l);
        }
        r.push($(i.id, s, o, i.tags));
      }

      return r;
    }

    function ae(e, t) {
      var r = [];
      r.size = e.size, void 0 !== e.start && (r.start = e.start, r.end = e.end);

      for (var n = 0; n < e.length; n += 3) {
        r.push(e[n] + t, e[n + 1], e[n + 2]);
      }

      return r;
    }

    function le(e, t) {
      if (e.transformed) return e;
      var r,
          n,
          o,
          i = 1 << e.z,
          s = e.x,
          a = e.y;

      for (r = 0; r < e.features.length; r++) {
        var l = e.features[r],
            u = l.geometry,
            h = l.type;
        if (l.geometry = [], 1 === h) for (n = 0; n < u.length; n += 2) {
          l.geometry.push(ue(u[n], u[n + 1], t, i, s, a));
        } else for (n = 0; n < u.length; n++) {
          var c = [];

          for (o = 0; o < u[n].length; o += 2) {
            c.push(ue(u[n][o], u[n][o + 1], t, i, s, a));
          }

          l.geometry.push(c);
        }
      }

      return e.transformed = !0, e;
    }

    function ue(e, t, r, n, o, i) {
      return [Math.round(r * (e * n - o)), Math.round(r * (t * n - i))];
    }

    function he(e, t, r, n, o) {
      for (var i = t === o.maxZoom ? 0 : o.tolerance / ((1 << t) * o.extent), s = {
        features: [],
        numPoints: 0,
        numSimplified: 0,
        numFeatures: 0,
        source: null,
        x: r,
        y: n,
        z: t,
        transformed: !1,
        minX: 2,
        minY: 1,
        maxX: -1,
        maxY: 0
      }, a = 0; a < e.length; a++) {
        s.numFeatures++, ce(s, e[a], i, o);
        var l = e[a].minX,
            u = e[a].minY,
            h = e[a].maxX,
            c = e[a].maxY;
        l < s.minX && (s.minX = l), u < s.minY && (s.minY = u), h > s.maxX && (s.maxX = h), c > s.maxY && (s.maxY = c);
      }

      return s;
    }

    function ce(e, t, r, n) {
      var o = t.geometry,
          i = t.type,
          s = [];
      if ("Point" === i || "MultiPoint" === i) for (var a = 0; a < o.length; a += 3) {
        s.push(o[a]), s.push(o[a + 1]), e.numPoints++, e.numSimplified++;
      } else if ("LineString" === i) fe(s, o, e, r, !1, !1);else if ("MultiLineString" === i || "Polygon" === i) for (a = 0; a < o.length; a++) {
        fe(s, o[a], e, r, "Polygon" === i, 0 === a);
      } else if ("MultiPolygon" === i) for (var l = 0; l < o.length; l++) {
        var u = o[l];

        for (a = 0; a < u.length; a++) {
          fe(s, u[a], e, r, !0, 0 === a);
        }
      }

      if (s.length) {
        var h = t.tags || null;

        if ("LineString" === i && n.lineMetrics) {
          for (var c in h = {}, t.tags) {
            h[c] = t.tags[c];
          }

          h.mapbox_clip_start = o.start / o.size, h.mapbox_clip_end = o.end / o.size;
        }

        var f = {
          geometry: s,
          type: "Polygon" === i || "MultiPolygon" === i ? 3 : "LineString" === i || "MultiLineString" === i ? 2 : 1,
          tags: h
        };
        null !== t.id && (f.id = t.id), e.features.push(f);
      }
    }

    function fe(e, t, r, n, o, i) {
      var s = n * n;
      if (n > 0 && t.size < (o ? s : n)) r.numPoints += t.length / 3;else {
        for (var a = [], l = 0; l < t.length; l += 3) {
          (0 === n || t[l + 2] > s) && (r.numSimplified++, a.push(t[l]), a.push(t[l + 1])), r.numPoints++;
        }

        o && function (e, t) {
          for (var r = 0, n = 0, o = e.length, i = o - 2; n < o; i = n, n += 2) {
            r += (e[n] - e[i]) * (e[n + 1] + e[i + 1]);
          }

          if (r > 0 === t) for (n = 0, o = e.length; n < o / 2; n += 2) {
            var s = e[n],
                a = e[n + 1];
            e[n] = e[o - 2 - n], e[n + 1] = e[o - 1 - n], e[o - 2 - n] = s, e[o - 1 - n] = a;
          }
        }(a, i), e.push(a);
      }
    }

    function pe(e, t) {
      var r = (t = this.options = function (e, t) {
        for (var r in t) {
          e[r] = t[r];
        }

        return e;
      }(Object.create(this.options), t)).debug;

      if (r && console.time("preprocess data"), t.maxZoom < 0 || t.maxZoom > 24) throw new Error("maxZoom should be in the 0-24 range");
      if (t.promoteId && t.generateId) throw new Error("promoteId and generateId cannot be used together.");

      var n = function (e, t) {
        var r = [];
        if ("FeatureCollection" === e.type) for (var n = 0; n < e.features.length; n++) {
          A(r, e.features[n], t, n);
        } else A(r, "Feature" === e.type ? e : {
          geometry: e
        }, t);
        return r;
      }(e, t);

      this.tiles = {}, this.tileCoords = [], r && (console.timeEnd("preprocess data"), console.log("index: maxZoom: %d, maxPoints: %d", t.indexMaxZoom, t.indexMaxPoints), console.time("generate tiles"), this.stats = {}, this.total = 0), (n = function (e, t) {
        var r = t.buffer / t.extent,
            n = e,
            o = H(e, 1, -1 - r, r, 0, -1, 2, t),
            i = H(e, 1, 1 - r, 2 + r, 0, -1, 2, t);
        return (o || i) && (n = H(e, 1, -r, 1 + r, 0, -1, 2, t) || [], o && (n = se(o, 1).concat(n)), i && (n = n.concat(se(i, -1)))), n;
      }(n, t)).length && this.splitTile(n, 0, 0, 0), r && (n.length && console.log("features: %d, points: %d", this.tiles[0].numFeatures, this.tiles[0].numPoints), console.timeEnd("generate tiles"), console.log("tiles generated:", this.total, JSON.stringify(this.stats)));
    }

    function ge(e, t, r) {
      return 32 * ((1 << e) * r + t) + e;
    }

    function de(e, t) {
      var r = e.tileID.canonical;
      if (!this._geoJSONIndex) return t(null, null);

      var n = this._geoJSONIndex.getTile(r.z, r.x, r.y);

      if (!n) return t(null, null);
      var o = new h(n.features);
      var i = d(o);
      0 === i.byteOffset && i.byteLength === i.buffer.byteLength || (i = new Uint8Array(i)), t(null, {
        vectorTile: o,
        rawData: i.buffer
      });
    }

    pe.prototype.options = {
      maxZoom: 14,
      indexMaxZoom: 5,
      indexMaxPoints: 1e5,
      tolerance: 3,
      extent: 4096,
      buffer: 64,
      lineMetrics: !1,
      promoteId: null,
      generateId: !1,
      debug: 0
    }, pe.prototype.splitTile = function (e, t, r, n, o, i, s) {
      for (var a = [e, t, r, n], l = this.options, u = l.debug; a.length;) {
        n = a.pop(), r = a.pop(), t = a.pop(), e = a.pop();
        var h = 1 << t,
            c = ge(t, r, n),
            f = this.tiles[c];

        if (!f && (u > 1 && console.time("creation"), f = this.tiles[c] = he(e, t, r, n, l), this.tileCoords.push({
          z: t,
          x: r,
          y: n
        }), u)) {
          u > 1 && (console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)", t, r, n, f.numFeatures, f.numPoints, f.numSimplified), console.timeEnd("creation"));
          var p = "z" + t;
          this.stats[p] = (this.stats[p] || 0) + 1, this.total++;
        }

        if (f.source = e, o) {
          if (t === l.maxZoom || t === o) continue;
          var g = 1 << o - t;
          if (r !== Math.floor(i / g) || n !== Math.floor(s / g)) continue;
        } else if (t === l.indexMaxZoom || f.numPoints <= l.indexMaxPoints) continue;

        if (f.source = null, 0 !== e.length) {
          u > 1 && console.time("clipping");

          var d,
              m,
              y,
              v,
              x,
              w,
              S = .5 * l.buffer / l.extent,
              M = .5 - S,
              _ = .5 + S,
              P = 1 + S;

          d = m = y = v = null, x = H(e, h, r - S, r + _, 0, f.minX, f.maxX, l), w = H(e, h, r + M, r + P, 0, f.minX, f.maxX, l), e = null, x && (d = H(x, h, n - S, n + _, 1, f.minY, f.maxY, l), m = H(x, h, n + M, n + P, 1, f.minY, f.maxY, l), x = null), w && (y = H(w, h, n - S, n + _, 1, f.minY, f.maxY, l), v = H(w, h, n + M, n + P, 1, f.minY, f.maxY, l), w = null), u > 1 && console.timeEnd("clipping"), a.push(d || [], t + 1, 2 * r, 2 * n), a.push(m || [], t + 1, 2 * r, 2 * n + 1), a.push(y || [], t + 1, 2 * r + 1, 2 * n), a.push(v || [], t + 1, 2 * r + 1, 2 * n + 1);
        }
      }
    }, pe.prototype.getTile = function (e, t, r) {
      var n = this.options,
          o = n.extent,
          i = n.debug;
      if (e < 0 || e > 24) return null;
      var s = 1 << e,
          a = ge(e, t = (t % s + s) % s, r);
      if (this.tiles[a]) return le(this.tiles[a], o);
      i > 1 && console.log("drilling down to z%d-%d-%d", e, t, r);

      for (var l, u = e, h = t, c = r; !l && u > 0;) {
        u--, h = Math.floor(h / 2), c = Math.floor(c / 2), l = this.tiles[ge(u, h, c)];
      }

      return l && l.source ? (i > 1 && console.log("found parent tile z%d-%d-%d", u, h, c), i > 1 && console.time("drilling down"), this.splitTile(l.source, u, h, c, e, t, r), i > 1 && console.timeEnd("drilling down"), this.tiles[a] ? le(this.tiles[a], o) : null) : null;
    };

    var me = /*#__PURE__*/function (_e$VectorTileWorkerSo) {
      _inherits(me, _e$VectorTileWorkerSo);

      var _super98 = _createSuper(me);

      function me(e, t, r, n) {
        var _this53;

        _classCallCheck(this, me);

        _this53 = _super98.call(this, e, t, r, de), n && (_this53.loadGeoJSON = n);
        return _this53;
      }

      _createClass(me, [{
        key: "loadData",
        value: function loadData(e, t) {
          this._pendingCallback && this._pendingCallback(null, {
            abandoned: !0
          }), this._pendingCallback = t, this._pendingLoadDataParams = e, this._state && "Idle" !== this._state ? this._state = "NeedsLoadData" : (this._state = "Coalescing", this._loadData());
        }
      }, {
        key: "_loadData",
        value: function _loadData() {
          var _this54 = this;

          if (!this._pendingCallback || !this._pendingLoadDataParams) return;
          var t = this._pendingCallback,
              r = this._pendingLoadDataParams;
          delete this._pendingCallback, delete this._pendingLoadDataParams;
          var n = !!(r && r.request && r.request.collectResourceTiming) && new e.RequestPerformance(r.request);
          this.loadGeoJSON(r, function (o, i) {
            if (o || !i) return t(o);
            if ("object" != _typeof(i)) return t(new Error("Input data given to '".concat(r.source, "' is not a valid GeoJSON object.")));
            {
              !function e(t, r) {
                var n,
                    o = t && t.type;
                if ("FeatureCollection" === o) for (n = 0; n < t.features.length; n++) {
                  e(t.features[n], r);
                } else if ("GeometryCollection" === o) for (n = 0; n < t.geometries.length; n++) {
                  e(t.geometries[n], r);
                } else if ("Feature" === o) e(t.geometry, r);else if ("Polygon" === o) s(t.coordinates, r);else if ("MultiPolygon" === o) for (n = 0; n < t.coordinates.length; n++) {
                  s(t.coordinates[n], r);
                }
                return t;
              }(i, !0);

              try {
                if (r.filter) {
                  var _t224 = e.createExpression(r.filter, {
                    type: "boolean",
                    "property-type": "data-driven",
                    overridable: !1,
                    transition: !1
                  });

                  if ("error" === _t224.result) throw new Error(_t224.value.map(function (e) {
                    return "".concat(e.key, ": ").concat(e.message);
                  }).join(", "));

                  var _n117 = i.features.filter(function (e) {
                    return _t224.value.evaluate({
                      zoom: 0
                    }, e);
                  });

                  i = {
                    type: "FeatureCollection",
                    features: _n117
                  };
                }

                _this54._geoJSONIndex = r.cluster ? new z(function (_ref160) {
                  var t = _ref160.superclusterOptions,
                      r = _ref160.clusterProperties;
                  if (!r || !t) return t;
                  var n = {},
                      o = {},
                      i = {
                    accumulated: null,
                    zoom: 0
                  },
                      s = {
                    properties: null
                  },
                      a = Object.keys(r);

                  for (var _i154 = 0, _a82 = a; _i154 < _a82.length; _i154++) {
                    var _t225 = _a82[_i154];

                    var _r$_t = _slicedToArray(r[_t225], 2),
                        _i155 = _r$_t[0],
                        _s94 = _r$_t[1],
                        _a83 = e.createExpression(_s94),
                        _l36 = e.createExpression("string" == typeof _i155 ? [_i155, ["accumulated"], ["get", _t225]] : _i155);

                    n[_t225] = _a83.value, o[_t225] = _l36.value;
                  }

                  return t.map = function (e) {
                    s.properties = e;
                    var t = {};

                    var _iterator146 = _createForOfIteratorHelper(a),
                        _step146;

                    try {
                      for (_iterator146.s(); !(_step146 = _iterator146.n()).done;) {
                        var _e215 = _step146.value;
                        t[_e215] = n[_e215].evaluate(i, s);
                      }
                    } catch (err) {
                      _iterator146.e(err);
                    } finally {
                      _iterator146.f();
                    }

                    return t;
                  }, t.reduce = function (e, t) {
                    s.properties = t;

                    var _iterator147 = _createForOfIteratorHelper(a),
                        _step147;

                    try {
                      for (_iterator147.s(); !(_step147 = _iterator147.n()).done;) {
                        var _t226 = _step147.value;
                        i.accumulated = e[_t226], e[_t226] = o[_t226].evaluate(i, s);
                      }
                    } catch (err) {
                      _iterator147.e(err);
                    } finally {
                      _iterator147.f();
                    }
                  }, t;
                }(r)).load(i.features) : function (e, t) {
                  return new pe(e, t);
                }(i, r.geojsonVtOptions);
              } catch (o) {
                return t(o);
              }

              _this54.loaded = {};
              var _a81 = {};

              if (n) {
                var _e216 = n.finish();

                _e216 && (_a81.resourceTiming = {}, _a81.resourceTiming[r.source] = JSON.parse(JSON.stringify(_e216)));
              }

              t(null, _a81);
            }
          });
        }
      }, {
        key: "coalesce",
        value: function coalesce() {
          "Coalescing" === this._state ? this._state = "Idle" : "NeedsLoadData" === this._state && (this._state = "Coalescing", this._loadData());
        }
      }, {
        key: "reloadTile",
        value: function reloadTile(e, t) {
          var r = this.loaded;
          return r && r[e.uid] ? _get(_getPrototypeOf(me.prototype), "reloadTile", this).call(this, e, t) : this.loadTile(e, t);
        }
      }, {
        key: "loadGeoJSON",
        value: function loadGeoJSON(t, r) {
          if (t.request) e.getJSON(t.request, r);else {
            if ("string" != typeof t.data) return r(new Error("Input data given to '".concat(t.source, "' is not a valid GeoJSON object.")));

            try {
              return r(null, JSON.parse(t.data));
            } catch (e) {
              return r(new Error("Input data given to '".concat(t.source, "' is not a valid GeoJSON object.")));
            }
          }
        }
      }, {
        key: "removeSource",
        value: function removeSource(e, t) {
          this._pendingCallback && this._pendingCallback(null, {
            abandoned: !0
          }), t();
        }
      }, {
        key: "getClusterExpansionZoom",
        value: function getClusterExpansionZoom(e, t) {
          try {
            t(null, this._geoJSONIndex.getClusterExpansionZoom(e.clusterId));
          } catch (e) {
            t(e);
          }
        }
      }, {
        key: "getClusterChildren",
        value: function getClusterChildren(e, t) {
          try {
            t(null, this._geoJSONIndex.getChildren(e.clusterId));
          } catch (e) {
            t(e);
          }
        }
      }, {
        key: "getClusterLeaves",
        value: function getClusterLeaves(e, t) {
          try {
            t(null, this._geoJSONIndex.getLeaves(e.clusterId, e.limit, e.offset));
          } catch (e) {
            t(e);
          }
        }
      }]);

      return me;
    }(e.VectorTileWorkerSource);

    var ye = /*#__PURE__*/function () {
      function ye(t) {
        var _this55 = this;

        _classCallCheck(this, ye);

        this.self = t, this.actor = new e.Actor(t, this), this.layerIndexes = {}, this.availableImages = {}, this.workerSourceTypes = {
          vector: e.VectorTileWorkerSource,
          geojson: me
        }, this.workerSources = {}, this.demWorkerSources = {}, this.self.registerWorkerSource = function (e, t) {
          if (_this55.workerSourceTypes[e]) throw new Error("Worker source with name \"".concat(e, "\" already registered."));
          _this55.workerSourceTypes[e] = t;
        }, this.self.registerRTLTextPlugin = function (t) {
          if (e.plugin.isParsed()) throw new Error("RTL text plugin already registered.");
          e.plugin.applyArabicShaping = t.applyArabicShaping, e.plugin.processBidirectionalText = t.processBidirectionalText, e.plugin.processStyledBidirectionalText = t.processStyledBidirectionalText;
        };
      }

      _createClass(ye, [{
        key: "checkIfReady",
        value: function checkIfReady(e, t, r) {
          r();
        }
      }, {
        key: "setReferrer",
        value: function setReferrer(e, t) {
          this.referrer = t;
        }
      }, {
        key: "setImages",
        value: function setImages(e, t, r) {
          this.availableImages[e] = t;

          for (var _r202 in this.workerSources[e]) {
            var _n118 = this.workerSources[e][_r202];

            for (var _e217 in _n118) {
              _n118[_e217].availableImages = t;
            }
          }

          r();
        }
      }, {
        key: "enableTerrain",
        value: function enableTerrain(e, t, r) {
          this.terrain = t, r();
        }
      }, {
        key: "setLayers",
        value: function setLayers(e, t, r) {
          this.getLayerIndex(e).replace(t), r();
        }
      }, {
        key: "updateLayers",
        value: function updateLayers(e, t, r) {
          this.getLayerIndex(e).update(t.layers, t.removedIds), r();
        }
      }, {
        key: "loadTile",
        value: function loadTile(t, r, n) {
          var o = this.enableTerrain ? e.extend({
            enableTerrain: this.terrain
          }, r) : r;
          this.getWorkerSource(t, r.type, r.source).loadTile(o, n);
        }
      }, {
        key: "loadDEMTile",
        value: function loadDEMTile(t, r, n) {
          var o = this.enableTerrain ? e.extend({
            buildQuadTree: this.terrain
          }, r) : r;
          this.getDEMWorkerSource(t, r.source).loadTile(o, n);
        }
      }, {
        key: "reloadTile",
        value: function reloadTile(t, r, n) {
          var o = this.enableTerrain ? e.extend({
            enableTerrain: this.terrain
          }, r) : r;
          this.getWorkerSource(t, r.type, r.source).reloadTile(o, n);
        }
      }, {
        key: "abortTile",
        value: function abortTile(e, t, r) {
          this.getWorkerSource(e, t.type, t.source).abortTile(t, r);
        }
      }, {
        key: "removeTile",
        value: function removeTile(e, t, r) {
          this.getWorkerSource(e, t.type, t.source).removeTile(t, r);
        }
      }, {
        key: "removeSource",
        value: function removeSource(e, t, r) {
          if (!this.workerSources[e] || !this.workerSources[e][t.type] || !this.workerSources[e][t.type][t.source]) return;
          var n = this.workerSources[e][t.type][t.source];
          delete this.workerSources[e][t.type][t.source], void 0 !== n.removeSource ? n.removeSource(t, r) : r();
        }
      }, {
        key: "loadWorkerSource",
        value: function loadWorkerSource(e, t, r) {
          try {
            this.self.importScripts(t.url), r();
          } catch (e) {
            r(e.toString());
          }
        }
      }, {
        key: "syncRTLPluginState",
        value: function syncRTLPluginState(t, r, n) {
          try {
            e.plugin.setState(r);

            var _t227 = e.plugin.getPluginURL();

            if (e.plugin.isLoaded() && !e.plugin.isParsed() && null != _t227) {
              this.self.importScripts(_t227);

              var _r203 = e.plugin.isParsed();

              n(_r203 ? void 0 : new Error("RTL Text Plugin failed to import scripts from ".concat(_t227)), _r203);
            }
          } catch (e) {
            n(e.toString());
          }
        }
      }, {
        key: "getAvailableImages",
        value: function getAvailableImages(e) {
          var t = this.availableImages[e];
          return t || (t = []), t;
        }
      }, {
        key: "getLayerIndex",
        value: function getLayerIndex(e) {
          var t = this.layerIndexes[e];
          return t || (t = this.layerIndexes[e] = new n()), t;
        }
      }, {
        key: "getWorkerSource",
        value: function getWorkerSource(e, t, r) {
          var _this56 = this;

          return this.workerSources[e] || (this.workerSources[e] = {}), this.workerSources[e][t] || (this.workerSources[e][t] = {}), this.workerSources[e][t][r] || (this.workerSources[e][t][r] = new this.workerSourceTypes[t]({
            send: function send(t, r, n, o, i, s) {
              _this56.actor.send(t, r, n, e, o, s);
            },
            scheduler: this.actor.scheduler
          }, this.getLayerIndex(e), this.getAvailableImages(e))), this.workerSources[e][t][r];
        }
      }, {
        key: "getDEMWorkerSource",
        value: function getDEMWorkerSource(e, t) {
          return this.demWorkerSources[e] || (this.demWorkerSources[e] = {}), this.demWorkerSources[e][t] || (this.demWorkerSources[e][t] = new i()), this.demWorkerSources[e][t];
        }
      }, {
        key: "enforceCacheSizeLimit",
        value: function enforceCacheSizeLimit(t, r) {
          e.enforceCacheSizeLimit(r);
        }
      }, {
        key: "getWorkerPerformanceMetrics",
        value: function getWorkerPerformanceMetrics(e, t, r) {
          r(void 0, void 0);
        }
      }]);

      return ye;
    }();

    return "undefined" != typeof WorkerGlobalScope && "undefined" != typeof self && self instanceof WorkerGlobalScope && (self.worker = new ye(self)), ye;
  });
  define(["./shared"], function (t) {
    "use strict";

    var e = i;

    function i(t) {
      return !function (t) {
        return "undefined" == typeof window || "undefined" == typeof document ? "not a browser" : Array.prototype && Array.prototype.every && Array.prototype.filter && Array.prototype.forEach && Array.prototype.indexOf && Array.prototype.lastIndexOf && Array.prototype.map && Array.prototype.some && Array.prototype.reduce && Array.prototype.reduceRight && Array.isArray ? Function.prototype && Function.prototype.bind ? Object.keys && Object.create && Object.getPrototypeOf && Object.getOwnPropertyNames && Object.isSealed && Object.isFrozen && Object.isExtensible && Object.getOwnPropertyDescriptor && Object.defineProperty && Object.defineProperties && Object.seal && Object.freeze && Object.preventExtensions ? "JSON" in window && "parse" in JSON && "stringify" in JSON ? function () {
          if (!("Worker" in window && "Blob" in window && "URL" in window)) return !1;
          var t,
              e,
              i = new Blob([""], {
            type: "text/javascript"
          }),
              o = URL.createObjectURL(i);

          try {
            e = new Worker(o), t = !0;
          } catch (e) {
            t = !1;
          }

          return e && e.terminate(), URL.revokeObjectURL(o), t;
        }() ? "Uint8ClampedArray" in window ? ArrayBuffer.isView ? function () {
          var t = document.createElement("canvas");
          t.width = t.height = 1;
          var e = t.getContext("2d");
          if (!e) return !1;
          var i = e.getImageData(0, 0, 1, 1);
          return i && i.width === t.width;
        }() ? (void 0 === o[e = t && t.failIfMajorPerformanceCaveat] && (o[e] = function (t) {
          var e,
              o = function (t) {
            var e = document.createElement("canvas"),
                o = Object.create(i.webGLContextAttributes);
            return o.failIfMajorPerformanceCaveat = t, e.getContext("webgl", o) || e.getContext("experimental-webgl", o);
          }(t);

          if (!o) return !1;

          try {
            e = o.createShader(o.VERTEX_SHADER);
          } catch (t) {
            return !1;
          }

          return !(!e || o.isContextLost()) && (o.shaderSource(e, "void main() {}"), o.compileShader(e), !0 === o.getShaderParameter(e, o.COMPILE_STATUS));
        }(e)), o[e] ? document.documentMode ? "insufficient ECMAScript 6 support" : void 0 : "insufficient WebGL support") : "insufficient Canvas/getImageData support" : "insufficient ArrayBuffer support" : "insufficient Uint8ClampedArray support" : "insufficient worker support" : "insufficient JSON support" : "insufficient Object support" : "insufficient Function support" : "insufficent Array support";
        var e;
      }(t);
    }

    var o = {};
    i.webGLContextAttributes = {
      antialias: !1,
      alpha: !0,
      stencil: !0,
      depth: !0
    };
    var a = {
      create: function create(e, i, o) {
        var a = t.window.document.createElement(e);
        return void 0 !== i && (a.className = i), o && o.appendChild(a), a;
      },
      createNS: function createNS(e, i) {
        return t.window.document.createElementNS(e, i);
      }
    },
        r = t.window.document && t.window.document.documentElement.style,
        n = r && void 0 !== r.userSelect ? "userSelect" : "WebkitUserSelect";
    var s;
    a.disableDrag = function () {
      r && n && (s = r[n], r[n] = "none");
    }, a.enableDrag = function () {
      r && n && (r[n] = s);
    }, a.setTransform = function (t, e) {
      t.style.transform = e;
    };
    var l = !1;

    try {
      var _e218 = Object.defineProperty({}, "passive", {
        get: function get() {
          l = !0;
        }
      });

      t.window.addEventListener("test", _e218, _e218), t.window.removeEventListener("test", _e218, _e218);
    } catch (t) {
      l = !1;
    }

    a.addEventListener = function (t, e, i) {
      var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
      t.addEventListener(e, i, "passive" in o && l ? o : o.capture);
    }, a.removeEventListener = function (t, e, i) {
      var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
      t.removeEventListener(e, i, "passive" in o && l ? o : o.capture);
    };

    var c = function c(e) {
      e.preventDefault(), e.stopPropagation(), t.window.removeEventListener("click", c, !0);
    };

    function h(t) {
      var e = t.userImage;
      return !!(e && e.render && e.render()) && (t.data.replace(new Uint8Array(e.data.buffer)), !0);
    }

    a.suppressClick = function () {
      t.window.addEventListener("click", c, !0), t.window.setTimeout(function () {
        t.window.removeEventListener("click", c, !0);
      }, 0);
    }, a.mousePos = function (e, i) {
      var o = e.getBoundingClientRect();
      return new t.Point(i.clientX - o.left - e.clientLeft, i.clientY - o.top - e.clientTop);
    }, a.touchPos = function (e, i) {
      var o = e.getBoundingClientRect(),
          a = [];

      for (var _r204 = 0; _r204 < i.length; _r204++) {
        a.push(new t.Point(i[_r204].clientX - o.left - e.clientLeft, i[_r204].clientY - o.top - e.clientTop));
      }

      return a;
    }, a.mouseButton = function (e) {
      return void 0 !== t.window.InstallTrigger && 2 === e.button && e.ctrlKey && t.window.navigator.platform.toUpperCase().indexOf("MAC") >= 0 ? 0 : e.button;
    }, a.remove = function (t) {
      t.parentNode && t.parentNode.removeChild(t);
    };

    var u = /*#__PURE__*/function (_t$Evented) {
      _inherits(u, _t$Evented);

      var _super99 = _createSuper(u);

      function u() {
        var _this57;

        _classCallCheck(this, u);

        _this57 = _super99.call(this), _this57.images = {}, _this57.updatedImages = {}, _this57.callbackDispatchedThisFrame = {}, _this57.loaded = !1, _this57.requestors = [], _this57.patterns = {}, _this57.atlasImage = new t.RGBAImage({
          width: 1,
          height: 1
        }), _this57.dirty = !0;
        return _this57;
      }

      _createClass(u, [{
        key: "isLoaded",
        value: function isLoaded() {
          return this.loaded;
        }
      }, {
        key: "setLoaded",
        value: function setLoaded(t) {
          if (this.loaded !== t && (this.loaded = t, t)) {
            var _iterator148 = _createForOfIteratorHelper(this.requestors),
                _step148;

            try {
              for (_iterator148.s(); !(_step148 = _iterator148.n()).done;) {
                var _ref162 = _step148.value;
                var _t228 = _ref162.ids;
                var _e219 = _ref162.callback;

                this._notify(_t228, _e219);
              }
            } catch (err) {
              _iterator148.e(err);
            } finally {
              _iterator148.f();
            }

            this.requestors = [];
          }
        }
      }, {
        key: "getImage",
        value: function getImage(t) {
          return this.images[t];
        }
      }, {
        key: "addImage",
        value: function addImage(t, e) {
          this._validate(t, e) && (this.images[t] = e);
        }
      }, {
        key: "_validate",
        value: function _validate(e, i) {
          var o = !0;
          return this._validateStretch(i.stretchX, i.data && i.data.width) || (this.fire(new t.ErrorEvent(new Error("Image \"".concat(e, "\" has invalid \"stretchX\" value")))), o = !1), this._validateStretch(i.stretchY, i.data && i.data.height) || (this.fire(new t.ErrorEvent(new Error("Image \"".concat(e, "\" has invalid \"stretchY\" value")))), o = !1), this._validateContent(i.content, i) || (this.fire(new t.ErrorEvent(new Error("Image \"".concat(e, "\" has invalid \"content\" value")))), o = !1), o;
        }
      }, {
        key: "_validateStretch",
        value: function _validateStretch(t, e) {
          if (!t) return !0;
          var i = 0;

          var _iterator149 = _createForOfIteratorHelper(t),
              _step149;

          try {
            for (_iterator149.s(); !(_step149 = _iterator149.n()).done;) {
              var _o48 = _step149.value;
              if (_o48[0] < i || _o48[1] < _o48[0] || e < _o48[1]) return !1;
              i = _o48[1];
            }
          } catch (err) {
            _iterator149.e(err);
          } finally {
            _iterator149.f();
          }

          return !0;
        }
      }, {
        key: "_validateContent",
        value: function _validateContent(t, e) {
          return !(t && (4 !== t.length || t[0] < 0 || e.data.width < t[0] || t[1] < 0 || e.data.height < t[1] || t[2] < 0 || e.data.width < t[2] || t[3] < 0 || e.data.height < t[3] || t[2] < t[0] || t[3] < t[1]));
        }
      }, {
        key: "updateImage",
        value: function updateImage(t, e) {
          e.version = this.images[t].version + 1, this.images[t] = e, this.updatedImages[t] = !0;
        }
      }, {
        key: "removeImage",
        value: function removeImage(t) {
          var e = this.images[t];
          delete this.images[t], delete this.patterns[t], e.userImage && e.userImage.onRemove && e.userImage.onRemove();
        }
      }, {
        key: "listImages",
        value: function listImages() {
          return Object.keys(this.images);
        }
      }, {
        key: "getImages",
        value: function getImages(t, e) {
          var i = !0;

          if (!this.isLoaded()) {
            var _iterator150 = _createForOfIteratorHelper(t),
                _step150;

            try {
              for (_iterator150.s(); !(_step150 = _iterator150.n()).done;) {
                var _e220 = _step150.value;
                this.images[_e220] || (i = !1);
              }
            } catch (err) {
              _iterator150.e(err);
            } finally {
              _iterator150.f();
            }
          }

          this.isLoaded() || i ? this._notify(t, e) : this.requestors.push({
            ids: t,
            callback: e
          });
        }
      }, {
        key: "_notify",
        value: function _notify(e, i) {
          var o = {};

          var _iterator151 = _createForOfIteratorHelper(e),
              _step151;

          try {
            for (_iterator151.s(); !(_step151 = _iterator151.n()).done;) {
              var _i156 = _step151.value;
              this.images[_i156] || this.fire(new t.Event("styleimagemissing", {
                id: _i156
              }));
              var _e221 = this.images[_i156];
              _e221 ? o[_i156] = {
                data: _e221.data.clone(),
                pixelRatio: _e221.pixelRatio,
                sdf: _e221.sdf,
                version: _e221.version,
                stretchX: _e221.stretchX,
                stretchY: _e221.stretchY,
                content: _e221.content,
                hasRenderCallback: Boolean(_e221.userImage && _e221.userImage.render)
              } : t.warnOnce("Image \"".concat(_i156, "\" could not be loaded. Please make sure you have added the image with map.addImage() or a \"sprite\" property in your style. You can provide missing images by listening for the \"styleimagemissing\" map event."));
            }
          } catch (err) {
            _iterator151.e(err);
          } finally {
            _iterator151.f();
          }

          i(null, o);
        }
      }, {
        key: "getPixelSize",
        value: function getPixelSize() {
          var _this$atlasImage = this.atlasImage,
              t = _this$atlasImage.width,
              e = _this$atlasImage.height;
          return {
            width: t,
            height: e
          };
        }
      }, {
        key: "getPattern",
        value: function getPattern(e) {
          var i = this.patterns[e],
              o = this.getImage(e);
          if (!o) return null;
          if (i && i.position.version === o.version) return i.position;
          if (i) i.position.version = o.version;else {
            var _i157 = {
              w: o.data.width + 2,
              h: o.data.height + 2,
              x: 0,
              y: 0
            },
                _a84 = new t.ImagePosition(_i157, o);

            this.patterns[e] = {
              bin: _i157,
              position: _a84
            };
          }
          return this._updatePatternAtlas(), this.patterns[e].position;
        }
      }, {
        key: "bind",
        value: function bind(e) {
          var i = e.gl;
          this.atlasTexture ? this.dirty && (this.atlasTexture.update(this.atlasImage), this.dirty = !1) : this.atlasTexture = new t.Texture(e, this.atlasImage, i.RGBA), this.atlasTexture.bind(i.LINEAR, i.CLAMP_TO_EDGE);
        }
      }, {
        key: "_updatePatternAtlas",
        value: function _updatePatternAtlas() {
          var e = [];

          for (var _t229 in this.patterns) {
            e.push(this.patterns[_t229].bin);
          }

          var _t$potpack = t.potpack(e),
              i = _t$potpack.w,
              o = _t$potpack.h,
              a = this.atlasImage;

          a.resize({
            width: i || 1,
            height: o || 1
          });

          for (var _e222 in this.patterns) {
            var _i158 = this.patterns[_e222].bin,
                _o49 = _i158.x + 1,
                _r205 = _i158.y + 1,
                _n119 = this.images[_e222].data,
                _s95 = _n119.width,
                _l37 = _n119.height;

            t.RGBAImage.copy(_n119, a, {
              x: 0,
              y: 0
            }, {
              x: _o49,
              y: _r205
            }, {
              width: _s95,
              height: _l37
            }), t.RGBAImage.copy(_n119, a, {
              x: 0,
              y: _l37 - 1
            }, {
              x: _o49,
              y: _r205 - 1
            }, {
              width: _s95,
              height: 1
            }), t.RGBAImage.copy(_n119, a, {
              x: 0,
              y: 0
            }, {
              x: _o49,
              y: _r205 + _l37
            }, {
              width: _s95,
              height: 1
            }), t.RGBAImage.copy(_n119, a, {
              x: _s95 - 1,
              y: 0
            }, {
              x: _o49 - 1,
              y: _r205
            }, {
              width: 1,
              height: _l37
            }), t.RGBAImage.copy(_n119, a, {
              x: 0,
              y: 0
            }, {
              x: _o49 + _s95,
              y: _r205
            }, {
              width: 1,
              height: _l37
            });
          }

          this.dirty = !0;
        }
      }, {
        key: "beginFrame",
        value: function beginFrame() {
          this.callbackDispatchedThisFrame = {};
        }
      }, {
        key: "dispatchRenderCallbacks",
        value: function dispatchRenderCallbacks(t) {
          var _iterator152 = _createForOfIteratorHelper(t),
              _step152;

          try {
            for (_iterator152.s(); !(_step152 = _iterator152.n()).done;) {
              var _e223 = _step152.value;
              if (this.callbackDispatchedThisFrame[_e223]) continue;
              this.callbackDispatchedThisFrame[_e223] = !0;
              var _t230 = this.images[_e223];
              h(_t230) && this.updateImage(_e223, _t230);
            }
          } catch (err) {
            _iterator152.e(err);
          } finally {
            _iterator152.f();
          }
        }
      }]);

      return u;
    }(t.Evented);

    var d = p,
        _ = p,
        m = 1e20;

    function p(t, e, i, o, a, r) {
      this.fontSize = t || 24, this.buffer = void 0 === e ? 3 : e, this.cutoff = o || .25, this.fontFamily = a || "sans-serif", this.fontWeight = r || "normal", this.radius = i || 8;
      var n = this.size = this.fontSize + 2 * this.buffer;
      this.canvas = document.createElement("canvas"), this.canvas.width = this.canvas.height = n, this.ctx = this.canvas.getContext("2d"), this.ctx.font = this.fontWeight + " " + this.fontSize + "px " + this.fontFamily, this.ctx.textBaseline = "middle", this.ctx.fillStyle = "black", this.gridOuter = new Float64Array(n * n), this.gridInner = new Float64Array(n * n), this.f = new Float64Array(n), this.d = new Float64Array(n), this.z = new Float64Array(n + 1), this.v = new Int16Array(n), this.middle = Math.round(n / 2 * (navigator.userAgent.indexOf("Gecko/") >= 0 ? 1.2 : 1));
    }

    function f(t, e, i, o, a, r, n) {
      for (var s = 0; s < e; s++) {
        for (var l = 0; l < i; l++) {
          o[l] = t[l * e + s];
        }

        for (g(o, a, r, n, i), l = 0; l < i; l++) {
          t[l * e + s] = a[l];
        }
      }

      for (l = 0; l < i; l++) {
        for (s = 0; s < e; s++) {
          o[s] = t[l * e + s];
        }

        for (g(o, a, r, n, e), s = 0; s < e; s++) {
          t[l * e + s] = Math.sqrt(a[s]);
        }
      }
    }

    function g(t, e, i, o, a) {
      i[0] = 0, o[0] = -m, o[1] = +m;

      for (var r = 1, n = 0; r < a; r++) {
        for (var s = (t[r] + r * r - (t[i[n]] + i[n] * i[n])) / (2 * r - 2 * i[n]); s <= o[n];) {
          n--, s = (t[r] + r * r - (t[i[n]] + i[n] * i[n])) / (2 * r - 2 * i[n]);
        }

        i[++n] = r, o[n] = s, o[n + 1] = +m;
      }

      for (r = 0, n = 0; r < a; r++) {
        for (; o[n + 1] < r;) {
          n++;
        }

        e[r] = (r - i[n]) * (r - i[n]) + t[i[n]];
      }
    }

    p.prototype.draw = function (t) {
      this.ctx.clearRect(0, 0, this.size, this.size), this.ctx.fillText(t, this.buffer, this.middle);

      for (var e = this.ctx.getImageData(0, 0, this.size, this.size), i = new Uint8ClampedArray(this.size * this.size), o = 0; o < this.size * this.size; o++) {
        var a = e.data[4 * o + 3] / 255;
        this.gridOuter[o] = 1 === a ? 0 : 0 === a ? m : Math.pow(Math.max(0, .5 - a), 2), this.gridInner[o] = 1 === a ? m : 0 === a ? 0 : Math.pow(Math.max(0, a - .5), 2);
      }

      for (f(this.gridOuter, this.size, this.size, this.f, this.d, this.v, this.z), f(this.gridInner, this.size, this.size, this.f, this.d, this.v, this.z), o = 0; o < this.size * this.size; o++) {
        i[o] = Math.max(0, Math.min(255, Math.round(255 - 255 * ((this.gridOuter[o] - this.gridInner[o]) / this.radius + this.cutoff))));
      }

      return i;
    }, d["default"] = _;

    var v = /*#__PURE__*/function () {
      function v(t, e) {
        _classCallCheck(this, v);

        this.requestManager = t, this.localIdeographFontFamily = e, this.entries = {};
      }

      _createClass(v, [{
        key: "setURL",
        value: function setURL(t) {
          this.url = t;
        }
      }, {
        key: "getGlyphs",
        value: function getGlyphs(e, i) {
          var _this58 = this;

          var o = [];

          for (var _t231 in e) {
            var _iterator153 = _createForOfIteratorHelper(e[_t231]),
                _step153;

            try {
              for (_iterator153.s(); !(_step153 = _iterator153.n()).done;) {
                var _i159 = _step153.value;
                o.push({
                  stack: _t231,
                  id: _i159
                });
              }
            } catch (err) {
              _iterator153.e(err);
            } finally {
              _iterator153.f();
            }
          }

          t.asyncAll(o, function (_ref163, i) {
            var t = _ref163.stack,
                e = _ref163.id;
            var o = _this58.entries[t];
            o || (o = _this58.entries[t] = {
              glyphs: {},
              requests: {},
              ranges: {}
            });
            var a = o.glyphs[e];
            if (void 0 !== a) return void i(null, {
              stack: t,
              id: e,
              glyph: a
            });
            if (a = _this58._tinySDF(o, t, e), a) return o.glyphs[e] = a, void i(null, {
              stack: t,
              id: e,
              glyph: a
            });
            var r = Math.floor(e / 256);
            if (256 * r > 65535) return void i(new Error("glyphs > 65535 not supported"));
            if (o.ranges[r]) return void i(null, {
              stack: t,
              id: e,
              glyph: a
            });
            var n = o.requests[r];
            n || (n = o.requests[r] = [], v.loadGlyphRange(t, r, _this58.url, _this58.requestManager, function (t, e) {
              if (e) {
                for (var _t232 in e) {
                  _this58._doesCharSupportLocalGlyph(+_t232) || (o.glyphs[+_t232] = e[+_t232]);
                }

                o.ranges[r] = !0;
              }

              var _iterator154 = _createForOfIteratorHelper(n),
                  _step154;

              try {
                for (_iterator154.s(); !(_step154 = _iterator154.n()).done;) {
                  var _i160 = _step154.value;

                  _i160(t, e);
                }
              } catch (err) {
                _iterator154.e(err);
              } finally {
                _iterator154.f();
              }

              delete o.requests[r];
            })), n.push(function (o, a) {
              o ? i(o) : a && i(null, {
                stack: t,
                id: e,
                glyph: a[e] || null
              });
            });
          }, function (t, e) {
            if (t) i(t);else if (e) {
              var _t233 = {};

              var _iterator155 = _createForOfIteratorHelper(e),
                  _step155;

              try {
                for (_iterator155.s(); !(_step155 = _iterator155.n()).done;) {
                  var _ref165 = _step155.value;
                  var _i161 = _ref165.stack;
                  var _o50 = _ref165.id;
                  var _a85 = _ref165.glyph;
                  (_t233[_i161] || (_t233[_i161] = {}))[_o50] = _a85 && {
                    id: _a85.id,
                    bitmap: _a85.bitmap.clone(),
                    metrics: _a85.metrics
                  };
                }
              } catch (err) {
                _iterator155.e(err);
              } finally {
                _iterator155.f();
              }

              i(null, _t233);
            }
          });
        }
      }, {
        key: "_doesCharSupportLocalGlyph",
        value: function _doesCharSupportLocalGlyph(e) {
          return !!this.localIdeographFontFamily && (t.isChar["CJK Unified Ideographs"](e) || t.isChar["Hangul Syllables"](e) || t.isChar.Hiragana(e) || t.isChar.Katakana(e));
        }
      }, {
        key: "_tinySDF",
        value: function _tinySDF(e, i, o) {
          var a = this.localIdeographFontFamily;
          if (!a) return;
          if (!this._doesCharSupportLocalGlyph(o)) return;
          var r = e.tinySDF;

          if (!r) {
            var _t234 = "400";
            /bold/i.test(i) ? _t234 = "900" : /medium/i.test(i) ? _t234 = "500" : /light/i.test(i) && (_t234 = "200"), r = e.tinySDF = new v.TinySDF(24, 3, 8, .25, a, _t234);
          }

          return {
            id: o,
            bitmap: new t.AlphaImage({
              width: 30,
              height: 30
            }, r.draw(String.fromCharCode(o))),
            metrics: {
              width: 24,
              height: 24,
              left: 0,
              top: -8,
              advance: 24
            }
          };
        }
      }]);

      return v;
    }();

    v.loadGlyphRange = function (e, i, o, a, r) {
      var n = 256 * i,
          s = n + 255,
          l = a.transformRequest(a.normalizeGlyphsURL(o).replace("{fontstack}", e).replace("{range}", "".concat(n, "-").concat(s)), t.ResourceType.Glyphs);
      t.getArrayBuffer(l, function (e, i) {
        if (e) r(e);else if (i) {
          var _e224 = {};

          var _iterator156 = _createForOfIteratorHelper(t.parseGlyphPBF(i)),
              _step156;

          try {
            for (_iterator156.s(); !(_step156 = _iterator156.n()).done;) {
              var _o51 = _step156.value;
              _e224[_o51.id] = _o51;
            }
          } catch (err) {
            _iterator156.e(err);
          } finally {
            _iterator156.f();
          }

          r(null, _e224);
        }
      });
    }, v.TinySDF = d;
    var x = new t.Properties({
      anchor: new t.DataConstantProperty(t.styleSpec.light.anchor),
      position: new ( /*#__PURE__*/function () {
        function _class17() {
          _classCallCheck(this, _class17);

          this.specification = t.styleSpec.light.position;
        }

        _createClass(_class17, [{
          key: "possiblyEvaluate",
          value: function possiblyEvaluate(e, i) {
            return function (_ref166) {
              var _ref167 = _slicedToArray(_ref166, 3),
                  e = _ref167[0],
                  i = _ref167[1],
                  o = _ref167[2];

              var a = t.degToRad(i + 90),
                  r = t.degToRad(o);
              return {
                x: e * Math.cos(a) * Math.sin(r),
                y: e * Math.sin(a) * Math.sin(r),
                z: e * Math.cos(r),
                azimuthal: i,
                polar: o
              };
            }(e.expression.evaluate(i));
          }
        }, {
          key: "interpolate",
          value: function interpolate(e, i, o) {
            return {
              x: t.number(e.x, i.x, o),
              y: t.number(e.y, i.y, o),
              z: t.number(e.z, i.z, o),
              azimuthal: t.number(e.azimuthal, i.azimuthal, o),
              polar: t.number(e.polar, i.polar, o)
            };
          }
        }]);

        return _class17;
      }())(),
      color: new t.DataConstantProperty(t.styleSpec.light.color),
      intensity: new t.DataConstantProperty(t.styleSpec.light.intensity)
    });

    var y = /*#__PURE__*/function (_t$Evented2) {
      _inherits(y, _t$Evented2);

      var _super100 = _createSuper(y);

      function y(e) {
        var _this59;

        _classCallCheck(this, y);

        _this59 = _super100.call(this), _this59._transitionable = new t.Transitionable(x), _this59.setLight(e), _this59._transitioning = _this59._transitionable.untransitioned();
        return _this59;
      }

      _createClass(y, [{
        key: "getLight",
        value: function getLight() {
          return this._transitionable.serialize();
        }
      }, {
        key: "setLight",
        value: function setLight(e) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
          if (!this._validate(t.validateLight, e, i)) for (var _i162 in e) {
            var _o52 = e[_i162];
            t.endsWith(_i162, "-transition") ? this._transitionable.setTransition(_i162.slice(0, -"-transition".length), _o52) : this._transitionable.setValue(_i162, _o52);
          }
        }
      }, {
        key: "updateTransitions",
        value: function updateTransitions(t) {
          this._transitioning = this._transitionable.transitioned(t, this._transitioning);
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return this._transitioning.hasTransition();
        }
      }, {
        key: "recalculate",
        value: function recalculate(t) {
          this.properties = this._transitioning.possiblyEvaluate(t);
        }
      }, {
        key: "_validate",
        value: function _validate(e, i, o) {
          return (!o || !1 !== o.validate) && t.emitValidationErrors(this, e.call(t.validateStyle, t.extend({
            value: i,
            style: {
              glyphs: !0,
              sprite: !0
            },
            styleSpec: t.styleSpec
          })));
        }
      }]);

      return y;
    }(t.Evented);

    var b = new t.Properties({
      source: new t.DataConstantProperty(t.styleSpec.terrain.source),
      exaggeration: new t.DataConstantProperty(t.styleSpec.terrain.exaggeration)
    });

    var w = /*#__PURE__*/function (_t$Evented3) {
      _inherits(w, _t$Evented3);

      var _super101 = _createSuper(w);

      function w(e) {
        var _this60;

        _classCallCheck(this, w);

        _this60 = _super101.call(this), _this60._transitionable = new t.Transitionable(b), _this60.set(e), _this60._transitioning = _this60._transitionable.untransitioned();
        return _this60;
      }

      _createClass(w, [{
        key: "get",
        value: function get() {
          return this._transitionable.serialize();
        }
      }, {
        key: "set",
        value: function set(e) {
          for (var _i163 in e) {
            var _o53 = e[_i163];
            t.endsWith(_i163, "-transition") ? this._transitionable.setTransition(_i163.slice(0, -"-transition".length), _o53) : this._transitionable.setValue(_i163, _o53);
          }
        }
      }, {
        key: "updateTransitions",
        value: function updateTransitions(t) {
          this._transitioning = this._transitionable.transitioned(t, this._transitioning);
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return this._transitioning.hasTransition();
        }
      }, {
        key: "recalculate",
        value: function recalculate(t) {
          this.properties = this._transitioning.possiblyEvaluate(t);
        }
      }]);

      return w;
    }(t.Evented);

    var T = /*#__PURE__*/function () {
      function T(t, e) {
        _classCallCheck(this, T);

        this.width = t, this.height = e, this.nextRow = 0, this.data = new Uint8Array(this.width * this.height), this.dashEntry = {};
      }

      _createClass(T, [{
        key: "getDash",
        value: function getDash(t, e) {
          var i = t.join(",") + String(e);
          return this.dashEntry[i] || (this.dashEntry[i] = this.addDash(t, e)), this.dashEntry[i];
        }
      }, {
        key: "getDashRanges",
        value: function getDashRanges(t, e, i) {
          var o = [];
          var a = t.length % 2 == 1 ? -t[t.length - 1] * i : 0,
              r = t[0] * i,
              n = !0;
          o.push({
            left: a,
            right: r,
            isDash: n,
            zeroLength: 0 === t[0]
          });
          var s = t[0];

          for (var _e225 = 1; _e225 < t.length; _e225++) {
            n = !n;
            var _l38 = t[_e225];
            a = s * i, s += _l38, r = s * i, o.push({
              left: a,
              right: r,
              isDash: n,
              zeroLength: 0 === _l38
            });
          }

          return o;
        }
      }, {
        key: "addRoundDash",
        value: function addRoundDash(t, e, i) {
          var o = e / 2;

          for (var _e226 = -i; _e226 <= i; _e226++) {
            var _a86 = this.width * (this.nextRow + i + _e226);

            var _r206 = 0,
                _n120 = t[_r206];

            for (var _s96 = 0; _s96 < this.width; _s96++) {
              _s96 / _n120.right > 1 && (_n120 = t[++_r206]);

              var _l39 = Math.abs(_s96 - _n120.left),
                  _c25 = Math.abs(_s96 - _n120.right),
                  _h15 = Math.min(_l39, _c25);

              var _u34 = void 0;

              var _d12 = _e226 / i * (o + 1);

              if (_n120.isDash) {
                var _t235 = o - Math.abs(_d12);

                _u34 = Math.sqrt(_h15 * _h15 + _t235 * _t235);
              } else _u34 = o - Math.sqrt(_h15 * _h15 + _d12 * _d12);

              this.data[_a86 + _s96] = Math.max(0, Math.min(255, _u34 + 128));
            }
          }
        }
      }, {
        key: "addRegularDash",
        value: function addRegularDash(t) {
          for (var _e227 = t.length - 1; _e227 >= 0; --_e227) {
            var _i164 = t[_e227],
                _o54 = t[_e227 + 1];
            _i164.zeroLength ? t.splice(_e227, 1) : _o54 && _o54.isDash === _i164.isDash && (_o54.left = _i164.left, t.splice(_e227, 1));
          }

          var e = t[0],
              i = t[t.length - 1];
          e.isDash === i.isDash && (e.left = i.left - this.width, i.right = e.right + this.width);
          var o = this.width * this.nextRow;
          var a = 0,
              r = t[a];

          for (var _e228 = 0; _e228 < this.width; _e228++) {
            _e228 / r.right > 1 && (r = t[++a]);

            var _i165 = Math.abs(_e228 - r.left),
                _n121 = Math.abs(_e228 - r.right),
                _s97 = Math.min(_i165, _n121);

            this.data[o + _e228] = Math.max(0, Math.min(255, (r.isDash ? _s97 : -_s97) + 128));
          }
        }
      }, {
        key: "addDash",
        value: function addDash(e, i) {
          var o = i ? 7 : 0,
              a = 2 * o + 1;
          if (this.nextRow + a > this.height) return t.warnOnce("LineAtlas out of space"), null;
          0 === e.length && e.push(1);
          var r = 0;

          for (var _i166 = 0; _i166 < e.length; _i166++) {
            e[_i166] < 0 && (t.warnOnce("Negative value is found in line dasharray, replacing values with 0"), e[_i166] = 0), r += e[_i166];
          }

          if (0 !== r) {
            var _t236 = this.width / r,
                _a87 = this.getDashRanges(e, this.width, _t236);

            i ? this.addRoundDash(_a87, _t236, o) : this.addRegularDash(_a87);
          }

          var n = {
            y: (this.nextRow + o + .5) / this.height,
            height: 2 * o / this.height,
            width: r
          };
          return this.nextRow += a, this.dirty = !0, n;
        }
      }, {
        key: "bind",
        value: function bind(t) {
          var e = t.gl;
          this.texture ? (e.bindTexture(e.TEXTURE_2D, this.texture), this.dirty && (this.dirty = !1, e.texSubImage2D(e.TEXTURE_2D, 0, 0, 0, this.width, this.height, e.ALPHA, e.UNSIGNED_BYTE, this.data))) : (this.texture = e.createTexture(), e.bindTexture(e.TEXTURE_2D, this.texture), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_S, e.REPEAT), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_T, e.REPEAT), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, e.LINEAR), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, e.LINEAR), e.texImage2D(e.TEXTURE_2D, 0, e.ALPHA, this.width, this.height, 0, e.ALPHA, e.UNSIGNED_BYTE, this.data));
        }
      }]);

      return T;
    }();

    var E = /*#__PURE__*/function () {
      function E(e, i) {
        var _this61 = this;

        _classCallCheck(this, E);

        this.workerPool = e, this.actors = [], this.currentActor = 0, this.id = t.uniqueId();
        var o = this.workerPool.acquire(this.id);

        for (var _t237 = 0; _t237 < o.length; _t237++) {
          var _e229 = new E.Actor(o[_t237], i, this.id);

          _e229.name = "Worker ".concat(_t237), this.actors.push(_e229);
        }

        this.ready = !1, this.broadcast("checkIfReady", null, function () {
          _this61.ready = !0;
        });
      }

      _createClass(E, [{
        key: "broadcast",
        value: function broadcast(e, i, o) {
          t.asyncAll(this.actors, function (t, o) {
            t.send(e, i, o);
          }, o = o || function () {});
        }
      }, {
        key: "getActor",
        value: function getActor() {
          return this.currentActor = (this.currentActor + 1) % this.actors.length, this.actors[this.currentActor];
        }
      }, {
        key: "remove",
        value: function remove() {
          this.actors.forEach(function (t) {
            t.remove();
          }), this.actors = [], this.workerPool.release(this.id);
        }
      }]);

      return E;
    }();

    function C(e, i, o) {
      return i * (t.EXTENT / (e.tileSize * Math.pow(2, o - e.tileID.overscaledZ)));
    }

    E.Actor = t.Actor;

    var S = /*#__PURE__*/function () {
      function S(t, e, i, o) {
        _classCallCheck(this, S);

        this.screenBounds = t, this.cameraPoint = e, this._screenRaycastCache = {}, this._cameraRaycastCache = {}, this.isAboveHorizon = i, this.screenGeometry = this.bufferedScreenGeometry(0), this.screenGeometryMercator = this.screenGeometry.map(function (t) {
          return o.pointCoordinate3D(t);
        }), this.cameraGeometry = this.bufferedCameraGeometry(0);
      }

      _createClass(S, [{
        key: "bufferedScreenGeometry",
        value: function bufferedScreenGeometry(e) {
          return t.polygonizeBounds(this.screenBounds[0], 1 === this.screenBounds.length ? this.screenBounds[0] : this.screenBounds[1], e);
        }
      }, {
        key: "bufferedCameraGeometry",
        value: function bufferedCameraGeometry(e) {
          var i = [this.screenBounds[0], 1 === this.screenBounds.length ? this.screenBounds[0].add(new t.Point(1, 0)) : this.screenBounds[1], this.cameraPoint];
          return t.bufferConvexPolygon(i, e);
        }
      }, {
        key: "containsTile",
        value: function containsTile(e, i, o) {
          var a = e.queryPadding + 1,
              r = o ? this._bufferedCameraMercator(a, i).map(function (t) {
            return e.tileID.getTilePoint(t);
          }) : this._bufferedScreenMercator(a, i).map(function (t) {
            return e.tileID.getTilePoint(t);
          }),
              n = this.screenGeometryMercator.map(function (t) {
            return e.tileID.getTileVec3(t);
          }),
              s = n.map(function (e) {
            return new t.Point(e[0], e[1]);
          }),
              l = i.getFreeCameraOptions().position || new t.MercatorCoordinate(0, 0, 0),
              c = e.tileID.getTileVec3(l),
              h = n.map(function (e) {
            var i = t.sub(e, e, c);
            return t.normalize(i, i), new t.Ray(c, i);
          }),
              u = C(e, 1, i.zoom);
          if (t.polygonIntersectsBox(r, 0, 0, t.EXTENT, t.EXTENT)) return {
            queryGeometry: this,
            tilespaceGeometry: s,
            tilespaceRays: h,
            bufferedTilespaceGeometry: r,
            bufferedTilespaceBounds: (d = t.getBounds(r), d.min.x = t.clamp(d.min.x, 0, t.EXTENT), d.min.y = t.clamp(d.min.y, 0, t.EXTENT), d.max.x = t.clamp(d.max.x, 0, t.EXTENT), d.max.y = t.clamp(d.max.y, 0, t.EXTENT), d),
            tile: e,
            tileID: e.tileID,
            pixelToTileUnitsFactor: u
          };
          var d;
        }
      }, {
        key: "_bufferedScreenMercator",
        value: function _bufferedScreenMercator(t, e) {
          var i = I(t);
          if (this._screenRaycastCache[i]) return this._screenRaycastCache[i];
          {
            var _o55 = this.bufferedScreenGeometry(t).map(function (t) {
              return e.pointCoordinate3D(t);
            });

            return this._screenRaycastCache[i] = _o55, _o55;
          }
        }
      }, {
        key: "_bufferedCameraMercator",
        value: function _bufferedCameraMercator(t, e) {
          var i = I(t);
          if (this._cameraRaycastCache[i]) return this._cameraRaycastCache[i];
          {
            var _o56 = this.bufferedCameraGeometry(t).map(function (t) {
              return e.pointCoordinate3D(t);
            });

            return this._cameraRaycastCache[i] = _o56, _o56;
          }
        }
      }], [{
        key: "createFromScreenPoints",
        value: function createFromScreenPoints(e, i) {
          var o, a;

          if (e instanceof t.Point || "number" == typeof e[0]) {
            var _r207 = t.Point.convert(e);

            o = [t.Point.convert(e)], a = i.isPointAboveHorizon(_r207);
          } else {
            var _r208 = t.Point.convert(e[0]),
                _n122 = t.Point.convert(e[1]);

            o = [_r208, _n122], a = t.polygonizeBounds(_r208, _n122).every(function (t) {
              return i.isPointAboveHorizon(t);
            });
          }

          return new S(o, i.getCameraPoint(), a, i);
        }
      }]);

      return S;
    }();

    function I(t) {
      return 100 * t | 0;
    }

    function P(e, i, o) {
      var a = function a(_a89, r) {
        if (_a89) return o(_a89);

        if (r) {
          var _a88 = t.pick(t.extend(r, e), ["tiles", "minzoom", "maxzoom", "attribution", "mapbox_logo", "bounds", "scheme", "tileSize", "encoding"]);

          r.vector_layers && (_a88.vectorLayers = r.vector_layers, _a88.vectorLayerIds = _a88.vectorLayers.map(function (t) {
            return t.id;
          })), _a88.tiles = i.canonicalizeTileset(_a88, e.url), o(null, _a88);
        }
      };

      return e.url ? t.getJSON(i.transformRequest(i.normalizeSourceURL(e.url), t.ResourceType.Source), a) : t.browser.frame(function () {
        return a(null, e);
      });
    }

    var M = /*#__PURE__*/function () {
      function M(e, i, o) {
        _classCallCheck(this, M);

        this.bounds = t.LngLatBounds.convert(this.validateBounds(e)), this.minzoom = i || 0, this.maxzoom = o || 24;
      }

      _createClass(M, [{
        key: "validateBounds",
        value: function validateBounds(t) {
          return Array.isArray(t) && 4 === t.length ? [Math.max(-180, t[0]), Math.max(-90, t[1]), Math.min(180, t[2]), Math.min(90, t[3])] : [-180, -90, 180, 90];
        }
      }, {
        key: "contains",
        value: function contains(e) {
          var i = Math.pow(2, e.z),
              o = Math.floor(t.mercatorXfromLng(this.bounds.getWest()) * i),
              a = Math.floor(t.mercatorYfromLat(this.bounds.getNorth()) * i),
              r = Math.ceil(t.mercatorXfromLng(this.bounds.getEast()) * i),
              n = Math.ceil(t.mercatorYfromLat(this.bounds.getSouth()) * i);
          return e.x >= o && e.x < r && e.y >= a && e.y < n;
        }
      }]);

      return M;
    }();

    var z = /*#__PURE__*/function (_t$Evented4) {
      _inherits(z, _t$Evented4);

      var _super102 = _createSuper(z);

      function z(e, i, o, a) {
        var _this62;

        _classCallCheck(this, z);

        _this62 = _super102.call(this), _this62.id = e, _this62.dispatcher = o, _this62.setEventedParent(a), _this62.type = "raster", _this62.minzoom = 0, _this62.maxzoom = 22, _this62.roundZoom = !0, _this62.scheme = "xyz", _this62.tileSize = 512, _this62._loaded = !1, _this62._options = t.extend({
          type: "raster"
        }, i), t.extend(_assertThisInitialized(_this62), t.pick(i, ["url", "scheme", "tileSize"]));
        return _this62;
      }

      _createClass(z, [{
        key: "load",
        value: function load() {
          var _this63 = this;

          this._loaded = !1, this.fire(new t.Event("dataloading", {
            dataType: "source"
          })), this._tileJSONRequest = P(this._options, this.map._requestManager, function (e, i) {
            _this63._tileJSONRequest = null, _this63._loaded = !0, e ? _this63.fire(new t.ErrorEvent(e)) : i && (t.extend(_this63, i), i.bounds && (_this63.tileBounds = new M(i.bounds, _this63.minzoom, _this63.maxzoom)), t.postTurnstileEvent(i.tiles), _this63.fire(new t.Event("data", {
              dataType: "source",
              sourceDataType: "metadata"
            })), _this63.fire(new t.Event("data", {
              dataType: "source",
              sourceDataType: "content"
            })));
          });
        }
      }, {
        key: "loaded",
        value: function loaded() {
          return this._loaded;
        }
      }, {
        key: "onAdd",
        value: function onAdd(t) {
          this.map = t, this.load();
        }
      }, {
        key: "onRemove",
        value: function onRemove() {
          this._tileJSONRequest && (this._tileJSONRequest.cancel(), this._tileJSONRequest = null);
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return t.extend({}, this._options);
        }
      }, {
        key: "hasTile",
        value: function hasTile(t) {
          return !this.tileBounds || this.tileBounds.contains(t.canonical);
        }
      }, {
        key: "loadTile",
        value: function loadTile(e, i) {
          var _this64 = this;

          var o = t.browser.devicePixelRatio >= 2,
              a = this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles, this.scheme), o, this.tileSize);

          e.request = t.getImage(this.map._requestManager.transformRequest(a, t.ResourceType.Tile), function (o, a) {
            if (delete e.request, e.aborted) e.state = "unloaded", i(null);else if (o) e.state = "errored", i(o);else if (a) {
              _this64.map._refreshExpiredTiles && e.setExpiryData(a), delete a.cacheControl, delete a.expires;
              var _o57 = _this64.map.painter.context,
                  _r209 = _o57.gl;
              e.texture = _this64.map.painter.getTileTexture(a.width), e.texture ? e.texture.update(a, {
                useMipmap: !0
              }) : (e.texture = new t.Texture(_o57, a, _r209.RGBA, {
                useMipmap: !0
              }), e.texture.bind(_r209.LINEAR, _r209.CLAMP_TO_EDGE, _r209.LINEAR_MIPMAP_NEAREST), _o57.extTextureFilterAnisotropic && _r209.texParameterf(_r209.TEXTURE_2D, _o57.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT, _o57.extTextureFilterAnisotropicMax)), e.state = "loaded", t.cacheEntryPossiblyAdded(_this64.dispatcher), i(null);
            }
          });
        }
      }, {
        key: "abortTile",
        value: function abortTile(t, e) {
          t.request && (t.request.cancel(), delete t.request), e();
        }
      }, {
        key: "unloadTile",
        value: function unloadTile(t, e) {
          t.texture && this.map.painter.saveTileTexture(t.texture), e();
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return !1;
        }
      }]);

      return z;
    }(t.Evented);

    var A = t.createLayout([{
      name: "a_pos",
      type: "Int16",
      components: 2
    }, {
      name: "a_texture_pos",
      type: "Int16",
      components: 2
    }]);

    var D = /*#__PURE__*/function (_t$Evented5) {
      _inherits(D, _t$Evented5);

      var _super103 = _createSuper(D);

      function D(t, e, i, o) {
        var _this65;

        _classCallCheck(this, D);

        _this65 = _super103.call(this), _this65.id = t, _this65.dispatcher = i, _this65.coordinates = e.coordinates, _this65.type = "image", _this65.minzoom = 0, _this65.maxzoom = 22, _this65.tileSize = 512, _this65.tiles = {}, _this65._loaded = !1, _this65.setEventedParent(o), _this65.options = e;
        return _this65;
      }

      _createClass(D, [{
        key: "load",
        value: function load(e, i) {
          var _this66 = this;

          this._loaded = !1, this.fire(new t.Event("dataloading", {
            dataType: "source"
          })), this.url = this.options.url, t.getImage(this.map._requestManager.transformRequest(this.url, t.ResourceType.Image), function (o, a) {
            _this66._loaded = !0, o ? _this66.fire(new t.ErrorEvent(o)) : a && (_this66.image = a, e && (_this66.coordinates = e), i && i(), _this66._finishLoading());
          });
        }
      }, {
        key: "loaded",
        value: function loaded() {
          return this._loaded;
        }
      }, {
        key: "updateImage",
        value: function updateImage(t) {
          var _this67 = this;

          return this.image && t.url ? (this.options.url = t.url, this.load(t.coordinates, function () {
            _this67.texture = null;
          }), this) : this;
        }
      }, {
        key: "_finishLoading",
        value: function _finishLoading() {
          this.map && (this.setCoordinates(this.coordinates), this.fire(new t.Event("data", {
            dataType: "source",
            sourceDataType: "metadata"
          })));
        }
      }, {
        key: "onAdd",
        value: function onAdd(t) {
          this.map = t, this.load();
        }
      }, {
        key: "setCoordinates",
        value: function setCoordinates(e) {
          var _this68 = this;

          this.coordinates = e;
          var i = e.map(t.MercatorCoordinate.fromLngLat);
          this.tileID = function (e) {
            var i = 1 / 0,
                o = 1 / 0,
                a = -1 / 0,
                r = -1 / 0;

            var _iterator157 = _createForOfIteratorHelper(e),
                _step157;

            try {
              for (_iterator157.s(); !(_step157 = _iterator157.n()).done;) {
                var _t238 = _step157.value;
                i = Math.min(i, _t238.x), o = Math.min(o, _t238.y), a = Math.max(a, _t238.x), r = Math.max(r, _t238.y);
              }
            } catch (err) {
              _iterator157.e(err);
            } finally {
              _iterator157.f();
            }

            var n = Math.max(a - i, r - o),
                s = Math.max(0, Math.floor(-Math.log(n) / Math.LN2)),
                l = Math.pow(2, s);
            return new t.CanonicalTileID(s, Math.floor((i + a) / 2 * l), Math.floor((o + r) / 2 * l));
          }(i), this.minzoom = this.maxzoom = this.tileID.z;
          var o = i.map(function (t) {
            return _this68.tileID.getTilePoint(t)._round();
          });
          return this._boundsArray = new t.StructArrayLayout4i8(), this._boundsArray.emplaceBack(o[0].x, o[0].y, 0, 0), this._boundsArray.emplaceBack(o[1].x, o[1].y, t.EXTENT, 0), this._boundsArray.emplaceBack(o[3].x, o[3].y, 0, t.EXTENT), this._boundsArray.emplaceBack(o[2].x, o[2].y, t.EXTENT, t.EXTENT), this.boundsBuffer && (this.boundsBuffer.destroy(), delete this.boundsBuffer), this.fire(new t.Event("data", {
            dataType: "source",
            sourceDataType: "content"
          })), this;
        }
      }, {
        key: "prepare",
        value: function prepare() {
          if (0 === Object.keys(this.tiles).length || !this.image) return;
          var e = this.map.painter.context,
              i = e.gl;
          this.boundsBuffer || (this.boundsBuffer = e.createVertexBuffer(this._boundsArray, A.members)), this.boundsSegments || (this.boundsSegments = t.SegmentVector.simpleSegment(0, 0, 4, 2)), this.texture || (this.texture = new t.Texture(e, this.image, i.RGBA), this.texture.bind(i.LINEAR, i.CLAMP_TO_EDGE));

          for (var _t239 in this.tiles) {
            var _e230 = this.tiles[_t239];
            "loaded" !== _e230.state && (_e230.state = "loaded", _e230.texture = this.texture);
          }
        }
      }, {
        key: "loadTile",
        value: function loadTile(t, e) {
          this.tileID && this.tileID.equals(t.tileID.canonical) ? (this.tiles[String(t.tileID.wrap)] = t, t.buckets = {}, e(null)) : (t.state = "errored", e(null));
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return {
            type: "image",
            url: this.options.url,
            coordinates: this.coordinates
          };
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return !1;
        }
      }]);

      return D;
    }(t.Evented);

    var L = {
      vector: /*#__PURE__*/function (_t$Evented6) {
        _inherits(vector, _t$Evented6);

        var _super104 = _createSuper(vector);

        function vector(e, i, o, a) {
          var _this69;

          _classCallCheck(this, vector);

          if (_this69 = _super104.call(this), _this69.id = e, _this69.dispatcher = o, _this69.type = "vector", _this69.minzoom = 0, _this69.maxzoom = 22, _this69.scheme = "xyz", _this69.tileSize = 512, _this69.reparseOverscaled = !0, _this69.isTileClipped = !0, _this69._loaded = !1, t.extend(_assertThisInitialized(_this69), t.pick(i, ["url", "scheme", "tileSize", "promoteId"])), _this69._options = t.extend({
            type: "vector"
          }, i), _this69._collectResourceTiming = i.collectResourceTiming, 512 !== _this69.tileSize) throw new Error("vector tile sources must have a tileSize of 512");
          _this69.setEventedParent(a), _this69._tileWorkers = {}, _this69._deduped = new t.DedupedRequest();
          return _possibleConstructorReturn(_this69);
        }

        _createClass(vector, [{
          key: "load",
          value: function load() {
            var _this70 = this;

            this._loaded = !1, this.fire(new t.Event("dataloading", {
              dataType: "source"
            })), this._tileJSONRequest = P(this._options, this.map._requestManager, function (e, i) {
              _this70._tileJSONRequest = null, _this70._loaded = !0, e ? _this70.fire(new t.ErrorEvent(e)) : i && (t.extend(_this70, i), i.bounds && (_this70.tileBounds = new M(i.bounds, _this70.minzoom, _this70.maxzoom)), t.postTurnstileEvent(i.tiles, _this70.map._requestManager._customAccessToken), _this70.fire(new t.Event("data", {
                dataType: "source",
                sourceDataType: "metadata"
              })), _this70.fire(new t.Event("data", {
                dataType: "source",
                sourceDataType: "content"
              })));
            });
          }
        }, {
          key: "loaded",
          value: function loaded() {
            return this._loaded;
          }
        }, {
          key: "hasTile",
          value: function hasTile(t) {
            return !this.tileBounds || this.tileBounds.contains(t.canonical);
          }
        }, {
          key: "onAdd",
          value: function onAdd(t) {
            this.map = t, this.load();
          }
        }, {
          key: "setSourceProperty",
          value: function setSourceProperty(t) {
            this._tileJSONRequest && this._tileJSONRequest.cancel(), t();

            var e = this.map.style._getSourceCaches(this.id);

            var _iterator158 = _createForOfIteratorHelper(e),
                _step158;

            try {
              for (_iterator158.s(); !(_step158 = _iterator158.n()).done;) {
                var _t240 = _step158.value;

                _t240.clearTiles();
              }
            } catch (err) {
              _iterator158.e(err);
            } finally {
              _iterator158.f();
            }

            this.load();
          }
        }, {
          key: "setTiles",
          value: function setTiles(t) {
            var _this71 = this;

            return this.setSourceProperty(function () {
              _this71._options.tiles = t;
            }), this;
          }
        }, {
          key: "setUrl",
          value: function setUrl(t) {
            var _this72 = this;

            return this.setSourceProperty(function () {
              _this72.url = t, _this72._options.url = t;
            }), this;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            this._tileJSONRequest && (this._tileJSONRequest.cancel(), this._tileJSONRequest = null);
          }
        }, {
          key: "serialize",
          value: function serialize() {
            return t.extend({}, this._options);
          }
        }, {
          key: "loadTile",
          value: function loadTile(e, i) {
            var _this73 = this;

            var o = this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles, this.scheme)),
                a = {
              request: this.map._requestManager.transformRequest(o, t.ResourceType.Tile),
              data: void 0,
              uid: e.uid,
              tileID: e.tileID,
              tileZoom: e.tileZoom,
              zoom: e.tileID.overscaledZ,
              tileSize: this.tileSize * e.tileID.overscaleFactor(),
              type: this.type,
              source: this.id,
              pixelRatio: t.browser.devicePixelRatio,
              showCollisionBoxes: this.map.showCollisionBoxes,
              promoteId: this.promoteId,
              isSymbolTile: e.isSymbolTile
            };

            if (a.request.collectResourceTiming = this._collectResourceTiming, e.actor && "expired" !== e.state) "loading" === e.state ? e.reloadCallback = i : e.request = e.actor.send("reloadTile", a, r.bind(this));else if (e.actor = this._tileWorkers[o] = this._tileWorkers[o] || this.dispatcher.getActor(), this.dispatcher.ready) e.request = e.actor.send("loadTile", a, r.bind(this));else {
              var _i167 = t.loadVectorTile.call({
                deduped: this._deduped
              }, a, function (t, i) {
                t || !i ? r.call(_this73, t) : (a.data = {
                  cacheControl: i.cacheControl,
                  expires: i.expires,
                  rawData: i.rawData.slice(0)
                }, e.actor && e.actor.send("loadTile", a, r.bind(_this73)));
              }, !0);

              e.request = {
                cancel: _i167
              };
            }

            function r(o, a) {
              return delete e.request, e.aborted ? i(null) : o && 404 !== o.status ? i(o) : (a && a.resourceTiming && (e.resourceTiming = a.resourceTiming), this.map._refreshExpiredTiles && a && e.setExpiryData(a), e.loadVectorData(a, this.map.painter), t.cacheEntryPossiblyAdded(this.dispatcher), i(null), void (e.reloadCallback && (this.loadTile(e, e.reloadCallback), e.reloadCallback = null)));
            }
          }
        }, {
          key: "abortTile",
          value: function abortTile(t) {
            t.request && (t.request.cancel(), delete t.request), t.actor && t.actor.send("abortTile", {
              uid: t.uid,
              type: this.type,
              source: this.id
            }, void 0);
          }
        }, {
          key: "unloadTile",
          value: function unloadTile(t) {
            t.unloadVectorData(), t.actor && t.actor.send("removeTile", {
              uid: t.uid,
              type: this.type,
              source: this.id
            }, void 0);
          }
        }, {
          key: "hasTransition",
          value: function hasTransition() {
            return !1;
          }
        }, {
          key: "afterUpdate",
          value: function afterUpdate() {
            this._tileWorkers = {};
          }
        }]);

        return vector;
      }(t.Evented),
      raster: z,
      "raster-dem": /*#__PURE__*/function (_z2) {
        _inherits(rasterDem, _z2);

        var _super105 = _createSuper(rasterDem);

        function rasterDem(e, i, o, a) {
          var _this74;

          _classCallCheck(this, rasterDem);

          _this74 = _super105.call(this, e, i, o, a), _this74.type = "raster-dem", _this74.maxzoom = 22, _this74._options = t.extend({
            type: "raster-dem"
          }, i), _this74.encoding = i.encoding || "mapbox";
          return _this74;
        }

        _createClass(rasterDem, [{
          key: "serialize",
          value: function serialize() {
            return {
              type: "raster-dem",
              url: this.url,
              tileSize: this.tileSize,
              tiles: this.tiles,
              bounds: this.bounds,
              encoding: this.encoding
            };
          }
        }, {
          key: "loadTile",
          value: function loadTile(e, i) {
            var o = this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles, this.scheme), !1, this.tileSize);

            function a(t, o) {
              t && (e.state = "errored", i(t)), o && (e.dem = o, e.dem.onDeserialize(), e.needsHillshadePrepare = !0, e.needsDEMTextureUpload = !0, e.state = "loaded", i(null));
            }

            e.request = t.getImage(this.map._requestManager.transformRequest(o, t.ResourceType.Tile), function (o, r) {
              if (delete e.request, e.aborted) e.state = "unloaded", i(null);else if (o) e.state = "errored", i(o);else if (r) {
                this.map._refreshExpiredTiles && e.setExpiryData(r), delete r.cacheControl, delete r.expires;

                var _i168 = t.window.ImageBitmap && r instanceof t.window.ImageBitmap && t.offscreenCanvasSupported(),
                    _o58 = 1 - (r.width - t.prevPowerOfTwo(r.width)) / 2;

                _o58 < 1 || e.neighboringTiles || (e.neighboringTiles = this._getNeighboringTiles(e.tileID));

                var _n123 = _i168 ? r : t.browser.getImageData(r, _o58),
                    _s98 = {
                  uid: e.uid,
                  coord: e.tileID,
                  source: this.id,
                  rawImageData: _n123,
                  encoding: this.encoding,
                  padding: _o58
                };

                e.actor && "expired" !== e.state || (e.actor = this.dispatcher.getActor(), e.actor.send("loadDEMTile", _s98, a.bind(this)));
              }
            }.bind(this));
          }
        }, {
          key: "_getNeighboringTiles",
          value: function _getNeighboringTiles(e) {
            var i = e.canonical,
                o = Math.pow(2, i.z),
                a = (i.x - 1 + o) % o,
                r = 0 === i.x ? e.wrap - 1 : e.wrap,
                n = (i.x + 1 + o) % o,
                s = i.x + 1 === o ? e.wrap + 1 : e.wrap,
                l = {};
            return l[new t.OverscaledTileID(e.overscaledZ, r, i.z, a, i.y).key] = {
              backfilled: !1
            }, l[new t.OverscaledTileID(e.overscaledZ, s, i.z, n, i.y).key] = {
              backfilled: !1
            }, i.y > 0 && (l[new t.OverscaledTileID(e.overscaledZ, r, i.z, a, i.y - 1).key] = {
              backfilled: !1
            }, l[new t.OverscaledTileID(e.overscaledZ, e.wrap, i.z, i.x, i.y - 1).key] = {
              backfilled: !1
            }, l[new t.OverscaledTileID(e.overscaledZ, s, i.z, n, i.y - 1).key] = {
              backfilled: !1
            }), i.y + 1 < o && (l[new t.OverscaledTileID(e.overscaledZ, r, i.z, a, i.y + 1).key] = {
              backfilled: !1
            }, l[new t.OverscaledTileID(e.overscaledZ, e.wrap, i.z, i.x, i.y + 1).key] = {
              backfilled: !1
            }, l[new t.OverscaledTileID(e.overscaledZ, s, i.z, n, i.y + 1).key] = {
              backfilled: !1
            }), l;
          }
        }, {
          key: "unloadTile",
          value: function unloadTile(t) {
            t.demTexture && this.map.painter.saveTileTexture(t.demTexture), t.fbo && (t.fbo.destroy(), delete t.fbo), t.dem && delete t.dem, delete t.neighboringTiles, t.state = "unloaded";
          }
        }]);

        return rasterDem;
      }(z),
      geojson: /*#__PURE__*/function (_t$Evented7) {
        _inherits(geojson, _t$Evented7);

        var _super106 = _createSuper(geojson);

        function geojson(e, i, o, a) {
          var _this75;

          _classCallCheck(this, geojson);

          _this75 = _super106.call(this), _this75.id = e, _this75.type = "geojson", _this75.minzoom = 0, _this75.maxzoom = 18, _this75.tileSize = 512, _this75.isTileClipped = !0, _this75.reparseOverscaled = !0, _this75._removed = !1, _this75._loaded = !1, _this75.actor = o.getActor(), _this75.setEventedParent(a), _this75._data = i.data, _this75._options = t.extend({}, i), _this75._collectResourceTiming = i.collectResourceTiming, _this75._resourceTiming = [], void 0 !== i.maxzoom && (_this75.maxzoom = i.maxzoom), i.type && (_this75.type = i.type), i.attribution && (_this75.attribution = i.attribution), _this75.promoteId = i.promoteId;
          var r = t.EXTENT / _this75.tileSize;
          _this75.workerOptions = t.extend({
            source: _this75.id,
            cluster: i.cluster || !1,
            geojsonVtOptions: {
              buffer: (void 0 !== i.buffer ? i.buffer : 128) * r,
              tolerance: (void 0 !== i.tolerance ? i.tolerance : .375) * r,
              extent: t.EXTENT,
              maxZoom: _this75.maxzoom,
              lineMetrics: i.lineMetrics || !1,
              generateId: i.generateId || !1
            },
            superclusterOptions: {
              maxZoom: void 0 !== i.clusterMaxZoom ? Math.min(i.clusterMaxZoom, _this75.maxzoom - 1) : _this75.maxzoom - 1,
              minPoints: Math.max(2, i.clusterMinPoints || 2),
              extent: t.EXTENT,
              radius: (i.clusterRadius || 50) * r,
              log: !1,
              generateId: i.generateId || !1
            },
            clusterProperties: i.clusterProperties,
            filter: i.filter
          }, i.workerOptions);
          return _this75;
        }

        _createClass(geojson, [{
          key: "load",
          value: function load() {
            var _this76 = this;

            this.fire(new t.Event("dataloading", {
              dataType: "source"
            })), this._updateWorkerData(function (e) {
              if (e) return void _this76.fire(new t.ErrorEvent(e));
              var i = {
                dataType: "source",
                sourceDataType: "metadata"
              };
              _this76._collectResourceTiming && _this76._resourceTiming && _this76._resourceTiming.length > 0 && (i.resourceTiming = _this76._resourceTiming, _this76._resourceTiming = []), _this76.fire(new t.Event("data", i));
            });
          }
        }, {
          key: "onAdd",
          value: function onAdd(t) {
            this.map = t, this.load();
          }
        }, {
          key: "setData",
          value: function setData(e) {
            var _this77 = this;

            return this._data = e, this.fire(new t.Event("dataloading", {
              dataType: "source"
            })), this._updateWorkerData(function (e) {
              if (e) return void _this77.fire(new t.ErrorEvent(e));
              var i = {
                dataType: "source",
                sourceDataType: "content"
              };
              _this77._collectResourceTiming && _this77._resourceTiming && _this77._resourceTiming.length > 0 && (i.resourceTiming = _this77._resourceTiming, _this77._resourceTiming = []), _this77.fire(new t.Event("data", i));
            }), this;
          }
        }, {
          key: "getClusterExpansionZoom",
          value: function getClusterExpansionZoom(t, e) {
            return this.actor.send("geojson.getClusterExpansionZoom", {
              clusterId: t,
              source: this.id
            }, e), this;
          }
        }, {
          key: "getClusterChildren",
          value: function getClusterChildren(t, e) {
            return this.actor.send("geojson.getClusterChildren", {
              clusterId: t,
              source: this.id
            }, e), this;
          }
        }, {
          key: "getClusterLeaves",
          value: function getClusterLeaves(t, e, i, o) {
            return this.actor.send("geojson.getClusterLeaves", {
              source: this.id,
              clusterId: t,
              limit: e,
              offset: i
            }, o), this;
          }
        }, {
          key: "_updateWorkerData",
          value: function _updateWorkerData(e) {
            var _this78 = this;

            this._loaded = !1;
            var i = t.extend({}, this.workerOptions),
                o = this._data;
            "string" == typeof o ? (i.request = this.map._requestManager.transformRequest(t.browser.resolveURL(o), t.ResourceType.Source), i.request.collectResourceTiming = this._collectResourceTiming) : i.data = JSON.stringify(o), this.actor.send("".concat(this.type, ".loadData"), i, function (t, o) {
              _this78._removed || o && o.abandoned || (_this78._loaded = !0, o && o.resourceTiming && o.resourceTiming[_this78.id] && (_this78._resourceTiming = o.resourceTiming[_this78.id].slice(0)), _this78.actor.send("".concat(_this78.type, ".coalesce"), {
                source: i.source
              }, null), e(t));
            });
          }
        }, {
          key: "loaded",
          value: function loaded() {
            return this._loaded;
          }
        }, {
          key: "loadTile",
          value: function loadTile(e, i) {
            var _this79 = this;

            var o = e.actor ? "reloadTile" : "loadTile";
            e.actor = this.actor, e.request = this.actor.send(o, {
              type: this.type,
              uid: e.uid,
              tileID: e.tileID,
              tileZoom: e.tileZoom,
              zoom: e.tileID.overscaledZ,
              maxZoom: this.maxzoom,
              tileSize: this.tileSize,
              source: this.id,
              pixelRatio: t.browser.devicePixelRatio,
              showCollisionBoxes: this.map.showCollisionBoxes,
              promoteId: this.promoteId
            }, function (t, a) {
              return delete e.request, e.unloadVectorData(), e.aborted ? i(null) : t ? i(t) : (e.loadVectorData(a, _this79.map.painter, "reloadTile" === o), i(null));
            });
          }
        }, {
          key: "abortTile",
          value: function abortTile(t) {
            t.request && (t.request.cancel(), delete t.request), t.aborted = !0;
          }
        }, {
          key: "unloadTile",
          value: function unloadTile(t) {
            t.unloadVectorData(), this.actor.send("removeTile", {
              uid: t.uid,
              type: this.type,
              source: this.id
            });
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            this._removed = !0, this.actor.send("removeSource", {
              type: this.type,
              source: this.id
            });
          }
        }, {
          key: "serialize",
          value: function serialize() {
            return t.extend({}, this._options, {
              type: this.type,
              data: this._data
            });
          }
        }, {
          key: "hasTransition",
          value: function hasTransition() {
            return !1;
          }
        }]);

        return geojson;
      }(t.Evented),
      video: /*#__PURE__*/function (_D) {
        _inherits(video, _D);

        var _super107 = _createSuper(video);

        function video(t, e, i, o) {
          var _this80;

          _classCallCheck(this, video);

          _this80 = _super107.call(this, t, e, i, o), _this80.roundZoom = !0, _this80.type = "video", _this80.options = e;
          return _this80;
        }

        _createClass(video, [{
          key: "load",
          value: function load() {
            var _this81 = this;

            this._loaded = !1;
            var e = this.options;
            this.urls = [];

            var _iterator159 = _createForOfIteratorHelper(e.urls),
                _step159;

            try {
              for (_iterator159.s(); !(_step159 = _iterator159.n()).done;) {
                var _i169 = _step159.value;
                this.urls.push(this.map._requestManager.transformRequest(_i169, t.ResourceType.Source).url);
              }
            } catch (err) {
              _iterator159.e(err);
            } finally {
              _iterator159.f();
            }

            t.getVideo(this.urls, function (e, i) {
              _this81._loaded = !0, e ? _this81.fire(new t.ErrorEvent(e)) : i && (_this81.video = i, _this81.video.loop = !0, _this81.video.addEventListener("playing", function () {
                _this81.map.triggerRepaint();
              }), _this81.map && _this81.video.play(), _this81._finishLoading());
            });
          }
        }, {
          key: "pause",
          value: function pause() {
            this.video && this.video.pause();
          }
        }, {
          key: "play",
          value: function play() {
            this.video && this.video.play();
          }
        }, {
          key: "seek",
          value: function seek(e) {
            if (this.video) {
              var _i170 = this.video.seekable;
              e < _i170.start(0) || e > _i170.end(0) ? this.fire(new t.ErrorEvent(new t.ValidationError("sources.".concat(this.id), null, "Playback for this video can be set only between the ".concat(_i170.start(0), " and ").concat(_i170.end(0), "-second mark.")))) : this.video.currentTime = e;
            }
          }
        }, {
          key: "getVideo",
          value: function getVideo() {
            return this.video;
          }
        }, {
          key: "onAdd",
          value: function onAdd(t) {
            this.map || (this.map = t, this.load(), this.video && (this.video.play(), this.setCoordinates(this.coordinates)));
          }
        }, {
          key: "prepare",
          value: function prepare() {
            if (0 === Object.keys(this.tiles).length || this.video.readyState < 2) return;
            var e = this.map.painter.context,
                i = e.gl;
            this.boundsBuffer || (this.boundsBuffer = e.createVertexBuffer(this._boundsArray, A.members)), this.boundsSegments || (this.boundsSegments = t.SegmentVector.simpleSegment(0, 0, 4, 2)), this.texture ? this.video.paused || (this.texture.bind(i.LINEAR, i.CLAMP_TO_EDGE), i.texSubImage2D(i.TEXTURE_2D, 0, 0, 0, i.RGBA, i.UNSIGNED_BYTE, this.video)) : (this.texture = new t.Texture(e, this.video, i.RGBA), this.texture.bind(i.LINEAR, i.CLAMP_TO_EDGE));

            for (var _t241 in this.tiles) {
              var _e231 = this.tiles[_t241];
              "loaded" !== _e231.state && (_e231.state = "loaded", _e231.texture = this.texture);
            }
          }
        }, {
          key: "serialize",
          value: function serialize() {
            return {
              type: "video",
              urls: this.urls,
              coordinates: this.coordinates
            };
          }
        }, {
          key: "hasTransition",
          value: function hasTransition() {
            return this.video && !this.video.paused;
          }
        }]);

        return video;
      }(D),
      image: D,
      canvas: /*#__PURE__*/function (_D2) {
        _inherits(canvas, _D2);

        var _super108 = _createSuper(canvas);

        function canvas(e, i, o, a) {
          var _this82;

          _classCallCheck(this, canvas);

          _this82 = _super108.call(this, e, i, o, a), i.coordinates ? Array.isArray(i.coordinates) && 4 === i.coordinates.length && !i.coordinates.some(function (t) {
            return !Array.isArray(t) || 2 !== t.length || t.some(function (t) {
              return "number" != typeof t;
            });
          }) || _this82.fire(new t.ErrorEvent(new t.ValidationError("sources.".concat(e), null, '"coordinates" property must be an array of 4 longitude/latitude array pairs'))) : _this82.fire(new t.ErrorEvent(new t.ValidationError("sources.".concat(e), null, 'missing required property "coordinates"'))), i.animate && "boolean" != typeof i.animate && _this82.fire(new t.ErrorEvent(new t.ValidationError("sources.".concat(e), null, 'optional "animate" property must be a boolean value'))), i.canvas ? "string" == typeof i.canvas || i.canvas instanceof t.window.HTMLCanvasElement || _this82.fire(new t.ErrorEvent(new t.ValidationError("sources.".concat(e), null, '"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))) : _this82.fire(new t.ErrorEvent(new t.ValidationError("sources.".concat(e), null, 'missing required property "canvas"'))), _this82.options = i, _this82.animate = void 0 === i.animate || i.animate;
          return _this82;
        }

        _createClass(canvas, [{
          key: "load",
          value: function load() {
            this._loaded = !0, this.canvas || (this.canvas = this.options.canvas instanceof t.window.HTMLCanvasElement ? this.options.canvas : t.window.document.getElementById(this.options.canvas)), this.width = this.canvas.width, this.height = this.canvas.height, this._hasInvalidDimensions() ? this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))) : (this.play = function () {
              this._playing = !0, this.map.triggerRepaint();
            }, this.pause = function () {
              this._playing && (this.prepare(), this._playing = !1);
            }, this._finishLoading());
          }
        }, {
          key: "getCanvas",
          value: function getCanvas() {
            return this.canvas;
          }
        }, {
          key: "onAdd",
          value: function onAdd(t) {
            this.map = t, this.load(), this.canvas && this.animate && this.play();
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            this.pause();
          }
        }, {
          key: "prepare",
          value: function prepare() {
            var e = !1;
            if (this.canvas.width !== this.width && (this.width = this.canvas.width, e = !0), this.canvas.height !== this.height && (this.height = this.canvas.height, e = !0), this._hasInvalidDimensions()) return;
            if (0 === Object.keys(this.tiles).length) return;
            var i = this.map.painter.context,
                o = i.gl;
            this.boundsBuffer || (this.boundsBuffer = i.createVertexBuffer(this._boundsArray, A.members)), this.boundsSegments || (this.boundsSegments = t.SegmentVector.simpleSegment(0, 0, 4, 2)), this.texture ? (e || this._playing) && this.texture.update(this.canvas, {
              premultiply: !0
            }) : this.texture = new t.Texture(i, this.canvas, o.RGBA, {
              premultiply: !0
            });

            for (var _t242 in this.tiles) {
              var _e232 = this.tiles[_t242];
              "loaded" !== _e232.state && (_e232.state = "loaded", _e232.texture = this.texture);
            }
          }
        }, {
          key: "serialize",
          value: function serialize() {
            return {
              type: "canvas",
              coordinates: this.coordinates
            };
          }
        }, {
          key: "hasTransition",
          value: function hasTransition() {
            return this._playing;
          }
        }, {
          key: "_hasInvalidDimensions",
          value: function _hasInvalidDimensions() {
            for (var _i171 = 0, _arr2 = [this.canvas.width, this.canvas.height]; _i171 < _arr2.length; _i171++) {
              var _t243 = _arr2[_i171];
              if (isNaN(_t243) || _t243 <= 0) return !0;
            }

            return !1;
          }
        }]);

        return canvas;
      }(D)
    },
        R = function R(e, i, o, a) {
      var r = new L[i.type](e, i, o, a);
      if (r.id !== e) throw new Error("Expected Source id to be ".concat(e, " instead of ").concat(r.id));
      return t.bindAll(["load", "abort", "unload", "serialize", "prepare"], r), r;
    };

    function k(e, i) {
      var o = t.identity([]);
      return t.scale(o, o, [.5 * e.width, .5 * -e.height, 1]), t.translate(o, o, [1, -1, 0]), t.multiply(o, o, e.calculatePosMatrix(i.toUnwrapped()));
    }

    function B(t, e, i, o, a, r, n) {
      var s = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : !1;
      var l = t.tilesIn(o, n, s);
      l.sort(F);
      var c = [];

      var _iterator160 = _createForOfIteratorHelper(l),
          _step160;

      try {
        for (_iterator160.s(); !(_step160 = _iterator160.n()).done;) {
          var _o61 = _step160.value;
          c.push({
            wrappedTileID: _o61.tile.tileID.wrapped().key,
            queryResults: _o61.tile.queryRenderedFeatures(e, i, t._state, _o61, a, r, k(t.transform, _o61.tile.tileID), s)
          });
        }
      } catch (err) {
        _iterator160.e(err);
      } finally {
        _iterator160.f();
      }

      var h = function (t) {
        var e = {},
            i = {};

        var _iterator161 = _createForOfIteratorHelper(t),
            _step161;

        try {
          for (_iterator161.s(); !(_step161 = _iterator161.n()).done;) {
            var _o59 = _step161.value;

            var _t244 = _o59.queryResults,
                _a90 = _o59.wrappedTileID,
                _r210 = i[_a90] = i[_a90] || {};

            for (var _i172 in _t244) {
              var _o60 = _t244[_i172],
                  _a91 = _r210[_i172] = _r210[_i172] || {},
                  _n124 = e[_i172] = e[_i172] || [];

              var _iterator162 = _createForOfIteratorHelper(_o60),
                  _step162;

              try {
                for (_iterator162.s(); !(_step162 = _iterator162.n()).done;) {
                  var _t245 = _step162.value;
                  _a91[_t245.featureIndex] || (_a91[_t245.featureIndex] = !0, _n124.push(_t245));
                }
              } catch (err) {
                _iterator162.e(err);
              } finally {
                _iterator162.f();
              }
            }
          }
        } catch (err) {
          _iterator161.e(err);
        } finally {
          _iterator161.f();
        }

        return e;
      }(c);

      for (var _e233 in h) {
        h[_e233].forEach(function (e) {
          var i = e.feature,
              o = t.getFeatureState(i.layer["source-layer"], i.id);
          i.source = i.layer.source, i.layer["source-layer"] && (i.sourceLayer = i.layer["source-layer"]), i.state = o;
        });
      }

      return h;
    }

    function O(t, e) {
      var i = t.getRenderableIds().map(function (e) {
        return t.getTileByID(e);
      }),
          o = [],
          a = {};

      for (var _t246 = 0; _t246 < i.length; _t246++) {
        var _r211 = i[_t246],
            _n125 = _r211.tileID.canonical.key;
        a[_n125] || (a[_n125] = !0, _r211.querySourceFeatures(o, e));
      }

      return o;
    }

    function F(t, e) {
      var i = t.tileID,
          o = e.tileID;
      return i.overscaledZ - o.overscaledZ || i.canonical.y - o.canonical.y || i.wrap - o.wrap || i.canonical.x - o.canonical.x;
    }

    function U() {
      return null != Ta.workerClass ? new Ta.workerClass() : new t.window.Worker(Ta.workerUrl);
    }

    var N = "mapboxgl_preloaded_worker_pool";

    var Z = /*#__PURE__*/function () {
      function Z() {
        _classCallCheck(this, Z);

        this.active = {};
      }

      _createClass(Z, [{
        key: "acquire",
        value: function acquire(t) {
          if (!this.workers) for (this.workers = []; this.workers.length < Z.workerCount;) {
            this.workers.push(new U());
          }
          return this.active[t] = !0, this.workers.slice();
        }
      }, {
        key: "release",
        value: function release(t) {
          delete this.active[t], 0 === this.numActive() && (this.workers.forEach(function (t) {
            t.terminate();
          }), this.workers = null);
        }
      }, {
        key: "isPreloaded",
        value: function isPreloaded() {
          return !!this.active[N];
        }
      }, {
        key: "numActive",
        value: function numActive() {
          return Object.keys(this.active).length;
        }
      }]);

      return Z;
    }();

    var G;

    function q() {
      return G || (G = new Z()), G;
    }

    function V(e, i) {
      var o = {};

      for (var _t247 in e) {
        "ref" !== _t247 && (o[_t247] = e[_t247]);
      }

      return t.refProperties.forEach(function (t) {
        t in i && (o[t] = i[t]);
      }), o;
    }

    function $(t) {
      t = t.slice();
      var e = Object.create(null);

      for (var _i173 = 0; _i173 < t.length; _i173++) {
        e[t[_i173].id] = t[_i173];
      }

      for (var _i174 = 0; _i174 < t.length; _i174++) {
        "ref" in t[_i174] && (t[_i174] = V(t[_i174], e[t[_i174].ref]));
      }

      return t;
    }

    Z.workerCount = 2;
    var j = {
      setStyle: "setStyle",
      addLayer: "addLayer",
      removeLayer: "removeLayer",
      setPaintProperty: "setPaintProperty",
      setLayoutProperty: "setLayoutProperty",
      setFilter: "setFilter",
      addSource: "addSource",
      removeSource: "removeSource",
      setGeoJSONSourceData: "setGeoJSONSourceData",
      setLayerZoomRange: "setLayerZoomRange",
      setLayerProperty: "setLayerProperty",
      setCenter: "setCenter",
      setZoom: "setZoom",
      setBearing: "setBearing",
      setPitch: "setPitch",
      setSprite: "setSprite",
      setGlyphs: "setGlyphs",
      setTransition: "setTransition",
      setLight: "setLight",
      setTerrain: "setTerrain"
    };

    function W(t, e, i) {
      i.push({
        command: j.addSource,
        args: [t, e[t]]
      });
    }

    function X(t, e, i) {
      e.push({
        command: j.removeSource,
        args: [t]
      }), i[t] = !0;
    }

    function H(t, e, i, o) {
      X(t, i, o), W(t, e, i);
    }

    function K(e, i, o) {
      var a;

      for (a in e[o]) {
        if (e[o].hasOwnProperty(a) && "data" !== a && !t.deepEqual(e[o][a], i[o][a])) return !1;
      }

      for (a in i[o]) {
        if (i[o].hasOwnProperty(a) && "data" !== a && !t.deepEqual(e[o][a], i[o][a])) return !1;
      }

      return !0;
    }

    function Y(e, i, o, a, r, n) {
      var s;

      for (s in i = i || {}, e = e || {}) {
        e.hasOwnProperty(s) && (t.deepEqual(e[s], i[s]) || o.push({
          command: n,
          args: [a, s, i[s], r]
        }));
      }

      for (s in i) {
        i.hasOwnProperty(s) && !e.hasOwnProperty(s) && (t.deepEqual(e[s], i[s]) || o.push({
          command: n,
          args: [a, s, i[s], r]
        }));
      }
    }

    function J(t) {
      return t.id;
    }

    function Q(t, e) {
      return t[e.id] = e, t;
    }

    var tt = /*#__PURE__*/function () {
      function tt(t, e) {
        _classCallCheck(this, tt);

        this.reset(t, e);
      }

      _createClass(tt, [{
        key: "reset",
        value: function reset(t, e) {
          this.points = t || [], this._distances = [0];

          for (var _t248 = 1; _t248 < this.points.length; _t248++) {
            this._distances[_t248] = this._distances[_t248 - 1] + this.points[_t248].dist(this.points[_t248 - 1]);
          }

          this.length = this._distances[this._distances.length - 1], this.padding = Math.min(e || 0, .5 * this.length), this.paddedLength = this.length - 2 * this.padding;
        }
      }, {
        key: "lerp",
        value: function lerp(e) {
          if (1 === this.points.length) return this.points[0];
          e = t.clamp(e, 0, 1);
          var i = 1,
              o = this._distances[i];
          var a = e * this.paddedLength + this.padding;

          for (; o < a && i < this._distances.length;) {
            o = this._distances[++i];
          }

          var r = i - 1,
              n = this._distances[r],
              s = o - n,
              l = s > 0 ? (a - n) / s : 0;
          return this.points[r].mult(1 - l).add(this.points[i].mult(l));
        }
      }]);

      return tt;
    }();

    var et = /*#__PURE__*/function () {
      function et(t, e, i) {
        _classCallCheck(this, et);

        var o = this.boxCells = [],
            a = this.circleCells = [];
        this.xCellCount = Math.ceil(t / i), this.yCellCount = Math.ceil(e / i);

        for (var _t249 = 0; _t249 < this.xCellCount * this.yCellCount; _t249++) {
          o.push([]), a.push([]);
        }

        this.circleKeys = [], this.boxKeys = [], this.bboxes = [], this.circles = [], this.width = t, this.height = e, this.xScale = this.xCellCount / t, this.yScale = this.yCellCount / e, this.boxUid = 0, this.circleUid = 0;
      }

      _createClass(et, [{
        key: "keysLength",
        value: function keysLength() {
          return this.boxKeys.length + this.circleKeys.length;
        }
      }, {
        key: "insert",
        value: function insert(t, e, i, o, a) {
          this._forEachCell(e, i, o, a, this._insertBoxCell, this.boxUid++), this.boxKeys.push(t), this.bboxes.push(e), this.bboxes.push(i), this.bboxes.push(o), this.bboxes.push(a);
        }
      }, {
        key: "insertCircle",
        value: function insertCircle(t, e, i, o) {
          this._forEachCell(e - o, i - o, e + o, i + o, this._insertCircleCell, this.circleUid++), this.circleKeys.push(t), this.circles.push(e), this.circles.push(i), this.circles.push(o);
        }
      }, {
        key: "_insertBoxCell",
        value: function _insertBoxCell(t, e, i, o, a, r) {
          this.boxCells[a].push(r);
        }
      }, {
        key: "_insertCircleCell",
        value: function _insertCircleCell(t, e, i, o, a, r) {
          this.circleCells[a].push(r);
        }
      }, {
        key: "_query",
        value: function _query(t, e, i, o, a, r) {
          if (i < 0 || t > this.width || o < 0 || e > this.height) return !a && [];
          var n = [];

          if (t <= 0 && e <= 0 && this.width <= i && this.height <= o) {
            if (a) return !0;

            for (var _t250 = 0; _t250 < this.boxKeys.length; _t250++) {
              n.push({
                key: this.boxKeys[_t250],
                x1: this.bboxes[4 * _t250],
                y1: this.bboxes[4 * _t250 + 1],
                x2: this.bboxes[4 * _t250 + 2],
                y2: this.bboxes[4 * _t250 + 3]
              });
            }

            for (var _t251 = 0; _t251 < this.circleKeys.length; _t251++) {
              var _e234 = this.circles[3 * _t251],
                  _i175 = this.circles[3 * _t251 + 1],
                  _o62 = this.circles[3 * _t251 + 2];
              n.push({
                key: this.circleKeys[_t251],
                x1: _e234 - _o62,
                y1: _i175 - _o62,
                x2: _e234 + _o62,
                y2: _i175 + _o62
              });
            }

            return r ? n.filter(r) : n;
          }

          return this._forEachCell(t, e, i, o, this._queryCell, n, {
            hitTest: a,
            seenUids: {
              box: {},
              circle: {}
            }
          }, r), a ? n.length > 0 : n;
        }
      }, {
        key: "_queryCircle",
        value: function _queryCircle(t, e, i, o, a) {
          var r = t - i,
              n = t + i,
              s = e - i,
              l = e + i;
          if (n < 0 || r > this.width || l < 0 || s > this.height) return !o && [];
          var c = [];
          return this._forEachCell(r, s, n, l, this._queryCellCircle, c, {
            hitTest: o,
            circle: {
              x: t,
              y: e,
              radius: i
            },
            seenUids: {
              box: {},
              circle: {}
            }
          }, a), o ? c.length > 0 : c;
        }
      }, {
        key: "query",
        value: function query(t, e, i, o, a) {
          return this._query(t, e, i, o, !1, a);
        }
      }, {
        key: "hitTest",
        value: function hitTest(t, e, i, o, a) {
          return this._query(t, e, i, o, !0, a);
        }
      }, {
        key: "hitTestCircle",
        value: function hitTestCircle(t, e, i, o) {
          return this._queryCircle(t, e, i, !0, o);
        }
      }, {
        key: "_queryCell",
        value: function _queryCell(t, e, i, o, a, r, n, s) {
          var l = n.seenUids,
              c = this.boxCells[a];

          if (null !== c) {
            var _a92 = this.bboxes;

            var _iterator163 = _createForOfIteratorHelper(c),
                _step163;

            try {
              for (_iterator163.s(); !(_step163 = _iterator163.n()).done;) {
                var _h16 = _step163.value;

                if (!l.box[_h16]) {
                  l.box[_h16] = !0;

                  var _c26 = 4 * _h16;

                  if (t <= _a92[_c26 + 2] && e <= _a92[_c26 + 3] && i >= _a92[_c26 + 0] && o >= _a92[_c26 + 1] && (!s || s(this.boxKeys[_h16]))) {
                    if (n.hitTest) return r.push(!0), !0;
                    r.push({
                      key: this.boxKeys[_h16],
                      x1: _a92[_c26],
                      y1: _a92[_c26 + 1],
                      x2: _a92[_c26 + 2],
                      y2: _a92[_c26 + 3]
                    });
                  }
                }
              }
            } catch (err) {
              _iterator163.e(err);
            } finally {
              _iterator163.f();
            }
          }

          var h = this.circleCells[a];

          if (null !== h) {
            var _a93 = this.circles;

            var _iterator164 = _createForOfIteratorHelper(h),
                _step164;

            try {
              for (_iterator164.s(); !(_step164 = _iterator164.n()).done;) {
                var _c27 = _step164.value;

                if (!l.circle[_c27]) {
                  l.circle[_c27] = !0;

                  var _h17 = 3 * _c27;

                  if (this._circleAndRectCollide(_a93[_h17], _a93[_h17 + 1], _a93[_h17 + 2], t, e, i, o) && (!s || s(this.circleKeys[_c27]))) {
                    if (n.hitTest) return r.push(!0), !0;
                    {
                      var _t252 = _a93[_h17],
                          _e235 = _a93[_h17 + 1],
                          _i176 = _a93[_h17 + 2];
                      r.push({
                        key: this.circleKeys[_c27],
                        x1: _t252 - _i176,
                        y1: _e235 - _i176,
                        x2: _t252 + _i176,
                        y2: _e235 + _i176
                      });
                    }
                  }
                }
              }
            } catch (err) {
              _iterator164.e(err);
            } finally {
              _iterator164.f();
            }
          }
        }
      }, {
        key: "_queryCellCircle",
        value: function _queryCellCircle(t, e, i, o, a, r, n, s) {
          var l = n.circle,
              c = n.seenUids,
              h = this.boxCells[a];

          if (null !== h) {
            var _t253 = this.bboxes;

            var _iterator165 = _createForOfIteratorHelper(h),
                _step165;

            try {
              for (_iterator165.s(); !(_step165 = _iterator165.n()).done;) {
                var _e236 = _step165.value;

                if (!c.box[_e236]) {
                  c.box[_e236] = !0;

                  var _i177 = 4 * _e236;

                  if (this._circleAndRectCollide(l.x, l.y, l.radius, _t253[_i177 + 0], _t253[_i177 + 1], _t253[_i177 + 2], _t253[_i177 + 3]) && (!s || s(this.boxKeys[_e236]))) return r.push(!0), !0;
                }
              }
            } catch (err) {
              _iterator165.e(err);
            } finally {
              _iterator165.f();
            }
          }

          var u = this.circleCells[a];

          if (null !== u) {
            var _t254 = this.circles;

            var _iterator166 = _createForOfIteratorHelper(u),
                _step166;

            try {
              for (_iterator166.s(); !(_step166 = _iterator166.n()).done;) {
                var _e237 = _step166.value;

                if (!c.circle[_e237]) {
                  c.circle[_e237] = !0;

                  var _i178 = 3 * _e237;

                  if (this._circlesCollide(_t254[_i178], _t254[_i178 + 1], _t254[_i178 + 2], l.x, l.y, l.radius) && (!s || s(this.circleKeys[_e237]))) return r.push(!0), !0;
                }
              }
            } catch (err) {
              _iterator166.e(err);
            } finally {
              _iterator166.f();
            }
          }
        }
      }, {
        key: "_forEachCell",
        value: function _forEachCell(t, e, i, o, a, r, n, s) {
          var l = this._convertToXCellCoord(t),
              c = this._convertToYCellCoord(e),
              h = this._convertToXCellCoord(i),
              u = this._convertToYCellCoord(o);

          for (var _d13 = l; _d13 <= h; _d13++) {
            for (var _l40 = c; _l40 <= u; _l40++) {
              if (a.call(this, t, e, i, o, this.xCellCount * _l40 + _d13, r, n, s)) return;
            }
          }
        }
      }, {
        key: "_convertToXCellCoord",
        value: function _convertToXCellCoord(t) {
          return Math.max(0, Math.min(this.xCellCount - 1, Math.floor(t * this.xScale)));
        }
      }, {
        key: "_convertToYCellCoord",
        value: function _convertToYCellCoord(t) {
          return Math.max(0, Math.min(this.yCellCount - 1, Math.floor(t * this.yScale)));
        }
      }, {
        key: "_circlesCollide",
        value: function _circlesCollide(t, e, i, o, a, r) {
          var n = o - t,
              s = a - e,
              l = i + r;
          return l * l > n * n + s * s;
        }
      }, {
        key: "_circleAndRectCollide",
        value: function _circleAndRectCollide(t, e, i, o, a, r, n) {
          var s = (r - o) / 2,
              l = Math.abs(t - (o + s));
          if (l > s + i) return !1;
          var c = (n - a) / 2,
              h = Math.abs(e - (a + c));
          if (h > c + i) return !1;
          if (l <= s || h <= c) return !0;
          var u = l - s,
              d = h - c;
          return u * u + d * d <= i * i;
        }
      }]);

      return et;
    }();

    function it(e, i, o, a, r) {
      var n = t.create();
      return i ? (t.scale(n, n, [1 / r, 1 / r, 1]), o || t.rotateZ(n, n, a.angle)) : t.multiply(n, a.labelPlaneMatrix, e), n;
    }

    function ot(e, i, o, a, r) {
      if (i) {
        var _i179 = t.clone(e);

        return t.scale(_i179, _i179, [r, r, 1]), o || t.rotateZ(_i179, _i179, -a.angle), _i179;
      }

      return a.glCoordMatrix;
    }

    function at(e, i) {
      var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var a = [e.x, e.y, o, 1];
      o ? t.transformMat4(a, a, i) : pt(a, a, i);
      var r = a[3];
      return {
        point: new t.Point(a[0] / r, a[1] / r),
        signedDistanceFromCamera: r
      };
    }

    function rt(t, e) {
      return Math.min(.5 + t / e * .5, 1.5);
    }

    function nt(t, e) {
      var i = t[0] / t[3],
          o = t[1] / t[3];
      return i >= -e[0] && i <= e[0] && o >= -e[1] && o <= e[1];
    }

    function st(e, i, o, a, r, n, s, l, c) {
      var h = a ? e.textSizeData : e.iconSizeData,
          u = t.evaluateSizeForZoom(h, o.transform.zoom),
          d = [256 / o.width * 2 + 1, 256 / o.height * 2 + 1],
          _ = a ? e.text.dynamicLayoutVertexArray : e.icon.dynamicLayoutVertexArray;

      _.clear();

      var m = e.lineVertexArray,
          p = a ? e.text.placedSymbolArray : e.icon.placedSymbolArray,
          f = o.transform.width / o.transform.height;
      var g = !1;

      for (var _a94 = 0; _a94 < p.length; _a94++) {
        var _v10 = p.get(_a94);

        if (_v10.hidden || _v10.writingMode === t.WritingMode.vertical && !g) {
          mt(_v10.numGlyphs, _);
          continue;
        }

        g = !1;

        var _x10 = c ? c({
          x: _v10.anchorX,
          y: _v10.anchorY
        }) : 0,
            _y10 = [_v10.anchorX, _v10.anchorY, _x10, 1];

        if (t.transformMat4(_y10, _y10, i), !nt(_y10, d)) {
          mt(_v10.numGlyphs, _);
          continue;
        }

        var _b8 = rt(o.transform.cameraToCenterDistance, _y10[3]),
            _w8 = t.evaluateSizeForFeature(h, u, _v10),
            _T3 = s ? _w8 / _b8 : _w8 * _b8,
            _E2 = new t.Point(_v10.anchorX, _v10.anchorY),
            _C = at(_E2, r, _x10);

        if (_C.signedDistanceFromCamera <= 0) {
          mt(_v10.numGlyphs, _);
          continue;
        }

        var _S5 = _C.point;
        var _I3 = {};

        var _P = s ? null : c,
            _M = ht(_v10, _T3, !1, l, i, r, n, e.glyphOffsetArray, m, _, _S5, _E2, _I3, f, _P);

        g = _M.useVertical, _P && _M.needsFlipping && (_I3 = {}), (_M.notEnoughRoom || g || _M.needsFlipping && ht(_v10, _T3, !0, l, i, r, n, e.glyphOffsetArray, m, _, _S5, _E2, _I3, f, _P).notEnoughRoom) && mt(_v10.numGlyphs, _);
      }

      a ? e.text.dynamicLayoutVertexBuffer.updateData(_) : e.icon.dynamicLayoutVertexBuffer.updateData(_);
    }

    function lt(t, e, i, o, a, r, n, s, l, c, h, u, d) {
      var _ = s.glyphStartIndex + s.numGlyphs,
          m = s.lineStartIndex,
          p = s.lineStartIndex + s.lineLength,
          f = e.getoffsetX(s.glyphStartIndex),
          g = e.getoffsetX(_ - 1),
          v = dt(t * f, i, o, a, r, n, s.segment, m, p, l, c, h, u, d, !0);

      if (!v) return null;
      var x = dt(t * g, i, o, a, r, n, s.segment, m, p, l, c, h, u, d, !0);
      return x ? {
        first: v,
        last: x
      } : null;
    }

    function ct(e, i, o, a) {
      return e === t.WritingMode.horizontal && Math.abs(o.y - i.y) > Math.abs(o.x - i.x) * a ? {
        useVertical: !0
      } : (e === t.WritingMode.vertical ? i.y < o.y : i.x > o.x) ? {
        needsFlipping: !0
      } : null;
    }

    function ht(e, i, o, a, r, n, s, l, c, h, u, d, _, m, p) {
      var f = i / 24,
          g = e.lineOffsetX * f,
          v = e.lineOffsetY * f;
      var x;

      if (e.numGlyphs > 1) {
        var _t255 = e.glyphStartIndex + e.numGlyphs,
            _i180 = e.lineStartIndex,
            _r212 = e.lineStartIndex + e.lineLength,
            _h18 = lt(f, l, g, v, o, u, d, e, c, n, _, p);

        if (!_h18) return {
          notEnoughRoom: !0
        };
        var _y11 = at(_h18.first.point, s).point,
            _b9 = at(_h18.last.point, s).point;

        if (a && !o) {
          var _t256 = ct(e.writingMode, _y11, _b9, m);

          if (_t256) return _t256;
        }

        x = [_h18.first];

        for (var _a95 = e.glyphStartIndex + 1; _a95 < _t255 - 1; _a95++) {
          x.push(dt(f * l.getoffsetX(_a95), g, v, o, u, d, e.segment, _i180, _r212, c, n, _, p));
        }

        x.push(_h18.last);
      } else {
        if (a && !o) {
          var _i182 = at(d, r).point,
              _o63 = e.lineStartIndex + e.segment + 1,
              _a96 = new t.Point(c.getx(_o63), c.gety(_o63)),
              _n126 = at(_a96, r),
              _s99 = _n126.signedDistanceFromCamera > 0 ? _n126.point : ut(d, _a96, _i182, 1, r),
              _l41 = ct(e.writingMode, _i182, _s99, m);

          if (_l41) return _l41;
        }

        var _i181 = dt(f * l.getoffsetX(e.glyphStartIndex), g, v, o, u, d, e.segment, e.lineStartIndex, e.lineStartIndex + e.lineLength, c, n, _, p);

        if (!_i181) return {
          notEnoughRoom: !0
        };
        x = [_i181];
      }

      var _iterator167 = _createForOfIteratorHelper(x),
          _step167;

      try {
        for (_iterator167.s(); !(_step167 = _iterator167.n()).done;) {
          var _e238 = _step167.value;
          t.addDynamicAttributes(h, _e238.point, _e238.angle);
        }
      } catch (err) {
        _iterator167.e(err);
      } finally {
        _iterator167.f();
      }

      return {};
    }

    function ut(t, e, i, o, a, r) {
      var n = t.add(t.sub(e)._unit()),
          s = at(n, a, r ? r(n) : 0).point,
          l = i.sub(s);
      return i.add(l._mult(o / l.mag()));
    }

    function dt(e, i, o, a, r, n, s, l, c, h, u, d, _, m, p) {
      var f = a ? e - i : e + i;
      var g = f > 0 ? 1 : -1,
          v = 0;
      a && (g *= -1, v = Math.PI), g < 0 && (v += Math.PI);
      var x = g > 0 ? l + s : l + s + 1,
          y = r,
          b = r,
          w = 0,
          T = 0;
      var E = Math.abs(f),
          C = [],
          S = [];
      var I = n;

      var P = function P() {
        var e = x - g;
        return 0 === w ? n : new t.Point(h.getx(e), h.gety(e));
      },
          M = function M() {
        return ut(P(), I, b, E - w + 1, u, _);
      };

      for (; w + T <= E;) {
        if (x += g, x < l || x >= c) return null;

        if (b = y, C.push(y), m && S.push(I || P()), y = d[x], void 0 === y) {
          I = new t.Point(h.getx(x), h.gety(x));

          var _e239 = at(I, u, _ ? _(I) : 0);

          y = _e239.signedDistanceFromCamera > 0 ? d[x] = _e239.point : M();
        } else I = null;

        w += T, T = b.dist(y);
      }

      p && _ && (I = I || new t.Point(h.getx(x), h.gety(x)), d[x] = y = void 0 === d[x] ? y : M(), T = b.dist(y));

      var z = (E - w) / T,
          A = y.sub(b),
          D = A.mult(z)._add(b);

      o && D._add(A._unit()._perp()._mult(o * g));
      var L = v + Math.atan2(y.y - b.y, y.x - b.x);
      return C.push(D), m && (I = I || new t.Point(h.getx(x), h.gety(x)), S.push(function (e, i, o) {
        var a = 1 - o;
        return new t.Point(e.x * a + i.x * o, e.y * a + i.y * o);
      }(S.length > 0 ? S[S.length - 1] : I, I, z))), {
        point: D,
        angle: L,
        path: C,
        tilePath: S
      };
    }

    var _t = new Float32Array([-1 / 0, -1 / 0, 0, -1 / 0, -1 / 0, 0, -1 / 0, -1 / 0, 0, -1 / 0, -1 / 0, 0]);

    function mt(t, e) {
      for (var _i183 = 0; _i183 < t; _i183++) {
        var _t257 = e.length;
        e.resize(_t257 + 4), e.float32.set(_t, 3 * _t257);
      }
    }

    function pt(t, e, i) {
      var o = e[0],
          a = e[1];
      return t[0] = i[0] * o + i[4] * a + i[12], t[1] = i[1] * o + i[5] * a + i[13], t[3] = i[3] * o + i[7] * a + i[15], t;
    }

    var ft = /*#__PURE__*/function () {
      function ft(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new et(t.width + 200, t.height + 200, 25);
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new et(t.width + 200, t.height + 200, 25);

        _classCallCheck(this, ft);

        this.transform = t, this.grid = e, this.ignoredGrid = i, this.pitchfactor = Math.cos(t._pitch) * t.cameraToCenterDistance, this.screenRightBoundary = t.width + 100, this.screenBottomBoundary = t.height + 100, this.gridRightBoundary = t.width + 200, this.gridBottomBoundary = t.height + 200;
      }

      _createClass(ft, [{
        key: "placeCollisionBox",
        value: function placeCollisionBox(t, e, i, o, a, r, n) {
          var s = this.projectAndGetPerspectiveRatio(r, e.anchorPointX, e.anchorPointY, e.elevation),
              l = a * s.perspectiveRatio,
              c = (e.x1 * t + i.x - e.padding) * l + s.point.x,
              h = (e.y1 * t + i.y - e.padding) * l + s.point.y,
              u = (e.x2 * t + i.x + e.padding) * l + s.point.x,
              d = (e.y2 * t + i.y + e.padding) * l + s.point.y,
              _ = s.perspectiveRatio <= .55;

          return !this.isInsideGrid(c, h, u, d) || !o && this.grid.hitTest(c, h, u, d, n) || _ ? {
            box: [],
            offscreen: !1
          } : {
            box: [c, h, u, d],
            offscreen: this.isOffscreen(c, h, u, d)
          };
        }
      }, {
        key: "placeCollisionCircles",
        value: function placeCollisionCircles(e, i, o, a, r, n, s, l, c, h, u, d, _, m) {
          var p = [],
              f = this.transform.elevation,
              g = f ? function (t) {
            return f.getAtTileOffset(m, t.x, t.y);
          } : function (t) {
            return 0;
          },
              v = new t.Point(i.anchorX, i.anchorY),
              x = g(v),
              y = at(v, n, x),
              b = rt(this.transform.cameraToCenterDistance, y.signedDistanceFromCamera),
              w = (h ? r / b : r * b) / t.ONE_EM,
              T = at(v, s, x).point,
              E = y.signedDistanceFromCamera > 0 ? lt(w, a, i.lineOffsetX * w, i.lineOffsetY * w, !1, T, v, i, o, s, {}, f && !h ? g : null, h && !!f) : null;
          var C = !1,
              S = !1,
              I = !0;

          if (E) {
            var _i184 = .5 * d * b + _,
                _o64 = new t.Point(-100, -100),
                _a97 = new t.Point(this.screenRightBoundary, this.screenBottomBoundary),
                _r213 = new tt(),
                _n127 = E.first,
                _s100 = E.last;

            var _h19 = [];

            for (var _t258 = _n127.path.length - 1; _t258 >= 1; _t258--) {
              _h19.push(_n127.path[_t258]);
            }

            for (var _t259 = 1; _t259 < _s100.path.length; _t259++) {
              _h19.push(_s100.path[_t259]);
            }

            var _m12 = 2.5 * _i184;

            if (l) {
              var _t260 = _h19.map(f ? function (t, e) {
                var i = g(e < _n127.path.length - 1 ? _n127.tilePath[_n127.path.length - 1 - e] : _s100.tilePath[e - _n127.path.length + 2]);
                return at(t, l, i);
              } : function (t) {
                return at(t, l);
              });

              _h19 = _t260.some(function (t) {
                return t.signedDistanceFromCamera <= 0;
              }) ? [] : _t260.map(function (t) {
                return t.point;
              });
            }

            var _v11 = [];

            if (_h19.length > 0) {
              var _e240 = _h19[0].clone(),
                  _i185 = _h19[0].clone();

              for (var _t261 = 1; _t261 < _h19.length; _t261++) {
                _e240.x = Math.min(_e240.x, _h19[_t261].x), _e240.y = Math.min(_e240.y, _h19[_t261].y), _i185.x = Math.max(_i185.x, _h19[_t261].x), _i185.y = Math.max(_i185.y, _h19[_t261].y);
              }

              _v11 = _e240.x >= _o64.x && _i185.x <= _a97.x && _e240.y >= _o64.y && _i185.y <= _a97.y ? [_h19] : _i185.x < _o64.x || _e240.x > _a97.x || _i185.y < _o64.y || _e240.y > _a97.y ? [] : t.clipLine([_h19], _o64.x, _o64.y, _a97.x, _a97.y);
            }

            var _iterator168 = _createForOfIteratorHelper(_v11),
                _step168;

            try {
              for (_iterator168.s(); !(_step168 = _iterator168.n()).done;) {
                var _t262 = _step168.value;

                _r213.reset(_t262, .25 * _i184);

                var _o65 = 0;
                _o65 = _r213.length <= .5 * _i184 ? 1 : Math.ceil(_r213.paddedLength / _m12) + 1;

                for (var _t263 = 0; _t263 < _o65; _t263++) {
                  var _a98 = _t263 / Math.max(_o65 - 1, 1),
                      _n128 = _r213.lerp(_a98),
                      _s101 = _n128.x + 100,
                      _l42 = _n128.y + 100;

                  p.push(_s101, _l42, _i184, 0);

                  var _h20 = _s101 - _i184,
                      _d14 = _l42 - _i184,
                      _10 = _s101 + _i184,
                      _m13 = _l42 + _i184;

                  if (I = I && this.isOffscreen(_h20, _d14, _10, _m13), S = S || this.isInsideGrid(_h20, _d14, _10, _m13), !e && this.grid.hitTestCircle(_s101, _l42, _i184, u) && (C = !0, !c)) return {
                    circles: [],
                    offscreen: !1,
                    collisionDetected: C
                  };
                }
              }
            } catch (err) {
              _iterator168.e(err);
            } finally {
              _iterator168.f();
            }
          }

          return {
            circles: !c && C || !S ? [] : p,
            offscreen: I,
            collisionDetected: C
          };
        }
      }, {
        key: "queryRenderedSymbols",
        value: function queryRenderedSymbols(e) {
          if (0 === e.length || 0 === this.grid.keysLength() && 0 === this.ignoredGrid.keysLength()) return {};
          var i = [];
          var o = 1 / 0,
              a = 1 / 0,
              r = -1 / 0,
              n = -1 / 0;

          var _iterator169 = _createForOfIteratorHelper(e),
              _step169;

          try {
            for (_iterator169.s(); !(_step169 = _iterator169.n()).done;) {
              var _s102 = _step169.value;

              var _e241 = new t.Point(_s102.x + 100, _s102.y + 100);

              o = Math.min(o, _e241.x), a = Math.min(a, _e241.y), r = Math.max(r, _e241.x), n = Math.max(n, _e241.y), i.push(_e241);
            }
          } catch (err) {
            _iterator169.e(err);
          } finally {
            _iterator169.f();
          }

          var s = this.grid.query(o, a, r, n).concat(this.ignoredGrid.query(o, a, r, n)),
              l = {},
              c = {};

          var _iterator170 = _createForOfIteratorHelper(s),
              _step170;

          try {
            for (_iterator170.s(); !(_step170 = _iterator170.n()).done;) {
              var _e242 = _step170.value;
              var _o66 = _e242.key;
              if (void 0 === l[_o66.bucketInstanceId] && (l[_o66.bucketInstanceId] = {}), l[_o66.bucketInstanceId][_o66.featureIndex]) continue;
              var _a99 = [new t.Point(_e242.x1, _e242.y1), new t.Point(_e242.x2, _e242.y1), new t.Point(_e242.x2, _e242.y2), new t.Point(_e242.x1, _e242.y2)];
              t.polygonIntersectsPolygon(i, _a99) && (l[_o66.bucketInstanceId][_o66.featureIndex] = !0, void 0 === c[_o66.bucketInstanceId] && (c[_o66.bucketInstanceId] = []), c[_o66.bucketInstanceId].push(_o66.featureIndex));
            }
          } catch (err) {
            _iterator170.e(err);
          } finally {
            _iterator170.f();
          }

          return c;
        }
      }, {
        key: "insertCollisionBox",
        value: function insertCollisionBox(t, e, i, o, a) {
          (e ? this.ignoredGrid : this.grid).insert({
            bucketInstanceId: i,
            featureIndex: o,
            collisionGroupID: a
          }, t[0], t[1], t[2], t[3]);
        }
      }, {
        key: "insertCollisionCircles",
        value: function insertCollisionCircles(t, e, i, o, a) {
          var r = e ? this.ignoredGrid : this.grid,
              n = {
            bucketInstanceId: i,
            featureIndex: o,
            collisionGroupID: a
          };

          for (var _e243 = 0; _e243 < t.length; _e243 += 4) {
            r.insertCircle(n, t[_e243], t[_e243 + 1], t[_e243 + 2]);
          }
        }
      }, {
        key: "projectAndGetPerspectiveRatio",
        value: function projectAndGetPerspectiveRatio(e, i, o, a) {
          var r = [i, o, 0, 1];
          return a ? (r[2] = a, t.transformMat4(r, r, e)) : pt(r, r, e), {
            point: new t.Point((r[0] / r[3] + 1) / 2 * this.transform.width + 100, (-r[1] / r[3] + 1) / 2 * this.transform.height + 100),
            perspectiveRatio: Math.min(.5 + this.transform.cameraToCenterDistance / r[3] * .5, 1.5)
          };
        }
      }, {
        key: "isOffscreen",
        value: function isOffscreen(t, e, i, o) {
          return i < 100 || t >= this.screenRightBoundary || o < 100 || e > this.screenBottomBoundary;
        }
      }, {
        key: "isInsideGrid",
        value: function isInsideGrid(t, e, i, o) {
          return i >= 0 && t < this.gridRightBoundary && o >= 0 && e < this.gridBottomBoundary;
        }
      }, {
        key: "getViewportMatrix",
        value: function getViewportMatrix() {
          var e = t.identity([]);
          return t.translate(e, e, [-100, -100, 0]), e;
        }
      }]);

      return ft;
    }();

    var gt = /*#__PURE__*/function () {
      function gt(t, e, i, o) {
        _classCallCheck(this, gt);

        this.opacity = t ? Math.max(0, Math.min(1, t.opacity + (t.placed ? e : -e))) : o && i ? 1 : 0, this.placed = i;
      }

      _createClass(gt, [{
        key: "isHidden",
        value: function isHidden() {
          return 0 === this.opacity && !this.placed;
        }
      }]);

      return gt;
    }();

    var vt = /*#__PURE__*/function () {
      function vt(t, e, i, o, a) {
        _classCallCheck(this, vt);

        this.text = new gt(t ? t.text : null, e, i, a), this.icon = new gt(t ? t.icon : null, e, o, a);
      }

      _createClass(vt, [{
        key: "isHidden",
        value: function isHidden() {
          return this.text.isHidden() && this.icon.isHidden();
        }
      }]);

      return vt;
    }();

    var xt = function xt(t, e, i) {
      _classCallCheck(this, xt);

      this.text = t, this.icon = e, this.skipFade = i;
    };

    var yt = function yt() {
      _classCallCheck(this, yt);

      this.invProjMatrix = t.create(), this.viewportMatrix = t.create(), this.circles = [];
    };

    var bt = function bt(t, e, i, o, a) {
      _classCallCheck(this, bt);

      this.bucketInstanceId = t, this.featureIndex = e, this.sourceLayerIndex = i, this.bucketIndex = o, this.tileID = a;
    };

    var wt = /*#__PURE__*/function () {
      function wt(t) {
        _classCallCheck(this, wt);

        this.crossSourceCollisions = t, this.maxGroupID = 0, this.collisionGroups = {};
      }

      _createClass(wt, [{
        key: "get",
        value: function get(t) {
          if (this.crossSourceCollisions) return {
            ID: 0,
            predicate: null
          };

          if (!this.collisionGroups[t]) {
            var _e244 = ++this.maxGroupID;

            this.collisionGroups[t] = {
              ID: _e244,
              predicate: function predicate(t) {
                return t.collisionGroupID === _e244;
              }
            };
          }

          return this.collisionGroups[t];
        }
      }]);

      return wt;
    }();

    function Tt(e, i, o, a, r) {
      var _t$getAnchorAlignment = t.getAnchorAlignment(e),
          n = _t$getAnchorAlignment.horizontalAlign,
          s = _t$getAnchorAlignment.verticalAlign,
          l = -(n - .5) * i,
          c = -(s - .5) * o,
          h = t.evaluateVariableOffset(e, a);

      return new t.Point(l + h[0] * r, c + h[1] * r);
    }

    function Et(e, i, o, a, r) {
      var n = new t.Point(e, i);
      return o && n._rotate(a ? r : -r), n;
    }

    var Ct = /*#__PURE__*/function () {
      function Ct(t, e, i, o) {
        _classCallCheck(this, Ct);

        this.transform = t.clone(), this.collisionIndex = new ft(this.transform), this.placements = {}, this.opacities = {}, this.variableOffsets = {}, this.stale = !1, this.commitTime = 0, this.fadeDuration = e, this.retainedQueryData = {}, this.collisionGroups = new wt(i), this.collisionCircleArrays = {}, this.prevPlacement = o, o && (o.prevPlacement = void 0), this.placedOrientations = {};
      }

      _createClass(Ct, [{
        key: "getBucketParts",
        value: function getBucketParts(e, i, o, a) {
          var r = o.getBucket(i),
              n = o.latestFeatureIndex;
          if (!r || !n || i.id !== r.layerIds[0]) return;

          var s = o.collisionBoxArray,
              l = r.layers[0].layout,
              c = Math.pow(2, this.transform.zoom - o.tileID.overscaledZ),
              h = o.tileSize / t.EXTENT,
              u = this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),
              d = "map" === l.get("text-pitch-alignment"),
              _ = "map" === l.get("text-rotation-alignment"),
              m = C(o, 1, this.transform.zoom),
              p = it(u, d, _, this.transform, m);

          var f = null;

          if (d) {
            var _e245 = ot(u, d, _, this.transform, m);

            f = t.multiply([], this.transform.labelPlaneMatrix, _e245);
          }

          this.retainedQueryData[r.bucketInstanceId] = new bt(r.bucketInstanceId, n, r.sourceLayerIndex, r.index, o.tileID);
          var g = {
            bucket: r,
            layout: l,
            posMatrix: u,
            textLabelPlaneMatrix: p,
            labelToScreenMatrix: f,
            scale: c,
            textPixelRatio: h,
            holdingForFade: o.holdingForFade(),
            collisionBoxArray: s,
            partiallyEvaluatedTextSize: t.evaluateSizeForZoom(r.textSizeData, this.transform.zoom),
            partiallyEvaluatedIconSize: t.evaluateSizeForZoom(r.iconSizeData, this.transform.zoom),
            collisionGroup: this.collisionGroups.get(r.sourceID)
          };

          if (a) {
            var _iterator171 = _createForOfIteratorHelper(r.sortKeyRanges),
                _step171;

            try {
              for (_iterator171.s(); !(_step171 = _iterator171.n()).done;) {
                var _t264 = _step171.value;
                var _i186 = _t264.sortKey,
                    _o67 = _t264.symbolInstanceStart,
                    _a100 = _t264.symbolInstanceEnd;
                e.push({
                  sortKey: _i186,
                  symbolInstanceStart: _o67,
                  symbolInstanceEnd: _a100,
                  parameters: g
                });
              }
            } catch (err) {
              _iterator171.e(err);
            } finally {
              _iterator171.f();
            }
          } else e.push({
            symbolInstanceStart: 0,
            symbolInstanceEnd: r.symbolInstances.length,
            parameters: g
          });
        }
      }, {
        key: "attemptAnchorPlacement",
        value: function attemptAnchorPlacement(t, e, i, o, a, r, n, s, l, c, h, u, d, _, m, p, f, g) {
          var v = [u.textOffset0, u.textOffset1],
              x = _.getSymbolInstanceTextSize(f, u, this.transform.zoom, d),
              y = Tt(t, i, o, v, a),
              b = this.collisionIndex.placeCollisionBox(x, e, Et(y.x, y.y, r, n, this.transform.angle), h, s, l, c.predicate);

          if ((!p || 0 !== this.collisionIndex.placeCollisionBox(_.getSymbolInstanceIconSize(g, this.transform.zoom, d), p, Et(y.x, y.y, r, n, this.transform.angle), h, s, l, c.predicate).box.length) && b.box.length > 0) {
            var _e246;

            return this.prevPlacement && this.prevPlacement.variableOffsets[u.crossTileID] && this.prevPlacement.placements[u.crossTileID] && this.prevPlacement.placements[u.crossTileID].text && (_e246 = this.prevPlacement.variableOffsets[u.crossTileID].anchor), this.variableOffsets[u.crossTileID] = {
              textOffset: v,
              width: i,
              height: o,
              anchor: t,
              textBoxScale: a,
              prevAnchor: _e246
            }, this.markUsedJustification(_, t, u, m), _.allowVerticalPlacement && (this.markUsedOrientation(_, m, u), this.placedOrientations[u.crossTileID] = m), {
              shift: y,
              placedGlyphBoxes: b
            };
          }
        }
      }, {
        key: "placeLayerBucketPart",
        value: function placeLayerBucketPart(e, i, o) {
          var _this83 = this;

          var _e$parameters = e.parameters,
              a = _e$parameters.bucket,
              r = _e$parameters.layout,
              n = _e$parameters.posMatrix,
              s = _e$parameters.textLabelPlaneMatrix,
              l = _e$parameters.labelToScreenMatrix,
              c = _e$parameters.textPixelRatio,
              h = _e$parameters.holdingForFade,
              u = _e$parameters.collisionBoxArray,
              d = _e$parameters.partiallyEvaluatedTextSize,
              _ = _e$parameters.partiallyEvaluatedIconSize,
              m = _e$parameters.collisionGroup,
              p = r.get("text-optional"),
              f = r.get("icon-optional"),
              g = r.get("text-allow-overlap"),
              v = r.get("icon-allow-overlap"),
              x = "map" === r.get("text-rotation-alignment"),
              y = "map" === r.get("text-pitch-alignment"),
              b = "none" !== r.get("icon-text-fit"),
              w = "viewport-y" === r.get("symbol-z-order"),
              T = g && (v || !a.hasIconData() || f),
              E = v && (g || !a.hasTextData() || p);
          !a.collisionArrays && u && a.deserializeCollisionBoxes(u), o && a.updateCollisionDebugBuffers(this.transform.zoom, u);

          var C = function C(e, u, w) {
            if (i[e.crossTileID]) return;
            if (h) return void (_this83.placements[e.crossTileID] = new xt(!1, !1, !1));
            var C = !1,
                S = !1,
                I = !0,
                P = null,
                M = {
              box: null,
              offscreen: null
            },
                z = {
              box: null,
              offscreen: null
            },
                A = null,
                D = null,
                L = null,
                R = 0,
                k = 0,
                B = 0;
            w.textFeatureIndex ? R = w.textFeatureIndex : e.useRuntimeCollisionCircles && (R = e.featureIndex), w.verticalTextFeatureIndex && (k = w.verticalTextFeatureIndex);

            var O = function O(t) {
              (_this83.transform.elevation || t.elevation) && (t.elevation = _this83.transform.elevation ? _this83.transform.elevation.getAtTileOffset(_this83.retainedQueryData[a.bucketInstanceId].tileID, t.anchorPointX, t.anchorPointY) : 0);
            },
                F = w.textBox;

            if (F) {
              O(F);

              var _i187 = function _i187(i) {
                var o = t.WritingMode.horizontal;

                if (a.allowVerticalPlacement && !i && _this83.prevPlacement) {
                  var _t265 = _this83.prevPlacement.placedOrientations[e.crossTileID];
                  _t265 && (_this83.placedOrientations[e.crossTileID] = _t265, o = _t265, _this83.markUsedOrientation(a, o, e));
                }

                return o;
              },
                  _o68 = function _o68(i, o) {
                if (a.allowVerticalPlacement && e.numVerticalGlyphVertices > 0 && w.verticalTextBox) {
                  var _iterator172 = _createForOfIteratorHelper(a.writingModes),
                      _step172;

                  try {
                    for (_iterator172.s(); !(_step172 = _iterator172.n()).done;) {
                      var _e247 = _step172.value;
                      if (_e247 === t.WritingMode.vertical ? (M = o(), z = M) : M = i(), M && M.box && M.box.length) break;
                    }
                  } catch (err) {
                    _iterator172.e(err);
                  } finally {
                    _iterator172.f();
                  }
                } else M = i();
              };

              if (r.get("text-variable-anchor")) {
                var _s103 = r.get("text-variable-anchor");

                if (_this83.prevPlacement && _this83.prevPlacement.variableOffsets[e.crossTileID]) {
                  var _t266 = _this83.prevPlacement.variableOffsets[e.crossTileID];
                  _s103.indexOf(_t266.anchor) > 0 && (_s103 = _s103.filter(function (e) {
                    return e !== _t266.anchor;
                  }), _s103.unshift(_t266.anchor));
                }

                var _l43 = function _l43(t, i, o) {
                  var r = e.textBoxScale,
                      l = (t.x2 - t.x1) * r + 2 * t.padding,
                      h = (t.y2 - t.y1) * r + 2 * t.padding,
                      p = b && !v ? i : null;
                  p && O(p);
                  var f = {
                    box: [],
                    offscreen: !1
                  };
                  var w = g ? 2 * _s103.length : _s103.length;

                  for (var _i188 = 0; _i188 < w; ++_i188) {
                    var _g12 = _this83.attemptAnchorPlacement(_s103[_i188 % _s103.length], t, l, h, r, x, y, c, n, m, _i188 >= _s103.length, e, u, a, o, p, d, _);

                    if (_g12 && (f = _g12.placedGlyphBoxes, f && f.box && f.box.length)) {
                      C = !0, P = _g12.shift;
                      break;
                    }
                  }

                  return f;
                };

                _o68(function () {
                  return _l43(F, w.iconBox, t.WritingMode.horizontal);
                }, function () {
                  var i = w.verticalTextBox;
                  return i && O(i), a.allowVerticalPlacement && !(M && M.box && M.box.length) && e.numVerticalGlyphVertices > 0 && i ? _l43(i, w.verticalIconBox, t.WritingMode.vertical) : {
                    box: null,
                    offscreen: null
                  };
                }), M && (C = M.box, I = M.offscreen);

                var _h21 = _i187(M && M.box);

                if (!C && _this83.prevPlacement) {
                  var _t267 = _this83.prevPlacement.variableOffsets[e.crossTileID];
                  _t267 && (_this83.variableOffsets[e.crossTileID] = _t267, _this83.markUsedJustification(a, _t267.anchor, e, _h21));
                }
              } else {
                var _r214 = function _r214(i, o) {
                  var r = a.getSymbolInstanceTextSize(d, e, _this83.transform.zoom, u),
                      s = _this83.collisionIndex.placeCollisionBox(r, i, new t.Point(0, 0), g, c, n, m.predicate);

                  return s && s.box && s.box.length && (_this83.markUsedOrientation(a, o, e), _this83.placedOrientations[e.crossTileID] = o), s;
                };

                _o68(function () {
                  return _r214(F, t.WritingMode.horizontal);
                }, function () {
                  var i = w.verticalTextBox;
                  return a.allowVerticalPlacement && e.numVerticalGlyphVertices > 0 && i ? (O(i), _r214(i, t.WritingMode.vertical)) : {
                    box: null,
                    offscreen: null
                  };
                }), _i187(M && M.box && M.box.length);
              }
            }

            if (A = M, C = A && A.box && A.box.length > 0, I = A && A.offscreen, e.useRuntimeCollisionCircles) {
              var _i189 = a.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),
                  _c28 = t.evaluateSizeForFeature(a.textSizeData, d, _i189),
                  _h22 = r.get("text-padding");

              D = _this83.collisionIndex.placeCollisionCircles(g, _i189, a.lineVertexArray, a.glyphOffsetArray, _c28, n, s, l, o, y, m.predicate, e.collisionCircleDiameter, _h22, _this83.retainedQueryData[a.bucketInstanceId].tileID), C = g || D.circles.length > 0 && !D.collisionDetected, I = I && D.offscreen;
            }

            if (w.iconFeatureIndex && (B = w.iconFeatureIndex), w.iconBox) {
              var _e248 = function _e248(e) {
                O(e);
                var i = b && P ? Et(P.x, P.y, x, y, _this83.transform.angle) : new t.Point(0, 0),
                    o = a.getSymbolInstanceIconSize(_, _this83.transform.zoom, u);
                return _this83.collisionIndex.placeCollisionBox(o, e, i, v, c, n, m.predicate);
              };

              z && z.box && z.box.length && w.verticalIconBox ? (L = _e248(w.verticalIconBox), S = L.box.length > 0) : (L = _e248(w.iconBox), S = L.box.length > 0), I = I && L.offscreen;
            }

            var U = p || 0 === e.numHorizontalGlyphVertices && 0 === e.numVerticalGlyphVertices,
                N = f || 0 === e.numIconVertices;

            if (U || N ? N ? U || (S = S && C) : C = S && C : S = C = S && C, C && A && A.box && _this83.collisionIndex.insertCollisionBox(A.box, r.get("text-ignore-placement"), a.bucketInstanceId, z && z.box && k ? k : R, m.ID), S && L && _this83.collisionIndex.insertCollisionBox(L.box, r.get("icon-ignore-placement"), a.bucketInstanceId, B, m.ID), D && (C && _this83.collisionIndex.insertCollisionCircles(D.circles, r.get("text-ignore-placement"), a.bucketInstanceId, R, m.ID), o)) {
              var _t268 = a.bucketInstanceId;
              var _e249 = _this83.collisionCircleArrays[_t268];
              void 0 === _e249 && (_e249 = _this83.collisionCircleArrays[_t268] = new yt());

              for (var _t269 = 0; _t269 < D.circles.length; _t269 += 4) {
                _e249.circles.push(D.circles[_t269 + 0]), _e249.circles.push(D.circles[_t269 + 1]), _e249.circles.push(D.circles[_t269 + 2]), _e249.circles.push(D.collisionDetected ? 1 : 0);
              }
            }

            _this83.placements[e.crossTileID] = new xt(C || T, S || E, I || a.justReloaded), i[e.crossTileID] = !0;
          };

          if (w) {
            var _t270 = a.getSortedSymbolIndexes(this.transform.angle);

            for (var _e250 = _t270.length - 1; _e250 >= 0; --_e250) {
              var _i190 = _t270[_e250];
              C(a.symbolInstances.get(_i190), _i190, a.collisionArrays[_i190]);
            }
          } else for (var _t271 = e.symbolInstanceStart; _t271 < e.symbolInstanceEnd; _t271++) {
            C(a.symbolInstances.get(_t271), _t271, a.collisionArrays[_t271]);
          }

          if (o && a.bucketInstanceId in this.collisionCircleArrays) {
            var _e251 = this.collisionCircleArrays[a.bucketInstanceId];
            t.invert(_e251.invProjMatrix, n), _e251.viewportMatrix = this.collisionIndex.getViewportMatrix();
          }

          a.justReloaded = !1;
        }
      }, {
        key: "markUsedJustification",
        value: function markUsedJustification(e, i, o, a) {
          var r;
          r = a === t.WritingMode.vertical ? o.verticalPlacedTextSymbolIndex : {
            left: o.leftJustifiedTextSymbolIndex,
            center: o.centerJustifiedTextSymbolIndex,
            right: o.rightJustifiedTextSymbolIndex
          }[t.getAnchorJustification(i)];
          var n = [o.leftJustifiedTextSymbolIndex, o.centerJustifiedTextSymbolIndex, o.rightJustifiedTextSymbolIndex, o.verticalPlacedTextSymbolIndex];

          for (var _i191 = 0, _n129 = n; _i191 < _n129.length; _i191++) {
            var _t272 = _n129[_i191];
            _t272 >= 0 && (e.text.placedSymbolArray.get(_t272).crossTileID = r >= 0 && _t272 !== r ? 0 : o.crossTileID);
          }
        }
      }, {
        key: "markUsedOrientation",
        value: function markUsedOrientation(e, i, o) {
          var a = i === t.WritingMode.horizontal || i === t.WritingMode.horizontalOnly ? i : 0,
              r = i === t.WritingMode.vertical ? i : 0,
              n = [o.leftJustifiedTextSymbolIndex, o.centerJustifiedTextSymbolIndex, o.rightJustifiedTextSymbolIndex];

          for (var _i192 = 0, _n130 = n; _i192 < _n130.length; _i192++) {
            var _t273 = _n130[_i192];
            e.text.placedSymbolArray.get(_t273).placedOrientation = a;
          }

          o.verticalPlacedTextSymbolIndex && (e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation = r);
        }
      }, {
        key: "commit",
        value: function commit(t) {
          this.commitTime = t, this.zoomAtLastRecencyCheck = this.transform.zoom;
          var e = this.prevPlacement;
          var i = !1;
          this.prevZoomAdjustment = e ? e.zoomAdjustment(this.transform.zoom) : 0;
          var o = e ? e.symbolFadeChange(t) : 1,
              a = e ? e.opacities : {},
              r = e ? e.variableOffsets : {},
              n = e ? e.placedOrientations : {};

          for (var _t274 in this.placements) {
            var _e252 = this.placements[_t274],
                _r215 = a[_t274];
            _r215 ? (this.opacities[_t274] = new vt(_r215, o, _e252.text, _e252.icon), i = i || _e252.text !== _r215.text.placed || _e252.icon !== _r215.icon.placed) : (this.opacities[_t274] = new vt(null, o, _e252.text, _e252.icon, _e252.skipFade), i = i || _e252.text || _e252.icon);
          }

          for (var _t275 in a) {
            var _e253 = a[_t275];

            if (!this.opacities[_t275]) {
              var _a101 = new vt(_e253, o, !1, !1);

              _a101.isHidden() || (this.opacities[_t275] = _a101, i = i || _e253.text.placed || _e253.icon.placed);
            }
          }

          for (var _t276 in r) {
            this.variableOffsets[_t276] || !this.opacities[_t276] || this.opacities[_t276].isHidden() || (this.variableOffsets[_t276] = r[_t276]);
          }

          for (var _t277 in n) {
            this.placedOrientations[_t277] || !this.opacities[_t277] || this.opacities[_t277].isHidden() || (this.placedOrientations[_t277] = n[_t277]);
          }

          i ? this.lastPlacementChangeTime = t : "number" != typeof this.lastPlacementChangeTime && (this.lastPlacementChangeTime = e ? e.lastPlacementChangeTime : t);
        }
      }, {
        key: "updateLayerOpacities",
        value: function updateLayerOpacities(t, e) {
          var i = {};

          var _iterator173 = _createForOfIteratorHelper(e),
              _step173;

          try {
            for (_iterator173.s(); !(_step173 = _iterator173.n()).done;) {
              var _o69 = _step173.value;

              var _e254 = _o69.getBucket(t);

              _e254 && _o69.latestFeatureIndex && t.id === _e254.layerIds[0] && this.updateBucketOpacities(_e254, i, _o69.collisionBoxArray);
            }
          } catch (err) {
            _iterator173.e(err);
          } finally {
            _iterator173.f();
          }
        }
      }, {
        key: "updateBucketOpacities",
        value: function updateBucketOpacities(e, i, o) {
          var _this84 = this;

          e.hasTextData() && e.text.opacityVertexArray.clear(), e.hasIconData() && e.icon.opacityVertexArray.clear(), e.hasIconCollisionBoxData() && e.iconCollisionBox.collisionVertexArray.clear(), e.hasTextCollisionBoxData() && e.textCollisionBox.collisionVertexArray.clear();
          var a = e.layers[0].layout,
              r = new vt(null, 0, !1, !1, !0),
              n = a.get("text-allow-overlap"),
              s = a.get("icon-allow-overlap"),
              l = a.get("text-variable-anchor"),
              c = "map" === a.get("text-rotation-alignment"),
              h = "map" === a.get("text-pitch-alignment"),
              u = "none" !== a.get("icon-text-fit"),
              d = new vt(null, 0, n && (s || !e.hasIconData() || a.get("icon-optional")), s && (n || !e.hasTextData() || a.get("text-optional")), !0);
          !e.collisionArrays && o && (e.hasIconCollisionBoxData() || e.hasTextCollisionBoxData()) && e.deserializeCollisionBoxes(o);

          var _ = function _(t, e, i) {
            for (var _o70 = 0; _o70 < e / 4; _o70++) {
              t.opacityVertexArray.emplaceBack(i);
            }
          };

          var _loop7 = function _loop7(_o71) {
            var a = e.symbolInstances.get(_o71),
                n = a.numHorizontalGlyphVertices,
                s = a.numVerticalGlyphVertices,
                m = a.crossTileID;
            var p = _this84.opacities[m];
            i[m] ? p = r : p || (p = d, _this84.opacities[m] = p), i[m] = !0;
            var f = a.numIconVertices > 0,
                g = _this84.placedOrientations[a.crossTileID],
                v = g === t.WritingMode.vertical,
                x = g === t.WritingMode.horizontal || g === t.WritingMode.horizontalOnly;

            if (n > 0 || s > 0) {
              var _t279 = Rt(p.text);

              _(e.text, n, v ? kt : _t279), _(e.text, s, x ? kt : _t279);

              var _i193 = p.text.isHidden();

              [a.rightJustifiedTextSymbolIndex, a.centerJustifiedTextSymbolIndex, a.leftJustifiedTextSymbolIndex].forEach(function (t) {
                t >= 0 && (e.text.placedSymbolArray.get(t).hidden = _i193 || v ? 1 : 0);
              }), a.verticalPlacedTextSymbolIndex >= 0 && (e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden = _i193 || x ? 1 : 0);
              var _o72 = _this84.variableOffsets[a.crossTileID];
              _o72 && _this84.markUsedJustification(e, _o72.anchor, a, g);
              var _r216 = _this84.placedOrientations[a.crossTileID];
              _r216 && (_this84.markUsedJustification(e, "left", a, _r216), _this84.markUsedOrientation(e, _r216, a));
            }

            if (f) {
              var _t280 = Rt(p.icon),
                  _i194 = !(u && a.verticalPlacedIconSymbolIndex && v);

              a.placedIconSymbolIndex >= 0 && (_(e.icon, a.numIconVertices, _i194 ? _t280 : kt), e.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden = p.icon.isHidden()), a.verticalPlacedIconSymbolIndex >= 0 && (_(e.icon, a.numVerticalIconVertices, _i194 ? kt : _t280), e.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden = p.icon.isHidden());
            }

            if (e.hasIconCollisionBoxData() || e.hasTextCollisionBoxData()) {
              var _i195 = e.collisionArrays[_o71];

              if (_i195) {
                var _o73 = new t.Point(0, 0);

                if (_i195.textBox || _i195.verticalTextBox) {
                  var _t281 = !0;

                  if (l) {
                    var _e255 = _this84.variableOffsets[m];
                    _e255 ? (_o73 = Tt(_e255.anchor, _e255.width, _e255.height, _e255.textOffset, _e255.textBoxScale), c && _o73._rotate(h ? _this84.transform.angle : -_this84.transform.angle)) : _t281 = !1;
                  }

                  _i195.textBox && St(e.textCollisionBox.collisionVertexArray, p.text.placed, !_t281 || v, _o73.x, _o73.y), _i195.verticalTextBox && St(e.textCollisionBox.collisionVertexArray, p.text.placed, !_t281 || x, _o73.x, _o73.y);
                }

                var _a102 = Boolean(!x && _i195.verticalIconBox);

                _i195.iconBox && St(e.iconCollisionBox.collisionVertexArray, p.icon.placed, _a102, u ? _o73.x : 0, u ? _o73.y : 0), _i195.verticalIconBox && St(e.iconCollisionBox.collisionVertexArray, p.icon.placed, !_a102, u ? _o73.x : 0, u ? _o73.y : 0);
              }
            }
          };

          for (var _o71 = 0; _o71 < e.symbolInstances.length; _o71++) {
            _loop7(_o71);
          }

          if (e.sortFeatures(this.transform.angle), this.retainedQueryData[e.bucketInstanceId] && (this.retainedQueryData[e.bucketInstanceId].featureSortOrder = e.featureSortOrder), e.hasTextData() && e.text.opacityVertexBuffer && e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray), e.hasIconData() && e.icon.opacityVertexBuffer && e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray), e.hasIconCollisionBoxData() && e.iconCollisionBox.collisionVertexBuffer && e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray), e.hasTextCollisionBoxData() && e.textCollisionBox.collisionVertexBuffer && e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray), e.bucketInstanceId in this.collisionCircleArrays) {
            var _t278 = this.collisionCircleArrays[e.bucketInstanceId];
            e.placementInvProjMatrix = _t278.invProjMatrix, e.placementViewportMatrix = _t278.viewportMatrix, e.collisionCircleArray = _t278.circles, delete this.collisionCircleArrays[e.bucketInstanceId];
          }
        }
      }, {
        key: "symbolFadeChange",
        value: function symbolFadeChange(t) {
          return 0 === this.fadeDuration ? 1 : (t - this.commitTime) / this.fadeDuration + this.prevZoomAdjustment;
        }
      }, {
        key: "zoomAdjustment",
        value: function zoomAdjustment(t) {
          return Math.max(0, (this.transform.zoom - t) / 1.5);
        }
      }, {
        key: "hasTransitions",
        value: function hasTransitions(t) {
          return this.stale || t - this.lastPlacementChangeTime < this.fadeDuration;
        }
      }, {
        key: "stillRecent",
        value: function stillRecent(t, e) {
          var i = this.zoomAtLastRecencyCheck === e ? 1 - this.zoomAdjustment(e) : 1;
          return this.zoomAtLastRecencyCheck = e, this.commitTime + this.fadeDuration * i > t;
        }
      }, {
        key: "setStale",
        value: function setStale() {
          this.stale = !0;
        }
      }]);

      return Ct;
    }();

    function St(t, e, i, o, a) {
      t.emplaceBack(e ? 1 : 0, i ? 1 : 0, o || 0, a || 0), t.emplaceBack(e ? 1 : 0, i ? 1 : 0, o || 0, a || 0), t.emplaceBack(e ? 1 : 0, i ? 1 : 0, o || 0, a || 0), t.emplaceBack(e ? 1 : 0, i ? 1 : 0, o || 0, a || 0);
    }

    var It = Math.pow(2, 25),
        Pt = Math.pow(2, 24),
        Mt = Math.pow(2, 17),
        zt = Math.pow(2, 16),
        At = Math.pow(2, 9),
        Dt = Math.pow(2, 8),
        Lt = Math.pow(2, 1);

    function Rt(t) {
      if (0 === t.opacity && !t.placed) return 0;
      if (1 === t.opacity && t.placed) return 4294967295;
      var e = t.placed ? 1 : 0,
          i = Math.floor(127 * t.opacity);
      return i * It + e * Pt + i * Mt + e * zt + i * At + e * Dt + i * Lt + e;
    }

    var kt = 0;

    var Bt = /*#__PURE__*/function () {
      function Bt(t) {
        _classCallCheck(this, Bt);

        this._sortAcrossTiles = "viewport-y" !== t.layout.get("symbol-z-order") && void 0 !== t.layout.get("symbol-sort-key").constantOr(1), this._currentTileIndex = 0, this._currentPartIndex = 0, this._seenCrossTileIDs = {}, this._bucketParts = [];
      }

      _createClass(Bt, [{
        key: "continuePlacement",
        value: function continuePlacement(t, e, i, o, a) {
          var r = this._bucketParts;

          for (; this._currentTileIndex < t.length;) {
            if (e.getBucketParts(r, o, t[this._currentTileIndex], this._sortAcrossTiles), this._currentTileIndex++, a()) return !0;
          }

          for (this._sortAcrossTiles && (this._sortAcrossTiles = !1, r.sort(function (t, e) {
            return t.sortKey - e.sortKey;
          })); this._currentPartIndex < r.length;) {
            if (e.placeLayerBucketPart(r[this._currentPartIndex], this._seenCrossTileIDs, i), this._currentPartIndex++, a()) return !0;
          }

          return !1;
        }
      }]);

      return Bt;
    }();

    var Ot = /*#__PURE__*/function () {
      function Ot(t, e, i, o, a, r, n) {
        _classCallCheck(this, Ot);

        this.placement = new Ct(t, a, r, n), this._currentPlacementIndex = e.length - 1, this._forceFullPlacement = i, this._showCollisionBoxes = o, this._done = !1;
      }

      _createClass(Ot, [{
        key: "isDone",
        value: function isDone() {
          return this._done;
        }
      }, {
        key: "continuePlacement",
        value: function continuePlacement(e, i, o) {
          var _this85 = this;

          var a = t.browser.now(),
              r = function r() {
            var e = t.browser.now() - a;
            return !_this85._forceFullPlacement && e > 2;
          };

          for (; this._currentPlacementIndex >= 0;) {
            var _t282 = i[e[this._currentPlacementIndex]],
                _a103 = this.placement.collisionIndex.transform.zoom;

            if ("symbol" === _t282.type && (!_t282.minzoom || _t282.minzoom <= _a103) && (!_t282.maxzoom || _t282.maxzoom > _a103)) {
              if (this._inProgressLayer || (this._inProgressLayer = new Bt(_t282)), this._inProgressLayer.continuePlacement(o[_t282.source], this.placement, this._showCollisionBoxes, _t282, r)) return;
              delete this._inProgressLayer;
            }

            this._currentPlacementIndex--;
          }

          this._done = !0;
        }
      }, {
        key: "commit",
        value: function commit(t) {
          return this.placement.commit(t), this.placement;
        }
      }]);

      return Ot;
    }();

    var Ft = 512 / t.EXTENT / 2;

    var Ut = /*#__PURE__*/function () {
      function Ut(t, e, i) {
        _classCallCheck(this, Ut);

        this.tileID = t, this.indexedSymbolInstances = {}, this.bucketInstanceId = i;

        for (var _i196 = 0; _i196 < e.length; _i196++) {
          var _o74 = e.get(_i196),
              _a104 = _o74.key;

          this.indexedSymbolInstances[_a104] || (this.indexedSymbolInstances[_a104] = []), this.indexedSymbolInstances[_a104].push({
            crossTileID: _o74.crossTileID,
            coord: this.getScaledCoordinates(_o74, t)
          });
        }
      }

      _createClass(Ut, [{
        key: "getScaledCoordinates",
        value: function getScaledCoordinates(e, i) {
          var o = Ft / Math.pow(2, i.canonical.z - this.tileID.canonical.z);
          return {
            x: Math.floor((i.canonical.x * t.EXTENT + e.anchorX) * o),
            y: Math.floor((i.canonical.y * t.EXTENT + e.anchorY) * o)
          };
        }
      }, {
        key: "findMatches",
        value: function findMatches(t, e, i) {
          var o = this.tileID.canonical.z < e.canonical.z ? 1 : Math.pow(2, this.tileID.canonical.z - e.canonical.z);

          for (var _a105 = 0; _a105 < t.length; _a105++) {
            var _r217 = t.get(_a105);

            if (_r217.crossTileID) continue;
            var _n131 = this.indexedSymbolInstances[_r217.key];
            if (!_n131) continue;

            var _s104 = this.getScaledCoordinates(_r217, e);

            var _iterator174 = _createForOfIteratorHelper(_n131),
                _step174;

            try {
              for (_iterator174.s(); !(_step174 = _iterator174.n()).done;) {
                var _t283 = _step174.value;

                if (Math.abs(_t283.coord.x - _s104.x) <= o && Math.abs(_t283.coord.y - _s104.y) <= o && !i[_t283.crossTileID]) {
                  i[_t283.crossTileID] = !0, _r217.crossTileID = _t283.crossTileID;
                  break;
                }
              }
            } catch (err) {
              _iterator174.e(err);
            } finally {
              _iterator174.f();
            }
          }
        }
      }]);

      return Ut;
    }();

    var Nt = /*#__PURE__*/function () {
      function Nt() {
        _classCallCheck(this, Nt);

        this.maxCrossTileID = 0;
      }

      _createClass(Nt, [{
        key: "generate",
        value: function generate() {
          return ++this.maxCrossTileID;
        }
      }]);

      return Nt;
    }();

    var Zt = /*#__PURE__*/function () {
      function Zt() {
        _classCallCheck(this, Zt);

        this.indexes = {}, this.usedCrossTileIDs = {}, this.lng = 0;
      }

      _createClass(Zt, [{
        key: "handleWrapJump",
        value: function handleWrapJump(t) {
          var e = Math.round((t - this.lng) / 360);
          if (0 !== e) for (var _t284 in this.indexes) {
            var _i197 = this.indexes[_t284],
                _o75 = {};

            for (var _t285 in _i197) {
              var _a106 = _i197[_t285];
              _a106.tileID = _a106.tileID.unwrapTo(_a106.tileID.wrap + e), _o75[_a106.tileID.key] = _a106;
            }

            this.indexes[_t284] = _o75;
          }
          this.lng = t;
        }
      }, {
        key: "addBucket",
        value: function addBucket(t, e, i) {
          if (this.indexes[t.overscaledZ] && this.indexes[t.overscaledZ][t.key]) {
            if (this.indexes[t.overscaledZ][t.key].bucketInstanceId === e.bucketInstanceId) return !1;
            this.removeBucketCrossTileIDs(t.overscaledZ, this.indexes[t.overscaledZ][t.key]);
          }

          for (var _t286 = 0; _t286 < e.symbolInstances.length; _t286++) {
            e.symbolInstances.get(_t286).crossTileID = 0;
          }

          this.usedCrossTileIDs[t.overscaledZ] || (this.usedCrossTileIDs[t.overscaledZ] = {});
          var o = this.usedCrossTileIDs[t.overscaledZ];

          for (var _i198 in this.indexes) {
            var _a107 = this.indexes[_i198];
            if (Number(_i198) > t.overscaledZ) for (var _i199 in _a107) {
              var _r218 = _a107[_i199];
              _r218.tileID.isChildOf(t) && _r218.findMatches(e.symbolInstances, t, o);
            } else {
              var _r219 = _a107[t.scaledTo(Number(_i198)).key];

              _r219 && _r219.findMatches(e.symbolInstances, t, o);
            }
          }

          for (var _t287 = 0; _t287 < e.symbolInstances.length; _t287++) {
            var _a108 = e.symbolInstances.get(_t287);

            _a108.crossTileID || (_a108.crossTileID = i.generate(), o[_a108.crossTileID] = !0);
          }

          return void 0 === this.indexes[t.overscaledZ] && (this.indexes[t.overscaledZ] = {}), this.indexes[t.overscaledZ][t.key] = new Ut(t, e.symbolInstances, e.bucketInstanceId), !0;
        }
      }, {
        key: "removeBucketCrossTileIDs",
        value: function removeBucketCrossTileIDs(t, e) {
          for (var _i200 in e.indexedSymbolInstances) {
            var _iterator175 = _createForOfIteratorHelper(e.indexedSymbolInstances[_i200]),
                _step175;

            try {
              for (_iterator175.s(); !(_step175 = _iterator175.n()).done;) {
                var _o76 = _step175.value;
                delete this.usedCrossTileIDs[t][_o76.crossTileID];
              }
            } catch (err) {
              _iterator175.e(err);
            } finally {
              _iterator175.f();
            }
          }
        }
      }, {
        key: "removeStaleBuckets",
        value: function removeStaleBuckets(t) {
          var e = !1;

          for (var _i201 in this.indexes) {
            var _o77 = this.indexes[_i201];

            for (var _a109 in _o77) {
              t[_o77[_a109].bucketInstanceId] || (this.removeBucketCrossTileIDs(_i201, _o77[_a109]), delete _o77[_a109], e = !0);
            }
          }

          return e;
        }
      }]);

      return Zt;
    }();

    var Gt = /*#__PURE__*/function () {
      function Gt() {
        _classCallCheck(this, Gt);

        this.layerIndexes = {}, this.crossTileIDs = new Nt(), this.maxBucketInstanceId = 0, this.bucketsInCurrentPlacement = {};
      }

      _createClass(Gt, [{
        key: "addLayer",
        value: function addLayer(t, e, i) {
          var o = this.layerIndexes[t.id];
          void 0 === o && (o = this.layerIndexes[t.id] = new Zt());
          var a = !1;
          var r = {};
          o.handleWrapJump(i);

          var _iterator176 = _createForOfIteratorHelper(e),
              _step176;

          try {
            for (_iterator176.s(); !(_step176 = _iterator176.n()).done;) {
              var _i202 = _step176.value;

              var _e256 = _i202.getBucket(t);

              _e256 && t.id === _e256.layerIds[0] && (_e256.bucketInstanceId || (_e256.bucketInstanceId = ++this.maxBucketInstanceId), o.addBucket(_i202.tileID, _e256, this.crossTileIDs) && (a = !0), r[_e256.bucketInstanceId] = !0);
            }
          } catch (err) {
            _iterator176.e(err);
          } finally {
            _iterator176.f();
          }

          return o.removeStaleBuckets(r) && (a = !0), a;
        }
      }, {
        key: "pruneUnusedLayers",
        value: function pruneUnusedLayers(t) {
          var e = {};
          t.forEach(function (t) {
            e[t] = !0;
          });

          for (var _t288 in this.layerIndexes) {
            e[_t288] || delete this.layerIndexes[_t288];
          }
        }
      }]);

      return Gt;
    }();

    var qt = function qt(e, i) {
      return t.emitValidationErrors(e, i && i.filter(function (t) {
        return "source.canvas" !== t.identifier;
      }));
    },
        Vt = t.pick(j, ["addLayer", "removeLayer", "setPaintProperty", "setLayoutProperty", "setFilter", "addSource", "removeSource", "setLayerZoomRange", "setLight", "setTransition", "setGeoJSONSourceData", "setTerrain"]),
        $t = t.pick(j, ["setCenter", "setZoom", "setBearing", "setPitch"]),
        jt = function () {
      var e = {},
          i = t.styleSpec.$version;

      for (var _o78 in t.styleSpec.$root) {
        var _a110 = t.styleSpec.$root[_o78];

        if (_a110.required) {
          var _t289 = null;
          _t289 = "version" === _o78 ? i : "array" === _a110.type ? [] : {}, null != _t289 && (e[_o78] = _t289);
        }
      }

      return e;
    }();

    var Wt = /*#__PURE__*/function (_t$Evented8) {
      _inherits(Wt, _t$Evented8);

      var _super109 = _createSuper(Wt);

      function Wt(e) {
        var _this86;

        var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

        _classCallCheck(this, Wt);

        _this86 = _super109.call(this), _this86.map = e, _this86.dispatcher = new E(q(), _assertThisInitialized(_this86)), _this86.imageManager = new u(), _this86.imageManager.setEventedParent(_assertThisInitialized(_this86)), _this86.glyphManager = new v(e._requestManager, i.localIdeographFontFamily), _this86.lineAtlas = new T(256, 512), _this86.crossTileSymbolIndex = new Gt(), _this86._layers = {}, _this86._num3DLayers = 0, _this86._serializedLayers = {}, _this86._order = [], _this86._sourceCaches = {}, _this86._otherSourceCaches = {}, _this86._symbolSourceCaches = {}, _this86.zoomHistory = new t.ZoomHistory(), _this86._loaded = !1, _this86._availableImages = [], _this86._resetUpdates(), _this86.dispatcher.broadcast("setReferrer", t.getReferrer());

        var o = _assertThisInitialized(_this86);

        _this86._rtlTextPluginCallback = Wt.registerForPluginStateChange(function (e) {
          o.dispatcher.broadcast("syncRTLPluginState", {
            pluginStatus: e.pluginStatus,
            pluginURL: e.pluginURL
          }, function (e, i) {
            if (t.triggerPluginCompletionEvent(e), i && i.every(function (t) {
              return t;
            })) for (var _t290 in o._sourceCaches) {
              var _e257 = o._sourceCaches[_t290],
                  _i203 = _e257.getSource().type;

              "vector" !== _i203 && "geojson" !== _i203 || _e257.reload();
            }
          });
        }), _this86.on("data", function (t) {
          if ("source" !== t.dataType || "metadata" !== t.sourceDataType) return;

          var e = _this86.getSource(t.sourceId);

          if (e && e.vectorLayerIds) for (var _t291 in _this86._layers) {
            var _i204 = _this86._layers[_t291];
            _i204.source === e.id && _this86._validateLayer(_i204);
          }
        });
        return _this86;
      }

      _createClass(Wt, [{
        key: "loadURL",
        value: function loadURL(e) {
          var _this87 = this;

          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
          this.fire(new t.Event("dataloading", {
            dataType: "style"
          }));
          var o = "boolean" == typeof i.validate ? i.validate : !t.isMapboxURL(e);
          e = this.map._requestManager.normalizeStyleURL(e, i.accessToken);

          var a = this.map._requestManager.transformRequest(e, t.ResourceType.Style);

          this._request = t.getJSON(a, function (e, i) {
            _this87._request = null, e ? _this87.fire(new t.ErrorEvent(e)) : i && _this87._load(i, o);
          });
        }
      }, {
        key: "loadJSON",
        value: function loadJSON(e) {
          var _this88 = this;

          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
          this.fire(new t.Event("dataloading", {
            dataType: "style"
          })), this._request = t.browser.frame(function () {
            _this88._request = null, _this88._load(e, !1 !== i.validate);
          });
        }
      }, {
        key: "loadEmpty",
        value: function loadEmpty() {
          this.fire(new t.Event("dataloading", {
            dataType: "style"
          })), this._load(jt, !1);
        }
      }, {
        key: "_load",
        value: function _load(e, i) {
          if (i && qt(this, t.validateStyle(e))) return;
          this._loaded = !0, this.stylesheet = e;

          for (var _t292 in e.sources) {
            this.addSource(_t292, e.sources[_t292], {
              validate: !1
            });
          }

          this._changed = !1, e.sprite ? this._loadSprite(e.sprite) : this.imageManager.setLoaded(!0), this.glyphManager.setURL(e.glyphs);
          var o = $(this.stylesheet.layers);
          this._order = o.map(function (t) {
            return t.id;
          }), this._layers = {}, this._serializedLayers = {};

          var _iterator177 = _createForOfIteratorHelper(o),
              _step177;

          try {
            for (_iterator177.s(); !(_step177 = _iterator177.n()).done;) {
              var _e258 = _step177.value;
              _e258 = t.createStyleLayer(_e258), _e258.setEventedParent(this, {
                layer: {
                  id: _e258.id
                }
              }), this._layers[_e258.id] = _e258, this._serializedLayers[_e258.id] = _e258.serialize(), _e258.is3D() && this._num3DLayers++;
            }
          } catch (err) {
            _iterator177.e(err);
          } finally {
            _iterator177.f();
          }

          this.dispatcher.broadcast("setLayers", this._serializeLayers(this._order)), this.light = new y(this.stylesheet.light), this.stylesheet.terrain && this._createTerrain(this.stylesheet.terrain), this.fire(new t.Event("data", {
            dataType: "style"
          })), this.fire(new t.Event("style.load"));
        }
      }, {
        key: "_loadSprite",
        value: function _loadSprite(e) {
          var _this89 = this;

          this._spriteRequest = function (e, i, o) {
            var a, r, n;
            var s = t.browser.devicePixelRatio > 1 ? "@2x" : "";
            var l = t.getJSON(i.transformRequest(i.normalizeSpriteURL(e, s, ".json"), t.ResourceType.SpriteJSON), function (t, e) {
              l = null, n || (n = t, a = e, h());
            }),
                c = t.getImage(i.transformRequest(i.normalizeSpriteURL(e, s, ".png"), t.ResourceType.SpriteImage), function (t, e) {
              c = null, n || (n = t, r = e, h());
            });

            function h() {
              if (n) o(n);else if (a && r) {
                var _e259 = t.browser.getImageData(r),
                    _i205 = {};

                for (var _o79 in a) {
                  var _a$_o = a[_o79],
                      _r220 = _a$_o.width,
                      _n132 = _a$_o.height,
                      _s105 = _a$_o.x,
                      _l44 = _a$_o.y,
                      _c29 = _a$_o.sdf,
                      _h23 = _a$_o.pixelRatio,
                      _u35 = _a$_o.stretchX,
                      _d15 = _a$_o.stretchY,
                      _11 = _a$_o.content,
                      _m14 = new t.RGBAImage({
                    width: _r220,
                    height: _n132
                  });

                  t.RGBAImage.copy(_e259, _m14, {
                    x: _s105,
                    y: _l44
                  }, {
                    x: 0,
                    y: 0
                  }, {
                    width: _r220,
                    height: _n132
                  }), _i205[_o79] = {
                    data: _m14,
                    pixelRatio: _h23,
                    sdf: _c29,
                    stretchX: _u35,
                    stretchY: _d15,
                    content: _11
                  };
                }

                o(null, _i205);
              }
            }

            return {
              cancel: function cancel() {
                l && (l.cancel(), l = null), c && (c.cancel(), c = null);
              }
            };
          }(e, this.map._requestManager, function (e, i) {
            if (_this89._spriteRequest = null, e) _this89.fire(new t.ErrorEvent(e));else if (i) for (var _t293 in i) {
              _this89.imageManager.addImage(_t293, i[_t293]);
            }
            _this89.imageManager.setLoaded(!0), _this89._availableImages = _this89.imageManager.listImages(), _this89.dispatcher.broadcast("setImages", _this89._availableImages), _this89.fire(new t.Event("data", {
              dataType: "style"
            }));
          });
        }
      }, {
        key: "_validateLayer",
        value: function _validateLayer(e) {
          var i = this.getSource(e.source);
          if (!i) return;
          var o = e.sourceLayer;
          o && ("geojson" === i.type || i.vectorLayerIds && -1 === i.vectorLayerIds.indexOf(o)) && this.fire(new t.ErrorEvent(new Error("Source layer \"".concat(o, "\" ") + "does not exist on source \"".concat(i.id, "\" ") + "as specified by style layer \"".concat(e.id, "\""))));
        }
      }, {
        key: "loaded",
        value: function loaded() {
          if (!this._loaded) return !1;
          if (Object.keys(this._updatedSources).length) return !1;

          for (var _t294 in this._sourceCaches) {
            if (!this._sourceCaches[_t294].loaded()) return !1;
          }

          return !!this.imageManager.isLoaded();
        }
      }, {
        key: "_serializeLayers",
        value: function _serializeLayers(t) {
          var e = [];

          var _iterator178 = _createForOfIteratorHelper(t),
              _step178;

          try {
            for (_iterator178.s(); !(_step178 = _iterator178.n()).done;) {
              var _i206 = _step178.value;
              var _t295 = this._layers[_i206];
              "custom" !== _t295.type && e.push(_t295.serialize());
            }
          } catch (err) {
            _iterator178.e(err);
          } finally {
            _iterator178.f();
          }

          return e;
        }
      }, {
        key: "hasTransitions",
        value: function hasTransitions() {
          if (this.light && this.light.hasTransition()) return !0;

          for (var _t296 in this._sourceCaches) {
            if (this._sourceCaches[_t296].hasTransition()) return !0;
          }

          for (var _t297 in this._layers) {
            if (this._layers[_t297].hasTransition()) return !0;
          }

          return !1;
        }
      }, {
        key: "_checkLoaded",
        value: function _checkLoaded() {
          if (!this._loaded) throw new Error("Style is not done loading");
        }
      }, {
        key: "update",
        value: function update(e) {
          if (!this._loaded) return;
          var i = this._changed;

          if (this._changed) {
            var _t298 = Object.keys(this._updatedLayers),
                _i207 = Object.keys(this._removedLayers);

            (_t298.length || _i207.length) && this._updateWorkerLayers(_t298, _i207);

            for (var _t299 in this._updatedSources) {
              var _e260 = this._updatedSources[_t299];
              "reload" === _e260 ? this._reloadSource(_t299) : "clear" === _e260 && this._clearSource(_t299);
            }

            this._updateTilesForChangedImages();

            for (var _t300 in this._updatedPaintProps) {
              this._layers[_t300].updateTransitions(e);
            }

            this.light.updateTransitions(e), this._resetUpdates();
          }

          var o = {};

          for (var _t301 in this._sourceCaches) {
            var _e261 = this._sourceCaches[_t301];
            o[_t301] = _e261.used, _e261.used = !1;
          }

          var _iterator179 = _createForOfIteratorHelper(this._order),
              _step179;

          try {
            for (_iterator179.s(); !(_step179 = _iterator179.n()).done;) {
              var _t302 = _step179.value;
              var _i209 = this._layers[_t302];

              if (_i209.recalculate(e, this._availableImages), !_i209.isHidden(e.zoom)) {
                var _t303 = this._getLayerSourceCache(_i209);

                _t303 && (_t303.used = !0);
              }

              var _o80 = this.map.painter;

              if (_o80) {
                var _t304 = _i209.getProgramIds();

                if (!_t304) continue;

                var _a111 = _i209.getProgramConfiguration(e.zoom);

                var _iterator180 = _createForOfIteratorHelper(_t304),
                    _step180;

                try {
                  for (_iterator180.s(); !(_step180 = _iterator180.n()).done;) {
                    var _e263 = _step180.value;

                    _o80.useProgram(_e263, _a111);
                  }
                } catch (err) {
                  _iterator180.e(err);
                } finally {
                  _iterator180.f();
                }
              }
            }
          } catch (err) {
            _iterator179.e(err);
          } finally {
            _iterator179.f();
          }

          for (var _e262 in o) {
            var _i208 = this._sourceCaches[_e262];
            o[_e262] !== _i208.used && _i208.getSource().fire(new t.Event("data", {
              sourceDataType: "visibility",
              dataType: "source",
              sourceId: _i208.getSource().id
            }));
          }

          this.light.recalculate(e), this.terrain && this.terrain.recalculate(e), this.z = e.zoom, i && this.fire(new t.Event("data", {
            dataType: "style"
          }));
        }
      }, {
        key: "_updateTilesForChangedImages",
        value: function _updateTilesForChangedImages() {
          var t = Object.keys(this._changedImages);

          if (t.length) {
            for (var _e264 in this._sourceCaches) {
              this._sourceCaches[_e264].reloadTilesForDependencies(["icons", "patterns"], t);
            }

            this._changedImages = {};
          }
        }
      }, {
        key: "_updateWorkerLayers",
        value: function _updateWorkerLayers(t, e) {
          this.dispatcher.broadcast("updateLayers", {
            layers: this._serializeLayers(t),
            removedIds: e
          });
        }
      }, {
        key: "_resetUpdates",
        value: function _resetUpdates() {
          this._changed = !1, this._updatedLayers = {}, this._removedLayers = {}, this._updatedSources = {}, this._updatedPaintProps = {}, this._changedImages = {};
        }
      }, {
        key: "setState",
        value: function setState(e) {
          var _this90 = this;

          if (this._checkLoaded(), qt(this, t.validateStyle(e))) return !1;
          (e = t.clone$1(e)).layers = $(e.layers);

          var i = function (e, i) {
            if (!e) return [{
              command: j.setStyle,
              args: [i]
            }];
            var o = [];

            try {
              if (!t.deepEqual(e.version, i.version)) return [{
                command: j.setStyle,
                args: [i]
              }];
              t.deepEqual(e.center, i.center) || o.push({
                command: j.setCenter,
                args: [i.center]
              }), t.deepEqual(e.zoom, i.zoom) || o.push({
                command: j.setZoom,
                args: [i.zoom]
              }), t.deepEqual(e.bearing, i.bearing) || o.push({
                command: j.setBearing,
                args: [i.bearing]
              }), t.deepEqual(e.pitch, i.pitch) || o.push({
                command: j.setPitch,
                args: [i.pitch]
              }), t.deepEqual(e.sprite, i.sprite) || o.push({
                command: j.setSprite,
                args: [i.sprite]
              }), t.deepEqual(e.glyphs, i.glyphs) || o.push({
                command: j.setGlyphs,
                args: [i.glyphs]
              }), t.deepEqual(e.transition, i.transition) || o.push({
                command: j.setTransition,
                args: [i.transition]
              }), t.deepEqual(e.light, i.light) || o.push({
                command: j.setLight,
                args: [i.light]
              });
              var _a112 = {},
                  _r221 = [];
              !function (e, i, o, a) {
                var r;

                for (r in i = i || {}, e = e || {}) {
                  e.hasOwnProperty(r) && (i.hasOwnProperty(r) || X(r, o, a));
                }

                for (r in i) {
                  i.hasOwnProperty(r) && (e.hasOwnProperty(r) ? t.deepEqual(e[r], i[r]) || ("geojson" === e[r].type && "geojson" === i[r].type && K(e, i, r) ? o.push({
                    command: j.setGeoJSONSourceData,
                    args: [r, i[r].data]
                  }) : H(r, i, o, a)) : W(r, i, o));
                }
              }(e.sources, i.sources, _r221, _a112);
              var _n133 = [];
              e.layers && e.layers.forEach(function (t) {
                _a112[t.source] ? o.push({
                  command: j.removeLayer,
                  args: [t.id]
                }) : _n133.push(t);
              });
              var _s106 = e.terrain;
              _s106 && _a112[_s106.source] && (o.push({
                command: j.setTerrain,
                args: [void 0]
              }), _s106 = void 0), o = o.concat(_r221), t.deepEqual(_s106, i.terrain) || o.push({
                command: j.setTerrain,
                args: [i.terrain]
              }), function (e, i, o) {
                i = i || [];
                var a = (e = e || []).map(J),
                    r = i.map(J),
                    n = e.reduce(Q, {}),
                    s = i.reduce(Q, {}),
                    l = a.slice(),
                    c = Object.create(null);

                var h, u, d, _, m, p, f;

                for (h = 0, u = 0; h < a.length; h++) {
                  d = a[h], s.hasOwnProperty(d) ? u++ : (o.push({
                    command: j.removeLayer,
                    args: [d]
                  }), l.splice(l.indexOf(d, u), 1));
                }

                for (h = 0, u = 0; h < r.length; h++) {
                  d = r[r.length - 1 - h], l[l.length - 1 - h] !== d && (n.hasOwnProperty(d) ? (o.push({
                    command: j.removeLayer,
                    args: [d]
                  }), l.splice(l.lastIndexOf(d, l.length - u), 1)) : u++, p = l[l.length - h], o.push({
                    command: j.addLayer,
                    args: [s[d], p]
                  }), l.splice(l.length - h, 0, d), c[d] = !0);
                }

                for (h = 0; h < r.length; h++) {
                  if (d = r[h], _ = n[d], m = s[d], !c[d] && !t.deepEqual(_, m)) if (t.deepEqual(_.source, m.source) && t.deepEqual(_["source-layer"], m["source-layer"]) && t.deepEqual(_.type, m.type)) {
                    for (f in Y(_.layout, m.layout, o, d, null, j.setLayoutProperty), Y(_.paint, m.paint, o, d, null, j.setPaintProperty), t.deepEqual(_.filter, m.filter) || o.push({
                      command: j.setFilter,
                      args: [d, m.filter]
                    }), t.deepEqual(_.minzoom, m.minzoom) && t.deepEqual(_.maxzoom, m.maxzoom) || o.push({
                      command: j.setLayerZoomRange,
                      args: [d, m.minzoom, m.maxzoom]
                    }), _) {
                      _.hasOwnProperty(f) && "layout" !== f && "paint" !== f && "filter" !== f && "metadata" !== f && "minzoom" !== f && "maxzoom" !== f && (0 === f.indexOf("paint.") ? Y(_[f], m[f], o, d, f.slice(6), j.setPaintProperty) : t.deepEqual(_[f], m[f]) || o.push({
                        command: j.setLayerProperty,
                        args: [d, f, m[f]]
                      }));
                    }

                    for (f in m) {
                      m.hasOwnProperty(f) && !_.hasOwnProperty(f) && "layout" !== f && "paint" !== f && "filter" !== f && "metadata" !== f && "minzoom" !== f && "maxzoom" !== f && (0 === f.indexOf("paint.") ? Y(_[f], m[f], o, d, f.slice(6), j.setPaintProperty) : t.deepEqual(_[f], m[f]) || o.push({
                        command: j.setLayerProperty,
                        args: [d, f, m[f]]
                      }));
                    }
                  } else o.push({
                    command: j.removeLayer,
                    args: [d]
                  }), p = l[l.lastIndexOf(d) + 1], o.push({
                    command: j.addLayer,
                    args: [m, p]
                  });
                }
              }(_n133, i.layers, o);
            } catch (t) {
              console.warn("Unable to compute style diff:", t), o = [{
                command: j.setStyle,
                args: [i]
              }];
            }

            return o;
          }(this.serialize(), e).filter(function (t) {
            return !(t.command in $t);
          });

          if (0 === i.length) return !1;
          var o = i.filter(function (t) {
            return !(t.command in Vt);
          });
          if (o.length > 0) throw new Error("Unimplemented: ".concat(o.map(function (t) {
            return t.command;
          }).join(", "), "."));
          return i.forEach(function (t) {
            "setTransition" !== t.command && _this90[t.command].apply(_this90, t.args);
          }), this.stylesheet = e, !0;
        }
      }, {
        key: "addImage",
        value: function addImage(e, i) {
          if (this.getImage(e)) return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));
          this.imageManager.addImage(e, i), this._afterImageUpdated(e);
        }
      }, {
        key: "updateImage",
        value: function updateImage(t, e) {
          this.imageManager.updateImage(t, e);
        }
      }, {
        key: "getImage",
        value: function getImage(t) {
          return this.imageManager.getImage(t);
        }
      }, {
        key: "removeImage",
        value: function removeImage(e) {
          if (!this.getImage(e)) return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));
          this.imageManager.removeImage(e), this._afterImageUpdated(e);
        }
      }, {
        key: "_afterImageUpdated",
        value: function _afterImageUpdated(e) {
          this._availableImages = this.imageManager.listImages(), this._changedImages[e] = !0, this._changed = !0, this.dispatcher.broadcast("setImages", this._availableImages), this.fire(new t.Event("data", {
            dataType: "style"
          }));
        }
      }, {
        key: "listImages",
        value: function listImages() {
          return this._checkLoaded(), this.imageManager.listImages();
        }
      }, {
        key: "addSource",
        value: function addSource(e, i) {
          var _this91 = this;

          var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          if (this._checkLoaded(), void 0 !== this.getSource(e)) throw new Error("There is already a source with this ID");
          if (!i.type) throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(i).join(", "), "."));
          if (["vector", "raster", "geojson", "video", "image"].indexOf(i.type) >= 0 && this._validate(t.validateStyle.source, "sources.".concat(e), i, null, o)) return;
          this.map && this.map._collectResourceTiming && (i.collectResourceTiming = !0);
          var a = R(e, i, this.dispatcher, this);
          a.setEventedParent(this, function () {
            return {
              isSourceLoaded: _this91.loaded(),
              source: a.serialize(),
              sourceId: e
            };
          });

          var r = function r(i) {
            var o = (i ? "symbol:" : "other:") + e,
                r = _this91._sourceCaches[o] = new t.SourceCache(o, a, i);
            (i ? _this91._symbolSourceCaches : _this91._otherSourceCaches)[e] = r, r.style = _this91, r.onAdd(_this91.map);
          };

          r(!1), "vector" !== i.type && "geojson" !== i.type || r(!0), a.onAdd && a.onAdd(this.map), this._changed = !0;
        }
      }, {
        key: "removeSource",
        value: function removeSource(e) {
          this._checkLoaded();

          var i = this.getSource(e);
          if (void 0 === i) throw new Error("There is no source with this ID");

          for (var _i210 in this._layers) {
            if (this._layers[_i210].source === e) return this.fire(new t.ErrorEvent(new Error("Source \"".concat(e, "\" cannot be removed while layer \"").concat(_i210, "\" is using it."))));
          }

          if (this.terrain && this.terrain.get().source === e) return this.fire(new t.ErrorEvent(new Error("Source \"".concat(e, "\" cannot be removed while terrain is using it."))));

          var o = this._getSourceCaches(e);

          var _iterator181 = _createForOfIteratorHelper(o),
              _step181;

          try {
            for (_iterator181.s(); !(_step181 = _iterator181.n()).done;) {
              var _e265 = _step181.value;
              delete this._sourceCaches[_e265.id], delete this._updatedSources[_e265.id], _e265.fire(new t.Event("data", {
                sourceDataType: "metadata",
                dataType: "source",
                sourceId: _e265.getSource().id
              })), _e265.setEventedParent(null), _e265.clearTiles();
            }
          } catch (err) {
            _iterator181.e(err);
          } finally {
            _iterator181.f();
          }

          delete this._otherSourceCaches[e], delete this._symbolSourceCaches[e], i.setEventedParent(null), i.onRemove && i.onRemove(this.map), this._changed = !0;
        }
      }, {
        key: "setGeoJSONSourceData",
        value: function setGeoJSONSourceData(t, e) {
          this._checkLoaded(), this.getSource(t).setData(e), this._changed = !0;
        }
      }, {
        key: "getSource",
        value: function getSource(t) {
          var e = this._getSourceCache(t);

          return e && e.getSource();
        }
      }, {
        key: "addLayer",
        value: function addLayer(e, i) {
          var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

          this._checkLoaded();

          var a = e.id;
          if (this.getLayer(a)) return void this.fire(new t.ErrorEvent(new Error("Layer with id \"".concat(a, "\" already exists on this map"))));
          var r;

          if ("custom" === e.type) {
            if (qt(this, t.validateCustomStyleLayer(e))) return;
            r = t.createStyleLayer(e);
          } else {
            if ("object" == _typeof(e.source) && (this.addSource(a, e.source), e = t.clone$1(e), e = t.extend(e, {
              source: a
            })), this._validate(t.validateStyle.layer, "layers.".concat(a), e, {
              arrayIndex: -1
            }, o)) return;
            r = t.createStyleLayer(e), this._validateLayer(r), r.setEventedParent(this, {
              layer: {
                id: a
              }
            }), this._serializedLayers[r.id] = r.serialize(), r.is3D() && this._num3DLayers++;
          }

          var n = i ? this._order.indexOf(i) : this._order.length;
          if (i && -1 === n) return void this.fire(new t.ErrorEvent(new Error("Layer with id \"".concat(i, "\" does not exist on this map."))));
          this._order.splice(n, 0, a), this._layerOrderChanged = !0, this._layers[a] = r;

          var s = this._getLayerSourceCache(r);

          if (this._removedLayers[a] && r.source && s && "custom" !== r.type) {
            var _t305 = this._removedLayers[a];
            delete this._removedLayers[a], _t305.type !== r.type ? this._updatedSources[r.source] = "clear" : (this._updatedSources[r.source] = "reload", s.pause());
          }

          this._updateLayer(r), r.onAdd && r.onAdd(this.map);
        }
      }, {
        key: "moveLayer",
        value: function moveLayer(e, i) {
          if (this._checkLoaded(), this._changed = !0, !this._layers[e]) return void this.fire(new t.ErrorEvent(new Error("The layer '".concat(e, "' does not exist in the map's style and cannot be moved."))));
          if (e === i) return;

          var o = this._order.indexOf(e);

          this._order.splice(o, 1);

          var a = i ? this._order.indexOf(i) : this._order.length;
          i && -1 === a ? this.fire(new t.ErrorEvent(new Error("Layer with id \"".concat(i, "\" does not exist on this map.")))) : (this._order.splice(a, 0, e), this._layerOrderChanged = !0);
        }
      }, {
        key: "removeLayer",
        value: function removeLayer(e) {
          this._checkLoaded();

          var i = this._layers[e];
          if (!i) return void this.fire(new t.ErrorEvent(new Error("The layer '".concat(e, "' does not exist in the map's style and cannot be removed."))));
          i.setEventedParent(null), i.is3D() && this._num3DLayers--;

          var o = this._order.indexOf(e);

          this._order.splice(o, 1), this._layerOrderChanged = !0, this._changed = !0, this._removedLayers[e] = i, delete this._layers[e], delete this._serializedLayers[e], delete this._updatedLayers[e], delete this._updatedPaintProps[e], i.onRemove && i.onRemove(this.map);
        }
      }, {
        key: "getLayer",
        value: function getLayer(t) {
          return this._layers[t];
        }
      }, {
        key: "hasLayer",
        value: function hasLayer(t) {
          return t in this._layers;
        }
      }, {
        key: "setLayerZoomRange",
        value: function setLayerZoomRange(e, i, o) {
          this._checkLoaded();

          var a = this.getLayer(e);
          a ? a.minzoom === i && a.maxzoom === o || (null != i && (a.minzoom = i), null != o && (a.maxzoom = o), this._updateLayer(a)) : this.fire(new t.ErrorEvent(new Error("The layer '".concat(e, "' does not exist in the map's style and cannot have zoom extent."))));
        }
      }, {
        key: "setFilter",
        value: function setFilter(e, i) {
          var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

          this._checkLoaded();

          var a = this.getLayer(e);

          if (a) {
            if (!t.deepEqual(a.filter, i)) return null == i ? (a.filter = void 0, void this._updateLayer(a)) : void (this._validate(t.validateStyle.filter, "layers.".concat(a.id, ".filter"), i, null, o) || (a.filter = t.clone$1(i), this._updateLayer(a)));
          } else this.fire(new t.ErrorEvent(new Error("The layer '".concat(e, "' does not exist in the map's style and cannot be filtered."))));
        }
      }, {
        key: "getFilter",
        value: function getFilter(e) {
          return t.clone$1(this.getLayer(e).filter);
        }
      }, {
        key: "setLayoutProperty",
        value: function setLayoutProperty(e, i, o) {
          var a = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

          this._checkLoaded();

          var r = this.getLayer(e);
          r ? t.deepEqual(r.getLayoutProperty(i), o) || (r.setLayoutProperty(i, o, a), this._updateLayer(r)) : this.fire(new t.ErrorEvent(new Error("The layer '".concat(e, "' does not exist in the map's style and cannot be styled."))));
        }
      }, {
        key: "getLayoutProperty",
        value: function getLayoutProperty(e, i) {
          var o = this.getLayer(e);
          if (o) return o.getLayoutProperty(i);
          this.fire(new t.ErrorEvent(new Error("The layer '".concat(e, "' does not exist in the map's style."))));
        }
      }, {
        key: "setPaintProperty",
        value: function setPaintProperty(e, i, o) {
          var a = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

          this._checkLoaded();

          var r = this.getLayer(e);
          r ? t.deepEqual(r.getPaintProperty(i), o) || (r.setPaintProperty(i, o, a) && this._updateLayer(r), this._changed = !0, this._updatedPaintProps[e] = !0) : this.fire(new t.ErrorEvent(new Error("The layer '".concat(e, "' does not exist in the map's style and cannot be styled."))));
        }
      }, {
        key: "getPaintProperty",
        value: function getPaintProperty(t, e) {
          return this.getLayer(t).getPaintProperty(e);
        }
      }, {
        key: "setFeatureState",
        value: function setFeatureState(e, i) {
          this._checkLoaded();

          var o = e.source,
              a = e.sourceLayer,
              r = this.getSource(o);
          if (void 0 === r) return void this.fire(new t.ErrorEvent(new Error("The source '".concat(o, "' does not exist in the map's style."))));
          var n = r.type;
          if ("geojson" === n && a) return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));
          if ("vector" === n && !a) return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));
          void 0 === e.id && this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));

          var s = this._getSourceCaches(o);

          var _iterator182 = _createForOfIteratorHelper(s),
              _step182;

          try {
            for (_iterator182.s(); !(_step182 = _iterator182.n()).done;) {
              var _t306 = _step182.value;

              _t306.setFeatureState(a, e.id, i);
            }
          } catch (err) {
            _iterator182.e(err);
          } finally {
            _iterator182.f();
          }
        }
      }, {
        key: "removeFeatureState",
        value: function removeFeatureState(e, i) {
          this._checkLoaded();

          var o = e.source,
              a = this.getSource(o);
          if (void 0 === a) return void this.fire(new t.ErrorEvent(new Error("The source '".concat(o, "' does not exist in the map's style."))));
          var r = a.type,
              n = "vector" === r ? e.sourceLayer : void 0;
          if ("vector" === r && !n) return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));
          if (i && "string" != typeof e.id && "number" != typeof e.id) return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));

          var s = this._getSourceCaches(o);

          var _iterator183 = _createForOfIteratorHelper(s),
              _step183;

          try {
            for (_iterator183.s(); !(_step183 = _iterator183.n()).done;) {
              var _t307 = _step183.value;

              _t307.removeFeatureState(n, e.id, i);
            }
          } catch (err) {
            _iterator183.e(err);
          } finally {
            _iterator183.f();
          }
        }
      }, {
        key: "getFeatureState",
        value: function getFeatureState(e) {
          this._checkLoaded();

          var i = e.source,
              o = e.sourceLayer,
              a = this.getSource(i);

          if (void 0 !== a) {
            if ("vector" !== a.type || o) return void 0 === e.id && this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))), this._getSourceCaches(i)[0].getFeatureState(o, e.id);
            this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));
          } else this.fire(new t.ErrorEvent(new Error("The source '".concat(i, "' does not exist in the map's style."))));
        }
      }, {
        key: "getTransition",
        value: function getTransition() {
          return t.extend({
            duration: 300,
            delay: 0
          }, this.stylesheet && this.stylesheet.transition);
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var e = {};

          for (var _t308 in this._sourceCaches) {
            var _i211 = this._sourceCaches[_t308].getSource();

            e[_i211.id] || (e[_i211.id] = _i211.serialize());
          }

          return t.filterObject({
            version: this.stylesheet.version,
            name: this.stylesheet.name,
            metadata: this.stylesheet.metadata,
            light: this.stylesheet.light,
            terrain: this.stylesheet.terrain,
            center: this.stylesheet.center,
            zoom: this.stylesheet.zoom,
            bearing: this.stylesheet.bearing,
            pitch: this.stylesheet.pitch,
            sprite: this.stylesheet.sprite,
            glyphs: this.stylesheet.glyphs,
            transition: this.stylesheet.transition,
            sources: e,
            layers: this._serializeLayers(this._order)
          }, function (t) {
            return void 0 !== t;
          });
        }
      }, {
        key: "_updateLayer",
        value: function _updateLayer(t) {
          this._updatedLayers[t.id] = !0;

          var e = this._getLayerSourceCache(t);

          t.source && !this._updatedSources[t.source] && e && "raster" !== e.getSource().type && (this._updatedSources[t.source] = "reload", e.pause()), this._changed = !0;
        }
      }, {
        key: "_flattenAndSortRenderedFeatures",
        value: function _flattenAndSortRenderedFeatures(t) {
          var _this92 = this;

          var e = function e(t) {
            return "fill-extrusion" === _this92._layers[t].type;
          },
              i = {},
              o = [];

          for (var _a113 = this._order.length - 1; _a113 >= 0; _a113--) {
            var _r222 = this._order[_a113];

            if (e(_r222)) {
              i[_r222] = _a113;

              var _iterator184 = _createForOfIteratorHelper(t),
                  _step184;

              try {
                for (_iterator184.s(); !(_step184 = _iterator184.n()).done;) {
                  var _e266 = _step184.value;
                  var _t309 = _e266[_r222];

                  if (_t309) {
                    var _iterator185 = _createForOfIteratorHelper(_t309),
                        _step185;

                    try {
                      for (_iterator185.s(); !(_step185 = _iterator185.n()).done;) {
                        var _e267 = _step185.value;
                        o.push(_e267);
                      }
                    } catch (err) {
                      _iterator185.e(err);
                    } finally {
                      _iterator185.f();
                    }
                  }
                }
              } catch (err) {
                _iterator184.e(err);
              } finally {
                _iterator184.f();
              }
            }
          }

          o.sort(function (t, e) {
            return e.intersectionZ - t.intersectionZ;
          });
          var a = [];

          for (var _r223 = this._order.length - 1; _r223 >= 0; _r223--) {
            var _n134 = this._order[_r223];
            if (e(_n134)) for (var _t310 = o.length - 1; _t310 >= 0; _t310--) {
              var _e268 = o[_t310].feature;
              if (i[_e268.layer.id] < _r223) break;
              a.push(_e268), o.pop();
            } else {
              var _iterator186 = _createForOfIteratorHelper(t),
                  _step186;

              try {
                for (_iterator186.s(); !(_step186 = _iterator186.n()).done;) {
                  var _e269 = _step186.value;
                  var _t311 = _e269[_n134];

                  if (_t311) {
                    var _iterator187 = _createForOfIteratorHelper(_t311),
                        _step187;

                    try {
                      for (_iterator187.s(); !(_step187 = _iterator187.n()).done;) {
                        var _e270 = _step187.value;
                        a.push(_e270.feature);
                      }
                    } catch (err) {
                      _iterator187.e(err);
                    } finally {
                      _iterator187.f();
                    }
                  }
                }
              } catch (err) {
                _iterator186.e(err);
              } finally {
                _iterator186.f();
              }
            }
          }

          return a;
        }
      }, {
        key: "queryRenderedFeatures",
        value: function queryRenderedFeatures(e, i, o) {
          var _this93 = this;

          i && i.filter && this._validate(t.validateStyle.filter, "queryRenderedFeatures.filter", i.filter, null, i);
          var a = {};

          if (i && i.layers) {
            if (!Array.isArray(i.layers)) return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))), [];

            var _iterator188 = _createForOfIteratorHelper(i.layers),
                _step188;

            try {
              for (_iterator188.s(); !(_step188 = _iterator188.n()).done;) {
                var _e271 = _step188.value;
                var _i212 = this._layers[_e271];
                if (!_i212) return this.fire(new t.ErrorEvent(new Error("The layer '".concat(_e271, "' does not exist in the map's style and cannot be queried for features.")))), [];
                a[_i212.source] = !0;
              }
            } catch (err) {
              _iterator188.e(err);
            } finally {
              _iterator188.f();
            }
          }

          var r = [];
          i.availableImages = this._availableImages;
          var n = i && i.layers ? i.layers.some(function (t) {
            var e = _this93.getLayer(t);

            return e && e.is3D();
          }) : this.has3DLayers(),
              s = S.createFromScreenPoints(e, o);

          for (var _t312 in this._sourceCaches) {
            var _e272 = this._sourceCaches[_t312].getSource().id;

            i.layers && !a[_e272] || r.push(B(this._sourceCaches[_t312], this._layers, this._serializedLayers, s, i, o, n, !!this.map._showQueryGeometry));
          }

          return this.placement && r.push(function (t, e, i, o, a, r, n) {
            var s = {},
                l = r.queryRenderedSymbols(o),
                c = [];

            var _iterator189 = _createForOfIteratorHelper(Object.keys(l).map(Number)),
                _step189;

            try {
              for (_iterator189.s(); !(_step189 = _iterator189.n()).done;) {
                var _t315 = _step189.value;
                c.push(n[_t315]);
              }
            } catch (err) {
              _iterator189.e(err);
            } finally {
              _iterator189.f();
            }

            c.sort(F);

            var _loop8 = function _loop8() {
              var i = _c30[_i213];
              var o = i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId], e, i.bucketIndex, i.sourceLayerIndex, a.filter, a.layers, a.availableImages, t);

              for (var _t313 in o) {
                var _e273 = s[_t313] = s[_t313] || [],
                    _a114 = o[_t313];

                _a114.sort(function (t, e) {
                  var o = i.featureSortOrder;

                  if (o) {
                    var _i214 = o.indexOf(t.featureIndex);

                    return o.indexOf(e.featureIndex) - _i214;
                  }

                  return e.featureIndex - t.featureIndex;
                });

                var _iterator190 = _createForOfIteratorHelper(_a114),
                    _step190;

                try {
                  for (_iterator190.s(); !(_step190 = _iterator190.n()).done;) {
                    var _t314 = _step190.value;

                    _e273.push(_t314);
                  }
                } catch (err) {
                  _iterator190.e(err);
                } finally {
                  _iterator190.f();
                }
              }
            };

            for (var _i213 = 0, _c30 = c; _i213 < _c30.length; _i213++) {
              _loop8();
            }

            var _loop9 = function _loop9(_e274) {
              s[_e274].forEach(function (o) {
                var a = o.feature,
                    r = i(t[_e274]).getFeatureState(a.layer["source-layer"], a.id);
                a.source = a.layer.source, a.layer["source-layer"] && (a.sourceLayer = a.layer["source-layer"]), a.state = r;
              });
            };

            for (var _e274 in s) {
              _loop9(_e274);
            }

            return s;
          }(this._layers, this._serializedLayers, this._getLayerSourceCache.bind(this), s.screenGeometry, i, this.placement.collisionIndex, this.placement.retainedQueryData)), this._flattenAndSortRenderedFeatures(r);
        }
      }, {
        key: "querySourceFeatures",
        value: function querySourceFeatures(e, i) {
          i && i.filter && this._validate(t.validateStyle.filter, "querySourceFeatures.filter", i.filter, null, i);

          var o = this._getSourceCaches(e);

          var a = [];

          var _iterator191 = _createForOfIteratorHelper(o),
              _step191;

          try {
            for (_iterator191.s(); !(_step191 = _iterator191.n()).done;) {
              var _t316 = _step191.value;
              a = a.concat(O(_t316, i));
            }
          } catch (err) {
            _iterator191.e(err);
          } finally {
            _iterator191.f();
          }

          return a;
        }
      }, {
        key: "addSourceType",
        value: function addSourceType(t, e, i) {
          return Wt.getSourceType(t) ? i(new Error("A source type called \"".concat(t, "\" already exists."))) : (Wt.setSourceType(t, e), e.workerSourceURL ? void this.dispatcher.broadcast("loadWorkerSource", {
            name: t,
            url: e.workerSourceURL
          }, i) : i(null, null));
        }
      }, {
        key: "getLight",
        value: function getLight() {
          return this.light.getLight();
        }
      }, {
        key: "setLight",
        value: function setLight(e) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

          this._checkLoaded();

          var o = this.light.getLight();
          var a = !1;

          for (var _i215 in e) {
            if (!t.deepEqual(e[_i215], o[_i215])) {
              a = !0;
              break;
            }
          }

          if (!a) return;
          var r = {
            now: t.browser.now(),
            transition: t.extend({
              duration: 300,
              delay: 0
            }, this.stylesheet.transition)
          };
          this.light.setLight(e, i), this.light.updateTransitions(r);
        }
      }, {
        key: "setTerrain",
        value: function setTerrain(e) {
          if (this._checkLoaded(), !e) return delete this.terrain, delete this.stylesheet.terrain, this.dispatcher.broadcast("enableTerrain", !1), void this._force3DLayerUpdate();

          if ("object" == _typeof(e.source)) {
            var _i216 = "terrain-dem-src";
            this.addSource(_i216, e.source), e = t.clone$1(e), e = t.extend(e, {
              source: _i216
            });
          }

          if (!this._validate(t.validateStyle.terrain, "terrain", e)) if (this.terrain) {
            var _i217 = this.terrain,
                _o81 = _i217.get();

            for (var _a115 in e) {
              if (!t.deepEqual(e[_a115], _o81[_a115])) {
                _i217.set(e), this.stylesheet.terrain = e;
                var _o82 = {
                  now: t.browser.now(),
                  transition: t.extend({
                    duration: 0
                  }, this.stylesheet.transition)
                };

                _i217.updateTransitions(_o82);

                break;
              }
            }
          } else this._createTerrain(e);
        }
      }, {
        key: "_createTerrain",
        value: function _createTerrain(e) {
          var i = this.terrain = new w(e);
          this.stylesheet.terrain = e, this.dispatcher.broadcast("enableTerrain", !0), this._force3DLayerUpdate();
          var o = {
            now: t.browser.now(),
            transition: t.extend({
              duration: 0
            }, this.stylesheet.transition)
          };
          i.updateTransitions(o);
        }
      }, {
        key: "_force3DLayerUpdate",
        value: function _force3DLayerUpdate() {
          for (var _t317 in this._layers) {
            var _e275 = this._layers[_t317];
            "fill-extrusion" === _e275.type && this._updateLayer(_e275);
          }
        }
      }, {
        key: "_validate",
        value: function _validate(e, i, o, a) {
          var r = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};
          return (!r || !1 !== r.validate) && qt(this, e.call(t.validateStyle, t.extend({
            key: i,
            style: this.serialize(),
            value: o,
            styleSpec: t.styleSpec
          }, a)));
        }
      }, {
        key: "_remove",
        value: function _remove() {
          this._request && (this._request.cancel(), this._request = null), this._spriteRequest && (this._spriteRequest.cancel(), this._spriteRequest = null), t.evented.off("pluginStateChange", this._rtlTextPluginCallback);

          for (var _t318 in this._layers) {
            this._layers[_t318].setEventedParent(null);
          }

          for (var _t319 in this._sourceCaches) {
            this._sourceCaches[_t319].clearTiles(), this._sourceCaches[_t319].setEventedParent(null);
          }

          this.imageManager.setEventedParent(null), this.setEventedParent(null), this.dispatcher.remove();
        }
      }, {
        key: "_clearSource",
        value: function _clearSource(t) {
          var e = this._getSourceCaches(t);

          var _iterator192 = _createForOfIteratorHelper(e),
              _step192;

          try {
            for (_iterator192.s(); !(_step192 = _iterator192.n()).done;) {
              var _t320 = _step192.value;

              _t320.clearTiles();
            }
          } catch (err) {
            _iterator192.e(err);
          } finally {
            _iterator192.f();
          }
        }
      }, {
        key: "_reloadSource",
        value: function _reloadSource(t) {
          var e = this._getSourceCaches(t);

          var _iterator193 = _createForOfIteratorHelper(e),
              _step193;

          try {
            for (_iterator193.s(); !(_step193 = _iterator193.n()).done;) {
              var _t321 = _step193.value;
              _t321.resume(), _t321.reload();
            }
          } catch (err) {
            _iterator193.e(err);
          } finally {
            _iterator193.f();
          }
        }
      }, {
        key: "_updateSources",
        value: function _updateSources(t) {
          for (var _e276 in this._sourceCaches) {
            this._sourceCaches[_e276].update(t);
          }
        }
      }, {
        key: "_generateCollisionBoxes",
        value: function _generateCollisionBoxes() {
          for (var _t322 in this._sourceCaches) {
            var _e277 = this._sourceCaches[_t322];
            _e277.resume(), _e277.reload();
          }
        }
      }, {
        key: "_updatePlacement",
        value: function _updatePlacement(e, i, o, a) {
          var _this94 = this;

          var r = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
          var n = !1,
              s = !1;
          var l = {};

          var _iterator194 = _createForOfIteratorHelper(this._order),
              _step194;

          try {
            for (_iterator194.s(); !(_step194 = _iterator194.n()).done;) {
              var _t324 = _step194.value;
              var _i218 = this._layers[_t324];
              if ("symbol" !== _i218.type) continue;

              if (!l[_i218.source]) {
                var _ret3 = function () {
                  var t = _this94._getLayerSourceCache(_i218);

                  if (!t) return "continue";
                  l[_i218.source] = t.getRenderableIds(!0).map(function (e) {
                    return t.getTileByID(e);
                  }).sort(function (t, e) {
                    return e.tileID.overscaledZ - t.tileID.overscaledZ || (t.tileID.isLessThan(e.tileID) ? -1 : 1);
                  });
                }();

                if (_ret3 === "continue") continue;
              }

              var _o83 = this.crossTileSymbolIndex.addLayer(_i218, l[_i218.source], e.center.lng);

              n = n || _o83;
            }
          } catch (err) {
            _iterator194.e(err);
          } finally {
            _iterator194.f();
          }

          if (this.crossTileSymbolIndex.pruneUnusedLayers(this._order), ((r = r || this._layerOrderChanged || 0 === o) || !this.pauseablePlacement || this.pauseablePlacement.isDone() && !this.placement.stillRecent(t.browser.now(), e.zoom)) && (this.pauseablePlacement = new Ot(e, this._order, r, i, o, a, this.placement), this._layerOrderChanged = !1), this.pauseablePlacement.isDone() ? this.placement.setStale() : (this.pauseablePlacement.continuePlacement(this._order, this._layers, l), this.pauseablePlacement.isDone() && (this.placement = this.pauseablePlacement.commit(t.browser.now()), s = !0), n && this.pauseablePlacement.placement.setStale()), s || n) {
            var _iterator195 = _createForOfIteratorHelper(this._order),
                _step195;

            try {
              for (_iterator195.s(); !(_step195 = _iterator195.n()).done;) {
                var _t323 = _step195.value;
                var _e278 = this._layers[_t323];
                "symbol" === _e278.type && this.placement.updateLayerOpacities(_e278, l[_e278.source]);
              }
            } catch (err) {
              _iterator195.e(err);
            } finally {
              _iterator195.f();
            }
          }

          return !this.pauseablePlacement.isDone() || this.placement.hasTransitions(t.browser.now());
        }
      }, {
        key: "_releaseSymbolFadeTiles",
        value: function _releaseSymbolFadeTiles() {
          for (var _t325 in this._sourceCaches) {
            this._sourceCaches[_t325].releaseSymbolFadeTiles();
          }
        }
      }, {
        key: "getImages",
        value: function getImages(t, e, i) {
          this.imageManager.getImages(e.icons, i), this._updateTilesForChangedImages();

          var o = function o(t) {
            t && t.setDependencies(e.tileID.key, e.type, e.icons);
          };

          o(this._otherSourceCaches[e.source]), o(this._symbolSourceCaches[e.source]);
        }
      }, {
        key: "getGlyphs",
        value: function getGlyphs(t, e, i) {
          this.glyphManager.getGlyphs(e.stacks, i);
        }
      }, {
        key: "getResource",
        value: function getResource(e, i, o) {
          return t.makeRequest(i, o);
        }
      }, {
        key: "_getSourceCache",
        value: function _getSourceCache(t) {
          return this._otherSourceCaches[t];
        }
      }, {
        key: "_getLayerSourceCache",
        value: function _getLayerSourceCache(t) {
          return "symbol" === t.type ? this._symbolSourceCaches[t.source] : this._otherSourceCaches[t.source];
        }
      }, {
        key: "_getSourceCaches",
        value: function _getSourceCaches(t) {
          var e = [];
          return this._otherSourceCaches[t] && e.push(this._otherSourceCaches[t]), this._symbolSourceCaches[t] && e.push(this._symbolSourceCaches[t]), e;
        }
      }, {
        key: "has3DLayers",
        value: function has3DLayers() {
          return this._num3DLayers > 0;
        }
      }]);

      return Wt;
    }(t.Evented);

    Wt.getSourceType = function (t) {
      return L[t];
    }, Wt.setSourceType = function (t, e) {
      L[t] = e;
    }, Wt.registerForPluginStateChange = t.registerForPluginStateChange;
    var Xt = "attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";
    var Ht = {};
    Ht = Ie("", "#ifdef TERRAIN\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float prevElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*word/7.3;}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif", !0);

    var Kt = Ie("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nconst float PI=3.141592653589793;", "#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const float PI=3.141592653589793;const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),
        Yt = Ie("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),
        Jt = Ie("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),
        Qt = Ie("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),
        te = Ie("void main() {gl_FragColor=vec4(1.0);}", "attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),
        ee = Ie("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}"),
        ie = Ie("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),
        oe = Ie("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}", "attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),
        ae = Ie("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}", "attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),
        re = Ie("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}", "attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),
        ne = Ie("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),
        se = Ie("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),
        le = Ie("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),
        ce = Ie("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),
        he = Ie("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);gl_Position=mix(u_matrix*vec4(pos_nx.xy,h,1),AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(pos_nx.xy,t > 0.0 ? height : base,1);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),
        ue = Ie("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);gl_Position=mix(u_matrix*vec4(pos_nx.xy,h,1),AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(pos_nx.xy,z,1);\n#endif\nvec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),
        de = Ie("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),
        _e = Ie("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),
        me = Ie("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);}"),
        pe = Ie("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);}"),
        fe = Ie("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),
        ge = Ie("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),
        ve = Ie("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),
        xe = Ie("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),
        ye = Ie("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),
        be = Ie("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),
        we = Ie("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;const float skirtOffset=24575.0;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);}"),
        Te = Ie("#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}", "uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),
        Ee = Ie("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(vec3(p.xyx)*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract(vec3((p3.x+p3.y)*p3.z,(p3.x+p3.z)*p3.y,(p3.y+p3.z)*p3.x));}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;color.rgb+=rnd/255.0;return color;}float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", Xt),
        Ce = Ie("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform lowp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(vec3(p.xyx)*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract(vec3((p3.x+p3.y)*p3.z,(p3.x+p3.z)*p3.y,(p3.y+p3.z)*p3.x));}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;color.rgb+=rnd/255.0;return color;}void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5))*u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", Xt),
        Se = Ie("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}", "attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}");

    function Ie(t, e, i) {
      var o = /#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,
          a = e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),
          r = t.match(/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g),
          n = e.match(/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g);
      var s = n ? n.concat(r) : r;
      i || (s = Ht.staticUniforms.concat(s));
      var l = {};
      return {
        fragmentSource: t = t.replace(o, function (t, e, i, o, a) {
          return l[a] = !0, "define" === e ? "\n#ifndef HAS_UNIFORM_u_".concat(a, "\nvarying ").concat(i, " ").concat(o, " ").concat(a, ";\n#else\nuniform ").concat(i, " ").concat(o, " u_").concat(a, ";\n#endif\n") : "\n#ifdef HAS_UNIFORM_u_".concat(a, "\n    ").concat(i, " ").concat(o, " ").concat(a, " = u_").concat(a, ";\n#endif\n");
        }),
        vertexSource: e = e.replace(o, function (t, e, i, o, a) {
          var r = "float" === o ? "vec2" : "vec4",
              n = a.match(/color/) ? "color" : r;
          return l[a] ? "define" === e ? "\n#ifndef HAS_UNIFORM_u_".concat(a, "\nuniform lowp float u_").concat(a, "_t;\nattribute ").concat(i, " ").concat(r, " a_").concat(a, ";\nvarying ").concat(i, " ").concat(o, " ").concat(a, ";\n#else\nuniform ").concat(i, " ").concat(o, " u_").concat(a, ";\n#endif\n") : "vec4" === n ? "\n#ifndef HAS_UNIFORM_u_".concat(a, "\n    ").concat(a, " = a_").concat(a, ";\n#else\n    ").concat(i, " ").concat(o, " ").concat(a, " = u_").concat(a, ";\n#endif\n") : "\n#ifndef HAS_UNIFORM_u_".concat(a, "\n    ").concat(a, " = unpack_mix_").concat(n, "(a_").concat(a, ", u_").concat(a, "_t);\n#else\n    ").concat(i, " ").concat(o, " ").concat(a, " = u_").concat(a, ";\n#endif\n") : "define" === e ? "\n#ifndef HAS_UNIFORM_u_".concat(a, "\nuniform lowp float u_").concat(a, "_t;\nattribute ").concat(i, " ").concat(r, " a_").concat(a, ";\n#else\nuniform ").concat(i, " ").concat(o, " u_").concat(a, ";\n#endif\n") : "vec4" === n ? "\n#ifndef HAS_UNIFORM_u_".concat(a, "\n    ").concat(i, " ").concat(o, " ").concat(a, " = a_").concat(a, ";\n#else\n    ").concat(i, " ").concat(o, " ").concat(a, " = u_").concat(a, ";\n#endif\n") : "\n#ifndef HAS_UNIFORM_u_".concat(a, "\n    ").concat(i, " ").concat(o, " ").concat(a, " = unpack_mix_").concat(n, "(a_").concat(a, ", u_").concat(a, "_t);\n#else\n    ").concat(i, " ").concat(o, " ").concat(a, " = u_").concat(a, ";\n#endif\n");
        }),
        staticAttributes: a,
        staticUniforms: s
      };
    }

    var Pe = Object.freeze({
      __proto__: null,

      get preludeTerrain() {
        return Ht;
      },

      prelude: Kt,
      background: Yt,
      backgroundPattern: Jt,
      circle: Qt,
      clippingMask: te,
      heatmap: ee,
      heatmapTexture: ie,
      collisionBox: oe,
      collisionCircle: ae,
      debug: re,
      fill: ne,
      fillOutline: se,
      fillOutlinePattern: le,
      fillPattern: ce,
      fillExtrusion: he,
      fillExtrusionPattern: ue,
      hillshadePrepare: de,
      hillshade: _e,
      line: me,
      lineGradient: pe,
      linePattern: fe,
      lineSDF: ge,
      raster: ve,
      symbolIcon: xe,
      symbolSDF: ye,
      symbolTextAndIcon: be,
      terrainRaster: we,
      terrainDepth: Te,
      skybox: Ee,
      skyboxGradient: Ce,
      skyboxCapture: Se
    });

    var Me = /*#__PURE__*/function () {
      function Me() {
        _classCallCheck(this, Me);

        this.boundProgram = null, this.boundLayoutVertexBuffer = null, this.boundPaintVertexBuffers = [], this.boundIndexBuffer = null, this.boundVertexOffset = null, this.boundDynamicVertexBuffer = null, this.vao = null;
      }

      _createClass(Me, [{
        key: "bind",
        value: function bind(t, e, i, o, a, r, n, s) {
          this.context = t;
          var l = this.boundPaintVertexBuffers.length !== o.length;

          for (var _t326 = 0; !l && _t326 < o.length; _t326++) {
            this.boundPaintVertexBuffers[_t326] !== o[_t326] && (l = !0);
          }

          t.extVertexArrayObject && this.vao && this.boundProgram === e && this.boundLayoutVertexBuffer === i && !l && this.boundIndexBuffer === a && this.boundVertexOffset === r && this.boundDynamicVertexBuffer === n && this.boundDynamicVertexBuffer2 === s ? (t.bindVertexArrayOES.set(this.vao), n && n.bind(), a && a.dynamicDraw && a.bind(), s && s.bind()) : this.freshBind(e, i, o, a, r, n, s);
        }
      }, {
        key: "freshBind",
        value: function freshBind(t, e, i, o, a, r, n) {
          var s;
          var l = t.numAttributes,
              c = this.context,
              h = c.gl;
          if (c.extVertexArrayObject) this.vao && this.destroy(), this.vao = c.extVertexArrayObject.createVertexArrayOES(), c.bindVertexArrayOES.set(this.vao), s = 0, this.boundProgram = t, this.boundLayoutVertexBuffer = e, this.boundPaintVertexBuffers = i, this.boundIndexBuffer = o, this.boundVertexOffset = a, this.boundDynamicVertexBuffer = r, this.boundDynamicVertexBuffer2 = n;else {
            s = c.currentNumAttributes || 0;

            for (var _t327 = l; _t327 < s; _t327++) {
              h.disableVertexAttribArray(_t327);
            }
          }
          e.enableAttributes(h, t);

          var _iterator196 = _createForOfIteratorHelper(i),
              _step196;

          try {
            for (_iterator196.s(); !(_step196 = _iterator196.n()).done;) {
              var _e279 = _step196.value;

              _e279.enableAttributes(h, t);
            }
          } catch (err) {
            _iterator196.e(err);
          } finally {
            _iterator196.f();
          }

          r && r.enableAttributes(h, t), n && n.enableAttributes(h, t), e.bind(), e.setVertexAttribPointers(h, t, a);

          var _iterator197 = _createForOfIteratorHelper(i),
              _step197;

          try {
            for (_iterator197.s(); !(_step197 = _iterator197.n()).done;) {
              var _e280 = _step197.value;
              _e280.bind(), _e280.setVertexAttribPointers(h, t, a);
            }
          } catch (err) {
            _iterator197.e(err);
          } finally {
            _iterator197.f();
          }

          r && (r.bind(), r.setVertexAttribPointers(h, t, a)), o && o.bind(), n && (n.bind(), n.setVertexAttribPointers(h, t, a)), c.currentNumAttributes = l;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.vao && (this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao), this.vao = null);
        }
      }]);

      return Me;
    }();

    function ze(e, i) {
      var o = Math.pow(2, i.canonical.z),
          a = i.canonical.y;
      return [new t.MercatorCoordinate(0, a / o).toLngLat().lat, new t.MercatorCoordinate(0, (a + 1) / o).toLngLat().lat];
    }

    function Ae(e, i, o, a, r, n, s) {
      var l = e.context,
          c = l.gl,
          h = o.fbo;
      if (!h) return;
      e.prepareDrawTile(i);
      var u = e.useProgram("hillshade");
      l.activeTexture.set(c.TEXTURE0), c.bindTexture(c.TEXTURE_2D, h.colorAttachment.get());

      var d = function (t, e, i, o) {
        var a = i.paint.get("hillshade-shadow-color"),
            r = i.paint.get("hillshade-highlight-color"),
            n = i.paint.get("hillshade-accent-color");
        var s = i.paint.get("hillshade-illumination-direction") * (Math.PI / 180);
        "viewport" === i.paint.get("hillshade-illumination-anchor") && (s -= t.transform.angle);
        var l = !t.options.moving;
        return {
          u_matrix: o || t.transform.calculatePosMatrix(e.tileID.toUnwrapped(), l),
          u_image: 0,
          u_latrange: ze(0, e.tileID),
          u_light: [i.paint.get("hillshade-exaggeration"), s],
          u_shadow: a,
          u_highlight: r,
          u_accent: n
        };
      }(e, o, a, e.terrain ? i.posMatrix : null);

      u.draw(l, c.TRIANGLES, r, n, s, t.CullFaceMode.disabled, d, a.id, e.rasterBoundsBuffer, e.quadTriangleIndexBuffer, e.rasterBoundsSegments);
    }

    function De(e, i, o) {
      if (!i.needsDEMTextureUpload) return;
      var a = e.context,
          r = a.gl;
      a.pixelStoreUnpackPremultiplyAlpha.set(!1), i.demTexture = i.demTexture || e.getTileTexture(o.stride);
      var n = o.getPixels();
      i.demTexture ? i.demTexture.update(n, {
        premultiply: !1
      }) : i.demTexture = new t.Texture(a, n, r.RGBA, {
        premultiply: !1
      }), i.needsDEMTextureUpload = !1;
    }

    function Le(e, i, o, a, r, n) {
      var s = e.context,
          l = s.gl;
      if (!i.dem) return;
      var c = i.dem;
      if (s.activeTexture.set(l.TEXTURE1), De(e, i, c), !i.demTexture) return;
      i.demTexture.bind(l.NEAREST, l.CLAMP_TO_EDGE);
      var h = c.dim;
      s.activeTexture.set(l.TEXTURE0);
      var u = i.fbo;

      if (!u) {
        var _e281 = new t.Texture(s, {
          width: h,
          height: h,
          data: null
        }, l.RGBA);

        _e281.bind(l.LINEAR, l.CLAMP_TO_EDGE), u = i.fbo = s.createFramebuffer(h, h, !0), u.colorAttachment.set(_e281.texture);
      }

      s.bindFramebuffer.set(u.framebuffer), s.viewport.set([0, 0, h, h]), e.useProgram("hillshadePrepare").draw(s, l.TRIANGLES, a, r, n, t.CullFaceMode.disabled, function (e, i) {
        var o = i.stride,
            a = t.create();
        return t.ortho(a, 0, t.EXTENT, -t.EXTENT, 0, 0, 1), t.translate(a, a, [0, -t.EXTENT, 0]), {
          u_matrix: a,
          u_image: 1,
          u_dimension: [o, o],
          u_zoom: e.overscaledZ,
          u_unpack: i.unpackVector
        };
      }(i.tileID, c), o.id, e.rasterBoundsBuffer, e.quadTriangleIndexBuffer, e.rasterBoundsSegments), i.needsHillshadePrepare = !1;
    }

    var Re = function Re(e, i) {
      return {
        u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
        u_image0: new t.Uniform1i(e, i.u_image0),
        u_skirt_height: new t.Uniform1f(e, i.u_skirt_height)
      };
    },
        ke = function ke(t, e) {
      return {
        u_matrix: t,
        u_image0: 0,
        u_skirt_height: e
      };
    },
        Be = new ( /*#__PURE__*/function () {
      function _class18() {
        _classCallCheck(this, _class18);

        this.operations = {};
      }

      _createClass(_class18, [{
        key: "newMorphing",
        value: function newMorphing(t, e, i, o, a) {
          if (t in this.operations) {
            var _e282 = this.operations[t];
            _e282.to.tileID.key !== i.tileID.key && (_e282.queued = i);
          } else this.operations[t] = {
            startTime: o,
            phase: 0,
            duration: a,
            from: e,
            to: i,
            queued: null
          };
        }
      }, {
        key: "getMorphValuesForProxy",
        value: function getMorphValuesForProxy(t) {
          if (!(t in this.operations)) return null;
          var e = this.operations[t];
          return {
            from: e.from,
            to: e.to,
            phase: e.phase
          };
        }
      }, {
        key: "update",
        value: function update(t) {
          for (var _e283 in this.operations) {
            var _i219 = this.operations[_e283];

            for (_i219.phase = (t - _i219.startTime) / _i219.duration; _i219.phase >= 1 || !this._validOp(_i219);) {
              if (!this._nextOp(_i219, t)) {
                delete this.operations[_e283];
                break;
              }
            }
          }
        }
      }, {
        key: "_nextOp",
        value: function _nextOp(t, e) {
          return !!t.queued && (t.from = t.to, t.to = t.queued, t.queued = null, t.phase = 0, t.startTime = e, !0);
        }
      }, {
        key: "_validOp",
        value: function _validOp(t) {
          return t.from.hasData() && t.to.hasData();
        }
      }]);

      return _class18;
    }())(),
        Oe = {
      0: null,
      1: "TERRAIN_VERTEX_MORPHING"
    };

    function Fe(e, i, o, a, r) {
      var n = e.context,
          s = n.gl;
      var l = e.useProgram("terrainRaster"),
          c = 0;
      var h = e.colorModeForRenderPass(),
          u = new t.DepthMode(s.LEQUAL, t.DepthMode.ReadWrite, e.depthRangeFor3D);
      Be.update(r);

      var d = e.transform,
          _ = 6 * Math.pow(1.5, 22 - d.zoom) * i.exaggeration();

      var m, p, f;

      var _iterator198 = _createForOfIteratorHelper(a),
          _step198;

      try {
        for (_iterator198.s(); !(_step198 = _iterator198.n()).done;) {
          var _g13 = _step198.value;

          var _a116 = o.getTile(_g13),
              _v12 = t.StencilMode.disabled,
              _x11 = i.prevTerrainTileForTile[_g13.key],
              _y12 = i.terrainTileForTile[_g13.key];

          f = _y12, null != (p = _x11) && null != f && p.hasData() && f.hasData() && null != p.demTexture && null != f.demTexture && p.tileID.key !== f.tileID.key && Be.newMorphing(_g13.key, _x11, _y12, r, 250), n.activeTexture.set(s.TEXTURE0), _a116.texture.bind(s.LINEAR, s.CLAMP_TO_EDGE, s.LINEAR_MIPMAP_NEAREST);

          var _b10 = Be.getMorphValuesForProxy(_g13.key),
              _w9 = _b10 ? 1 : 0;

          var _T4 = void 0;

          _b10 && (_T4 = {
            morphing: {
              srcDemTile: _b10.from,
              dstDemTile: _b10.to,
              phase: t.easeCubicInOut(_b10.phase)
            }
          });

          var _E3 = ke(_g13.posMatrix, Ue(_g13.canonical, d.renderWorldCopies) ? _ / 10 : _);

          c !== (m = _w9) && (l = e.useProgram("terrainRaster", null, Oe[m]), c = m), i.setupElevationDraw(_a116, l, _T4), l.draw(n, s.TRIANGLES, u, _v12, h, t.CullFaceMode.backCCW, _E3, "terrain_raster", i.gridBuffer, i.gridIndexBuffer, i.gridSegments);
        }
      } catch (err) {
        _iterator198.e(err);
      } finally {
        _iterator198.f();
      }
    }

    function Ue(t, e) {
      var i = 1 << t.z;
      return !e && (0 === t.x || t.x === i - 1) || 0 === t.y || t.y === i - 1;
    }

    var Ne = function Ne(t) {
      return {
        u_matrix: t
      };
    };

    function Ze(e, i, o, a, r) {
      if (r > 0) {
        var _n135 = t.browser.now(),
            _s107 = (_n135 - e.timeAdded) / r,
            _l45 = i ? (_n135 - i.timeAdded) / r : -1,
            _c31 = o.getSource(),
            _h24 = a.coveringZoomLevel({
          tileSize: _c31.tileSize,
          roundZoom: _c31.roundZoom
        }),
            _u36 = !i || Math.abs(i.tileID.overscaledZ - _h24) > Math.abs(e.tileID.overscaledZ - _h24),
            _d16 = _u36 && e.refreshedUponExpiration ? 1 : t.clamp(_u36 ? _s107 : 1 - _l45, 0, 1);

        return e.refreshedUponExpiration && _s107 >= 1 && (e.refreshedUponExpiration = !1), i ? {
          opacity: 1,
          mix: 1 - _d16
        } : {
          opacity: _d16,
          mix: 0
        };
      }

      return {
        opacity: 1,
        mix: 0
      };
    }

    var Ge = {
      fill: !0,
      line: !0,
      background: !0,
      hillshade: !0,
      raster: !0
    };

    var qe = /*#__PURE__*/function (_t$SourceCache) {
      _inherits(qe, _t$SourceCache);

      var _super110 = _createSuper(qe);

      function qe(t) {
        var _this95;

        _classCallCheck(this, qe);

        var e = R("proxy", {
          type: "geojson",
          maxzoom: t.transform.maxZoom
        }, new E(q(), null), t.style);
        _this95 = _super110.call(this, "proxy", e, !1), e.setEventedParent(_assertThisInitialized(_this95)), _this95.map = _this95.getSource().map = t, _this95.used = _this95._sourceLoaded = !0, _this95.renderCache = [], _this95.renderCachePool = [], _this95.proxyCachedFBO = {};
        return _this95;
      }

      _createClass(qe, [{
        key: "update",
        value: function update(e, i, o) {
          var _this96 = this;

          if (e.freezeTileCoverage) return;
          this.transform = e;
          var a = e.coveringTiles({
            tileSize: this._source.tileSize,
            minzoom: this._source.minzoom,
            maxzoom: this._source.maxzoom,
            roundZoom: this._source.roundZoom,
            reparseOverscaled: this._source.reparseOverscaled,
            useElevationData: !0
          }).reduce(function (i, o) {
            if (i[o.key] = "", !_this96._tiles[o.key]) {
              var _i220 = new t.Tile(o, _this96._source.tileSize * o.overscaleFactor(), e.tileZoom);

              _i220.state = "loaded", _this96._tiles[o.key] = _i220;
            }

            return i;
          }, {});

          for (var _t328 in this._tiles) {
            _t328 in a || (this.freeFBO(_t328), this._tiles[_t328].state = "unloaded", delete this._tiles[_t328]);
          }
        }
      }, {
        key: "freeFBO",
        value: function freeFBO(t) {
          var e = this.proxyCachedFBO[t];
          void 0 !== e && (this.renderCachePool.push(e), delete this.proxyCachedFBO[t]);
        }
      }, {
        key: "deallocRenderCache",
        value: function deallocRenderCache() {
          this.renderCache.forEach(function (t) {
            return t.fb.destroy();
          }), this.renderCache = [], this.renderCachePool = [], this.proxyCachedFBO = {};
        }
      }]);

      return qe;
    }(t.SourceCache);

    var Ve = /*#__PURE__*/function (_t$OverscaledTileID) {
      _inherits(Ve, _t$OverscaledTileID);

      var _super111 = _createSuper(Ve);

      function Ve(t, e, i) {
        var _this97;

        _classCallCheck(this, Ve);

        _this97 = _super111.call(this, t.overscaledZ, t.wrap, t.canonical.z, t.canonical.x, t.canonical.y), _this97.proxyTileKey = e, _this97.posMatrix = i;
        return _this97;
      }

      return Ve;
    }(t.OverscaledTileID);

    var $e = /*#__PURE__*/function (_t$Elevation) {
      _inherits($e, _t$Elevation);

      var _super112 = _createSuper($e);

      function $e(e, i) {
        var _this98;

        _classCallCheck(this, $e);

        _this98 = _super112.call(this), _this98.painter = e, _this98.terrainTileForTile = {}, _this98.prevTerrainTileForTile = {};

        var _ref168 = function (e) {
          var i = new t.StructArrayLayout4i8(),
              o = new t.StructArrayLayout3ui6();
          i.reserve(17161), o.reserve(33800);
          var a = t.EXTENT / 128,
              r = t.EXTENT + a / 2,
              n = r + a;

          for (var _e284 = -a; _e284 < n; _e284 += a) {
            for (var _o84 = -a; _o84 < n; _o84 += a) {
              var _a117 = _o84 < 0 || _o84 > r || _e284 < 0 || _e284 > r ? 24575 : 0,
                  _n136 = t.clamp(Math.round(_o84), 0, t.EXTENT),
                  _s108 = t.clamp(Math.round(_e284), 0, t.EXTENT);

              i.emplaceBack(_n136 + _a117, _s108, _n136, _s108);
            }
          }

          var s = function s(t, e) {
            var i = 131 * e + t;
            o.emplaceBack(i + 1, i, i + 131), o.emplaceBack(i + 131, i + 131 + 1, i + 1);
          };

          for (var _t329 = 1; _t329 < 129; _t329++) {
            for (var _e285 = 1; _e285 < 129; _e285++) {
              s(_e285, _t329);
            }
          }

          return [0, 129].forEach(function (t) {
            for (var _e286 = 0; _e286 < 130; _e286++) {
              s(_e286, t), s(t, _e286);
            }
          }), [i, o, 32768];
        }(),
            _ref169 = _slicedToArray(_ref168, 3),
            o = _ref169[0],
            a = _ref169[1],
            r = _ref169[2],
            n = e.context;

        _this98.gridBuffer = n.createVertexBuffer(o, A.members), _this98.gridIndexBuffer = n.createIndexBuffer(a), _this98.gridSegments = t.SegmentVector.simpleSegment(0, 0, o.length, a.length), _this98.gridNoSkirtSegments = t.SegmentVector.simpleSegment(0, 0, o.length, r), _this98.proxyCoords = [], _this98.proxiedCoords = {}, _this98._visibleDemTiles = [], _this98._sourceTilesOverlap = {}, _this98.proxySourceCache = new qe(i.map), _this98.orthoMatrix = t.create(), t.ortho(_this98.orthoMatrix, 0, t.EXTENT, 0, t.EXTENT, 0, 1);
        var s = n.gl;
        _this98._overlapStencilMode = new t.StencilMode({
          func: s.GEQUAL,
          mask: 255
        }, 0, 255, s.KEEP, s.KEEP, s.REPLACE), _this98._previousZoom = e.transform.zoom, _this98.pool = [], _this98._findCoveringTileCache = {}, _this98._tilesDirty = {}, _this98.style = i, i.on("data", _this98._onStyleDataEvent.bind(_assertThisInitialized(_this98)));
        return _this98;
      }

      _createClass($e, [{
        key: "update",
        value: function update(e, i, o) {
          var _this99 = this;

          if (e && e.terrain) {
            this.style !== e && (e.on("data", this._onStyleDataEvent.bind(this)), this.style = e), this.enabled = !0;
            var _a118 = e.terrain.properties;
            this.sourceCache = e._getSourceCache(_a118.get("source")), this._exaggeration = _a118.get("exaggeration");

            var _r224 = function _r224() {
              _this99.sourceCache.used && t.warnOnce("Raster DEM source '".concat(_this99.sourceCache.id, "' is used both for terrain and as layer source.\n") + "This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.");

              var e = _this99.sourceCache.getSource().tileSize / 128,
                  o = _this99.proxySourceCache.getSource().tileSize;

              _this99.sourceCache.update(i, e * o, !0), _this99._findCoveringTileCache[_this99.sourceCache.id] = {};
            };

            this.sourceCache.usedForTerrain || (this._findCoveringTileCache[this.sourceCache.id] = {}, this.sourceCache.usedForTerrain = !0, _r224(), this._initializing = !0), _r224(), i.updateElevation(!o), this._findCoveringTileCache[this.proxySourceCache.id] = {}, this.proxySourceCache.update(i), this._depthDone = !1, this._emptyDEMTextureDirty = !0;
          } else this._disable();
        }
      }, {
        key: "_onStyleDataEvent",
        value: function _onStyleDataEvent(t) {
          t.coord && "source" === t.dataType ? this._clearRenderCacheForTile(t.sourceCacheId, t.coord) : "style" === t.dataType && (this._invalidateRenderCache = !0);
        }
      }, {
        key: "_disable",
        value: function _disable() {
          if (this.enabled && (this.enabled = !1, this.proxySourceCache.deallocRenderCache(), this.painter.style)) for (var _t330 in this.painter.style._sourceCaches) {
            this.painter.style._sourceCaches[_t330].usedForTerrain = !1;
          }
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this._disable(), this._emptyDEMTexture && this._emptyDEMTexture.destroy(), this.pool.forEach(function (t) {
            return t.fb.destroy();
          }), this.pool = [], this._depthFBO && (this._depthFBO.destroy(), delete this._depthFBO, delete this._depthTexture);
        }
      }, {
        key: "_source",
        value: function _source() {
          return this.enabled ? this.sourceCache : null;
        }
      }, {
        key: "exaggeration",
        value: function exaggeration() {
          return this._exaggeration;
        }
      }, {
        key: "updateTileBinding",
        value: function updateTileBinding(e) {
          var _this100 = this;

          if (!this.enabled) return;
          this.prevTerrainTileForTile = this.terrainTileForTile;
          var i = this.proxySourceCache,
              o = this.painter.transform;
          this._initializing && (this._initializing = 0 === o._centerAltitude && -1 === this.getAtPoint(t.MercatorCoordinate.fromLngLat(o.center), -1), this._emptyDEMTextureDirty = !this._initializing);
          var a = this.painter.options;
          this.drapeFirst = (a.zooming || a.moving || a.rotating || !!this.forceDrapeFirst) && !this._invalidateRenderCache, this._invalidateRenderCache = !1;
          var r = this.proxyCoords = i.getIds().map(function (t) {
            var e = i.getTileByID(t).tileID;
            return e.posMatrix = o.calculatePosMatrix(e.toUnwrapped()), e;
          });
          !function (e, i) {
            var o = i.transform.pointCoordinate(i.transform.getCameraPoint()),
                a = new t.Point(o.x, o.y);
            e.sort(function (e, i) {
              if (i.overscaledZ - e.overscaledZ) return i.overscaledZ - e.overscaledZ;
              var o = new t.Point(e.canonical.x + (1 << e.canonical.z) * e.wrap, e.canonical.y),
                  r = new t.Point(i.canonical.x + (1 << i.canonical.z) * i.wrap, i.canonical.y),
                  n = a.mult(1 << e.canonical.z);
              return n.x -= .5, n.y -= .5, n.distSqr(o) - n.distSqr(r);
            });
          }(r, this.painter), this._previousZoom = o.zoom;
          var n = this.proxyToSource || {};
          this.proxyToSource = {}, r.forEach(function (t) {
            _this100.proxyToSource[t.key] = {};
          }), this.terrainTileForTile = {};
          var s = this.painter.style._sourceCaches;

          for (var _t331 in s) {
            var _i221 = s[_t331];
            if (!_i221.used) continue;
            if (_i221 !== this.sourceCache && (this._findCoveringTileCache[_i221.id] = {}), this._setupProxiedCoordsForOrtho(_i221, e[_t331], n), _i221.usedForTerrain) continue;
            var _o85 = e[_t331];
            _i221.getSource().reparseOverscaled && this._assignTerrainTiles(_o85);
          }

          this.proxiedCoords[i.id] = r.map(function (t) {
            return new Ve(t, t.key, _this100.orthoMatrix);
          }), this._assignTerrainTiles(r), this._prepareDEMTextures(), this._setupRenderCache(n), this.drapeFirstPending = this.drapeFirst, this.renderingToTexture = !1, this._initFBOPool(), this._updateTimestamp = t.browser.now();
          var l = {};
          this._visibleDemTiles = [];

          var _iterator199 = _createForOfIteratorHelper(this.proxyCoords),
              _step199;

          try {
            for (_iterator199.s(); !(_step199 = _iterator199.n()).done;) {
              var _t332 = _step199.value;
              var _e287 = this.terrainTileForTile[_t332.key];
              if (!_e287) continue;
              var _i222 = _e287.tileID.key;
              _i222 in l || (this._visibleDemTiles.push(_e287), l[_i222] = _i222);
            }
          } catch (err) {
            _iterator199.e(err);
          } finally {
            _iterator199.f();
          }
        }
      }, {
        key: "_assignTerrainTiles",
        value: function _assignTerrainTiles(t) {
          var _this101 = this;

          this._initializing || t.forEach(function (t) {
            if (_this101.terrainTileForTile[t.key]) return;

            var e = _this101._findTileCoveringTileID(t, _this101.sourceCache);

            e && (_this101.terrainTileForTile[t.key] = e);
          });
        }
      }, {
        key: "_prepareDEMTextures",
        value: function _prepareDEMTextures() {
          var t = this.painter.context,
              e = t.gl;

          for (var _i223 in this.terrainTileForTile) {
            var _o86 = this.terrainTileForTile[_i223],
                _a119 = _o86.dem;
            !_a119 || _o86.demTexture && !_o86.needsDEMTextureUpload || (t.activeTexture.set(e.TEXTURE1), De(this.painter, _o86, _a119));
          }
        }
      }, {
        key: "_prepareDemTileUniforms",
        value: function _prepareDemTileUniforms(t, e, i, o) {
          if (!e || null == e.demTexture) return !1;
          var a = t.tileID.canonical,
              r = Math.pow(2, e.tileID.canonical.z - a.z),
              n = o || "";
          return i["u_dem_tl".concat(n)] = [a.x * r % 1, a.y * r % 1], i["u_dem_scale".concat(n)] = r, !0;
        }
      }, {
        key: "_getLoadedAreaMinimum",
        value: function _getLoadedAreaMinimum() {
          var t = 0;

          var e = this._visibleDemTiles.reduce(function (e, i) {
            if (!i.dem) return e;
            var o = i.dem.tree.minimums[0];
            return o > 0 && t++, e + o;
          }, 0);

          return t ? e / t : 0;
        }
      }, {
        key: "_updateEmptyDEMTexture",
        value: function _updateEmptyDEMTexture() {
          var e = this.painter.context,
              i = e.gl;
          e.activeTexture.set(i.TEXTURE2);

          var o = this._getLoadedAreaMinimum(),
              a = {
            width: 1,
            height: 1,
            data: new Uint8Array(t.DEMData.pack(o, this.sourceCache.getSource().encoding))
          };

          this._emptyDEMTextureDirty = !1;
          var r = this._emptyDEMTexture;
          return r ? r.update(a, {
            premultiply: !1
          }) : r = this._emptyDEMTexture = new t.Texture(e, a, i.RGBA, {
            premultiply: !1
          }), r;
        }
      }, {
        key: "setupElevationDraw",
        value: function setupElevationDraw(e, i, o) {
          var a = this.painter.context,
              r = a.gl,
              n = (s = this.sourceCache.getSource().encoding, {
            u_dem: 2,
            u_dem_prev: 4,
            u_dem_unpack: t.DEMData.getUnpackVector(s),
            u_dem_tl: [0, 0],
            u_dem_tl_prev: [0, 0],
            u_dem_scale: 0,
            u_dem_scale_prev: 0,
            u_dem_size: 0,
            u_dem_lerp: 1,
            u_depth: 3,
            u_depth_size_inv: [0, 0],
            u_exaggeration: 0
          });
          var s;
          n.u_dem_size = this.sourceCache.getSource().tileSize, n.u_exaggeration = this.exaggeration();
          var l = null,
              c = null,
              h = 1;

          if (o && o.morphing) {
            var _t333 = o.morphing.srcDemTile,
                _i224 = o.morphing.dstDemTile;
            h = o.morphing.phase, _t333 && _i224 && (this._prepareDemTileUniforms(e, _t333, n, "_prev") && (c = _t333), this._prepareDemTileUniforms(e, _i224, n) && (l = _i224));
          }

          if (c && l ? (a.activeTexture.set(r.TEXTURE2), l.demTexture.bind(r.NEAREST, r.CLAMP_TO_EDGE, r.NEAREST), a.activeTexture.set(r.TEXTURE4), c.demTexture.bind(r.NEAREST, r.CLAMP_TO_EDGE, r.NEAREST), n.u_dem_lerp = h) : (l = this.terrainTileForTile[e.tileID.key], a.activeTexture.set(r.TEXTURE2), (this._prepareDemTileUniforms(e, l, n) ? l.demTexture : this.emptyDEMTexture).bind(r.NEAREST, r.CLAMP_TO_EDGE, r.NEAREST)), o && o.useDepthForOcclusion && (a.activeTexture.set(r.TEXTURE3), this._depthTexture.bind(r.NEAREST, r.CLAMP_TO_EDGE, r.NEAREST), n.u_depth_size_inv = [1 / this._depthFBO.width, 1 / this._depthFBO.height]), o && o.useMeterToDem && l) {
            var _e288 = (1 << l.tileID.canonical.z) * t.mercatorZfromAltitude(1, this.painter.transform.center.lat) * this.sourceCache.getSource().tileSize;

            n.u_meter_to_dem = _e288;
          }

          o && o.labelPlaneMatrixInv && (n.u_label_plane_matrix_inv = o.labelPlaneMatrixInv), i.setTerrainUniformValues(a, n);
        }
      }, {
        key: "renderLayer",
        value: function renderLayer(t, e) {
          return "translucent" !== this.painter.renderPass ? (this._depthDone || "symbol" !== t.type && "circle" !== t.type || this.drawDepth(), !0) : this.drapeFirst && this.drapeFirstPending ? (this.render(), this.drapeFirstPending = !1, !0) : !!this._isLayerDrapedOverTerrain(t) && (this.drapeFirst && !this.renderingToTexture || this.render(), !0);
        }
      }, {
        key: "render",
        value: function render() {
          var _this102 = this;

          this.renderingToTexture = !0;

          var e = this.painter,
              i = this.painter.context,
              o = this.proxySourceCache,
              a = this.proxiedCoords[o.id],
              r = function r() {
            i.bindFramebuffer.set(null), i.viewport.set([0, 0, e.width, e.height]), _this102.renderingToTexture = !1;
          },
              n = e.currentLayer;

          var s = n,
              l = [];
          var c = e.style._order;
          var h = 0;

          for (var _u37 = 0; _u37 < a.length; _u37++) {
            var _d17 = a[_u37],
                _12 = o.getTileByID(_d17.proxyTileKey),
                _m15 = o.proxyCachedFBO[_d17.key],
                _p15 = this.currentFBO = void 0 !== _m15 ? o.renderCache[_m15] : this.pool[h++];

            if (_12.texture = _p15.tex, void 0 !== _m15 && !_p15.dirty) {
              l.push(_12.tileID);
              continue;
            }

            var _f12 = void 0;

            for (i.bindFramebuffer.set(_p15.fb.framebuffer), this.renderedToTile = !1, _p15.dirty && (i.clear({
              color: t.Color.transparent
            }), _p15.dirty = !1), e.currentLayer = n; e.currentLayer < c.length; e.currentLayer++) {
              var _t334 = e.style._layers[c[e.currentLayer]],
                  _o87 = _t334.isHidden(e.transform.zoom),
                  _a120 = this._isLayerDrapedOverTerrain(_t334);

              if (this.drapeFirst && !_a120) continue;

              if (e.currentLayer > s) {
                if (!_o87 && !_a120) break;
                s++;
              }

              if (_o87) continue;

              var _r225 = this.painter.style._getLayerSourceCache(_t334),
                  _n137 = _r225 ? this.proxyToSource[_d17.key][_r225.id] : [_d17];

              if (!_n137) continue;
              var _l46 = _n137;
              i.viewport.set([0, 0, _p15.fb.width, _p15.fb.height]), _f12 !== (_r225 ? _r225.id : null) && (this._setupStencil(_n137, _t334, _r225), _f12 = _r225 ? _r225.id : null), e.renderLayer(e, _r225, _t334, _l46);
            }

            _p15.dirty = this.renderedToTile, this.renderedToTile && l.push(_12.tileID), 5 === h && (h = 0, l.length > 0 && (r(), Fe(e, this, o, l, this._updateTimestamp), this.renderingToTexture = !0, l = []));
          }

          r(), l.length > 0 && Fe(e, this, o, l, this._updateTimestamp), e.currentLayer = this.drapeFirst ? -1 : s;
        }
      }, {
        key: "raycast",
        value: function raycast(t, e, i) {
          if (!this._visibleDemTiles) return null;

          var o = this._visibleDemTiles.filter(function (t) {
            return t.dem;
          }).map(function (o) {
            var a = o.tileID,
                r = Math.pow(2, a.overscaledZ),
                _a$canonical = a.canonical,
                n = _a$canonical.x,
                s = _a$canonical.y,
                l = n / r,
                c = (n + 1) / r,
                h = s / r,
                u = (s + 1) / r;
            return {
              minx: l,
              miny: h,
              maxx: c,
              maxy: u,
              t: o.dem.tree.raycastRoot(l, h, c, u, t, e, i),
              tile: o
            };
          });

          o.sort(function (t, e) {
            return (null !== t.t ? t.t : Number.MAX_VALUE) - (null !== e.t ? e.t : Number.MAX_VALUE);
          });

          var _iterator200 = _createForOfIteratorHelper(o),
              _step200;

          try {
            for (_iterator200.s(); !(_step200 = _iterator200.n()).done;) {
              var _a121 = _step200.value;
              if (null == _a121.t) return null;

              var _o88 = _a121.tile.dem.tree.raycast(_a121.minx, _a121.miny, _a121.maxx, _a121.maxy, t, e, i);

              if (null != _o88) return _o88;
            }
          } catch (err) {
            _iterator200.e(err);
          } finally {
            _iterator200.f();
          }

          return null;
        }
      }, {
        key: "_createFBO",
        value: function _createFBO() {
          var e = this.painter.context,
              i = e.gl,
              o = this.drapeBufferSize;
          e.activeTexture.set(i.TEXTURE0);
          var a = new t.Texture(e, {
            width: o[0],
            height: o[1],
            data: null
          }, i.RGBA);
          a.bind(i.LINEAR, i.CLAMP_TO_EDGE);
          var r = e.createFramebuffer(o[0], o[1], !1);
          return r.colorAttachment.set(a.texture), e.extTextureFilterAnisotropic && !e.extTextureFilterAnisotropicForceOff && i.texParameterf(i.TEXTURE_2D, e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT, e.extTextureFilterAnisotropicMax), {
            fb: r,
            tex: a,
            dirty: !1,
            ref: 1
          };
        }
      }, {
        key: "_initFBOPool",
        value: function _initFBOPool() {
          for (; this.pool.length < Math.min(5, this.proxyCoords.length);) {
            this.pool.push(this._createFBO());
          }
        }
      }, {
        key: "_shouldDisableRenderCache",
        value: function _shouldDisableRenderCache() {
          var _this103 = this;

          return !this.drapeFirst || this.painter.style._order.some(function (t) {
            var e = _this103.painter.style._layers[t],
                i = !e.isHidden(_this103.painter.transform.zoom),
                o = e.getCrossfadeParameters();
            return "custom" !== e.type && !i && !!o && 1 !== o.t;
          });
        }
      }, {
        key: "_clearRasterFadeFromRenderCache",
        value: function _clearRasterFadeFromRenderCache() {
          for (var _t335 in this.painter.style._sourceCaches) {
            if (!(this.painter.style._sourceCaches[_t335]._source instanceof z)) return;
          }

          for (var _t336 = 0; _t336 < this.painter.style._order.length; ++_t336) {
            var _e289 = this.painter.style._layers[this.painter.style._order[_t336]],
                _i225 = _e289.isHidden(this.painter.transform.zoom),
                _o89 = this.painter.style._getLayerSourceCache(_e289);

            if ("raster" !== _e289.type || _i225 || !_o89) continue;

            var _a122 = _e289.paint.get("raster-fade-duration");

            var _iterator201 = _createForOfIteratorHelper(this.proxyCoords),
                _step201;

            try {
              for (_iterator201.s(); !(_step201 = _iterator201.n()).done;) {
                var _t337 = _step201.value;
                var _e290 = this.proxyToSource[_t337.key][_o89.id];

                if (_e290) {
                  var _iterator202 = _createForOfIteratorHelper(_e290),
                      _step202;

                  try {
                    for (_iterator202.s(); !(_step202 = _iterator202.n()).done;) {
                      var _t338 = _step202.value;

                      var _e291 = Ze(_o89.getTile(_t338), _o89.findLoadedParent(_t338, 0), _o89, this.painter.transform, _a122);

                      (1 !== _e291.opacity || 0 !== _e291.mix) && this._clearRenderCacheForTile(_o89.id, _t338);
                    }
                  } catch (err) {
                    _iterator202.e(err);
                  } finally {
                    _iterator202.f();
                  }
                }
              }
            } catch (err) {
              _iterator201.e(err);
            } finally {
              _iterator201.f();
            }
          }
        }
      }, {
        key: "_setupRenderCache",
        value: function _setupRenderCache(t) {
          var e = this.proxySourceCache;

          if (this._shouldDisableRenderCache()) {
            if (e.renderCache.length > e.renderCachePool.length) {
              var _t339 = Object.values(e.proxyCachedFBO);

              e.proxyCachedFBO = {}, e.renderCachePool = e.renderCachePool.concat(_t339);
            }

            return;
          }

          this._clearRasterFadeFromRenderCache();

          var i = this.proxyCoords,
              o = this._tilesDirty;

          for (var _a123 = i.length - 1; _a123 >= 0; _a123--) {
            var _r226 = i[_a123];

            if (e.getTileByID(_r226.key), void 0 !== e.proxyCachedFBO[_r226.key]) {
              var _i226 = t[_r226.key],
                  _a124 = this.proxyToSource[_r226.key];
              var _n138 = 0;

              var _loop10 = function _loop10(_t340) {
                var e = _a124[_t340],
                    r = _i226[_t340];

                if (!r || r.length !== e.length || e.some(function (e, i) {
                  return e !== r[i] || o[_t340] && o[_t340].hasOwnProperty(e.key);
                })) {
                  _n138 = -1;
                  return "break";
                }

                ++_n138;
              };

              for (var _t340 in _a124) {
                var _ret4 = _loop10(_t340);

                if (_ret4 === "break") break;
              }

              e.renderCache[e.proxyCachedFBO[_r226.key]].dirty = _n138 < 0 || _n138 !== Object.values(_i226).length;
            } else {
              var _t341 = e.renderCachePool.pop();

              void 0 === _t341 && e.renderCache.length < 50 && (_t341 = e.renderCache.length, e.renderCache.push(this._createFBO())), void 0 !== _t341 && (e.proxyCachedFBO[_r226.key] = _t341, e.renderCache[_t341].dirty = !0);
            }
          }

          this._tilesDirty = {};
        }
      }, {
        key: "_setupStencil",
        value: function _setupStencil(e, i, o) {
          if (!o || !this._sourceTilesOverlap[o.id]) return void (this._overlapStencilType && (this._overlapStencilType = !1));
          var a = this.painter.context,
              r = a.gl;
          if (e.length <= 1) return void (this._overlapStencilType = !1);
          var n = this.currentFBO,
              s = n.fb;
          var l;
          if (i.isTileClipped()) l = e.length, this._overlapStencilMode.test = {
            func: r.EQUAL,
            mask: 255
          }, this._overlapStencilType = "Clip";else {
            if (!(e[0].overscaledZ > e[e.length - 1].overscaledZ)) return void (this._overlapStencilType = !1);
            l = 1, this._overlapStencilMode.test = {
              func: r.GREATER,
              mask: 255
            }, this._overlapStencilType = "Mask";
          }

          if (!s.depthAttachment) {
            var _e292 = a.createRenderbuffer(a.gl.DEPTH_STENCIL, s.width, s.height);

            s.depthAttachment = new t.DepthStencilAttachment(a, s.framebuffer), s.depthAttachment.set(_e292), a.clear({
              stencil: 0
            });
          }

          n.ref + l > 255 && (a.clear({
            stencil: 0
          }), n.ref = 0), n.ref += l, this._overlapStencilMode.ref = n.ref, i.isTileClipped() && this._renderTileClippingMasks(e, this._overlapStencilMode.ref);
        }
      }, {
        key: "stencilModeForRTTOverlap",
        value: function stencilModeForRTTOverlap(e) {
          return this.renderingToTexture && this._overlapStencilType ? ("Clip" === this._overlapStencilType && (this._overlapStencilMode.ref = this.painter._tileClippingMaskIDs[e.key]), this._overlapStencilMode) : t.StencilMode.disabled;
        }
      }, {
        key: "_renderTileClippingMasks",
        value: function _renderTileClippingMasks(e, i) {
          var o = this.painter,
              a = this.painter.context,
              r = a.gl;
          o._tileClippingMaskIDs = {}, a.setColorMode(t.ColorMode.disabled), a.setDepthMode(t.DepthMode.disabled);
          var n = o.useProgram("clippingMask");

          var _iterator203 = _createForOfIteratorHelper(e),
              _step203;

          try {
            for (_iterator203.s(); !(_step203 = _iterator203.n()).done;) {
              var _s109 = _step203.value;

              var _e293 = o._tileClippingMaskIDs[_s109.key] = --i;

              n.draw(a, r.TRIANGLES, t.DepthMode.disabled, new t.StencilMode({
                func: r.ALWAYS,
                mask: 0
              }, _e293, 255, r.KEEP, r.KEEP, r.REPLACE), t.ColorMode.disabled, t.CullFaceMode.disabled, Ne(_s109.posMatrix), "$clipping", o.tileExtentBuffer, o.quadTriangleIndexBuffer, o.tileExtentSegments);
            }
          } catch (err) {
            _iterator203.e(err);
          } finally {
            _iterator203.f();
          }
        }
      }, {
        key: "pointCoordinate",
        value: function pointCoordinate(e) {
          var i = this.painter.transform;
          if (e.x < 0 || e.x > i.width || e.y < 0 || e.y > i.height) return null;
          var o = [e.x, e.y, 1, 1];
          t.transformMat4(o, o, i.pixelMatrixInverse), t.scale$1(o, o, 1 / o[3]), o[0] /= i.worldSize, o[1] /= i.worldSize;
          var a = i._camera.position,
              r = t.mercatorZfromAltitude(1, i.center.lat),
              n = [a[0], a[1], a[2] / r, 0],
              s = t.subtract([], o.slice(0, 3), n);
          t.normalize(s, s);
          var l = this.raycast(n, s, this._exaggeration);
          return null !== l && l ? (t.scaleAndAdd(n, n, s, l), n[3] = n[2], n[2] *= r, n) : null;
        }
      }, {
        key: "drawDepth",
        value: function drawDepth() {
          var e = this.painter,
              i = e.context,
              o = this.proxySourceCache,
              a = Math.ceil(e.width),
              r = Math.ceil(e.height);

          if (!this._depthFBO || this._depthFBO.width === a && this._depthFBO.height === r || (this._depthFBO.destroy(), delete this._depthFBO, delete this._depthTexture), !this._depthFBO) {
            var _e294 = i.gl,
                _o90 = i.createFramebuffer(a, r, !0);

            i.activeTexture.set(_e294.TEXTURE0);

            var _n139 = new t.Texture(i, {
              width: a,
              height: r,
              data: null
            }, _e294.RGBA);

            _n139.bind(_e294.NEAREST, _e294.CLAMP_TO_EDGE), _o90.colorAttachment.set(_n139.texture);

            var _s110 = i.createRenderbuffer(i.gl.DEPTH_COMPONENT16, a, r);

            _o90.depthAttachment.set(_s110), this._depthFBO = _o90, this._depthTexture = _n139;
          }

          i.bindFramebuffer.set(this._depthFBO.framebuffer), i.viewport.set([0, 0, a, r]), function (e, i, o, a) {
            var r = e.context,
                n = r.gl;
            r.clear({
              depth: 1
            });
            var s = e.useProgram("terrainDepth"),
                l = new t.DepthMode(n.LESS, t.DepthMode.ReadWrite, e.depthRangeFor3D);

            var _iterator204 = _createForOfIteratorHelper(a),
                _step204;

            try {
              for (_iterator204.s(); !(_step204 = _iterator204.n()).done;) {
                var _e295 = _step204.value;

                var _a125 = o.getTile(_e295),
                    _c32 = ke(_e295.posMatrix, 0);

                i.setupElevationDraw(_a125, s), s.draw(r, n.TRIANGLES, l, t.StencilMode.disabled, t.ColorMode.unblended, t.CullFaceMode.backCCW, _c32, "terrain_depth", i.gridBuffer, i.gridIndexBuffer, i.gridNoSkirtSegments);
              }
            } catch (err) {
              _iterator204.e(err);
            } finally {
              _iterator204.f();
            }
          }(e, this, o, this.proxyCoords), i.bindFramebuffer.set(null), i.viewport.set([0, 0, e.width, e.height]), this._depthDone = !0;
        }
      }, {
        key: "_isLayerDrapedOverTerrain",
        value: function _isLayerDrapedOverTerrain(t) {
          return !!this.enabled && Ge.hasOwnProperty(t.type);
        }
      }, {
        key: "_setupProxiedCoordsForOrtho",
        value: function _setupProxiedCoordsForOrtho(t, e, i) {
          if (t.getSource() instanceof D) return this._setupProxiedCoordsForImageSource(t, e, i);
          this._findCoveringTileCache[t.id] = this._findCoveringTileCache[t.id] || {};
          var o = this.proxiedCoords[t.id] = [],
              a = this.proxyCoords;

          for (var _e296 = 0; _e296 < a.length; _e296++) {
            var _r227 = a[_e296],
                _n140 = this._findTileCoveringTileID(_r227, t);

            if (_n140) {
              var _e297 = this._createProxiedId(_r227, _n140, i[_r227.key] && i[_r227.key][t.id]);

              o.push(_e297), this.proxyToSource[_r227.key][t.id] = [_e297];
            }
          }

          var r = !1;

          for (var _a126 = 0; _a126 < e.length; _a126++) {
            var _n141 = t.getTile(e[_a126]);

            if (!_n141 || !_n141.hasData()) continue;

            var _s111 = this._findTileCoveringTileID(_n141.tileID, this.proxySourceCache);

            if (_s111 && _s111.tileID.canonical.z !== _n141.tileID.canonical.z) {
              var _e298 = this.proxyToSource[_s111.tileID.key][t.id],
                  _a127 = this._createProxiedId(_s111.tileID, _n141, i[_s111.tileID.key] && i[_s111.tileID.key][t.id]);

              _e298 ? _e298.splice(_e298.length - 1, 0, _a127) : this.proxyToSource[_s111.tileID.key][t.id] = [_a127], o.push(_a127), r = !0;
            }
          }

          this._sourceTilesOverlap[t.id] = r;
        }
      }, {
        key: "_setupProxiedCoordsForImageSource",
        value: function _setupProxiedCoordsForImageSource(e, i, o) {
          if (!e.getSource().loaded()) return;

          var a = this.proxiedCoords[e.id] = [],
              r = this.proxyCoords,
              n = e.getSource(),
              s = new t.Point(n.tileID.x, n.tileID.y)._div(1 << n.tileID.z),
              l = n.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce(function (t, e) {
            return t.min.x = Math.min(t.min.x, e.x - s.x), t.min.y = Math.min(t.min.y, e.y - s.y), t.max.x = Math.max(t.max.x, e.x - s.x), t.max.y = Math.max(t.max.y, e.y - s.y), t;
          }, {
            min: new t.Point(Number.MAX_VALUE, Number.MAX_VALUE),
            max: new t.Point(-Number.MAX_VALUE, -Number.MAX_VALUE)
          }),
              c = function c(e, i) {
            var o = e.wrap + e.canonical.x / (1 << e.canonical.z),
                a = e.canonical.y / (1 << e.canonical.z),
                r = t.EXTENT / (1 << e.canonical.z),
                n = i.wrap + i.canonical.x / (1 << i.canonical.z),
                s = i.canonical.y / (1 << i.canonical.z);
            return o + r < n + l.min.x || o > n + l.max.x || a + r < s + l.min.y || a > s + l.max.y;
          };

          for (var _t342 = 0; _t342 < r.length; _t342++) {
            var _n142 = r[_t342];

            for (var _t343 = 0; _t343 < i.length; _t343++) {
              var _r228 = e.getTile(i[_t343]);

              if (!_r228 || !_r228.hasData()) continue;
              if (c(_n142, _r228.tileID)) continue;

              var _s112 = this._createProxiedId(_n142, _r228, o[_n142.key] && o[_n142.key][e.id]),
                  _l47 = this.proxyToSource[_n142.key][e.id];

              _l47 ? _l47.push(_s112) : this.proxyToSource[_n142.key][e.id] = [_s112], a.push(_s112);
            }
          }
        }
      }, {
        key: "_createProxiedId",
        value: function _createProxiedId(e, i, o) {
          var a = this.orthoMatrix;

          if (o) {
            var _t344 = o.find(function (t) {
              return t.key === i.tileID.key;
            });

            if (_t344) return _t344;
          }

          if (i.tileID.key !== e.key) {
            var _o91 = e.canonical.z - i.tileID.canonical.z;

            var _r229, _n143, _s113;

            a = t.create();

            var _l48 = i.tileID.wrap - e.wrap << e.overscaledZ;

            _o91 > 0 ? (_r229 = t.EXTENT >> _o91, _n143 = _r229 * ((i.tileID.canonical.x << _o91) - e.canonical.x + _l48), _s113 = _r229 * ((i.tileID.canonical.y << _o91) - e.canonical.y)) : (_r229 = t.EXTENT << -_o91, _n143 = t.EXTENT * (i.tileID.canonical.x - (e.canonical.x + _l48 << -_o91)), _s113 = t.EXTENT * (i.tileID.canonical.y - (e.canonical.y << -_o91))), t.ortho(a, 0, _r229, 0, _r229, 0, 1), t.translate(a, a, [_n143, _s113, 0]);
          }

          return new Ve(i.tileID, e.key, a);
        }
      }, {
        key: "_findTileCoveringTileID",
        value: function _findTileCoveringTileID(e, i) {
          var o = i.getTile(e);
          if (o && o.hasData()) return o;
          var a = this._findCoveringTileCache[i.id],
              r = a[e.key];
          if (o = r ? i.getTileByID(r) : null, o && o.hasData() || null === r) return o;
          var n = o ? o.tileID : e,
              s = n.overscaledZ;
          var l = i.getSource().minzoom,
              c = [];

          if (!r) {
            var _a128 = i.getSource().maxzoom;

            if (e.canonical.z >= _a128) {
              var _o92 = e.canonical.z - _a128;

              i.getSource().reparseOverscaled ? (s = Math.max(e.canonical.z + 2, i.transform.tileZoom), n = new t.OverscaledTileID(s, e.wrap, _a128, e.canonical.x >> _o92, e.canonical.y >> _o92)) : 0 !== _o92 && (s = _a128, n = new t.OverscaledTileID(s, e.wrap, _a128, e.canonical.x >> _o92, e.canonical.y >> _o92));
            }

            n.key !== e.key && (c.push(n.key), o = i.getTile(n));
          }

          var h = function h(t) {
            c.forEach(function (e) {
              a[e] = t;
            }), c.length = 0;
          };

          for (s -= 1; s >= l && (!o || !o.hasData()); s--) {
            o && h(o.tileID.key);

            var _t345 = n.calculateScaledKey(s);

            if (o = i.getTileByID(_t345), o && o.hasData()) break;
            var _e299 = a[_t345];
            if (null === _e299) break;
            void 0 === _e299 ? c.push(_t345) : o = i.getTileByID(_e299);
          }

          return h(o ? o.tileID.key : null), o && o.hasData() ? o : null;
        }
      }, {
        key: "findDEMTileFor",
        value: function findDEMTileFor(t) {
          return this.enabled ? this._findTileCoveringTileID(t, this.sourceCache) : null;
        }
      }, {
        key: "prepareDrawTile",
        value: function prepareDrawTile(t) {
          this.renderedToTile || (this.renderedToTile = !0);
        }
      }, {
        key: "_clearRenderCacheForTile",
        value: function _clearRenderCacheForTile(t, e) {
          var i = this._tilesDirty[t];
          i || (i = this._tilesDirty[t] = {}), i[e.key] = !0;
        }
      }, {
        key: "visibleDemTiles",
        get: function get() {
          return this._visibleDemTiles;
        }
      }, {
        key: "drapeBufferSize",
        get: function get() {
          var t = 2 * this.proxySourceCache.getSource().tileSize;
          return [t, t];
        }
      }, {
        key: "emptyDEMTexture",
        get: function get() {
          return !this._emptyDEMTextureDirty && this._emptyDEMTexture ? this._emptyDEMTexture : this._updateEmptyDEMTexture();
        }
      }]);

      return $e;
    }(t.Elevation);

    function je(t) {
      var e = [];

      for (var _i227 = 0; _i227 < t.length; _i227++) {
        if (null === t[_i227]) continue;

        var _o93 = t[_i227].split(" ");

        e.push(_o93.pop());
      }

      return e;
    }

    var We = /*#__PURE__*/function () {
      _createClass(We, null, [{
        key: "cacheKey",
        value: function cacheKey(t, e, i) {
          var o = "".concat(t).concat(i ? i.cacheKey : "");

          var _iterator205 = _createForOfIteratorHelper(e),
              _step205;

          try {
            for (_iterator205.s(); !(_step205 = _iterator205.n()).done;) {
              var _t346 = _step205.value;
              o += "/".concat(_t346);
            }
          } catch (err) {
            _iterator205.e(err);
          } finally {
            _iterator205.f();
          }

          return o;
        }
      }]);

      function We(e, i, o, a, r, n) {
        _classCallCheck(this, We);

        var s = e.gl;
        this.program = s.createProgram();

        var l = je(o.staticAttributes),
            c = a ? a.getBinderAttributes() : [],
            h = l.concat(c),
            u = o.staticUniforms ? je(o.staticUniforms) : [],
            d = a ? a.getBinderUniforms() : [],
            _ = u.concat(d),
            m = [];

        var _iterator206 = _createForOfIteratorHelper(_),
            _step206;

        try {
          for (_iterator206.s(); !(_step206 = _iterator206.n()).done;) {
            var _t350 = _step206.value;
            m.indexOf(_t350) < 0 && m.push(_t350);
          }
        } catch (err) {
          _iterator206.e(err);
        } finally {
          _iterator206.f();
        }

        var p = a ? a.defines() : [];
        p = p.concat(n.map(function (t) {
          return "#define ".concat(t);
        }));
        var f = p.concat(Kt.fragmentSource, o.fragmentSource).join("\n"),
            g = p.concat(Kt.vertexSource, Ht.vertexSource, o.vertexSource).join("\n"),
            v = s.createShader(s.FRAGMENT_SHADER);
        if (s.isContextLost()) return void (this.failedToCreate = !0);
        s.shaderSource(v, f), s.compileShader(v), s.attachShader(this.program, v);
        var x = s.createShader(s.VERTEX_SHADER);
        if (s.isContextLost()) return void (this.failedToCreate = !0);
        s.shaderSource(x, g), s.compileShader(x), s.attachShader(this.program, x), this.attributes = {};
        var y = {};
        this.numAttributes = h.length;

        for (var _t347 = 0; _t347 < this.numAttributes; _t347++) {
          h[_t347] && (s.bindAttribLocation(this.program, _t347, h[_t347]), this.attributes[h[_t347]] = _t347);
        }

        s.linkProgram(this.program), s.deleteShader(x), s.deleteShader(v);

        for (var _t348 = 0; _t348 < m.length; _t348++) {
          var _e300 = m[_t348];

          if (_e300 && !y[_e300]) {
            var _t349 = s.getUniformLocation(this.program, _e300);

            _t349 && (y[_e300] = _t349);
          }
        }

        this.fixedUniforms = r(e, y), this.binderUniforms = a ? a.getUniforms(e, y) : [], -1 !== n.indexOf("TERRAIN") && (this.terrainUniforms = function (e, i) {
          return {
            u_dem: new t.Uniform1i(e, i.u_dem),
            u_dem_prev: new t.Uniform1i(e, i.u_dem_prev),
            u_dem_unpack: new t.Uniform4f(e, i.u_dem_unpack),
            u_dem_tl: new t.Uniform2f(e, i.u_dem_tl),
            u_dem_scale: new t.Uniform1f(e, i.u_dem_scale),
            u_dem_tl_prev: new t.Uniform2f(e, i.u_dem_tl_prev),
            u_dem_scale_prev: new t.Uniform1f(e, i.u_dem_scale_prev),
            u_dem_size: new t.Uniform1f(e, i.u_dem_size),
            u_dem_lerp: new t.Uniform1f(e, i.u_dem_lerp),
            u_exaggeration: new t.Uniform1f(e, i.u_exaggeration),
            u_depth: new t.Uniform1i(e, i.u_depth),
            u_depth_size_inv: new t.Uniform2f(e, i.u_depth_size_inv),
            u_meter_to_dem: new t.Uniform1f(e, i.u_meter_to_dem),
            u_label_plane_matrix_inv: new t.UniformMatrix4f(e, i.u_label_plane_matrix_inv)
          };
        }(e, y));
      }

      _createClass(We, [{
        key: "setTerrainUniformValues",
        value: function setTerrainUniformValues(t, e) {
          if (!this.terrainUniforms) return;
          var i = this.terrainUniforms;

          if (!this.failedToCreate) {
            t.program.set(this.program);

            for (var _t351 in e) {
              i[_t351].set(e[_t351]);
            }
          }
        }
      }, {
        key: "draw",
        value: function draw(t, e, i, o, a, r, n, s, l, c, h, u, d, _, m, p) {
          var _f$LINES$f$TRIANGLES$;

          var f = t.gl;
          if (this.failedToCreate) return;
          t.program.set(this.program), t.setDepthMode(i), t.setStencilMode(o), t.setColorMode(a), t.setCullFace(r);

          for (var _t352 in this.fixedUniforms) {
            this.fixedUniforms[_t352].set(n[_t352]);
          }

          _ && _.setUniforms(t, this.binderUniforms, u, {
            zoom: d
          });
          var g = (_f$LINES$f$TRIANGLES$ = {}, _defineProperty(_f$LINES$f$TRIANGLES$, f.LINES, 2), _defineProperty(_f$LINES$f$TRIANGLES$, f.TRIANGLES, 3), _defineProperty(_f$LINES$f$TRIANGLES$, f.LINE_STRIP, 1), _f$LINES$f$TRIANGLES$)[e];

          var _iterator207 = _createForOfIteratorHelper(h.get()),
              _step207;

          try {
            for (_iterator207.s(); !(_step207 = _iterator207.n()).done;) {
              var _i228 = _step207.value;

              var _o94 = _i228.vaos || (_i228.vaos = {});

              (_o94[s] || (_o94[s] = new Me())).bind(t, this, l, _ ? _.getPaintVertexBuffers() : [], c, _i228.vertexOffset, m, p), f.drawElements(e, _i228.primitiveLength * g, f.UNSIGNED_SHORT, _i228.primitiveOffset * g * 2);
            }
          } catch (err) {
            _iterator207.e(err);
          } finally {
            _iterator207.f();
          }
        }
      }]);

      return We;
    }();

    function Xe(t, e, i) {
      var o = 1 / C(i, 1, e.transform.tileZoom),
          a = Math.pow(2, i.tileID.overscaledZ),
          r = i.tileSize * Math.pow(2, e.transform.tileZoom) / a,
          n = r * (i.tileID.canonical.x + i.tileID.wrap * a),
          s = r * i.tileID.canonical.y;
      return {
        u_image: 0,
        u_texsize: i.imageAtlasTexture.size,
        u_scale: [o, t.fromScale, t.toScale],
        u_fade: t.t,
        u_pixel_coord_upper: [n >> 16, s >> 16],
        u_pixel_coord_lower: [65535 & n, 65535 & s]
      };
    }

    var He = function He(e, i, o, a) {
      var r = i.style.light,
          n = r.properties.get("position"),
          s = [n.x, n.y, n.z],
          l = t.create$1();
      "viewport" === r.properties.get("anchor") && (t.fromRotation(l, -i.transform.angle), t.transformMat3(s, s, l));
      var c = r.properties.get("color");
      return {
        u_matrix: e,
        u_lightpos: s,
        u_lightintensity: r.properties.get("intensity"),
        u_lightcolor: [c.r, c.g, c.b],
        u_vertical_gradient: +o,
        u_opacity: a
      };
    },
        Ke = function Ke(e, i, o, a, r, n, s) {
      return t.extend(He(e, i, o, a), Xe(n, i, s), {
        u_height_factor: -Math.pow(2, r.overscaledZ) / s.tileSize / 8
      });
    },
        Ye = function Ye(t) {
      return {
        u_matrix: t
      };
    },
        Je = function Je(e, i, o, a) {
      return t.extend(Ye(e), Xe(o, i, a));
    },
        Qe = function Qe(t, e) {
      return {
        u_matrix: t,
        u_world: e
      };
    },
        ti = function ti(e, i, o, a, r) {
      return t.extend(Je(e, i, o, a), {
        u_world: r
      });
    },
        ei = function ei(e, i, o, a) {
      var r = e.transform;
      var n;

      if ("map" === a.paint.get("circle-pitch-alignment")) {
        var _t353 = C(o, 1, r.zoom);

        n = [_t353, _t353];
      } else n = r.pixelsToGLUnits;

      return {
        u_camera_to_center_distance: r.cameraToCenterDistance,
        u_matrix: e.translatePosMatrix(i.posMatrix, o, a.paint.get("circle-translate"), a.paint.get("circle-translate-anchor")),
        u_device_pixel_ratio: t.browser.devicePixelRatio,
        u_extrude_scale: n
      };
    },
        ii = function ii(t) {
      var e = [];
      return "map" === t.paint.get("circle-pitch-alignment") && e.push("PITCH_WITH_MAP"), "map" === t.paint.get("circle-pitch-scale") && e.push("SCALE_WITH_MAP"), e;
    },
        oi = function oi(e, i, o) {
      var a = t.EXTENT / o.tileSize;
      return {
        u_matrix: e,
        u_camera_to_center_distance: i.cameraToCenterDistance,
        u_extrude_scale: [i.pixelsToGLUnits[0] / a, i.pixelsToGLUnits[1] / a]
      };
    },
        ai = function ai(t, e) {
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      return {
        u_matrix: t,
        u_color: e,
        u_overlay: 0,
        u_overlay_scale: i
      };
    },
        ri = function ri(t, e, i, o) {
      return {
        u_matrix: t,
        u_extrude_scale: C(e, 1, i),
        u_intensity: o
      };
    },
        ni = function ni(e, i, o, a) {
      var r = e.transform;
      return {
        u_matrix: ui(e, i, o, a),
        u_ratio: 1 / C(i, 1, r.zoom),
        u_device_pixel_ratio: t.browser.devicePixelRatio,
        u_units_to_pixels: [1 / r.pixelsToGLUnits[0], 1 / r.pixelsToGLUnits[1]]
      };
    },
        si = function si(e, i, o, a, r) {
      return t.extend(ni(e, i, o, a), {
        u_image: 0,
        u_image_height: r
      });
    },
        li = function li(e, i, o, a, r) {
      var n = e.transform,
          s = hi(i, n);
      return {
        u_matrix: ui(e, i, o, r),
        u_texsize: i.imageAtlasTexture.size,
        u_ratio: 1 / C(i, 1, n.zoom),
        u_device_pixel_ratio: t.browser.devicePixelRatio,
        u_image: 0,
        u_scale: [s, a.fromScale, a.toScale],
        u_fade: a.t,
        u_units_to_pixels: [1 / n.pixelsToGLUnits[0], 1 / n.pixelsToGLUnits[1]]
      };
    },
        ci = function ci(e, i, o, a, r, n) {
      var s = e.lineAtlas,
          l = hi(i, e.transform),
          c = "round" === o.layout.get("line-cap"),
          h = s.getDash(a.from, c),
          u = s.getDash(a.to, c),
          d = h.width * r.fromScale,
          _ = u.width * r.toScale;

      return t.extend(ni(e, i, o, n), {
        u_patternscale_a: [l / d, -h.height / 2],
        u_patternscale_b: [l / _, -u.height / 2],
        u_sdfgamma: s.width / (256 * Math.min(d, _) * t.browser.devicePixelRatio) / 2,
        u_image: 0,
        u_tex_y_a: h.y,
        u_tex_y_b: u.y,
        u_mix: r.t
      });
    };

    function hi(t, e) {
      return 1 / C(t, 1, e.tileZoom);
    }

    function ui(t, e, i, o) {
      return t.translatePosMatrix(o || e.tileID.posMatrix, e, i.paint.get("line-translate"), i.paint.get("line-translate-anchor"));
    }

    var di = function di(t, e, i, o, a) {
      return {
        u_matrix: t,
        u_tl_parent: e,
        u_scale_parent: i,
        u_buffer_scale: 1,
        u_fade_t: o.mix,
        u_opacity: o.opacity * a.paint.get("raster-opacity"),
        u_image0: 0,
        u_image1: 1,
        u_brightness_low: a.paint.get("raster-brightness-min"),
        u_brightness_high: a.paint.get("raster-brightness-max"),
        u_saturation_factor: (n = a.paint.get("raster-saturation"), n > 0 ? 1 - 1 / (1.001 - n) : -n),
        u_contrast_factor: (r = a.paint.get("raster-contrast"), r > 0 ? 1 / (1 - r) : 1 + r),
        u_spin_weights: _i(a.paint.get("raster-hue-rotate"))
      };
      var r, n;
    };

    function _i(t) {
      t *= Math.PI / 180;
      var e = Math.sin(t),
          i = Math.cos(t);
      return [(2 * i + 1) / 3, (-Math.sqrt(3) * e - i + 1) / 3, (Math.sqrt(3) * e - i + 1) / 3];
    }

    var mi = function mi(t, e, i, o, a, r, n, s, l, c) {
      var h = a.transform;
      return {
        u_is_size_zoom_constant: +("constant" === t || "source" === t),
        u_is_size_feature_constant: +("constant" === t || "camera" === t),
        u_size_t: e ? e.uSizeT : 0,
        u_size: e ? e.uSize : 0,
        u_camera_to_center_distance: h.cameraToCenterDistance,
        u_pitch: h.pitch / 360 * 2 * Math.PI,
        u_rotate_symbol: +i,
        u_aspect_ratio: h.width / h.height,
        u_fade_change: a.options.fadeDuration ? a.symbolFadeChange : 1,
        u_matrix: r,
        u_label_plane_matrix: n,
        u_coord_matrix: s,
        u_is_text: +l,
        u_pitch_with_map: +o,
        u_texsize: c,
        u_texture: 0
      };
    },
        pi = function pi(e, i, o, a, r, n, s, l, c, h, u) {
      var d = r.transform;
      return t.extend(mi(e, i, o, a, r, n, s, l, c, h), {
        u_gamma_scale: a ? Math.cos(d._pitch) * d.cameraToCenterDistance : 1,
        u_device_pixel_ratio: t.browser.devicePixelRatio,
        u_is_halo: +u
      });
    },
        fi = function fi(e, i, o, a, r, n, s, l, c, h) {
      return t.extend(pi(e, i, o, a, r, n, s, l, !0, c, !0), {
        u_texsize_icon: h,
        u_texture_icon: 1
      });
    },
        gi = function gi(t, e, i) {
      return {
        u_matrix: t,
        u_opacity: e,
        u_color: i
      };
    },
        vi = function vi(e, i, o, a, r, n) {
      return t.extend(function (t, e, i, o) {
        var a = i.imageManager.getPattern(t.from.toString()),
            r = i.imageManager.getPattern(t.to.toString()),
            _i$imageManager$getPi = i.imageManager.getPixelSize(),
            n = _i$imageManager$getPi.width,
            s = _i$imageManager$getPi.height,
            l = Math.pow(2, o.tileID.overscaledZ),
            c = o.tileSize * Math.pow(2, i.transform.tileZoom) / l,
            h = c * (o.tileID.canonical.x + o.tileID.wrap * l),
            u = c * o.tileID.canonical.y;

        return {
          u_image: 0,
          u_pattern_tl_a: a.tl,
          u_pattern_br_a: a.br,
          u_pattern_tl_b: r.tl,
          u_pattern_br_b: r.br,
          u_texsize: [n, s],
          u_mix: e.t,
          u_pattern_size_a: a.displaySize,
          u_pattern_size_b: r.displaySize,
          u_scale_a: e.fromScale,
          u_scale_b: e.toScale,
          u_tile_units_to_pixels: 1 / C(o, 1, i.transform.tileZoom),
          u_pixel_coord_upper: [h >> 16, u >> 16],
          u_pixel_coord_lower: [65535 & h, 65535 & u]
        };
      }(a, n, o, r), {
        u_matrix: e,
        u_opacity: i
      });
    },
        xi = {
      fillExtrusion: function fillExtrusion(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_lightpos: new t.Uniform3f(e, i.u_lightpos),
          u_lightintensity: new t.Uniform1f(e, i.u_lightintensity),
          u_lightcolor: new t.Uniform3f(e, i.u_lightcolor),
          u_vertical_gradient: new t.Uniform1f(e, i.u_vertical_gradient),
          u_opacity: new t.Uniform1f(e, i.u_opacity)
        };
      },
      fillExtrusionPattern: function fillExtrusionPattern(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_lightpos: new t.Uniform3f(e, i.u_lightpos),
          u_lightintensity: new t.Uniform1f(e, i.u_lightintensity),
          u_lightcolor: new t.Uniform3f(e, i.u_lightcolor),
          u_vertical_gradient: new t.Uniform1f(e, i.u_vertical_gradient),
          u_height_factor: new t.Uniform1f(e, i.u_height_factor),
          u_image: new t.Uniform1i(e, i.u_image),
          u_texsize: new t.Uniform2f(e, i.u_texsize),
          u_pixel_coord_upper: new t.Uniform2f(e, i.u_pixel_coord_upper),
          u_pixel_coord_lower: new t.Uniform2f(e, i.u_pixel_coord_lower),
          u_scale: new t.Uniform3f(e, i.u_scale),
          u_fade: new t.Uniform1f(e, i.u_fade),
          u_opacity: new t.Uniform1f(e, i.u_opacity)
        };
      },
      fill: function fill(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix)
        };
      },
      fillPattern: function fillPattern(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_image: new t.Uniform1i(e, i.u_image),
          u_texsize: new t.Uniform2f(e, i.u_texsize),
          u_pixel_coord_upper: new t.Uniform2f(e, i.u_pixel_coord_upper),
          u_pixel_coord_lower: new t.Uniform2f(e, i.u_pixel_coord_lower),
          u_scale: new t.Uniform3f(e, i.u_scale),
          u_fade: new t.Uniform1f(e, i.u_fade)
        };
      },
      fillOutline: function fillOutline(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_world: new t.Uniform2f(e, i.u_world)
        };
      },
      fillOutlinePattern: function fillOutlinePattern(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_world: new t.Uniform2f(e, i.u_world),
          u_image: new t.Uniform1i(e, i.u_image),
          u_texsize: new t.Uniform2f(e, i.u_texsize),
          u_pixel_coord_upper: new t.Uniform2f(e, i.u_pixel_coord_upper),
          u_pixel_coord_lower: new t.Uniform2f(e, i.u_pixel_coord_lower),
          u_scale: new t.Uniform3f(e, i.u_scale),
          u_fade: new t.Uniform1f(e, i.u_fade)
        };
      },
      circle: function circle(e, i) {
        return {
          u_camera_to_center_distance: new t.Uniform1f(e, i.u_camera_to_center_distance),
          u_extrude_scale: new t.Uniform2f(e, i.u_extrude_scale),
          u_device_pixel_ratio: new t.Uniform1f(e, i.u_device_pixel_ratio),
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix)
        };
      },
      collisionBox: function collisionBox(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_camera_to_center_distance: new t.Uniform1f(e, i.u_camera_to_center_distance),
          u_extrude_scale: new t.Uniform2f(e, i.u_extrude_scale)
        };
      },
      collisionCircle: function collisionCircle(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_inv_matrix: new t.UniformMatrix4f(e, i.u_inv_matrix),
          u_camera_to_center_distance: new t.Uniform1f(e, i.u_camera_to_center_distance),
          u_viewport_size: new t.Uniform2f(e, i.u_viewport_size)
        };
      },
      debug: function debug(e, i) {
        return {
          u_color: new t.UniformColor(e, i.u_color),
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_overlay: new t.Uniform1i(e, i.u_overlay),
          u_overlay_scale: new t.Uniform1f(e, i.u_overlay_scale)
        };
      },
      clippingMask: function clippingMask(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix)
        };
      },
      heatmap: function heatmap(e, i) {
        return {
          u_extrude_scale: new t.Uniform1f(e, i.u_extrude_scale),
          u_intensity: new t.Uniform1f(e, i.u_intensity),
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix)
        };
      },
      heatmapTexture: function heatmapTexture(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_world: new t.Uniform2f(e, i.u_world),
          u_image: new t.Uniform1i(e, i.u_image),
          u_color_ramp: new t.Uniform1i(e, i.u_color_ramp),
          u_opacity: new t.Uniform1f(e, i.u_opacity)
        };
      },
      hillshade: function hillshade(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_image: new t.Uniform1i(e, i.u_image),
          u_latrange: new t.Uniform2f(e, i.u_latrange),
          u_light: new t.Uniform2f(e, i.u_light),
          u_shadow: new t.UniformColor(e, i.u_shadow),
          u_highlight: new t.UniformColor(e, i.u_highlight),
          u_accent: new t.UniformColor(e, i.u_accent)
        };
      },
      hillshadePrepare: function hillshadePrepare(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_image: new t.Uniform1i(e, i.u_image),
          u_dimension: new t.Uniform2f(e, i.u_dimension),
          u_zoom: new t.Uniform1f(e, i.u_zoom),
          u_unpack: new t.Uniform4f(e, i.u_unpack)
        };
      },
      line: function line(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_ratio: new t.Uniform1f(e, i.u_ratio),
          u_device_pixel_ratio: new t.Uniform1f(e, i.u_device_pixel_ratio),
          u_units_to_pixels: new t.Uniform2f(e, i.u_units_to_pixels)
        };
      },
      lineGradient: function lineGradient(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_ratio: new t.Uniform1f(e, i.u_ratio),
          u_device_pixel_ratio: new t.Uniform1f(e, i.u_device_pixel_ratio),
          u_units_to_pixels: new t.Uniform2f(e, i.u_units_to_pixels),
          u_image: new t.Uniform1i(e, i.u_image),
          u_image_height: new t.Uniform1f(e, i.u_image_height)
        };
      },
      linePattern: function linePattern(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_texsize: new t.Uniform2f(e, i.u_texsize),
          u_ratio: new t.Uniform1f(e, i.u_ratio),
          u_device_pixel_ratio: new t.Uniform1f(e, i.u_device_pixel_ratio),
          u_image: new t.Uniform1i(e, i.u_image),
          u_units_to_pixels: new t.Uniform2f(e, i.u_units_to_pixels),
          u_scale: new t.Uniform3f(e, i.u_scale),
          u_fade: new t.Uniform1f(e, i.u_fade)
        };
      },
      lineSDF: function lineSDF(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_ratio: new t.Uniform1f(e, i.u_ratio),
          u_device_pixel_ratio: new t.Uniform1f(e, i.u_device_pixel_ratio),
          u_units_to_pixels: new t.Uniform2f(e, i.u_units_to_pixels),
          u_patternscale_a: new t.Uniform2f(e, i.u_patternscale_a),
          u_patternscale_b: new t.Uniform2f(e, i.u_patternscale_b),
          u_sdfgamma: new t.Uniform1f(e, i.u_sdfgamma),
          u_image: new t.Uniform1i(e, i.u_image),
          u_tex_y_a: new t.Uniform1f(e, i.u_tex_y_a),
          u_tex_y_b: new t.Uniform1f(e, i.u_tex_y_b),
          u_mix: new t.Uniform1f(e, i.u_mix)
        };
      },
      raster: function raster(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_tl_parent: new t.Uniform2f(e, i.u_tl_parent),
          u_scale_parent: new t.Uniform1f(e, i.u_scale_parent),
          u_buffer_scale: new t.Uniform1f(e, i.u_buffer_scale),
          u_fade_t: new t.Uniform1f(e, i.u_fade_t),
          u_opacity: new t.Uniform1f(e, i.u_opacity),
          u_image0: new t.Uniform1i(e, i.u_image0),
          u_image1: new t.Uniform1i(e, i.u_image1),
          u_brightness_low: new t.Uniform1f(e, i.u_brightness_low),
          u_brightness_high: new t.Uniform1f(e, i.u_brightness_high),
          u_saturation_factor: new t.Uniform1f(e, i.u_saturation_factor),
          u_contrast_factor: new t.Uniform1f(e, i.u_contrast_factor),
          u_spin_weights: new t.Uniform3f(e, i.u_spin_weights)
        };
      },
      symbolIcon: function symbolIcon(e, i) {
        return {
          u_is_size_zoom_constant: new t.Uniform1i(e, i.u_is_size_zoom_constant),
          u_is_size_feature_constant: new t.Uniform1i(e, i.u_is_size_feature_constant),
          u_size_t: new t.Uniform1f(e, i.u_size_t),
          u_size: new t.Uniform1f(e, i.u_size),
          u_camera_to_center_distance: new t.Uniform1f(e, i.u_camera_to_center_distance),
          u_pitch: new t.Uniform1f(e, i.u_pitch),
          u_rotate_symbol: new t.Uniform1i(e, i.u_rotate_symbol),
          u_aspect_ratio: new t.Uniform1f(e, i.u_aspect_ratio),
          u_fade_change: new t.Uniform1f(e, i.u_fade_change),
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_label_plane_matrix: new t.UniformMatrix4f(e, i.u_label_plane_matrix),
          u_coord_matrix: new t.UniformMatrix4f(e, i.u_coord_matrix),
          u_is_text: new t.Uniform1i(e, i.u_is_text),
          u_pitch_with_map: new t.Uniform1i(e, i.u_pitch_with_map),
          u_texsize: new t.Uniform2f(e, i.u_texsize),
          u_texture: new t.Uniform1i(e, i.u_texture)
        };
      },
      symbolSDF: function symbolSDF(e, i) {
        return {
          u_is_size_zoom_constant: new t.Uniform1i(e, i.u_is_size_zoom_constant),
          u_is_size_feature_constant: new t.Uniform1i(e, i.u_is_size_feature_constant),
          u_size_t: new t.Uniform1f(e, i.u_size_t),
          u_size: new t.Uniform1f(e, i.u_size),
          u_camera_to_center_distance: new t.Uniform1f(e, i.u_camera_to_center_distance),
          u_pitch: new t.Uniform1f(e, i.u_pitch),
          u_rotate_symbol: new t.Uniform1i(e, i.u_rotate_symbol),
          u_aspect_ratio: new t.Uniform1f(e, i.u_aspect_ratio),
          u_fade_change: new t.Uniform1f(e, i.u_fade_change),
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_label_plane_matrix: new t.UniformMatrix4f(e, i.u_label_plane_matrix),
          u_coord_matrix: new t.UniformMatrix4f(e, i.u_coord_matrix),
          u_is_text: new t.Uniform1i(e, i.u_is_text),
          u_pitch_with_map: new t.Uniform1i(e, i.u_pitch_with_map),
          u_texsize: new t.Uniform2f(e, i.u_texsize),
          u_texture: new t.Uniform1i(e, i.u_texture),
          u_gamma_scale: new t.Uniform1f(e, i.u_gamma_scale),
          u_device_pixel_ratio: new t.Uniform1f(e, i.u_device_pixel_ratio),
          u_is_halo: new t.Uniform1i(e, i.u_is_halo)
        };
      },
      symbolTextAndIcon: function symbolTextAndIcon(e, i) {
        return {
          u_is_size_zoom_constant: new t.Uniform1i(e, i.u_is_size_zoom_constant),
          u_is_size_feature_constant: new t.Uniform1i(e, i.u_is_size_feature_constant),
          u_size_t: new t.Uniform1f(e, i.u_size_t),
          u_size: new t.Uniform1f(e, i.u_size),
          u_camera_to_center_distance: new t.Uniform1f(e, i.u_camera_to_center_distance),
          u_pitch: new t.Uniform1f(e, i.u_pitch),
          u_rotate_symbol: new t.Uniform1i(e, i.u_rotate_symbol),
          u_aspect_ratio: new t.Uniform1f(e, i.u_aspect_ratio),
          u_fade_change: new t.Uniform1f(e, i.u_fade_change),
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_label_plane_matrix: new t.UniformMatrix4f(e, i.u_label_plane_matrix),
          u_coord_matrix: new t.UniformMatrix4f(e, i.u_coord_matrix),
          u_is_text: new t.Uniform1i(e, i.u_is_text),
          u_pitch_with_map: new t.Uniform1i(e, i.u_pitch_with_map),
          u_texsize: new t.Uniform2f(e, i.u_texsize),
          u_texsize_icon: new t.Uniform2f(e, i.u_texsize_icon),
          u_texture: new t.Uniform1i(e, i.u_texture),
          u_texture_icon: new t.Uniform1i(e, i.u_texture_icon),
          u_gamma_scale: new t.Uniform1f(e, i.u_gamma_scale),
          u_device_pixel_ratio: new t.Uniform1f(e, i.u_device_pixel_ratio),
          u_is_halo: new t.Uniform1i(e, i.u_is_halo)
        };
      },
      background: function background(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_opacity: new t.Uniform1f(e, i.u_opacity),
          u_color: new t.UniformColor(e, i.u_color)
        };
      },
      backgroundPattern: function backgroundPattern(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_opacity: new t.Uniform1f(e, i.u_opacity),
          u_image: new t.Uniform1i(e, i.u_image),
          u_pattern_tl_a: new t.Uniform2f(e, i.u_pattern_tl_a),
          u_pattern_br_a: new t.Uniform2f(e, i.u_pattern_br_a),
          u_pattern_tl_b: new t.Uniform2f(e, i.u_pattern_tl_b),
          u_pattern_br_b: new t.Uniform2f(e, i.u_pattern_br_b),
          u_texsize: new t.Uniform2f(e, i.u_texsize),
          u_mix: new t.Uniform1f(e, i.u_mix),
          u_pattern_size_a: new t.Uniform2f(e, i.u_pattern_size_a),
          u_pattern_size_b: new t.Uniform2f(e, i.u_pattern_size_b),
          u_scale_a: new t.Uniform1f(e, i.u_scale_a),
          u_scale_b: new t.Uniform1f(e, i.u_scale_b),
          u_pixel_coord_upper: new t.Uniform2f(e, i.u_pixel_coord_upper),
          u_pixel_coord_lower: new t.Uniform2f(e, i.u_pixel_coord_lower),
          u_tile_units_to_pixels: new t.Uniform1f(e, i.u_tile_units_to_pixels)
        };
      },
      terrainRaster: Re,
      terrainDepth: Re,
      skybox: function skybox(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_sun_direction: new t.Uniform3f(e, i.u_sun_direction),
          u_cubemap: new t.Uniform1i(e, i.u_cubemap),
          u_opacity: new t.Uniform1f(e, i.u_opacity),
          u_temporal_offset: new t.Uniform1f(e, i.u_temporal_offset)
        };
      },
      skyboxGradient: function skyboxGradient(e, i) {
        return {
          u_matrix: new t.UniformMatrix4f(e, i.u_matrix),
          u_color_ramp: new t.Uniform1i(e, i.u_color_ramp),
          u_center_direction: new t.Uniform3f(e, i.u_center_direction),
          u_radius: new t.Uniform1f(e, i.u_radius),
          u_opacity: new t.Uniform1f(e, i.u_opacity),
          u_temporal_offset: new t.Uniform1f(e, i.u_temporal_offset)
        };
      },
      skyboxCapture: function skyboxCapture(e, i) {
        return {
          u_matrix_3f: new t.UniformMatrix3f(e, i.u_matrix_3f),
          u_sun_direction: new t.Uniform3f(e, i.u_sun_direction),
          u_sun_intensity: new t.Uniform1f(e, i.u_sun_intensity),
          u_color_tint_r: new t.Uniform4f(e, i.u_color_tint_r),
          u_color_tint_m: new t.Uniform4f(e, i.u_color_tint_m),
          u_luminance: new t.Uniform1f(e, i.u_luminance)
        };
      }
    };

    var yi;

    function bi(e, i, o, a, r, n, s) {
      var l = e.context,
          c = l.gl,
          h = e.useProgram("collisionBox"),
          u = [];
      var d = 0,
          _ = 0;

      for (var _m16 = 0; _m16 < a.length; _m16++) {
        var _p16 = a[_m16],
            _f13 = i.getTile(_p16),
            _g14 = _f13.getBucket(o);

        if (!_g14) continue;
        var _v13 = _p16.posMatrix;
        0 === r[0] && 0 === r[1] || (_v13 = e.translatePosMatrix(_p16.posMatrix, _f13, r, n));

        var _x12 = s ? _g14.textCollisionBox : _g14.iconCollisionBox,
            _y13 = _g14.collisionCircleArray;

        if (_y13.length > 0) {
          var _i229 = t.create(),
              _o95 = _v13;

          t.mul(_i229, _g14.placementInvProjMatrix, e.transform.glCoordMatrix), t.mul(_i229, _i229, _g14.placementViewportMatrix), u.push({
            circleArray: _y13,
            circleOffset: _,
            transform: _o95,
            invTransform: _i229
          }), d += _y13.length / 4, _ = d;
        }

        _x12 && (e.terrain && e.terrain.setupElevationDraw(_f13, h), h.draw(l, c.LINES, t.DepthMode.disabled, t.StencilMode.disabled, e.colorModeForRenderPass(), t.CullFaceMode.disabled, oi(_v13, e.transform, _f13), o.id, _x12.layoutVertexBuffer, _x12.indexBuffer, _x12.segments, null, e.transform.zoom, null, _x12.collisionVertexBuffer, _x12.collisionVertexBufferExt));
      }

      if (!s || !u.length) return;
      var m = e.useProgram("collisionCircle"),
          p = new t.StructArrayLayout2f1f2i16();
      p.resize(4 * d), p._trim();
      var f = 0;

      for (var _i230 = 0, _u38 = u; _i230 < _u38.length; _i230++) {
        var _t354 = _u38[_i230];

        for (var _e301 = 0; _e301 < _t354.circleArray.length / 4; _e301++) {
          var _i231 = 4 * _e301,
              _o96 = _t354.circleArray[_i231 + 0],
              _a129 = _t354.circleArray[_i231 + 1],
              _r230 = _t354.circleArray[_i231 + 2],
              _n144 = _t354.circleArray[_i231 + 3];

          p.emplace(f++, _o96, _a129, _r230, _n144, 0), p.emplace(f++, _o96, _a129, _r230, _n144, 1), p.emplace(f++, _o96, _a129, _r230, _n144, 2), p.emplace(f++, _o96, _a129, _r230, _n144, 3);
        }
      }

      (!yi || yi.length < 2 * d) && (yi = function (e) {
        var i = 2 * e,
            o = new t.StructArrayLayout3ui6();
        o.resize(i), o._trim();

        for (var _t355 = 0; _t355 < i; _t355++) {
          var _e302 = 6 * _t355;

          o.uint16[_e302 + 0] = 4 * _t355 + 0, o.uint16[_e302 + 1] = 4 * _t355 + 1, o.uint16[_e302 + 2] = 4 * _t355 + 2, o.uint16[_e302 + 3] = 4 * _t355 + 2, o.uint16[_e302 + 4] = 4 * _t355 + 3, o.uint16[_e302 + 5] = 4 * _t355 + 0;
        }

        return o;
      }(d));
      var g = l.createIndexBuffer(yi, !0),
          v = l.createVertexBuffer(p, t.collisionCircleLayout.members, !0);

      for (var _i232 = 0, _u39 = u; _i232 < _u39.length; _i232++) {
        var _i233 = _u39[_i232];
        var _a130 = {
          u_matrix: _i233.transform,
          u_inv_matrix: _i233.invTransform,
          u_camera_to_center_distance: (x = e.transform).cameraToCenterDistance,
          u_viewport_size: [x.width, x.height]
        };
        m.draw(l, c.TRIANGLES, t.DepthMode.disabled, t.StencilMode.disabled, e.colorModeForRenderPass(), t.CullFaceMode.disabled, _a130, o.id, v, g, t.SegmentVector.simpleSegment(0, 2 * _i233.circleOffset, _i233.circleArray.length, _i233.circleArray.length / 2), null, e.transform.zoom, null, null, null);
      }

      var x;
      v.destroy(), g.destroy();
    }

    var wi = t.identity(new Float32Array(16));

    function Ti(e, i, o, a, r, n) {
      var _t$getAnchorAlignment2 = t.getAnchorAlignment(e),
          s = _t$getAnchorAlignment2.horizontalAlign,
          l = _t$getAnchorAlignment2.verticalAlign,
          c = -(s - .5) * i,
          h = -(l - .5) * o,
          u = t.evaluateVariableOffset(e, a);

      return new t.Point((c / r + u[0]) * n, (h / r + u[1]) * n);
    }

    function Ei(e, i, o, a, r, n, s, l, c, h, u, d) {
      var _ = e.text.placedSymbolArray,
          m = e.text.dynamicLayoutVertexArray,
          p = e.icon.dynamicLayoutVertexArray,
          f = {};
      m.clear();

      for (var _p17 = 0; _p17 < _.length; _p17++) {
        var _g15 = _.get(_p17),
            _v14 = e.allowVerticalPlacement && !_g15.placedOrientation,
            _x13 = _g15.hidden || !_g15.crossTileID || _v14 ? null : a[_g15.crossTileID];

        if (_x13) {
          var _a131 = new t.Point(_g15.anchorX, _g15.anchorY),
              _13 = d(_a131),
              _p18 = at(_a131, o ? l : s, _13),
              _v15 = rt(n.cameraToCenterDistance, _p18.signedDistanceFromCamera);

          var _y14 = r.evaluateSizeForFeature(e.textSizeData, h, _g15) * _v15 / t.ONE_EM;

          o && (_y14 *= e.tilePixelRatio / c);

          var _b11 = _x13.width,
              _w10 = _x13.height,
              _T5 = _x13.anchor,
              _E4 = _x13.textOffset,
              _C2 = _x13.textBoxScale,
              _S6 = Ti(_T5, _b11, _w10, _E4, _C2, _y14),
              _I4 = o ? at(_a131.add(_S6), s, _13).point : _p18.point.add(i ? _S6.rotate(-n.angle) : _S6),
              _P2 = e.allowVerticalPlacement && _g15.placedOrientation === t.WritingMode.vertical ? Math.PI / 2 : 0;

          for (var _e303 = 0; _e303 < _g15.numGlyphs; _e303++) {
            t.addDynamicAttributes(m, _I4, _P2);
          }

          u && _g15.associatedIconIndex >= 0 && (f[_g15.associatedIconIndex] = {
            shiftedAnchor: _I4,
            angle: _P2
          });
        } else mt(_g15.numGlyphs, m);
      }

      if (u) {
        p.clear();
        var _i234 = e.icon.placedSymbolArray;

        for (var _e304 = 0; _e304 < _i234.length; _e304++) {
          var _o97 = _i234.get(_e304);

          if (_o97.hidden) mt(_o97.numGlyphs, p);else {
            var _i235 = f[_e304];
            if (_i235) for (var _e305 = 0; _e305 < _o97.numGlyphs; _e305++) {
              t.addDynamicAttributes(p, _i235.shiftedAnchor, _i235.angle);
            } else mt(_o97.numGlyphs, p);
          }
        }

        e.icon.dynamicLayoutVertexBuffer.updateData(p);
      }

      e.text.dynamicLayoutVertexBuffer.updateData(m);
    }

    function Ci(t, e, i) {
      return i.iconsInText && e ? "symbolTextAndIcon" : t ? "symbolSDF" : "symbolIcon";
    }

    function Si(e, i, o, a, r, n, s, l, c, h, u, d) {
      var _ = e.context,
          m = _.gl,
          p = e.transform,
          f = "map" === l,
          g = "map" === c,
          v = f && "point" !== o.layout.get("symbol-placement"),
          x = f && !g && !v,
          y = void 0 !== o.layout.get("symbol-sort-key").constantOr(1);
      var b = !1;
      var w = e.depthModeForSublayer(0, t.DepthMode.ReadOnly),
          T = o.layout.get("text-variable-anchor"),
          E = [],
          S = e.terrain && g ? ["PITCH_WITH_MAP_TERRAIN"] : null;

      var _iterator208 = _createForOfIteratorHelper(a),
          _step208;

      try {
        var _loop11 = function _loop11() {
          var l = _step208.value;
          var a = i.getTile(l),
              c = a.getBucket(o);
          if (!c) return "continue";
          var u = r ? c.text : c.icon;
          if (!u || !u.segments.get().length) return "continue";

          var d = u.programConfigurations.get(o.id),
              _ = r || c.sdfIcons,
              w = r ? c.textSizeData : c.iconSizeData,
              I = g || 0 !== p.pitch,
              P = e.useProgram(Ci(_, r, c), d, S),
              M = t.evaluateSizeForZoom(w, p.zoom);

          var z = void 0,
              A = void 0,
              D = void 0,
              L = void 0,
              R = [0, 0],
              k = null;

          if (r) {
            if (A = a.glyphAtlasTexture, D = m.LINEAR, z = a.glyphAtlasTexture.size, c.iconsInText) {
              R = a.imageAtlasTexture.size, k = a.imageAtlasTexture;

              var _t357 = "composite" === w.kind || "camera" === w.kind;

              L = I || e.options.rotating || e.options.zooming || _t357 ? m.LINEAR : m.NEAREST;
            }
          } else {
            var _t358 = 1 !== o.layout.get("icon-size").constantOr(0) || c.iconsNeedLinear;

            A = a.imageAtlasTexture, D = _ || e.options.rotating || e.options.zooming || _t358 || I ? m.LINEAR : m.NEAREST, z = a.imageAtlasTexture.size;
          }

          var B = C(a, 1, e.transform.zoom),
              O = it(l.posMatrix, g, f, e.transform, B),
              F = e.terrain && g && v ? t.invert(new Float32Array(16), O) : wi,
              U = ot(l.posMatrix, g, f, e.transform, B),
              N = T && c.hasTextData(),
              Z = "none" !== o.layout.get("icon-text-fit") && N && c.hasIconData();

          if (v) {
            var _t359 = p.elevation;
            st(c, l.posMatrix, e, r, O, U, g, h, _t359 ? function (e) {
              return _t359.getAtTileOffset(l, e.x, e.y);
            } : null);
          }

          var G = e.translatePosMatrix(l.posMatrix, a, n, s),
              q = v || r && T || Z ? wi : O,
              V = e.translatePosMatrix(U, a, n, s, !0),
              $ = _ && 0 !== o.paint.get(r ? "text-halo-width" : "icon-halo-width").constantOr(1);

          var j = void 0;
          j = _ ? c.iconsInText ? fi(w.kind, M, x, g, e, G, q, V, z, R) : pi(w.kind, M, x, g, e, G, q, V, r, z, !0) : mi(w.kind, M, x, g, e, G, q, V, r, z);
          var W = {
            program: P,
            buffers: u,
            uniformValues: j,
            atlasTexture: A,
            atlasTextureIcon: k,
            atlasInterpolation: D,
            atlasInterpolationIcon: L,
            isSDF: _,
            hasHalo: $,
            tile: a,
            labelPlaneMatrixInv: F
          };

          if (y && c.canOverlap) {
            b = !0;

            var _e306 = u.segments.get();

            var _iterator209 = _createForOfIteratorHelper(_e306),
                _step209;

            try {
              for (_iterator209.s(); !(_step209 = _iterator209.n()).done;) {
                var _i238 = _step209.value;
                E.push({
                  segments: new t.SegmentVector([_i238]),
                  sortKey: _i238.sortKey,
                  state: W
                });
              }
            } catch (err) {
              _iterator209.e(err);
            } finally {
              _iterator209.f();
            }
          } else E.push({
            segments: u.segments,
            sortKey: 0,
            state: W
          });
        };

        for (_iterator208.s(); !(_step208 = _iterator208.n()).done;) {
          var _ret5 = _loop11();

          if (_ret5 === "continue") continue;
        }
      } catch (err) {
        _iterator208.e(err);
      } finally {
        _iterator208.f();
      }

      b && E.sort(function (t, e) {
        return t.sortKey - e.sortKey;
      });

      for (var _i236 = 0, _E5 = E; _i236 < _E5.length; _i236++) {
        var _t356 = _E5[_i236];
        var _i237 = _t356.state;

        if (e.terrain && e.terrain.setupElevationDraw(_i237.tile, _i237.program, {
          useDepthForOcclusion: !0,
          labelPlaneMatrixInv: _i237.labelPlaneMatrixInv
        }), _.activeTexture.set(m.TEXTURE0), _i237.atlasTexture.bind(_i237.atlasInterpolation, m.CLAMP_TO_EDGE), _i237.atlasTextureIcon && (_.activeTexture.set(m.TEXTURE1), _i237.atlasTextureIcon && _i237.atlasTextureIcon.bind(_i237.atlasInterpolationIcon, m.CLAMP_TO_EDGE)), _i237.isSDF) {
          var _a132 = _i237.uniformValues;
          _i237.hasHalo && (_a132.u_is_halo = 1, Ii(_i237.buffers, _t356.segments, o, e, _i237.program, w, u, d, _a132)), _a132.u_is_halo = 0;
        }

        Ii(_i237.buffers, _t356.segments, o, e, _i237.program, w, u, d, _i237.uniformValues);
      }
    }

    function Ii(e, i, o, a, r, n, s, l, c) {
      var h = a.context;
      r.draw(h, h.gl.TRIANGLES, n, s, l, t.CullFaceMode.disabled, c, o.id, e.layoutVertexBuffer, e.indexBuffer, i, o.paint, a.transform.zoom, e.programConfigurations.get(o.id), e.dynamicLayoutVertexBuffer, e.opacityVertexBuffer);
    }

    function Pi(e, i, o, a, r, n, s) {
      var l = e.context.gl,
          c = o.paint.get("fill-pattern"),
          h = c && c.constantOr(1),
          u = o.getCrossfadeParameters();

      var d, _, m, p, f;

      s ? (_ = h && !o.getPaintProperty("fill-outline-color") ? "fillOutlinePattern" : "fillOutline", d = l.LINES) : (_ = h ? "fillPattern" : "fill", d = l.TRIANGLES);

      var _iterator210 = _createForOfIteratorHelper(a),
          _step210;

      try {
        for (_iterator210.s(); !(_step210 = _iterator210.n()).done;) {
          var _g16 = _step210.value;

          var _a133 = i.getTile(_g16);

          if (h && !_a133.patternsLoaded()) continue;

          var _v16 = _a133.getBucket(o);

          if (!_v16) continue;
          e.prepareDrawTile(_g16);

          var _x14 = _v16.programConfigurations.get(o.id),
              _y15 = e.useProgram(_, _x14);

          h && (e.context.activeTexture.set(l.TEXTURE0), _a133.imageAtlasTexture.bind(l.LINEAR, l.CLAMP_TO_EDGE), _x14.updatePaintBuffers(u));

          var _b12 = c.constantOr(null);

          if (_b12 && _a133.imageAtlas) {
            var _t360 = _a133.imageAtlas,
                _e307 = _t360.patternPositions[_b12.to.toString()],
                _i239 = _t360.patternPositions[_b12.from.toString()];

            _e307 && _i239 && _x14.setConstantPatternPositions(_e307, _i239);
          }

          var _w11 = e.translatePosMatrix(_g16.posMatrix, _a133, o.paint.get("fill-translate"), o.paint.get("fill-translate-anchor"));

          if (s) {
            p = _v16.indexBuffer2, f = _v16.segments2;

            var _t361 = e.terrain && e.terrain.renderingToTexture ? e.terrain.drapeBufferSize : [l.drawingBufferWidth, l.drawingBufferHeight];

            m = "fillOutlinePattern" === _ && h ? ti(_w11, e, u, _a133, _t361) : Qe(_w11, _t361);
          } else p = _v16.indexBuffer, f = _v16.segments, m = h ? Je(_w11, e, u, _a133) : Ye(_w11);

          _y15.draw(e.context, d, r, e.stencilModeForClipping(_g16), n, t.CullFaceMode.disabled, m, o.id, _v16.layoutVertexBuffer, p, f, o.paint, e.transform.zoom, _x14);
        }
      } catch (err) {
        _iterator210.e(err);
      } finally {
        _iterator210.f();
      }
    }

    function Mi(e, i, o, a, r, n, s) {
      var l = e.context,
          c = l.gl,
          h = o.paint.get("fill-extrusion-pattern"),
          u = h.constantOr(1),
          d = o.getCrossfadeParameters(),
          _ = o.paint.get("fill-extrusion-opacity");

      var _iterator211 = _createForOfIteratorHelper(a),
          _step211;

      try {
        for (_iterator211.s(); !(_step211 = _iterator211.n()).done;) {
          var _m17 = _step211.value;

          var _a134 = i.getTile(_m17),
              _p19 = _a134.getBucket(o);

          if (!_p19) continue;

          var _f14 = _p19.programConfigurations.get(o.id),
              _g17 = e.useProgram(u ? "fillExtrusionPattern" : "fillExtrusion", _f14);

          if (e.terrain) {
            var _t362 = e.terrain;
            if (!_p19.enableTerrain) continue;

            if (_t362.setupElevationDraw(_a134, _g17, {
              useMeterToDem: !0
            }), zi(l, i, _m17, _p19, o, _t362), !_p19.centroidVertexBuffer) {
              var _t363 = _g17.attributes.a_centroid_pos;
              void 0 !== _t363 && c.vertexAttrib2f(_t363, 0, 0);
            }
          }

          u && (e.context.activeTexture.set(c.TEXTURE0), _a134.imageAtlasTexture.bind(c.LINEAR, c.CLAMP_TO_EDGE), _f14.updatePaintBuffers(d));

          var _v17 = h.constantOr(null);

          if (_v17 && _a134.imageAtlas) {
            var _t364 = _a134.imageAtlas,
                _e308 = _t364.patternPositions[_v17.to.toString()],
                _i240 = _t364.patternPositions[_v17.from.toString()];

            _e308 && _i240 && _f14.setConstantPatternPositions(_e308, _i240);
          }

          var _x15 = e.translatePosMatrix(_m17.posMatrix, _a134, o.paint.get("fill-extrusion-translate"), o.paint.get("fill-extrusion-translate-anchor")),
              _y16 = o.paint.get("fill-extrusion-vertical-gradient"),
              _b13 = u ? Ke(_x15, e, _y16, _, _m17, d, _a134) : He(_x15, e, _y16, _);

          _g17.draw(l, l.gl.TRIANGLES, r, n, s, t.CullFaceMode.backCCW, _b13, o.id, _p19.layoutVertexBuffer, _p19.indexBuffer, _p19.segments, o.paint, e.transform.zoom, _f14, e.terrain ? _p19.centroidVertexBuffer : null);
        }
      } catch (err) {
        _iterator211.e(err);
      } finally {
        _iterator211.f();
      }
    }

    function zi(e, i, o, a, r, n) {
      var s = [function (e) {
        var i = e.canonical.x - 1,
            o = e.wrap;
        return i < 0 && (i = (1 << e.canonical.z) - 1, o--), new t.OverscaledTileID(e.overscaledZ, o, e.canonical.z, i, e.canonical.y);
      }, function (e) {
        var i = e.canonical.x + 1,
            o = e.wrap;
        return i === 1 << e.canonical.z && (i = 0, o++), new t.OverscaledTileID(e.overscaledZ, o, e.canonical.z, i, e.canonical.y);
      }, function (e) {
        return new t.OverscaledTileID(e.overscaledZ, e.wrap, e.canonical.z, e.canonical.x, (0 === e.canonical.y ? 1 << e.canonical.z : e.canonical.y) - 1);
      }, function (e) {
        return new t.OverscaledTileID(e.overscaledZ, e.wrap, e.canonical.z, e.canonical.x, e.canonical.y === (1 << e.canonical.z) - 1 ? 0 : e.canonical.y + 1);
      }],
          l = function l(t) {
        var e = i.getSource().maxzoom;

        for (var _i241 = 0, _arr3 = [0, -1, 1]; _i241 < _arr3.length; _i241++) {
          var _o98 = _arr3[_i241];
          if (t.overscaledZ + _o98 < e) continue;
          if (_o98 > 0 && t.overscaledZ < e) continue;

          var _a135 = i.getTileByID(t.calculateScaledKey(t.overscaledZ + _o98));

          if (_a135 && _a135.hasData()) {
            var _t365 = _a135.getBucket(r);

            if (_t365) return _t365;
          }
        }
      },
          c = [0, 0, 0],
          h = function h(e, i) {
        return c[0] = Math.min(e.min.y, i.min.y), c[1] = Math.max(e.max.y, i.max.y), c[2] = t.EXTENT - i.min.x > e.max.x ? i.min.x - t.EXTENT : e.max.x, c;
      },
          u = function u(e, i) {
        return c[0] = Math.min(e.min.x, i.min.x), c[1] = Math.max(e.max.x, i.max.x), c[2] = t.EXTENT - i.min.y > e.max.y ? i.min.y - t.EXTENT : e.max.y, c;
      },
          d = [function (t, e) {
        return h(t, e);
      }, function (t, e) {
        return h(e, t);
      }, function (t, e) {
        return u(t, e);
      }, function (t, e) {
        return u(e, t);
      }],
          _ = new t.Point(0, 0);

      var m, p, f;

      var g = function g(e, i, a, r, s) {
        var l = [[r ? a : e, r ? e : a, 0], [r ? a : i, r ? i : a, 0]],
            c = s < 0 ? t.EXTENT + s : s,
            h = [r ? c : (e + i) / 2, r ? (e + i) / 2 : c, 0];
        return 0 === a && s < 0 || 0 !== a && s > 0 ? n.getForTilePoints(f, [h], !0, p) : l.push(h), n.getForTilePoints(o, l, !0, m), Math.max(l[0][2], l[1][2], h[2]) / n.exaggeration();
      };

      for (var _e309 = 0; _e309 < 4; _e309++) {
        var _i242 = a.borders[_e309];
        if (0 === _i242.length && (a.borderDone[_e309] = !0), a.borderDone[_e309]) continue;

        var _r231 = f = s[_e309](o),
            _c33 = l(_r231);

        if (!_c33 || !_c33.enableTerrain) continue;
        if (p = n.findDEMTileFor(_r231), !p || !p.dem) continue;

        if (!m) {
          var _t366 = n.findDEMTileFor(o);

          if (!_t366 || !_t366.dem) return;
          m = _t366;
        }

        var _h25 = (_e309 < 2 ? 1 : 5) - _e309,
            _u40 = _c33.borders[_h25];

        var _v18 = 0;

        for (var _o99 = 0; _o99 < _i242.length; _o99++) {
          var _r232 = a.featuresOnBorder[_i242[_o99]],
              _n145 = _r232.borders[_e309];

          var _s114 = void 0;

          for (; _v18 < _u40.length && (_s114 = _c33.featuresOnBorder[_u40[_v18]], !(_s114.borders[_h25][1] > _n145[0] + 3));) {
            _c33.borderDone[_h25] || _c33.encodeCentroid(void 0, _s114, !1), _v18++;
          }

          if (_s114 && _v18 < _u40.length) {
            var _i243 = _v18;
            var _o100 = 0;

            for (; !(_s114.borders[_h25][0] > _n145[1] - 3) && (_o100++, ++_v18 !== _u40.length);) {
              _s114 = _c33.featuresOnBorder[_u40[_v18]];
            }

            if (_s114 = _c33.featuresOnBorder[_u40[_i243]], _r232.intersectsCount() > 1 || _s114.intersectsCount() > 1 || 1 !== _o100) {
              1 !== _o100 && (_v18 = _i243), a.encodeCentroid(void 0, _r232, !1), _c33.borderDone[_h25] || _c33.encodeCentroid(void 0, _s114, !1);
              continue;
            }

            var _l49 = d[_e309](_r232, _s114),
                _m18 = _e309 % 2 ? t.EXTENT - 1 : 0;

            _.x = g(_l49[0], Math.min(t.EXTENT - 1, _l49[1]), _m18, _e309 < 2, _l49[2]), _.y = 0, a.encodeCentroid(_, _r232, !1), _c33.borderDone[_h25] || _c33.encodeCentroid(_, _s114, !1);
          } else a.encodeCentroid(void 0, _r232, !1);
        }

        a.borderDone[_e309] = a.needsCentroidUpdate = !0, _c33.borderDone[_h25] || (_c33.borderDone[_h25] = _c33.needsCentroidUpdate = !0);
      }

      (a.needsCentroidUpdate || !a.centroidVertexBuffer && 0 !== a.centroidVertexArray.length) && a.uploadCentroid(e);
    }

    var Ai = new t.Color(1, 0, 0, 1),
        Di = new t.Color(0, 1, 0, 1),
        Li = new t.Color(0, 0, 1, 1),
        Ri = new t.Color(1, 0, 1, 1),
        ki = new t.Color(0, 1, 1, 1);

    function Bi(t, e, i, o) {
      Fi(t, 0, e + i / 2, t.transform.width, i, o);
    }

    function Oi(t, e, i, o) {
      Fi(t, e - i / 2, 0, i, t.transform.height, o);
    }

    function Fi(e, i, o, a, r, n) {
      var s = e.context,
          l = s.gl;
      l.enable(l.SCISSOR_TEST), l.scissor(i * t.browser.devicePixelRatio, o * t.browser.devicePixelRatio, a * t.browser.devicePixelRatio, r * t.browser.devicePixelRatio), s.clear({
        color: n
      }), l.disable(l.SCISSOR_TEST);
    }

    function Ui(e, i, o) {
      var a = e.context,
          r = a.gl,
          n = o.posMatrix,
          s = e.useProgram("debug"),
          l = i.getTileByID(o.key);
      e.terrain && e.terrain.setupElevationDraw(l, s);
      var c = t.DepthMode.disabled,
          h = t.StencilMode.disabled,
          u = e.colorModeForRenderPass();
      a.activeTexture.set(r.TEXTURE0), e.emptyTexture.bind(r.LINEAR, r.CLAMP_TO_EDGE), s.draw(a, r.LINE_STRIP, c, h, u, t.CullFaceMode.disabled, ai(n, t.Color.red), "$debug", e.debugBuffer, e.tileBorderIndexBuffer, e.debugSegments);

      var d = l.latestRawTileData,
          _ = Math.floor((d && d.byteLength || 0) / 1024),
          m = i.getTile(o).tileSize,
          p = 512 / Math.min(m, 512) * (o.overscaledZ / e.transform.zoom) * .5;

      var f = o.canonical.toString();
      o.overscaledZ !== o.canonical.z && (f += " => ".concat(o.overscaledZ)), function (t, e) {
        t.initDebugOverlayCanvas();
        var i = t.debugOverlayCanvas,
            o = t.context.gl,
            a = t.debugOverlayCanvas.getContext("2d");
        a.clearRect(0, 0, i.width, i.height), a.shadowColor = "white", a.shadowBlur = 2, a.lineWidth = 1.5, a.strokeStyle = "white", a.textBaseline = "top", a.font = "bold 36px Open Sans, sans-serif", a.fillText(e, 5, 5), a.strokeText(e, 5, 5), t.debugOverlayTexture.update(i), t.debugOverlayTexture.bind(o.LINEAR, o.CLAMP_TO_EDGE);
      }(e, "".concat(f, " ").concat(_, "kb")), s.draw(a, r.TRIANGLES, c, h, t.ColorMode.alphaBlended, t.CullFaceMode.disabled, ai(n, t.Color.transparent, p), "$debug", e.debugBuffer, e.quadTriangleIndexBuffer, e.debugSegments);
    }

    var Ni = t.createLayout([{
      name: "a_pos_3f",
      components: 3,
      type: "Float32"
    }]),
        Zi = Ni.members;

    function Gi(t, e, i, o) {
      t.emplaceBack(e, i, o);
    }

    var qi = function qi(e) {
      _classCallCheck(this, qi);

      this.vertexArray = new t.StructArrayLayout3f12(), this.indices = new t.StructArrayLayout3ui6(), Gi(this.vertexArray, -1, -1, 1), Gi(this.vertexArray, 1, -1, 1), Gi(this.vertexArray, -1, 1, 1), Gi(this.vertexArray, 1, 1, 1), Gi(this.vertexArray, -1, -1, -1), Gi(this.vertexArray, 1, -1, -1), Gi(this.vertexArray, -1, 1, -1), Gi(this.vertexArray, 1, 1, -1), this.indices.emplaceBack(5, 1, 3), this.indices.emplaceBack(3, 7, 5), this.indices.emplaceBack(6, 2, 0), this.indices.emplaceBack(0, 4, 6), this.indices.emplaceBack(2, 6, 7), this.indices.emplaceBack(7, 3, 2), this.indices.emplaceBack(5, 4, 0), this.indices.emplaceBack(0, 1, 5), this.indices.emplaceBack(0, 2, 3), this.indices.emplaceBack(3, 1, 0), this.indices.emplaceBack(7, 6, 4), this.indices.emplaceBack(4, 5, 7), this.vertexBuffer = e.createVertexBuffer(this.vertexArray, Zi), this.indexBuffer = e.createIndexBuffer(this.indices), this.segment = t.SegmentVector.simpleSegment(0, 0, 36, 12);
    };

    function Vi(e, i, o, a, r, n) {
      var s = e.gl,
          l = i.paint.get("sky-atmosphere-color"),
          c = i.paint.get("sky-atmosphere-halo-color"),
          h = i.paint.get("sky-atmosphere-sun-intensity"),
          u = function (t, e, i, o, a) {
        return {
          u_matrix_3f: t,
          u_sun_direction: e,
          u_sun_intensity: i,
          u_color_tint_r: [o.r, o.g, o.b, o.a],
          u_color_tint_m: [a.r, a.g, a.b, a.a],
          u_luminance: 5e-5
        };
      }(t.fromMat4([], a), r, h, l, c);

      s.framebufferTexture2D(s.FRAMEBUFFER, s.COLOR_ATTACHMENT0, s.TEXTURE_CUBE_MAP_POSITIVE_X + n, i.skyboxTexture, 0), o.draw(e, s.TRIANGLES, t.DepthMode.disabled, t.StencilMode.disabled, t.ColorMode.unblended, t.CullFaceMode.frontCW, u, "skyboxCapture", i.skyboxGeometry.vertexBuffer, i.skyboxGeometry.indexBuffer, i.skyboxGeometry.segment);
    }

    var $i = {
      symbol: function symbol(e, i, o, a, r) {
        if ("translucent" !== e.renderPass) return;
        var n = t.StencilMode.disabled,
            s = e.colorModeForRenderPass();
        o.layout.get("text-variable-anchor") && function (e, i, o, a, r, n, s) {
          var l = i.transform,
              c = "map" === r,
              h = "map" === n;

          var _iterator212 = _createForOfIteratorHelper(e),
              _step212;

          try {
            var _loop12 = function _loop12() {
              var r = _step212.value;
              var e = a.getTile(r),
                  n = e.getBucket(o);
              if (!n || !n.text || !n.text.segments.get().length) return "continue";

              var u = t.evaluateSizeForZoom(n.textSizeData, l.zoom),
                  d = C(e, 1, i.transform.zoom),
                  _ = it(r.posMatrix, h, c, i.transform, d),
                  m = "none" !== o.layout.get("icon-text-fit") && n.hasIconData();

              if (u) {
                var _i244 = Math.pow(2, l.zoom - e.tileID.overscaledZ),
                    _o101 = l.elevation;

                Ei(n, c, h, s, t.symbolSize, l, _, r.posMatrix, _i244, u, m, _o101 ? function (t) {
                  return _o101.getAtTileOffset(r, t.x, t.y);
                } : function (t) {
                  return 0;
                });
              }
            };

            for (_iterator212.s(); !(_step212 = _iterator212.n()).done;) {
              var _ret6 = _loop12();

              if (_ret6 === "continue") continue;
            }
          } catch (err) {
            _iterator212.e(err);
          } finally {
            _iterator212.f();
          }
        }(a, e, o, i, o.layout.get("text-rotation-alignment"), o.layout.get("text-pitch-alignment"), r), 0 !== o.paint.get("icon-opacity").constantOr(1) && Si(e, i, o, a, !1, o.paint.get("icon-translate"), o.paint.get("icon-translate-anchor"), o.layout.get("icon-rotation-alignment"), o.layout.get("icon-pitch-alignment"), o.layout.get("icon-keep-upright"), n, s), 0 !== o.paint.get("text-opacity").constantOr(1) && Si(e, i, o, a, !0, o.paint.get("text-translate"), o.paint.get("text-translate-anchor"), o.layout.get("text-rotation-alignment"), o.layout.get("text-pitch-alignment"), o.layout.get("text-keep-upright"), n, s), i.map.showCollisionBoxes && (bi(e, i, o, a, o.paint.get("text-translate"), o.paint.get("text-translate-anchor"), !0), bi(e, i, o, a, o.paint.get("icon-translate"), o.paint.get("icon-translate-anchor"), !1));
      },
      circle: function circle(e, i, o, a) {
        if ("translucent" !== e.renderPass) return;
        var r = o.paint.get("circle-opacity"),
            n = o.paint.get("circle-stroke-width"),
            s = o.paint.get("circle-stroke-opacity"),
            l = void 0 !== o.layout.get("circle-sort-key").constantOr(1);
        if (0 === r.constantOr(1) && (0 === n.constantOr(1) || 0 === s.constantOr(1))) return;

        var c = e.context,
            h = c.gl,
            u = e.depthModeForSublayer(0, t.DepthMode.ReadOnly),
            d = t.StencilMode.disabled,
            _ = e.colorModeForRenderPass(),
            m = [];

        for (var _r233 = 0; _r233 < a.length; _r233++) {
          var _n146 = a[_r233],
              _s115 = i.getTile(_n146),
              _c34 = _s115.getBucket(o);

          if (!_c34) continue;

          var _h26 = _c34.programConfigurations.get(o.id),
              _u41 = ii(o),
              _d18 = {
            programConfiguration: _h26,
            program: e.useProgram("circle", _h26, _u41),
            layoutVertexBuffer: _c34.layoutVertexBuffer,
            indexBuffer: _c34.indexBuffer,
            uniformValues: ei(e, _n146, _s115, o),
            tile: _s115
          };

          if (l) {
            var _e310 = _c34.segments.get();

            var _iterator213 = _createForOfIteratorHelper(_e310),
                _step213;

            try {
              for (_iterator213.s(); !(_step213 = _iterator213.n()).done;) {
                var _i245 = _step213.value;
                m.push({
                  segments: new t.SegmentVector([_i245]),
                  sortKey: _i245.sortKey,
                  state: _d18
                });
              }
            } catch (err) {
              _iterator213.e(err);
            } finally {
              _iterator213.f();
            }
          } else m.push({
            segments: _c34.segments,
            sortKey: 0,
            state: _d18
          });
        }

        l && m.sort(function (t, e) {
          return t.sortKey - e.sortKey;
        });

        for (var _i246 = 0, _m19 = m; _i246 < _m19.length; _i246++) {
          var _i247 = _m19[_i246];
          var _i247$state = _i247.state,
              _a136 = _i247$state.programConfiguration,
              _r234 = _i247$state.program,
              _n147 = _i247$state.layoutVertexBuffer,
              _s116 = _i247$state.indexBuffer,
              _l50 = _i247$state.uniformValues,
              _m20 = _i247$state.tile,
              _p20 = _i247.segments;
          e.terrain && e.terrain.setupElevationDraw(_m20, _r234, {
            useDepthForOcclusion: !0
          }), _r234.draw(c, h.TRIANGLES, u, d, _, t.CullFaceMode.disabled, _l50, o.id, _n147, _s116, _p20, o.paint, e.transform.zoom, _a136);
        }
      },
      heatmap: function heatmap(e, i, o, a) {
        if (0 !== o.paint.get("heatmap-opacity")) if ("offscreen" === e.renderPass) {
          var _r235 = e.context,
              _n148 = _r235.gl,
              _s117 = t.StencilMode.disabled,
              _l51 = new t.ColorMode([_n148.ONE, _n148.ONE], t.Color.transparent, [!0, !0, !0, !0]);

          !function (t, e, i) {
            var o = t.gl;
            t.activeTexture.set(o.TEXTURE1), t.viewport.set([0, 0, e.width / 4, e.height / 4]);
            var a = i.heatmapFbo;
            if (a) o.bindTexture(o.TEXTURE_2D, a.colorAttachment.get()), t.bindFramebuffer.set(a.framebuffer);else {
              var _r236 = o.createTexture();

              o.bindTexture(o.TEXTURE_2D, _r236), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, o.LINEAR), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, o.LINEAR), a = i.heatmapFbo = t.createFramebuffer(e.width / 4, e.height / 4, !1), function (t, e, i, o) {
                var a = t.gl;
                a.texImage2D(a.TEXTURE_2D, 0, a.RGBA, e.width / 4, e.height / 4, 0, a.RGBA, t.extRenderToTextureHalfFloat ? t.extTextureHalfFloat.HALF_FLOAT_OES : a.UNSIGNED_BYTE, null), o.colorAttachment.set(i);
              }(t, e, _r236, a);
            }
          }(_r235, e, o), _r235.clear({
            color: t.Color.transparent
          });

          for (var _c35 = 0; _c35 < a.length; _c35++) {
            var _h27 = a[_c35];
            if (i.hasRenderableParent(_h27)) continue;

            var _u42 = i.getTile(_h27),
                _d19 = _u42.getBucket(o);

            if (!_d19) continue;

            var _14 = _d19.programConfigurations.get(o.id),
                _m21 = e.useProgram("heatmap", _14),
                _p21 = e.transform.zoom;

            e.terrain && e.terrain.setupElevationDraw(_u42, _m21), _m21.draw(_r235, _n148.TRIANGLES, t.DepthMode.disabled, _s117, _l51, t.CullFaceMode.disabled, ri(_h27.posMatrix, _u42, _p21, o.paint.get("heatmap-intensity")), o.id, _d19.layoutVertexBuffer, _d19.indexBuffer, _d19.segments, o.paint, e.transform.zoom, _14);
          }

          _r235.viewport.set([0, 0, e.width, e.height]);
        } else "translucent" === e.renderPass && (e.context.setColorMode(e.colorModeForRenderPass()), function (e, i) {
          var o = e.context,
              a = o.gl,
              r = i.heatmapFbo;
          if (!r) return;
          o.activeTexture.set(a.TEXTURE0), a.bindTexture(a.TEXTURE_2D, r.colorAttachment.get()), o.activeTexture.set(a.TEXTURE1);
          var n = i.colorRampTexture;
          n || (n = i.colorRampTexture = new t.Texture(o, i.colorRamp, a.RGBA)), n.bind(a.LINEAR, a.CLAMP_TO_EDGE), e.useProgram("heatmapTexture").draw(o, a.TRIANGLES, t.DepthMode.disabled, t.StencilMode.disabled, e.colorModeForRenderPass(), t.CullFaceMode.disabled, function (e, i, o, a) {
            var r = t.create();
            t.ortho(r, 0, e.width, e.height, 0, 0, 1);
            var n = e.context.gl;
            return {
              u_matrix: r,
              u_world: [n.drawingBufferWidth, n.drawingBufferHeight],
              u_image: 0,
              u_color_ramp: 1,
              u_opacity: i.paint.get("heatmap-opacity")
            };
          }(e, i), i.id, e.viewportBuffer, e.quadTriangleIndexBuffer, e.viewportSegments, i.paint, e.transform.zoom);
        }(e, o));
      },
      line: function line(e, i, o, a) {
        if ("translucent" !== e.renderPass) return;
        var r = o.paint.get("line-opacity"),
            n = o.paint.get("line-width");
        if (0 === r.constantOr(1) || 0 === n.constantOr(1)) return;

        var s = e.depthModeForSublayer(0, t.DepthMode.ReadOnly),
            l = e.colorModeForRenderPass(),
            c = o.paint.get("line-dasharray"),
            h = o.paint.get("line-pattern"),
            u = h.constantOr(1),
            d = o.paint.get("line-gradient"),
            _ = o.getCrossfadeParameters(),
            m = u ? "linePattern" : c ? "lineSDF" : d ? "lineGradient" : "line",
            p = e.context,
            f = p.gl;

        var g = !0;

        var _iterator214 = _createForOfIteratorHelper(a),
            _step214;

        try {
          for (_iterator214.s(); !(_step214 = _iterator214.n()).done;) {
            var _r237 = _step214.value;

            var _a137 = i.getTile(_r237);

            if (u && !_a137.patternsLoaded()) continue;

            var _n149 = _a137.getBucket(o);

            if (!_n149) continue;
            e.prepareDrawTile(_r237);

            var _v19 = _n149.programConfigurations.get(o.id),
                _x16 = e.context.program.get(),
                _y17 = e.useProgram(m, _v19),
                _b14 = g || _y17.program !== _x16,
                _w12 = h.constantOr(null);

            if (_w12 && _a137.imageAtlas) {
              var _t367 = _a137.imageAtlas,
                  _e311 = _t367.patternPositions[_w12.to.toString()],
                  _i248 = _t367.patternPositions[_w12.from.toString()];

              _e311 && _i248 && _v19.setConstantPatternPositions(_e311, _i248);
            }

            var _T6 = e.terrain ? _r237.posMatrix : null,
                _E6 = u ? li(e, _a137, o, _, _T6) : c ? ci(e, _a137, o, c, _, _T6) : d ? si(e, _a137, o, _T6, _n149.lineClipsArray.length) : ni(e, _a137, o, _T6);

            if (u) p.activeTexture.set(f.TEXTURE0), _a137.imageAtlasTexture.bind(f.LINEAR, f.CLAMP_TO_EDGE), _v19.updatePaintBuffers(_);else if (c && (_b14 || e.lineAtlas.dirty)) p.activeTexture.set(f.TEXTURE0), e.lineAtlas.bind(p);else if (d) {
              var _a138 = _n149.gradients[o.id];
              var _s118 = _a138.texture;

              if (o.gradientVersion !== _a138.version) {
                var _l52 = 256;

                if (o.stepInterpolant) {
                  var _o102 = i.getSource().maxzoom,
                      _a139 = _r237.canonical.z === _o102 ? Math.ceil(1 << e.transform.maxZoom - _r237.canonical.z) : 1;

                  _l52 = t.clamp(t.nextPowerOfTwo(_n149.maxLineLength / t.EXTENT * 1024 * _a139), 256, p.maxTextureSize);
                }

                _a138.gradient = t.renderColorRamp({
                  expression: o.gradientExpression(),
                  evaluationKey: "lineProgress",
                  resolution: _l52,
                  image: _a138.gradient || void 0,
                  clips: _n149.lineClipsArray
                }), _a138.texture ? _a138.texture.update(_a138.gradient) : _a138.texture = new t.Texture(p, _a138.gradient, f.RGBA), _a138.version = o.gradientVersion, _s118 = _a138.texture;
              }

              p.activeTexture.set(f.TEXTURE0), _s118.bind(o.stepInterpolant ? f.NEAREST : f.LINEAR, f.CLAMP_TO_EDGE);
            }
            _y17.draw(p, f.TRIANGLES, s, e.stencilModeForClipping(_r237), l, t.CullFaceMode.disabled, _E6, o.id, _n149.layoutVertexBuffer, _n149.indexBuffer, _n149.segments, o.paint, e.transform.zoom, _v19, _n149.layoutVertexBuffer2), g = !1;
          }
        } catch (err) {
          _iterator214.e(err);
        } finally {
          _iterator214.f();
        }
      },
      fill: function fill(e, i, o, a) {
        var r = o.paint.get("fill-color"),
            n = o.paint.get("fill-opacity");
        if (0 === n.constantOr(1)) return;
        var s = e.colorModeForRenderPass(),
            l = o.paint.get("fill-pattern"),
            c = e.opaquePassEnabledForLayer() && !l.constantOr(1) && 1 === r.constantOr(t.Color.transparent).a && 1 === n.constantOr(0) ? "opaque" : "translucent";

        if (e.renderPass === c) {
          var _r238 = e.depthModeForSublayer(1, "opaque" === e.renderPass ? t.DepthMode.ReadWrite : t.DepthMode.ReadOnly);

          Pi(e, i, o, a, _r238, s, !1);
        }

        if ("translucent" === e.renderPass && o.paint.get("fill-antialias")) {
          var _r239 = e.depthModeForSublayer(o.getPaintProperty("fill-outline-color") ? 2 : 0, t.DepthMode.ReadOnly);

          Pi(e, i, o, a, _r239, s, !0);
        }
      },
      "fill-extrusion": function fillExtrusion(e, i, o, a) {
        var r = o.paint.get("fill-extrusion-opacity");

        if (0 !== r && "translucent" === e.renderPass) {
          var _n150 = new t.DepthMode(e.context.gl.LEQUAL, t.DepthMode.ReadWrite, e.depthRangeFor3D);

          if (1 !== r || o.paint.get("fill-extrusion-pattern").constantOr(1)) Mi(e, i, o, a, _n150, t.StencilMode.disabled, t.ColorMode.disabled), Mi(e, i, o, a, _n150, e.stencilModeFor3D(), e.colorModeForRenderPass());else {
            var _r240 = e.colorModeForRenderPass();

            Mi(e, i, o, a, _n150, t.StencilMode.disabled, _r240);
          }
        }
      },
      hillshade: function hillshade(e, i, o, a) {
        if ("offscreen" !== e.renderPass && "translucent" !== e.renderPass) return;

        var r = e.context,
            n = e.depthModeForSublayer(0, t.DepthMode.ReadOnly),
            s = e.colorModeForRenderPass(),
            l = e.terrain && e.terrain.renderingToTexture,
            _ref170 = "translucent" !== e.renderPass || l ? [{}, a] : e.stencilConfigForOverlap(a),
            _ref171 = _slicedToArray(_ref170, 2),
            c = _ref171[0],
            h = _ref171[1];

        var _iterator215 = _createForOfIteratorHelper(h),
            _step215;

        try {
          for (_iterator215.s(); !(_step215 = _iterator215.n()).done;) {
            var _a140 = _step215.value;

            var _r241 = i.getTile(_a140);

            if (_r241.needsHillshadePrepare && "offscreen" === e.renderPass) Le(e, _r241, o, n, t.StencilMode.disabled, s);else if ("translucent" === e.renderPass) {
              var _t368 = l && e.terrain ? e.terrain.stencilModeForRTTOverlap(_a140) : c[_a140.overscaledZ];

              Ae(e, _a140, _r241, o, n, _t368, s);
            }
          }
        } catch (err) {
          _iterator215.e(err);
        } finally {
          _iterator215.f();
        }

        r.viewport.set([0, 0, e.width, e.height]);
      },
      raster: function raster(e, i, o, a, r, n) {
        if ("translucent" !== e.renderPass) return;
        if (0 === o.paint.get("raster-opacity")) return;
        if (!a.length) return;

        var s = e.context,
            l = s.gl,
            c = i.getSource(),
            h = e.useProgram("raster"),
            u = e.colorModeForRenderPass(),
            d = e.terrain && e.terrain.renderingToTexture,
            _ref172 = c instanceof D || d ? [{}, a] : e.stencilConfigForOverlap(a),
            _ref173 = _slicedToArray(_ref172, 2),
            _ = _ref173[0],
            m = _ref173[1],
            p = m[m.length - 1].overscaledZ,
            f = !e.options.moving;

        var _iterator216 = _createForOfIteratorHelper(m),
            _step216;

        try {
          for (_iterator216.s(); !(_step216 = _iterator216.n()).done;) {
            var _a141 = _step216.value;

            var _r242 = d ? t.DepthMode.disabled : e.depthModeForSublayer(_a141.overscaledZ - p, 1 === o.paint.get("raster-opacity") ? t.DepthMode.ReadWrite : t.DepthMode.ReadOnly, l.LESS),
                _m22 = i.getTile(_a141);

            if (d && (!_m22 || !_m22.hasData())) continue;

            var _g18 = d ? _a141.posMatrix : e.transform.calculatePosMatrix(_a141.toUnwrapped(), f),
                _v20 = e.terrain && d ? e.terrain.stencilModeForRTTOverlap(_a141) : _[_a141.overscaledZ],
                _x17 = n ? 0 : o.paint.get("raster-fade-duration");

            _m22.registerFadeDuration(_x17);

            var _y18 = i.findLoadedParent(_a141, 0),
                _b15 = Ze(_m22, _y18, i, e.transform, _x17);

            var _w13 = void 0,
                _T7 = void 0;

            e.terrain && e.terrain.prepareDrawTile(_a141);

            var _E7 = "nearest" === o.paint.get("raster-resampling") ? l.NEAREST : l.LINEAR;

            s.activeTexture.set(l.TEXTURE0), _m22.texture.bind(_E7, l.CLAMP_TO_EDGE, l.LINEAR_MIPMAP_NEAREST), s.activeTexture.set(l.TEXTURE1), _y18 ? (_y18.texture.bind(_E7, l.CLAMP_TO_EDGE, l.LINEAR_MIPMAP_NEAREST), _w13 = Math.pow(2, _y18.tileID.overscaledZ - _m22.tileID.overscaledZ), _T7 = [_m22.tileID.canonical.x * _w13 % 1, _m22.tileID.canonical.y * _w13 % 1]) : _m22.texture.bind(_E7, l.CLAMP_TO_EDGE, l.LINEAR_MIPMAP_NEAREST);

            var _C3 = di(_g18, _T7 || [0, 0], _w13 || 1, _b15, o);

            c instanceof D ? h.draw(s, l.TRIANGLES, _r242, t.StencilMode.disabled, u, t.CullFaceMode.disabled, _C3, o.id, c.boundsBuffer, e.quadTriangleIndexBuffer, c.boundsSegments) : h.draw(s, l.TRIANGLES, _r242, _v20, u, t.CullFaceMode.disabled, _C3, o.id, e.rasterBoundsBuffer, e.quadTriangleIndexBuffer, e.rasterBoundsSegments);
          }
        } catch (err) {
          _iterator216.e(err);
        } finally {
          _iterator216.f();
        }
      },
      background: function background(e, i, o, a) {
        var r = o.paint.get("background-color"),
            n = o.paint.get("background-opacity");
        if (0 === n) return;
        var s = e.context,
            l = s.gl,
            c = e.transform,
            h = c.tileSize,
            u = o.paint.get("background-pattern");
        if (e.isPatternMissing(u)) return;
        var d = !u && 1 === r.a && 1 === n && e.opaquePassEnabledForLayer() ? "opaque" : "translucent";
        if (e.renderPass !== d) return;
        var _ = t.StencilMode.disabled,
            m = e.depthModeForSublayer(0, "opaque" === d ? t.DepthMode.ReadWrite : t.DepthMode.ReadOnly),
            p = e.colorModeForRenderPass(),
            f = e.useProgram(u ? "backgroundPattern" : "background"),
            g = a || c.coveringTiles({
          tileSize: h
        });
        u && (s.activeTexture.set(l.TEXTURE0), e.imageManager.bind(e.context));
        var v = o.getCrossfadeParameters();

        var _iterator217 = _createForOfIteratorHelper(g),
            _step217;

        try {
          for (_iterator217.s(); !(_step217 = _iterator217.n()).done;) {
            var _i249 = _step217.value;

            var _c36 = a ? _i249.posMatrix : e.transform.calculatePosMatrix(_i249.toUnwrapped());

            e.prepareDrawTile(_i249);

            var _d20 = u ? vi(_c36, n, e, u, {
              tileID: _i249,
              tileSize: h
            }, v) : gi(_c36, n, r);

            f.draw(s, l.TRIANGLES, m, _, p, t.CullFaceMode.disabled, _d20, o.id, e.tileExtentBuffer, e.quadTriangleIndexBuffer, e.tileExtentSegments);
          }
        } catch (err) {
          _iterator217.e(err);
        } finally {
          _iterator217.f();
        }
      },
      sky: function sky(e, i, o) {
        var a = o.paint.get("sky-opacity");
        if (0 === a) return;
        var r = e.context,
            n = o.paint.get("sky-type"),
            s = new t.DepthMode(r.gl.LEQUAL, t.DepthMode.ReadOnly, [0, 1]),
            l = e.frameCounter / 1e3 % 1;
        "atmosphere" === n ? "offscreen" === e.renderPass ? o.needsSkyboxCapture(e) && (function (e, i, o, a) {
          var r = e.context,
              n = r.gl;
          var s = i.skyboxFbo;

          if (!s) {
            s = i.skyboxFbo = r.createFramebuffer(32, 32, !1), i.skyboxGeometry = new qi(r), i.skyboxTexture = r.gl.createTexture(), n.bindTexture(n.TEXTURE_CUBE_MAP, i.skyboxTexture), n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_WRAP_S, n.CLAMP_TO_EDGE), n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_WRAP_T, n.CLAMP_TO_EDGE), n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_MIN_FILTER, n.LINEAR), n.texParameteri(n.TEXTURE_CUBE_MAP, n.TEXTURE_MAG_FILTER, n.LINEAR);

            for (var _t369 = 0; _t369 < 6; ++_t369) {
              n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X + _t369, 0, n.RGBA, 32, 32, 0, n.RGBA, n.UNSIGNED_BYTE, null);
            }
          }

          r.bindFramebuffer.set(s.framebuffer), r.viewport.set([0, 0, 32, 32]);
          var l = i.getCenter(e, !0),
              c = e.useProgram("skyboxCapture"),
              h = new Float64Array(16);
          t.identity(h), t.rotateY(h, h, .5 * -Math.PI), Vi(r, i, c, h, l, 0), t.identity(h), t.rotateY(h, h, .5 * Math.PI), Vi(r, i, c, h, l, 1), t.identity(h), t.rotateX(h, h, .5 * -Math.PI), Vi(r, i, c, h, l, 2), t.identity(h), t.rotateX(h, h, .5 * Math.PI), Vi(r, i, c, h, l, 3), t.identity(h), Vi(r, i, c, h, l, 4), t.identity(h), t.rotateY(h, h, Math.PI), Vi(r, i, c, h, l, 5), r.viewport.set([0, 0, e.width, e.height]);
        }(e, o), o.markSkyboxValid(e)) : "sky" === e.renderPass && function (e, i, o, a, r) {
          var n = e.context,
              s = n.gl,
              l = e.transform,
              c = e.useProgram("skybox");
          n.activeTexture.set(s.TEXTURE0), s.bindTexture(s.TEXTURE_CUBE_MAP, i.skyboxTexture);

          var h = function (t, e, i, o, a) {
            return {
              u_matrix: t,
              u_sun_direction: e,
              u_cubemap: 0,
              u_opacity: o,
              u_temporal_offset: a
            };
          }(l.skyboxMatrix, i.getCenter(e, !1), 0, a, r);

          c.draw(n, s.TRIANGLES, o, t.StencilMode.disabled, e.colorModeForRenderPass(), t.CullFaceMode.backCW, h, "skybox", i.skyboxGeometry.vertexBuffer, i.skyboxGeometry.indexBuffer, i.skyboxGeometry.segment);
        }(e, o, s, a, l) : "gradient" === n && "sky" === e.renderPass && function (e, i, o, a, r) {
          var n = e.context,
              s = n.gl,
              l = e.transform,
              c = e.useProgram("skyboxGradient");
          i.skyboxGeometry || (i.skyboxGeometry = new qi(n)), n.activeTexture.set(s.TEXTURE0);
          var h = i.colorRampTexture;
          h || (h = i.colorRampTexture = new t.Texture(n, i.colorRamp, s.RGBA)), h.bind(s.LINEAR, s.CLAMP_TO_EDGE);

          var u = function (e, i, o, a, r) {
            return {
              u_matrix: e,
              u_color_ramp: 0,
              u_center_direction: i,
              u_radius: t.degToRad(o),
              u_opacity: a,
              u_temporal_offset: r
            };
          }(l.skyboxMatrix, i.getCenter(e, !1), i.paint.get("sky-gradient-radius"), a, r);

          c.draw(n, s.TRIANGLES, o, t.StencilMode.disabled, e.colorModeForRenderPass(), t.CullFaceMode.backCW, u, "skyboxGradient", i.skyboxGeometry.vertexBuffer, i.skyboxGeometry.indexBuffer, i.skyboxGeometry.segment);
        }(e, o, s, a, l);
      },
      debug: function debug(t, e, i) {
        for (var _o103 = 0; _o103 < i.length; _o103++) {
          Ui(t, e, i[_o103]);
        }
      },
      custom: function custom(e, i, o) {
        var a = e.context,
            r = o.implementation;

        if ("offscreen" === e.renderPass) {
          var _t370 = r.prerender;
          _t370 && (e.setCustomLayerDefaults(), a.setColorMode(e.colorModeForRenderPass()), _t370.call(r, a.gl, e.transform.customLayerMatrix()), a.setDirty(), e.setBaseState());
        } else if ("translucent" === e.renderPass) {
          e.setCustomLayerDefaults(), a.setColorMode(e.colorModeForRenderPass()), a.setStencilMode(t.StencilMode.disabled);

          var _i250 = "3d" === r.renderingMode ? new t.DepthMode(e.context.gl.LEQUAL, t.DepthMode.ReadWrite, e.depthRangeFor3D) : e.depthModeForSublayer(0, t.DepthMode.ReadOnly);

          a.setDepthMode(_i250), r.render(a.gl, e.transform.customLayerMatrix()), a.setDirty(), e.setBaseState(), a.bindFramebuffer.set(null);
        }
      }
    };

    var ji = /*#__PURE__*/function () {
      function ji(e, i) {
        _classCallCheck(this, ji);

        this.context = new t.Context(e), this.transform = i, this._tileTextures = {}, this.frameCopies = [], this.loadTimeStamps = [], this.setup(), this.numSublayers = t.SourceCache.maxUnderzooming + t.SourceCache.maxOverzooming + 1, this.depthEpsilon = 1 / Math.pow(2, 16), this.crossTileSymbolIndex = new Gt(), this.gpuTimers = {}, this.frameCounter = 0;
      }

      _createClass(ji, [{
        key: "updateTerrain",
        value: function updateTerrain(t, e) {
          var i = !!t && !!t.terrain;
          if (!(i || this._terrain && this._terrain.enabled)) return;
          this._terrain || (this._terrain = new $e(this, t));
          var o = this._terrain;
          this.transform.elevation = i ? o : null, o.update(t, this.transform, e);
        }
      }, {
        key: "resize",
        value: function resize(e, i) {
          if (this.width = e * t.browser.devicePixelRatio, this.height = i * t.browser.devicePixelRatio, this.context.viewport.set([0, 0, this.width, this.height]), this.style) {
            var _iterator218 = _createForOfIteratorHelper(this.style._order),
                _step218;

            try {
              for (_iterator218.s(); !(_step218 = _iterator218.n()).done;) {
                var _t371 = _step218.value;

                this.style._layers[_t371].resize();
              }
            } catch (err) {
              _iterator218.e(err);
            } finally {
              _iterator218.f();
            }
          }
        }
      }, {
        key: "setup",
        value: function setup() {
          var e = this.context,
              i = new t.StructArrayLayout2i4();
          i.emplaceBack(0, 0), i.emplaceBack(t.EXTENT, 0), i.emplaceBack(0, t.EXTENT), i.emplaceBack(t.EXTENT, t.EXTENT), this.tileExtentBuffer = e.createVertexBuffer(i, t.posAttributes.members), this.tileExtentSegments = t.SegmentVector.simpleSegment(0, 0, 4, 2);
          var o = new t.StructArrayLayout2i4();
          o.emplaceBack(0, 0), o.emplaceBack(t.EXTENT, 0), o.emplaceBack(0, t.EXTENT), o.emplaceBack(t.EXTENT, t.EXTENT), this.debugBuffer = e.createVertexBuffer(o, t.posAttributes.members), this.debugSegments = t.SegmentVector.simpleSegment(0, 0, 4, 5);
          var a = new t.StructArrayLayout4i8();
          a.emplaceBack(0, 0, 0, 0), a.emplaceBack(t.EXTENT, 0, t.EXTENT, 0), a.emplaceBack(0, t.EXTENT, 0, t.EXTENT), a.emplaceBack(t.EXTENT, t.EXTENT, t.EXTENT, t.EXTENT), this.rasterBoundsBuffer = e.createVertexBuffer(a, A.members), this.rasterBoundsSegments = t.SegmentVector.simpleSegment(0, 0, 4, 2);
          var r = new t.StructArrayLayout2i4();
          r.emplaceBack(0, 0), r.emplaceBack(1, 0), r.emplaceBack(0, 1), r.emplaceBack(1, 1), this.viewportBuffer = e.createVertexBuffer(r, t.posAttributes.members), this.viewportSegments = t.SegmentVector.simpleSegment(0, 0, 4, 2);
          var n = new t.StructArrayLayout1ui2();
          n.emplaceBack(0), n.emplaceBack(1), n.emplaceBack(3), n.emplaceBack(2), n.emplaceBack(0), this.tileBorderIndexBuffer = e.createIndexBuffer(n);
          var s = new t.StructArrayLayout3ui6();
          s.emplaceBack(0, 1, 2), s.emplaceBack(2, 1, 3), this.quadTriangleIndexBuffer = e.createIndexBuffer(s), this.emptyTexture = new t.Texture(e, {
            width: 1,
            height: 1,
            data: new Uint8Array([0, 0, 0, 0])
          }, e.gl.RGBA);
          var l = this.context.gl;
          this.stencilClearMode = new t.StencilMode({
            func: l.ALWAYS,
            mask: 0
          }, 0, 255, l.ZERO, l.ZERO, l.ZERO), this.loadTimeStamps.push(t.window.performance.now());
        }
      }, {
        key: "clearStencil",
        value: function clearStencil() {
          var e = this.context,
              i = e.gl;
          this.nextStencilID = 1, this.currentStencilSource = void 0;
          var o = t.create();
          t.ortho(o, 0, this.width, this.height, 0, 0, 1), t.scale(o, o, [i.drawingBufferWidth, i.drawingBufferHeight, 0]), this.useProgram("clippingMask").draw(e, i.TRIANGLES, t.DepthMode.disabled, this.stencilClearMode, t.ColorMode.disabled, t.CullFaceMode.disabled, Ne(o), "$clipping", this.viewportBuffer, this.quadTriangleIndexBuffer, this.viewportSegments);
        }
      }, {
        key: "_renderTileClippingMasks",
        value: function _renderTileClippingMasks(e, i, o) {
          if (!(i && this.currentStencilSource !== i.id && e.isTileClipped() && o && o.length)) return;
          this.currentStencilSource = i.id;
          var a = this.context,
              r = a.gl;
          this.nextStencilID + o.length > 256 && this.clearStencil(), a.setColorMode(t.ColorMode.disabled), a.setDepthMode(t.DepthMode.disabled);
          var n = this.useProgram("clippingMask");
          this._tileClippingMaskIDs = {};

          var _iterator219 = _createForOfIteratorHelper(o),
              _step219;

          try {
            for (_iterator219.s(); !(_step219 = _iterator219.n()).done;) {
              var _e312 = _step219.value;

              var _i251 = this._tileClippingMaskIDs[_e312.key] = this.nextStencilID++;

              n.draw(a, r.TRIANGLES, t.DepthMode.disabled, new t.StencilMode({
                func: r.ALWAYS,
                mask: 0
              }, _i251, 255, r.KEEP, r.KEEP, r.REPLACE), t.ColorMode.disabled, t.CullFaceMode.disabled, Ne(_e312.posMatrix), "$clipping", this.tileExtentBuffer, this.quadTriangleIndexBuffer, this.tileExtentSegments);
            }
          } catch (err) {
            _iterator219.e(err);
          } finally {
            _iterator219.f();
          }
        }
      }, {
        key: "stencilModeFor3D",
        value: function stencilModeFor3D() {
          this.currentStencilSource = void 0, this.nextStencilID + 1 > 256 && this.clearStencil();
          var e = this.nextStencilID++,
              i = this.context.gl;
          return new t.StencilMode({
            func: i.NOTEQUAL,
            mask: 255
          }, e, 255, i.KEEP, i.KEEP, i.REPLACE);
        }
      }, {
        key: "stencilModeForClipping",
        value: function stencilModeForClipping(e) {
          if (this.terrain) return this.terrain.stencilModeForRTTOverlap(e);
          var i = this.context.gl;
          return new t.StencilMode({
            func: i.EQUAL,
            mask: 255
          }, this._tileClippingMaskIDs[e.key], 0, i.KEEP, i.KEEP, i.REPLACE);
        }
      }, {
        key: "stencilConfigForOverlap",
        value: function stencilConfigForOverlap(e) {
          var i = this.context.gl,
              o = e.sort(function (t, e) {
            return e.overscaledZ - t.overscaledZ;
          }),
              a = o[o.length - 1].overscaledZ,
              r = o[0].overscaledZ - a + 1;

          if (r > 1) {
            this.currentStencilSource = void 0, this.nextStencilID + r > 256 && this.clearStencil();
            var _e313 = {};

            for (var _o104 = 0; _o104 < r; _o104++) {
              _e313[_o104 + a] = new t.StencilMode({
                func: i.GEQUAL,
                mask: 255
              }, _o104 + this.nextStencilID, 255, i.KEEP, i.KEEP, i.REPLACE);
            }

            return this.nextStencilID += r, [_e313, o];
          }

          return [_defineProperty({}, a, t.StencilMode.disabled), o];
        }
      }, {
        key: "colorModeForRenderPass",
        value: function colorModeForRenderPass() {
          var e = this.context.gl;

          if (this._showOverdrawInspector) {
            var _i252 = 1 / 8;

            return new t.ColorMode([e.CONSTANT_COLOR, e.ONE], new t.Color(_i252, _i252, _i252, 0), [!0, !0, !0, !0]);
          }

          return "opaque" === this.renderPass ? t.ColorMode.unblended : t.ColorMode.alphaBlended;
        }
      }, {
        key: "depthModeForSublayer",
        value: function depthModeForSublayer(e, i, o) {
          if (!this.opaquePassEnabledForLayer()) return t.DepthMode.disabled;
          var a = 1 - ((1 + this.currentLayer) * this.numSublayers + e) * this.depthEpsilon;
          return new t.DepthMode(o || this.context.gl.LEQUAL, i, [a, a]);
        }
      }, {
        key: "opaquePassEnabledForLayer",
        value: function opaquePassEnabledForLayer() {
          return this.currentLayer < this.opaquePassCutoff;
        }
      }, {
        key: "render",
        value: function render(e, i) {
          var _this104 = this;

          this.style = e, this.options = i, this.lineAtlas = e.lineAtlas, this.imageManager = e.imageManager, this.glyphManager = e.glyphManager, this.symbolFadeChange = e.placement.symbolFadeChange(t.browser.now()), this.imageManager.beginFrame();
          var o = this.style._order,
              a = this.style._sourceCaches;

          for (var _t372 in a) {
            var _e314 = a[_t372];
            _e314.used && _e314.prepare(this.context);
          }

          var r = {},
              n = {},
              s = {};

          for (var _t373 in a) {
            var _e315 = a[_t373];
            r[_t373] = _e315.getVisibleCoordinates(), n[_t373] = r[_t373].slice().reverse(), s[_t373] = _e315.getVisibleCoordinates(!0).reverse();
          }

          this.opaquePassCutoff = 1 / 0;

          for (var _t374 = 0; _t374 < o.length; _t374++) {
            if (this.style._layers[o[_t374]].is3D()) {
              this.opaquePassCutoff = _t374;
              break;
            }
          }

          this.terrain && (this.terrain.updateTileBinding(s), this.opaquePassCutoff = 0), this.renderPass = "offscreen";

          var _iterator220 = _createForOfIteratorHelper(o),
              _step220;

          try {
            for (_iterator220.s(); !(_step220 = _iterator220.n()).done;) {
              var _t378 = _step220.value;

              var _i257 = this.style._layers[_t378],
                  _o105 = e._getLayerSourceCache(_i257);

              if (!_i257.hasOffscreenPass() || _i257.isHidden(this.transform.zoom)) continue;

              var _a144 = _o105 ? n[_o105.id] : void 0;

              ("custom" === _i257.type || _i257.isSky() || _a144 && _a144.length) && this.renderLayer(this, _o105, _i257, _a144);
            }
          } catch (err) {
            _iterator220.e(err);
          } finally {
            _iterator220.f();
          }

          for (this.context.bindFramebuffer.set(null), this.context.clear({
            color: i.showOverdrawInspector ? t.Color.black : t.Color.transparent,
            depth: 1
          }), this.clearStencil(), this._showOverdrawInspector = i.showOverdrawInspector, this.depthRangeFor3D = [0, 1 - (e._order.length + 2) * this.numSublayers * this.depthEpsilon], this.renderPass = "opaque", this.currentLayer = o.length - 1; this.currentLayer >= 0; this.currentLayer--) {
            var _t375 = this.style._layers[o[this.currentLayer]],
                _i253 = e._getLayerSourceCache(_t375);

            if (this.terrain && this.terrain.renderLayer(_t375, _i253) || _t375.isSky()) continue;

            var _a142 = _i253 ? n[_i253.id] : void 0;

            this._renderTileClippingMasks(_t375, _i253, _a142), this.renderLayer(this, _i253, _t375, _a142);
          }

          if (this.renderPass = "sky", this.transform.isHorizonVisible()) for (this.currentLayer = 0; this.currentLayer < o.length; this.currentLayer++) {
            var _t376 = this.style._layers[o[this.currentLayer]],
                _i254 = e._getLayerSourceCache(_t376);

            _t376.isSky() && this.renderLayer(this, _i254, _t376, _i254 ? n[_i254.id] : void 0);
          }

          for (this.renderPass = "translucent", this.currentLayer = 0; this.currentLayer < o.length; this.currentLayer++) {
            var _t377 = this.style._layers[o[this.currentLayer]],
                _i255 = e._getLayerSourceCache(_t377);

            if (this.terrain && this.terrain.renderLayer(_t377, _i255) || _t377.isSky()) continue;

            var _a143 = _i255 ? ("symbol" === _t377.type ? s : n)[_i255.id] : void 0;

            this._renderTileClippingMasks(_t377, _i255, _i255 ? r[_i255.id] : void 0), this.renderLayer(this, _i255, _t377, _a143);
          }

          if (this.options.showTileBoundaries || this.options.showQueryGeometry) {
            var _i256 = null;
            t.values(this.style._layers).forEach(function (t) {
              var o = e._getLayerSourceCache(t);

              o && !t.isHidden(_this104.transform.zoom) && (!_i256 || _i256.getSource().maxzoom < o.getSource().maxzoom) && (_i256 = o);
            }), _i256 && this.options.showTileBoundaries && $i.debug(this, _i256, _i256.getVisibleCoordinates());
          }

          this.options.showPadding && function (t) {
            var e = t.transform.padding;
            Bi(t, t.transform.height - (e.top || 0), 3, Ai), Bi(t, e.bottom || 0, 3, Di), Oi(t, e.left || 0, 3, Li), Oi(t, t.transform.width - (e.right || 0), 3, Ri);
            var i = t.transform.centerPoint;
            !function (t, e, i, o) {
              Fi(t, e - 1, i - 10, 2, 20, o), Fi(t, e - 10, i - 1, 20, 2, o);
            }(t, i.x, t.transform.height - i.y, ki);
          }(this), this.context.setDefault(), this.frameCounter = (this.frameCounter + 1) % t.MAX_SAFE_INTEGER, this.tileLoaded && this.options.speedIndexTiming && (this.loadTimeStamps.push(t.window.performance.now()), this.saveCanvasCopy());
        }
      }, {
        key: "renderLayer",
        value: function renderLayer(t, e, i, o) {
          i.isHidden(this.transform.zoom) || ("background" === i.type || "sky" === i.type || "custom" === i.type || o && o.length) && (this.id = i.id, this.gpuTimingStart(i), $i[i.type](t, e, i, o, this.style.placement.variableOffsets, this.options.isInitialLoad), this.gpuTimingEnd());
        }
      }, {
        key: "gpuTimingStart",
        value: function gpuTimingStart(t) {
          if (!this.options.gpuTiming) return;
          var e = this.context.extTimerQuery;
          var i = this.gpuTimers[t.id];
          i || (i = this.gpuTimers[t.id] = {
            calls: 0,
            cpuTime: 0,
            query: e.createQueryEXT()
          }), i.calls++, e.beginQueryEXT(e.TIME_ELAPSED_EXT, i.query);
        }
      }, {
        key: "gpuTimingEnd",
        value: function gpuTimingEnd() {
          if (!this.options.gpuTiming) return;
          var t = this.context.extTimerQuery;
          t.endQueryEXT(t.TIME_ELAPSED_EXT);
        }
      }, {
        key: "collectGpuTimers",
        value: function collectGpuTimers() {
          var t = this.gpuTimers;
          return this.gpuTimers = {}, t;
        }
      }, {
        key: "queryGpuTimers",
        value: function queryGpuTimers(t) {
          var e = {};

          for (var _i258 in t) {
            var _o106 = t[_i258],
                _a145 = this.context.extTimerQuery,
                _r243 = _a145.getQueryObjectEXT(_o106.query, _a145.QUERY_RESULT_EXT) / 1e6;

            _a145.deleteQueryEXT(_o106.query), e[_i258] = _r243;
          }

          return e;
        }
      }, {
        key: "translatePosMatrix",
        value: function translatePosMatrix(e, i, o, a, r) {
          if (!o[0] && !o[1]) return e;
          var n = r ? "map" === a ? this.transform.angle : 0 : "viewport" === a ? -this.transform.angle : 0;

          if (n) {
            var _t379 = Math.sin(n),
                _e316 = Math.cos(n);

            o = [o[0] * _e316 - o[1] * _t379, o[0] * _t379 + o[1] * _e316];
          }

          var s = [r ? o[0] : C(i, o[0], this.transform.zoom), r ? o[1] : C(i, o[1], this.transform.zoom), 0],
              l = new Float32Array(16);
          return t.translate(l, e, s), l;
        }
      }, {
        key: "saveTileTexture",
        value: function saveTileTexture(t) {
          var e = this._tileTextures[t.size[0]];
          e ? e.push(t) : this._tileTextures[t.size[0]] = [t];
        }
      }, {
        key: "getTileTexture",
        value: function getTileTexture(t) {
          var e = this._tileTextures[t];
          return e && e.length > 0 ? e.pop() : null;
        }
      }, {
        key: "isPatternMissing",
        value: function isPatternMissing(t) {
          if (!t) return !1;
          if (!t.from || !t.to) return !0;
          var e = this.imageManager.getPattern(t.from.toString()),
              i = this.imageManager.getPattern(t.to.toString());
          return !e || !i;
        }
      }, {
        key: "currentGlobalDefines",
        value: function currentGlobalDefines() {
          var t = this.terrain && this.terrain.renderingToTexture,
              e = [];
          return this.terrain && !this.terrain.renderingToTexture && e.push("TERRAIN"), t && e.push("RENDER_TO_TEXTURE"), this._showOverdrawInspector && e.push("OVERDRAW_INSPECTOR"), e;
        }
      }, {
        key: "useProgram",
        value: function useProgram(t, e, i) {
          this.cache = this.cache || {};
          var o = i || [],
              a = this.currentGlobalDefines().concat(o),
              r = We.cacheKey(t, a, e);
          return this.cache[r] || (this.cache[r] = new We(this.context, t, Pe[t], e, xi[t], a)), this.cache[r];
        }
      }, {
        key: "setCustomLayerDefaults",
        value: function setCustomLayerDefaults() {
          this.context.unbindVAO(), this.context.cullFace.setDefault(), this.context.activeTexture.setDefault(), this.context.pixelStoreUnpack.setDefault(), this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(), this.context.pixelStoreUnpackFlipY.setDefault();
        }
      }, {
        key: "setBaseState",
        value: function setBaseState() {
          var t = this.context.gl;
          this.context.cullFace.set(!1), this.context.viewport.set([0, 0, this.width, this.height]), this.context.blendEquation.set(t.FUNC_ADD);
        }
      }, {
        key: "initDebugOverlayCanvas",
        value: function initDebugOverlayCanvas() {
          null == this.debugOverlayCanvas && (this.debugOverlayCanvas = t.window.document.createElement("canvas"), this.debugOverlayCanvas.width = 512, this.debugOverlayCanvas.height = 512, this.debugOverlayTexture = new t.Texture(this.context, this.debugOverlayCanvas, this.context.gl.RGBA));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this._terrain && this._terrain.destroy(), this.emptyTexture.destroy(), this.debugOverlayTexture && this.debugOverlayTexture.destroy();
        }
      }, {
        key: "prepareDrawTile",
        value: function prepareDrawTile(t) {
          this.terrain && this.terrain.prepareDrawTile(t);
        }
      }, {
        key: "setTileLoadedFlag",
        value: function setTileLoadedFlag(t) {
          this.tileLoaded = t;
        }
      }, {
        key: "saveCanvasCopy",
        value: function saveCanvasCopy() {
          this.frameCopies.push(this.canvasCopy()), this.tileLoaded = !1;
        }
      }, {
        key: "canvasCopy",
        value: function canvasCopy() {
          var t = this.context.gl,
              e = t.createTexture();
          return t.bindTexture(t.TEXTURE_2D, e), t.copyTexImage2D(t.TEXTURE_2D, 0, t.RGBA, 0, 0, t.drawingBufferWidth, t.drawingBufferHeight, 0), e;
        }
      }, {
        key: "getCanvasCopiesAndTimestamps",
        value: function getCanvasCopiesAndTimestamps() {
          return {
            canvasCopies: this.frameCopies,
            timeStamps: this.loadTimeStamps
          };
        }
      }, {
        key: "terrain",
        get: function get() {
          return this._terrain && this._terrain.enabled ? this._terrain : null;
        }
      }]);

      return ji;
    }();

    var Wi = /*#__PURE__*/function () {
      function Wi() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
        var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;

        _classCallCheck(this, Wi);

        if (isNaN(t) || t < 0 || isNaN(e) || e < 0 || isNaN(i) || i < 0 || isNaN(o) || o < 0) throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");
        this.top = t, this.bottom = e, this.left = i, this.right = o;
      }

      _createClass(Wi, [{
        key: "interpolate",
        value: function interpolate(e, i, o) {
          return null != i.top && null != e.top && (this.top = t.number(e.top, i.top, o)), null != i.bottom && null != e.bottom && (this.bottom = t.number(e.bottom, i.bottom, o)), null != i.left && null != e.left && (this.left = t.number(e.left, i.left, o)), null != i.right && null != e.right && (this.right = t.number(e.right, i.right, o)), this;
        }
      }, {
        key: "getCenter",
        value: function getCenter(e, i) {
          var o = t.clamp((this.left + e - this.right) / 2, 0, e),
              a = t.clamp((this.top + i - this.bottom) / 2, 0, i);
          return new t.Point(o, a);
        }
      }, {
        key: "equals",
        value: function equals(t) {
          return this.top === t.top && this.bottom === t.bottom && this.left === t.left && this.right === t.right;
        }
      }, {
        key: "clone",
        value: function clone() {
          return new Wi(this.top, this.bottom, this.left, this.right);
        }
      }, {
        key: "toJSON",
        value: function toJSON() {
          return {
            top: this.top,
            bottom: this.bottom,
            left: this.left,
            right: this.right
          };
        }
      }]);

      return Wi;
    }();

    function Xi(t, e) {
      return [t[4 * e], t[4 * e + 1], t[4 * e + 2], t[4 * e + 3]];
    }

    function Hi(t, e, i) {
      t[4 * e + 0] = i[0], t[4 * e + 1] = i[1], t[4 * e + 2] = i[2], t[4 * e + 3] = i[3];
    }

    function Ki(e, i) {
      var o = Xi(e, 3);
      t.fromQuat(e, i), Hi(e, 3, o);
    }

    function Yi(t, e) {
      Hi(t, 3, [e[0], e[1], e[2], 1]);
    }

    function Ji(e, i) {
      var o = t.identity$1([]);
      return t.rotateZ$1(o, o, -i), t.rotateX$1(o, o, -e), o;
    }

    function Qi(e, i) {
      var o = [e[0], e[1], 0],
          a = [i[0], i[1], 0];

      if (t.length(o) >= 1e-15) {
        var _e317 = t.normalize([], o);

        t.scale$2(a, _e317, t.dot(a, _e317)), i[0] = a[0], i[1] = a[1];
      }

      var r = t.cross([], i, e);
      if (t.len(r) < 1e-15) return null;
      var n = Math.atan2(-r[1], r[0]);
      return Ji(Math.atan2(Math.sqrt(e[0] * e[0] + e[1] * e[1]), -e[2]), n);
    }

    var to = /*#__PURE__*/function () {
      function to(t, e) {
        _classCallCheck(this, to);

        this.position = t, this.orientation = e;
      }

      _createClass(to, [{
        key: "lookAtPoint",
        value: function lookAtPoint(e, i) {
          if (this.orientation = null, !this.position) return;
          var o = this._elevation ? this._elevation.getAtPoint(t.MercatorCoordinate.fromLngLat(e)) : 0,
              a = this.position,
              r = t.MercatorCoordinate.fromLngLat(e, o),
              n = [r.x - a.x, r.y - a.y, r.z - a.z];
          i || (i = [0, 0, 1]), i[2] = Math.abs(i[2]), this.orientation = Qi(n, i);
        }
      }, {
        key: "setPitchBearing",
        value: function setPitchBearing(e, i) {
          this.orientation = Ji(t.degToRad(e), t.degToRad(-i));
        }
      }, {
        key: "position",
        get: function get() {
          return this._position;
        },
        set: function set(e) {
          this._position = this._renderWorldCopies ? function (e) {
            if (!e) return;
            var i = Array.isArray(e) ? new t.MercatorCoordinate(e[0], e[1], e[2]) : e;
            return i.x = t.wrap(i.x, 0, 1), i;
          }(e) : e;
        }
      }]);

      return to;
    }();

    var eo = /*#__PURE__*/function () {
      function eo(e, i) {
        _classCallCheck(this, eo);

        this._transform = t.identity([]), this._orientation = t.identity$1([]), i && (this._orientation = i, Ki(this._transform, this._orientation)), e && Yi(this._transform, e);
      }

      _createClass(eo, [{
        key: "getPitchBearing",
        value: function getPitchBearing() {
          var t = this.forward(),
              e = this.right();
          return {
            bearing: Math.atan2(-e[1], e[0]),
            pitch: Math.atan2(Math.sqrt(t[0] * t[0] + t[1] * t[1]), -t[2])
          };
        }
      }, {
        key: "setPitchBearing",
        value: function setPitchBearing(t, e) {
          this._orientation = Ji(t, e), Ki(this._transform, this._orientation);
        }
      }, {
        key: "forward",
        value: function forward() {
          var t = Xi(this._transform, 2);
          return [-t[0], -t[1], -t[2]];
        }
      }, {
        key: "up",
        value: function up() {
          var t = Xi(this._transform, 1);
          return [-t[0], -t[1], -t[2]];
        }
      }, {
        key: "right",
        value: function right() {
          var t = Xi(this._transform, 0);
          return [t[0], t[1], t[2]];
        }
      }, {
        key: "getCameraToWorld",
        value: function getCameraToWorld(e, i) {
          var o = new Float64Array(16);
          return t.invert(o, this.getWorldToCamera(e, i)), o;
        }
      }, {
        key: "getWorldToCamera",
        value: function getWorldToCamera(e, i) {
          var o = new Float64Array(16),
              a = new Float64Array(4),
              r = this.position;
          return t.conjugate(a, this._orientation), t.scale$2(r, r, -e), t.fromQuat(o, a), t.translate(o, o, r), o[1] *= -1, o[5] *= -1, o[9] *= -1, o[13] *= -1, o[8] *= i, o[9] *= i, o[10] *= i, o[11] *= i, o;
        }
      }, {
        key: "getCameraToClipPerspective",
        value: function getCameraToClipPerspective(e, i, o, a) {
          var r = new Float64Array(16);
          return t.perspective(r, e, i, o, a), r;
        }
      }, {
        key: "clone",
        value: function clone() {
          return new eo(_toConsumableArray(this.position), _toConsumableArray(this.orientation));
        }
      }, {
        key: "mercatorPosition",
        get: function get() {
          var e = this.position;
          return new t.MercatorCoordinate(e[0], e[1], e[2]);
        }
      }, {
        key: "position",
        get: function get() {
          var t = Xi(this._transform, 3);
          return [t[0], t[1], t[2]];
        },
        set: function set(t) {
          Yi(this._transform, t);
        }
      }, {
        key: "orientation",
        get: function get() {
          return this._orientation;
        },
        set: function set(t) {
          this._orientation = t, Ki(this._transform, this._orientation);
        }
      }]);

      return eo;
    }();

    var io = /*#__PURE__*/function () {
      function io(e, i, o, a, r) {
        _classCallCheck(this, io);

        this.tileSize = 512, this.maxValidLatitude = 85.051129, this._renderWorldCopies = void 0 === r || r, this._minZoom = e || 0, this._maxZoom = i || 22, this._minPitch = null == o ? 0 : o, this._maxPitch = null == a ? 60 : a, this.setMaxBounds(), this.width = 0, this.height = 0, this._center = new t.LngLat(0, 0), this.zoom = 0, this.angle = 0, this._fov = .6435011087932844, this._pitch = 0, this._unmodified = !0, this._edgeInsets = new Wi(), this._posMatrixCache = {}, this._alignedPosMatrixCache = {}, this._camera = new eo(), this._centerAltitude = 0, this.cameraElevationReference = "ground";
      }

      _createClass(io, [{
        key: "clone",
        value: function clone() {
          var t = new io(this._minZoom, this._maxZoom, this._minPitch, this.maxPitch, this._renderWorldCopies);
          return t._elevation = this._elevation, t._centerAltitude = this._centerAltitude, t.tileSize = this.tileSize, t.latRange = this.latRange, t.width = this.width, t.height = this.height, t.cameraElevationReference = this.cameraElevationReference, t._center = this._center, t._setZoom(this.zoom), t._cameraZoom = this._cameraZoom, t.angle = this.angle, t._fov = this._fov, t._pitch = this._pitch, t._unmodified = this._unmodified, t._edgeInsets = this._edgeInsets.clone(), t._camera = this._camera.clone(), t._calcMatrices(), t.freezeTileCoverage = this.freezeTileCoverage, t;
        }
      }, {
        key: "updateElevation",
        value: function updateElevation(t) {
          this._terrainEnabled() && null == this._cameraZoom && this._updateCenterElevation() && this._updateCameraOnTerrain(), t && this._constrainCameraAltitude(), this._calcMatrices();
        }
      }, {
        key: "_setZoom",
        value: function _setZoom(t) {
          this._zoom = t, this.scale = this.zoomScale(t), this.tileZoom = Math.floor(t), this.zoomFraction = t - this.tileZoom;
        }
      }, {
        key: "_updateCenterElevation",
        value: function _updateCenterElevation() {
          if (!this._elevation) return !1;

          var e = this._elevation.getAtPoint(t.MercatorCoordinate.fromLngLat(this.center), -1);

          return -1 === e ? (this._cameraZoom = null, !1) : (this._centerAltitude = e, !0);
        }
      }, {
        key: "_updateCameraOnTerrain",
        value: function _updateCameraOnTerrain() {
          var e = this.cameraToCenterDistance / this.worldSize,
              i = t.mercatorZfromAltitude(this._centerAltitude, this.center.lat);
          this._cameraZoom = this._zoomFromMercatorZ(i + e);
        }
      }, {
        key: "_updateZoomFromElevation",
        value: function _updateZoomFromElevation() {
          if (null == this._cameraZoom || !this._elevation) return;

          var e = this._cameraZoom,
              i = this._elevation.getAtPoint(t.MercatorCoordinate.fromLngLat(this.center)),
              o = t.mercatorZfromAltitude(i, this.center.lat),
              a = this._mercatorZfromZoom(e),
              r = this._mercatorZfromZoom(this._maxZoom),
              n = Math.max(a - o, r);

          this._setZoom(this._zoomFromMercatorZ(n));
        }
      }, {
        key: "computeZoomRelativeTo",
        value: function computeZoomRelativeTo(e) {
          var i = this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint, e.toAltitude()));
          var o;
          o = e.z < this._camera.position[2] ? [i.x, i.y, i.z] : [e.x, e.y, e.z];
          var a = t.length(t.sub([], this._camera.position, o));
          return t.clamp(this._zoomFromMercatorZ(a), this._minZoom, this._maxZoom);
        }
      }, {
        key: "setFreeCameraOptions",
        value: function setFreeCameraOptions(e) {
          if (!this.height) return;
          if (!e.position && !e.orientation) return;

          this._updateCameraState();

          var i = !1;

          if (e.orientation && !t.exactEquals(e.orientation, this._camera.orientation) && (i = this._setCameraOrientation(e.orientation)), e.position) {
            var _o107 = [e.position.x, e.position.y, e.position.z];
            t.exactEquals$1(_o107, this._camera.position) || (this._setCameraPosition(_o107), i = !0);
          }

          i && (this._updateStateFromCamera(), this.recenterOnTerrain());
        }
      }, {
        key: "getFreeCameraOptions",
        value: function getFreeCameraOptions() {
          this._updateCameraState();

          var e = this._camera.position,
              i = new to();
          return i.position = new t.MercatorCoordinate(e[0], e[1], e[2]), i.orientation = this._camera.orientation, i._elevation = this.elevation, i._renderWorldCopies = this._renderWorldCopies, i;
        }
      }, {
        key: "_setCameraOrientation",
        value: function _setCameraOrientation(e) {
          if (!t.length$1(e)) return !1;
          t.normalize$1(e, e);
          var i = t.transformQuat([], [0, 0, -1], e),
              o = t.transformQuat([], [0, -1, 0], e);
          if (o[2] < 0) return !1;
          var a = Qi(i, o);
          return !!a && (this._camera.orientation = a, !0);
        }
      }, {
        key: "_setCameraPosition",
        value: function _setCameraPosition(e) {
          var i = this.zoomScale(this.minZoom) * this.tileSize,
              o = this.zoomScale(this.maxZoom) * this.tileSize,
              a = this.cameraToCenterDistance;
          e[2] = t.clamp(e[2], a / o, a / i), this._camera.position = e;
        }
      }, {
        key: "isPaddingEqual",
        value: function isPaddingEqual(t) {
          return this._edgeInsets.equals(t);
        }
      }, {
        key: "interpolatePadding",
        value: function interpolatePadding(t, e, i) {
          this._unmodified = !1, this._edgeInsets.interpolate(t, e, i), this._constrain(), this._calcMatrices();
        }
      }, {
        key: "coveringZoomLevel",
        value: function coveringZoomLevel(t) {
          var e = (t.roundZoom ? Math.round : Math.floor)(this.zoom + this.scaleZoom(this.tileSize / t.tileSize));
          return Math.max(0, e);
        }
      }, {
        key: "getVisibleUnwrappedCoordinates",
        value: function getVisibleUnwrappedCoordinates(e) {
          var i = [new t.UnwrappedTileID(0, e)];

          if (this._renderWorldCopies) {
            var _o108 = this.pointCoordinate(new t.Point(0, 0)),
                _a146 = this.pointCoordinate(new t.Point(this.width, 0)),
                _r244 = this.pointCoordinate(new t.Point(this.width, this.height)),
                _n151 = this.pointCoordinate(new t.Point(0, this.height)),
                _s119 = Math.floor(Math.min(_o108.x, _a146.x, _r244.x, _n151.x)),
                _l53 = Math.floor(Math.max(_o108.x, _a146.x, _r244.x, _n151.x)),
                _c37 = 1;

            for (var _o109 = _s119 - _c37; _o109 <= _l53 + _c37; _o109++) {
              0 !== _o109 && i.push(new t.UnwrappedTileID(_o109, e));
            }
          }

          return i;
        }
      }, {
        key: "coveringTiles",
        value: function coveringTiles(e) {
          var _this105 = this;

          var i = this.coveringZoomLevel(e);
          var o = i,
              a = !!e.useElevationData;
          if (void 0 !== e.minzoom && i < e.minzoom) return [];
          void 0 !== e.maxzoom && i > e.maxzoom && (i = e.maxzoom);

          var r = t.MercatorCoordinate.fromLngLat(this.center),
              n = 1 << i,
              s = [n * r.x, n * r.y, 0],
              l = t.Frustum.fromInvProjectionMatrix(this.invProjMatrix, this.worldSize, i),
              c = this.pointCoordinate(this.getCameraPoint()),
              h = n * t.mercatorZfromAltitude(1, this.center.lat),
              u = this._camera.position[2] / t.mercatorZfromAltitude(1, this.center.lat),
              d = [n * c.x, n * c.y, u],
              _ = this.cameraToCenterDistance / e.tileSize * (e.roundZoom ? 1 : .502),
              m = this.pitch <= 60 && this._edgeInsets.top <= this._edgeInsets.bottom && !this._elevation ? i : 0,
              p = this.elevation ? 1e4 * this.elevation.exaggeration() : 0,
              f = function f(e) {
            return {
              aabb: new t.Aabb([e * n, 0, -p], [(e + 1) * n, n, p]),
              zoom: 0,
              x: 0,
              y: 0,
              wrap: e,
              fullyVisible: !1
            };
          },
              g = [],
              v = [],
              x = i,
              y = e.reparseOverscaled ? o : i,
              b = function b(t, e) {
            if (!_this105._elevation) return;

            var i = _this105._elevation.getMinMaxForTile(e);

            i && (t.min[2] = i.min, t.max[2] = i.max, t.center[2] = (t.min[2] + t.max[2]) / 2);
          },
              w = function w(t) {
            return t * t;
          },
              T = w((u - this._centerAltitude) * h),
              E = function E(t, e) {
            if (e * w(.707) < t) return 1;
            var i = Math.sqrt(e / t);
            return i / (1 / .707 + (Math.pow(1.1, i - 1 / .707 + 1) - 1) / (1.1 - 1) - 1);
          };

          if (this._renderWorldCopies) for (var _t380 = 1; _t380 <= 3; _t380++) {
            g.push(f(-_t380)), g.push(f(_t380));
          }

          for (g.push(f(0)); g.length > 0;) {
            var _o110 = g.pop(),
                _r245 = _o110.x,
                _n152 = _o110.y;

            var _c38 = _o110.fullyVisible;

            if (!_c38) {
              var _t381 = _o110.aabb.intersects(l);

              if (0 === _t381) continue;
              _c38 = 2 === _t381;
            }

            var _u43 = !0;

            if (m <= _o110.zoom && _o110.zoom < x) {
              var _t382 = _o110.aabb.distanceX(d),
                  _e318 = _o110.aabb.distanceY(d);

              var _i259 = T;
              a && (_i259 = w(_o110.aabb.distanceZ(d) * h));

              var _r246 = _t382 * _t382 + _e318 * _e318 + _i259;

              _u43 = _r246 < w((1 << x - _o110.zoom) * _ * E(Math.max(_i259, T), _r246));
            }

            if (_o110.zoom !== x && _u43) for (var _e319 = 0; _e319 < 4; _e319++) {
              var _i260 = (_r245 << 1) + _e319 % 2,
                  _s120 = (_n152 << 1) + (_e319 >> 1),
                  _l54 = _o110.aabb.quadrant(_e319);

              var _h28 = null;
              a && _o110.zoom > x - 6 && (_h28 = new t.OverscaledTileID(_o110.zoom + 1 === x ? y : _o110.zoom + 1, _o110.wrap, _o110.zoom + 1, _i260, _s120), b(_l54, _h28)), g.push({
                aabb: _l54,
                zoom: _o110.zoom + 1,
                x: _i260,
                y: _s120,
                wrap: _o110.wrap,
                fullyVisible: _c38,
                tileID: _h28
              });
            } else {
              var _a147 = _o110.zoom === x ? y : _o110.zoom;

              if (e.minzoom && e.minzoom > _a147) continue;

              var _l55 = s[0] - (.5 + _r245 + (_o110.wrap << _o110.zoom)) * (1 << i - _o110.zoom),
                  _c39 = s[1] - .5 - _n152,
                  _h29 = _o110.tileID ? _o110.tileID : new t.OverscaledTileID(_a147, _o110.wrap, _o110.zoom, _r245, _n152);

              v.push({
                tileID: _h29,
                distanceSq: _l55 * _l55 + _c39 * _c39
              });
            }
          }

          return v.sort(function (t, e) {
            return t.distanceSq - e.distanceSq;
          }).map(function (t) {
            return t.tileID;
          });
        }
      }, {
        key: "resize",
        value: function resize(t, e) {
          this.width = t, this.height = e, this.pixelsToGLUnits = [2 / t, -2 / e], this._constrain(), this._calcMatrices();
        }
      }, {
        key: "zoomScale",
        value: function zoomScale(t) {
          return Math.pow(2, t);
        }
      }, {
        key: "scaleZoom",
        value: function scaleZoom(t) {
          return Math.log(t) / Math.LN2;
        }
      }, {
        key: "project",
        value: function project(e) {
          var i = t.clamp(e.lat, -this.maxValidLatitude, this.maxValidLatitude);
          return new t.Point(t.mercatorXfromLng(e.lng) * this.worldSize, t.mercatorYfromLat(i) * this.worldSize);
        }
      }, {
        key: "unproject",
        value: function unproject(e) {
          return new t.MercatorCoordinate(e.x / this.worldSize, e.y / this.worldSize).toLngLat();
        }
      }, {
        key: "setLocationAtPoint",
        value: function setLocationAtPoint(e, i) {
          var o = this.pointCoordinate(i),
              a = this.pointCoordinate(this.centerPoint),
              r = this.locationCoordinate(e),
              n = new t.MercatorCoordinate(r.x - (o.x - a.x), r.y - (o.y - a.y));
          this.center = this.coordinateLocation(n), this._renderWorldCopies && (this.center = this.center.wrap());
        }
      }, {
        key: "setLocation",
        value: function setLocation(t) {
          this.center = this.coordinateLocation(t), this._renderWorldCopies && (this.center = this.center.wrap());
        }
      }, {
        key: "locationPoint",
        value: function locationPoint(t) {
          return this._coordinatePoint(this.locationCoordinate(t), !1);
        }
      }, {
        key: "locationPoint3D",
        value: function locationPoint3D(t) {
          return this._coordinatePoint(this.locationCoordinate(t), !0);
        }
      }, {
        key: "pointLocation",
        value: function pointLocation(t) {
          return this.coordinateLocation(this.pointCoordinate(t));
        }
      }, {
        key: "pointLocation3D",
        value: function pointLocation3D(t) {
          return this.coordinateLocation(this.pointCoordinate3D(t));
        }
      }, {
        key: "locationCoordinate",
        value: function locationCoordinate(e) {
          return t.MercatorCoordinate.fromLngLat(e);
        }
      }, {
        key: "coordinateLocation",
        value: function coordinateLocation(t) {
          return t.toLngLat();
        }
      }, {
        key: "pointRayIntersection",
        value: function pointRayIntersection(e, i) {
          var o = null != i ? i : this._centerAltitude,
              a = [e.x, e.y, 0, 1],
              r = [e.x, e.y, 1, 1];
          t.transformMat4(a, a, this.pixelMatrixInverse), t.transformMat4(r, r, this.pixelMatrixInverse);
          var n = r[3];
          t.scale$1(a, a, 1 / a[3]), t.scale$1(r, r, 1 / n);
          var s = a[2],
              l = r[2];
          return {
            p0: a,
            p1: r,
            t: s === l ? 0 : (o - s) / (l - s)
          };
        }
      }, {
        key: "screenPointToMercatorRay",
        value: function screenPointToMercatorRay(e) {
          var i = [e.x, e.y, 0, 1],
              o = [e.x, e.y, 1, 1];
          return t.transformMat4(i, i, this.pixelMatrixInverse), t.transformMat4(o, o, this.pixelMatrixInverse), t.scale$1(i, i, 1 / i[3]), t.scale$1(o, o, 1 / o[3]), i[2] = t.mercatorZfromAltitude(i[2], this._center.lat) * this.worldSize, o[2] = t.mercatorZfromAltitude(o[2], this._center.lat) * this.worldSize, t.scale$1(i, i, 1 / this.worldSize), t.scale$1(o, o, 1 / this.worldSize), new t.Ray([i[0], i[1], i[2]], t.normalize([], t.sub([], o, i)));
        }
      }, {
        key: "rayIntersectionCoordinate",
        value: function rayIntersectionCoordinate(e) {
          var i = e.p0,
              o = e.p1,
              a = e.t,
              r = t.mercatorZfromAltitude(i[2], this._center.lat),
              n = t.mercatorZfromAltitude(o[2], this._center.lat);
          return new t.MercatorCoordinate(t.number(i[0], o[0], a) / this.worldSize, t.number(i[1], o[1], a) / this.worldSize, t.number(r, n, a));
        }
      }, {
        key: "pointCoordinate",
        value: function pointCoordinate(e) {
          var i = this.horizonLineFromTop(!1),
              o = new t.Point(e.x, Math.max(i, e.y));
          return this.rayIntersectionCoordinate(this.pointRayIntersection(o));
        }
      }, {
        key: "pointCoordinate3D",
        value: function pointCoordinate3D(e) {
          if (!this.elevation) return this.pointCoordinate(e);
          var i = this.elevation;
          var o = this.elevation.pointCoordinate(e);
          if (o) return new t.MercatorCoordinate(o[0], o[1], o[2]);
          var a = 0,
              r = this.horizonLineFromTop();
          if (e.y > r) return this.pointCoordinate(e);
          var n = .02 * r,
              s = e.clone();

          for (var _e320 = 0; _e320 < 10 && r - a > n; _e320++) {
            s.y = t.number(a, r, .66);

            var _e321 = i.pointCoordinate(s);

            _e321 ? (r = s.y, o = _e321) : a = s.y;
          }

          return o ? new t.MercatorCoordinate(o[0], o[1], o[2]) : this.pointCoordinate(e);
        }
      }, {
        key: "isPointAboveHorizon",
        value: function isPointAboveHorizon(t) {
          if (this.elevation) return !this.elevation.pointCoordinate(t);
          {
            var _e322 = this.horizonLineFromTop();

            return t.y < _e322;
          }
        }
      }, {
        key: "_coordinatePoint",
        value: function _coordinatePoint(e, i) {
          var o = i && this.elevation ? this.elevation.getAtPoint(e, this._centerAltitude) : this._centerAltitude,
              a = [e.x * this.worldSize, e.y * this.worldSize, o + e.toAltitude(), 1];
          return t.transformMat4(a, a, this.pixelMatrix), a[3] > 0 ? new t.Point(a[0] / a[3], a[1] / a[3]) : new t.Point(Number.MAX_VALUE, Number.MAX_VALUE);
        }
      }, {
        key: "getBounds",
        value: function getBounds() {
          return this._terrainEnabled() ? this._getBounds3D() : new t.LngLatBounds().extend(this.pointLocation(new t.Point(0, 0))).extend(this.pointLocation(new t.Point(this.width, 0))).extend(this.pointLocation(new t.Point(this.width, this.height))).extend(this.pointLocation(new t.Point(0, this.height)));
        }
      }, {
        key: "_getBounds3D",
        value: function _getBounds3D() {
          var _this106 = this;

          var e = this.elevation,
              i = e.visibleDemTiles.reduce(function (t, e) {
            if (e.dem) {
              var _i261 = e.dem.tree;
              t.min = Math.min(t.min, _i261.minimums[0]), t.max = Math.max(t.max, _i261.maximums[0]);
            }

            return t;
          }, {
            min: Number.MAX_VALUE,
            max: 0
          });
          i.min *= e.exaggeration(), i.max *= e.exaggeration();
          var o = this.horizonLineFromTop();
          return [new t.Point(0, o), new t.Point(this.width, o), new t.Point(this.width, this.height), new t.Point(0, this.height)].reduce(function (t, e) {
            return t.extend(_this106.coordinateLocation(_this106.rayIntersectionCoordinate(_this106.pointRayIntersection(e, i.min)))).extend(_this106.coordinateLocation(_this106.rayIntersectionCoordinate(_this106.pointRayIntersection(e, i.max))));
          }, new t.LngLatBounds());
        }
      }, {
        key: "horizonLineFromTop",
        value: function horizonLineFromTop() {
          var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;
          var e = this.height / 2 / Math.tan(this._fov / 2) / Math.tan(Math.max(this._pitch, .1)) + this.centerOffset.y,
              i = this.height / 2 - .97 * e;
          return t ? Math.max(0, i) : i;
        }
      }, {
        key: "getMaxBounds",
        value: function getMaxBounds() {
          return this.latRange && 2 === this.latRange.length && this.lngRange && 2 === this.lngRange.length ? new t.LngLatBounds([this.lngRange[0], this.latRange[0]], [this.lngRange[1], this.latRange[1]]) : null;
        }
      }, {
        key: "setMaxBounds",
        value: function setMaxBounds(t) {
          t ? (this.lngRange = [t.getWest(), t.getEast()], this.latRange = [t.getSouth(), t.getNorth()], this._constrain()) : (this.lngRange = null, this.latRange = [-this.maxValidLatitude, this.maxValidLatitude]);
        }
      }, {
        key: "calculatePosMatrix",
        value: function calculatePosMatrix(e) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
          var o = e.key,
              a = i ? this._alignedPosMatrixCache : this._posMatrixCache;
          if (a[o]) return a[o];
          var r = e.canonical,
              n = this.worldSize / this.zoomScale(r.z),
              s = r.x + Math.pow(2, r.z) * e.wrap,
              l = t.identity(new Float64Array(16));
          return t.translate(l, l, [s * n, r.y * n, 0]), t.scale(l, l, [n / t.EXTENT, n / t.EXTENT, 1]), t.multiply(l, i ? this.alignedProjMatrix : this.projMatrix, l), a[o] = new Float32Array(l), a[o];
        }
      }, {
        key: "customLayerMatrix",
        value: function customLayerMatrix() {
          return this.mercatorMatrix.slice();
        }
      }, {
        key: "recenterOnTerrain",
        value: function recenterOnTerrain() {
          if (!this._elevation) return;
          var e = this._elevation;

          this._updateCameraState();

          var i = this._camera.position,
              o = this._camera.forward();

          if (i.z <= 0 || o[2] >= 0) return;
          var a = t.mercatorZfromAltitude(1, this._center.lat);
          i[2] /= a, o[2] /= a, t.normalize(o, o);
          var r = e.raycast(i, o, e.exaggeration());

          if (r) {
            var _e323 = t.scaleAndAdd([], i, o, r),
                _a148 = new t.MercatorCoordinate(_e323[0], _e323[1], t.mercatorZfromAltitude(_e323[2], t.latFromMercatorY(_e323[1]))),
                _n153 = this._camera.position,
                _s121 = _a148.z + t.length([_a148.x - _n153[0], _a148.y - _n153[1], _a148.z - _n153[2]]);

            this._cameraZoom = this._zoomFromMercatorZ(_s121), this._centerAltitude = _a148.toAltitude(), this._center = _a148.toLngLat(), this._updateZoomFromElevation(), this._constrain(), this._calcMatrices();
          }
        }
      }, {
        key: "_constrainCameraAltitude",
        value: function _constrainCameraAltitude() {
          if (!this._elevation) return;
          var e = this._elevation;

          this._updateCameraState();

          var i = e.getAtPoint(this._camera.mercatorPosition),
              o = this._minimumHeightOverTerrain() * Math.cos(t.degToRad(this._maxPitch)),
              a = t.mercatorZfromAltitude(i, this._center.lat),
              r = this._camera.position[2] - a;

          if (r < o) {
            var _e324 = t.MercatorCoordinate.fromLngLat(this._center, this._centerAltitude),
                _i262 = this._camera.mercatorPosition,
                _a149 = [_e324.x - _i262.x, _e324.y - _i262.y, _e324.z - _i262.z],
                _n154 = t.length(_a149);

            _a149[2] -= o - r;

            var _s122 = t.length(_a149);

            if (0 === _s122) return;
            t.scale$2(_a149, _a149, _n154 / _s122), this._camera.position = [_e324.x - _a149[0], _e324.y - _a149[1], _e324.z - _a149[2]], this._camera.orientation = Qi(_a149, this._camera.up()), this._updateStateFromCamera();
          }
        }
      }, {
        key: "_constrain",
        value: function _constrain() {
          if (!this.center || !this.width || !this.height || this._constraining) return;
          this._constraining = !0;
          var e,
              i,
              o,
              a,
              r = -90,
              n = 90,
              s = -180,
              l = 180;
          var c = this.size,
              h = this._unmodified;

          if (this.latRange) {
            var _i263 = this.latRange;
            r = t.mercatorYfromLat(_i263[1]) * this.worldSize, n = t.mercatorYfromLat(_i263[0]) * this.worldSize, e = n - r < c.y ? c.y / (n - r) : 0;
          }

          if (this.lngRange) {
            var _e325 = this.lngRange;
            s = t.mercatorXfromLng(_e325[0]) * this.worldSize, l = t.mercatorXfromLng(_e325[1]) * this.worldSize, i = l - s < c.x ? c.x / (l - s) : 0;
          }

          var u = this.point,
              d = Math.max(i || 0, e || 0);
          if (d) return this.center = this.unproject(new t.Point(i ? (l + s) / 2 : u.x, e ? (n + r) / 2 : u.y)), this.zoom += this.scaleZoom(d), this._unmodified = h, void (this._constraining = !1);

          if (this.latRange) {
            var _t383 = u.y,
                _e326 = c.y / 2;

            _t383 - _e326 < r && (a = r + _e326), _t383 + _e326 > n && (a = n - _e326);
          }

          if (this.lngRange) {
            var _t384 = u.x,
                _e327 = c.x / 2;

            _t384 - _e327 < s && (o = s + _e327), _t384 + _e327 > l && (o = l - _e327);
          }

          void 0 === o && void 0 === a || (this.center = this.unproject(new t.Point(void 0 !== o ? o : u.x, void 0 !== a ? a : u.y))), this._constrainCameraAltitude(), this._unmodified = h, this._constraining = !1;
        }
      }, {
        key: "_minZoomForBounds",
        value: function _minZoomForBounds() {
          var _this107 = this;

          var e = function e(t, _e328) {
            return Math.log2(t / (_this107.tileSize * Math.abs(_e328[1] - _e328[0])));
          };

          var i = 0;

          if (this.latRange) {
            var _o111 = this.latRange;
            i = e(this.height, [t.mercatorYfromLat(_o111[0]), t.mercatorYfromLat(_o111[1])]);
          }

          var o = 0;

          if (this.lngRange) {
            var _i264 = this.lngRange;
            o = e(this.width, [t.mercatorXfromLng(_i264[0]), t.mercatorXfromLng(_i264[1])]);
          }

          return Math.max(i, o);
        }
      }, {
        key: "_maxCameraBoundsDistance",
        value: function _maxCameraBoundsDistance() {
          return this._mercatorZfromZoom(this._minZoomForBounds());
        }
      }, {
        key: "_calcMatrices",
        value: function _calcMatrices() {
          if (!this.height) return;
          var e = this.centerOffset;
          this.cameraToCenterDistance = .5 / Math.tan(this._fov / 2) * this.height;
          var i = t.mercatorZfromAltitude(1, this.center.lat) * this.worldSize;

          this._updateCameraState();

          var o = Math.PI / 2 + this._pitch,
              a = this.fovAboveCenter,
              r = this._camera.position[2] * this.worldSize / Math.cos(this._pitch),
              n = Math.sin(a) * r / Math.sin(t.clamp(Math.PI - o - a, .01, Math.PI - .01)),
              s = this.point,
              l = s.x,
              c = s.y,
              h = 1.01 * (Math.cos(Math.PI / 2 - this._pitch) * n + r),
              u = this.height / 50,
              d = this._camera.getWorldToCamera(this.worldSize, i),
              _ = this._camera.getCameraToClipPerspective(this._fov, this.width / this.height, u, h);

          _[8] = 2 * -e.x / this.width, _[9] = 2 * e.y / this.height;
          var m = t.mul([], _, d);
          this.mercatorMatrix = t.scale([], m, [this.worldSize, this.worldSize, this.worldSize / i]), this.projMatrix = m, this.invProjMatrix = t.invert(new Float64Array(16), this.projMatrix);
          var p = new Float32Array(16);
          t.identity(p), t.scale(p, p, [1, -1, 1]), t.rotateX(p, p, this._pitch), t.rotateZ(p, p, this.angle);
          var f = t.perspective(new Float32Array(16), this._fov, this.width / this.height, u, h);
          f[8] = 2 * -e.x / this.width, f[9] = 2 * e.y / this.height, this.skyboxMatrix = t.multiply(p, f, p);
          var g = this.width % 2 / 2,
              v = this.height % 2 / 2,
              x = Math.cos(this.angle),
              y = Math.sin(this.angle),
              b = l - Math.round(l) + x * g + y * v,
              w = c - Math.round(c) + x * v + y * g,
              T = new Float64Array(m);
          if (t.translate(T, T, [b > .5 ? b - 1 : b, w > .5 ? w - 1 : w, 0]), this.alignedProjMatrix = T, m = t.create(), t.scale(m, m, [this.width / 2, -this.height / 2, 1]), t.translate(m, m, [1, -1, 0]), this.labelPlaneMatrix = m, m = t.create(), t.scale(m, m, [1, -1, 1]), t.translate(m, m, [-1, -1, 0]), t.scale(m, m, [2 / this.width, 2 / this.height, 1]), this.glCoordMatrix = m, this.pixelMatrix = t.multiply(new Float64Array(16), this.labelPlaneMatrix, this.projMatrix), m = t.invert(new Float64Array(16), this.pixelMatrix), !m) throw new Error("failed to invert matrix");
          this.pixelMatrixInverse = m, this._posMatrixCache = {}, this._alignedPosMatrixCache = {};
        }
      }, {
        key: "_updateCameraState",
        value: function _updateCameraState() {
          if (!this.height) return;

          this._camera.setPitchBearing(this._pitch, this.angle);

          var e = this._camera.forward(),
              i = this.cameraToCenterDistance,
              o = this.point,
              a = this._mercatorZfromZoom(this._cameraZoom ? this._cameraZoom : this._zoom) - t.mercatorZfromAltitude(this._centerAltitude, this.center.lat),
              r = this.cameraToCenterDistance / a;

          this._camera.position = [o.x / this.worldSize - e[0] * i / r, o.y / this.worldSize - e[1] * i / r, t.mercatorZfromAltitude(this._centerAltitude, this._center.lat) + -e[2] * i / r];
        }
      }, {
        key: "_translateCameraConstrained",
        value: function _translateCameraConstrained(e) {
          var i = this._maxCameraBoundsDistance() * Math.cos(this._pitch),
              o = e[2];
          var a = 1;
          o > 0 && (a = Math.min((i - this._camera.position[2]) / o, 1)), this._camera.position = t.scaleAndAdd([], this._camera.position, e, a), this._updateStateFromCamera();
        }
      }, {
        key: "_updateStateFromCamera",
        value: function _updateStateFromCamera() {
          var e = this._camera.position,
              i = this._camera.forward(),
              _this$_camera$getPitc = this._camera.getPitchBearing(),
              o = _this$_camera$getPitc.pitch,
              a = _this$_camera$getPitc.bearing,
              r = t.mercatorZfromAltitude(this._centerAltitude, this.center.lat),
              n = this._mercatorZfromZoom(this._maxZoom) * Math.cos(t.degToRad(this._maxPitch)),
              s = Math.max((e[2] - r) / Math.cos(o), n),
              l = this._zoomFromMercatorZ(s);

          t.scaleAndAdd(e, e, i, s), this._pitch = t.clamp(o, t.degToRad(this.minPitch), t.degToRad(this.maxPitch)), this.angle = t.wrap(a, -Math.PI, Math.PI), this._setZoom(t.clamp(l, this._minZoom, this._maxZoom)), this._terrainEnabled() && this._updateCameraOnTerrain(), this._center = new t.MercatorCoordinate(e[0], e[1], e[2]).toLngLat(), this._unmodified = !1, this._constrain(), this._calcMatrices();
        }
      }, {
        key: "_worldSizeFromZoom",
        value: function _worldSizeFromZoom(t) {
          return Math.pow(2, t) * this.tileSize;
        }
      }, {
        key: "_mercatorZfromZoom",
        value: function _mercatorZfromZoom(t) {
          return this.cameraToCenterDistance / this._worldSizeFromZoom(t);
        }
      }, {
        key: "_minimumHeightOverTerrain",
        value: function _minimumHeightOverTerrain() {
          var t = Math.min((null != this._cameraZoom ? this._cameraZoom : this._zoom) + 2, this._maxZoom);
          return this._mercatorZfromZoom(t);
        }
      }, {
        key: "_zoomFromMercatorZ",
        value: function _zoomFromMercatorZ(t) {
          return this.scaleZoom(this.cameraToCenterDistance / (t * this.tileSize));
        }
      }, {
        key: "_terrainEnabled",
        value: function _terrainEnabled() {
          return !!this._elevation;
        }
      }, {
        key: "isHorizonVisibleForPoints",
        value: function isHorizonVisibleForPoints(e, i) {
          var o = Math.min(e.x, i.x),
              a = Math.max(e.x, i.x),
              r = Math.min(e.y, i.y),
              n = Math.max(e.y, i.y),
              s = [new t.Point(o, r), new t.Point(a, n), new t.Point(o, n), new t.Point(a, r)],
              l = this._renderWorldCopies ? -3 : 0,
              c = this._renderWorldCopies ? 4 : 1;

          for (var _i265 = 0, _s123 = s; _i265 < _s123.length; _i265++) {
            var _t385 = _s123[_i265];

            var _e329 = this.pointRayIntersection(_t385);

            if (_e329.t < 0) return !0;

            var _i266 = this.rayIntersectionCoordinate(_e329);

            if (_i266.x < l || _i266.y < 0 || _i266.x > c || _i266.y > 1) return !0;
          }

          return !1;
        }
      }, {
        key: "isHorizonVisible",
        value: function isHorizonVisible() {
          return this.pitch + t.radToDeg(this.fovAboveCenter) > 88 || this.isHorizonVisibleForPoints(new t.Point(0, 0), new t.Point(this.width, this.height));
        }
      }, {
        key: "zoomDeltaToMovement",
        value: function zoomDeltaToMovement(e, i) {
          var o = t.length(t.sub([], this._camera.position, e)),
              a = this._zoomFromMercatorZ(o) + i;
          return o - this._mercatorZfromZoom(a);
        }
      }, {
        key: "getCameraPoint",
        value: function getCameraPoint() {
          var e = Math.tan(this._pitch) * (this.cameraToCenterDistance || 1);
          return this.centerPoint.add(new t.Point(0, e));
        }
      }, {
        key: "elevation",
        get: function get() {
          return this._elevation;
        },
        set: function set(t) {
          this._elevation !== t && (this._elevation = t, t ? this._updateCenterElevation() && this._updateCameraOnTerrain() : (this._cameraZoom = null, this._centerAltitude = 0), this._calcMatrices());
        }
      }, {
        key: "minZoom",
        get: function get() {
          return this._minZoom;
        },
        set: function set(t) {
          this._minZoom !== t && (this._minZoom = t, this.zoom = Math.max(this.zoom, t));
        }
      }, {
        key: "maxZoom",
        get: function get() {
          return this._maxZoom;
        },
        set: function set(t) {
          this._maxZoom !== t && (this._maxZoom = t, this.zoom = Math.min(this.zoom, t));
        }
      }, {
        key: "minPitch",
        get: function get() {
          return this._minPitch;
        },
        set: function set(t) {
          this._minPitch !== t && (this._minPitch = t, this.pitch = Math.max(this.pitch, t));
        }
      }, {
        key: "maxPitch",
        get: function get() {
          return this._maxPitch;
        },
        set: function set(t) {
          this._maxPitch !== t && (this._maxPitch = t, this.pitch = Math.min(this.pitch, t));
        }
      }, {
        key: "renderWorldCopies",
        get: function get() {
          return this._renderWorldCopies;
        },
        set: function set(t) {
          void 0 === t ? t = !0 : null === t && (t = !1), this._renderWorldCopies = t;
        }
      }, {
        key: "worldSize",
        get: function get() {
          return this.tileSize * this.scale;
        }
      }, {
        key: "centerOffset",
        get: function get() {
          return this.centerPoint._sub(this.size._div(2));
        }
      }, {
        key: "size",
        get: function get() {
          return new t.Point(this.width, this.height);
        }
      }, {
        key: "bearing",
        get: function get() {
          return -this.angle / Math.PI * 180;
        },
        set: function set(e) {
          var i = -t.wrap(e, -180, 180) * Math.PI / 180;
          this.angle !== i && (this._unmodified = !1, this.angle = i, this._calcMatrices(), this.rotationMatrix = t.create$2(), t.rotate(this.rotationMatrix, this.rotationMatrix, this.angle));
        }
      }, {
        key: "pitch",
        get: function get() {
          return this._pitch / Math.PI * 180;
        },
        set: function set(e) {
          var i = t.clamp(e, this.minPitch, this.maxPitch) / 180 * Math.PI;
          this._pitch !== i && (this._unmodified = !1, this._pitch = i, this._calcMatrices());
        }
      }, {
        key: "fov",
        get: function get() {
          return this._fov / Math.PI * 180;
        },
        set: function set(t) {
          t = Math.max(.01, Math.min(60, t)), this._fov !== t && (this._unmodified = !1, this._fov = t / 180 * Math.PI, this._calcMatrices());
        }
      }, {
        key: "zoom",
        get: function get() {
          return this._zoom;
        },
        set: function set(t) {
          var e = Math.min(Math.max(t, this.minZoom), this.maxZoom);
          this._zoom !== e && (this._unmodified = !1, this._setZoom(e), this._terrainEnabled() && this._updateCameraOnTerrain(), this._constrain(), this._calcMatrices());
        }
      }, {
        key: "center",
        get: function get() {
          return this._center;
        },
        set: function set(t) {
          t.lat === this._center.lat && t.lng === this._center.lng || (this._unmodified = !1, this._center = t, this._terrainEnabled() && ("ground" === this.cameraElevationReference ? this._updateCenterElevation() ? this._updateCameraOnTerrain() : this._cameraZoom = null : this._updateZoomFromElevation()), this._constrain(), this._calcMatrices());
        }
      }, {
        key: "padding",
        get: function get() {
          return this._edgeInsets.toJSON();
        },
        set: function set(t) {
          this._edgeInsets.equals(t) || (this._unmodified = !1, this._edgeInsets.interpolate(this._edgeInsets, t, 1), this._calcMatrices());
        }
      }, {
        key: "centerPoint",
        get: function get() {
          return this._edgeInsets.getCenter(this.width, this.height);
        }
      }, {
        key: "fovAboveCenter",
        get: function get() {
          return this._fov * (.5 + this.centerOffset.y / this.height);
        }
      }, {
        key: "unmodified",
        get: function get() {
          return this._unmodified;
        }
      }, {
        key: "point",
        get: function get() {
          return this.project(this.center);
        }
      }]);

      return io;
    }();

    var oo = /*#__PURE__*/function () {
      function oo(e) {
        _classCallCheck(this, oo);

        this._hashName = e && encodeURIComponent(e), t.bindAll(["_getCurrentHash", "_onHashChange", "_updateHash"], this), this._updateHash = function (t, e) {
          var i = !1,
              o = null;

          var a = function a() {
            o = null, i && (t(), o = setTimeout(a, 300), i = !1);
          };

          return function () {
            return i = !0, o || a(), o;
          };
        }(this._updateHashUnthrottled.bind(this));
      }

      _createClass(oo, [{
        key: "addTo",
        value: function addTo(e) {
          return this._map = e, t.window.addEventListener("hashchange", this._onHashChange, !1), this._map.on("moveend", this._updateHash), this;
        }
      }, {
        key: "remove",
        value: function remove() {
          return t.window.removeEventListener("hashchange", this._onHashChange, !1), this._map.off("moveend", this._updateHash), clearTimeout(this._updateHash()), delete this._map, this;
        }
      }, {
        key: "getHashString",
        value: function getHashString(e) {
          var i = this._map.getCenter(),
              o = Math.round(100 * this._map.getZoom()) / 100,
              a = Math.ceil((o * Math.LN2 + Math.log(512 / 360 / .5)) / Math.LN10),
              r = Math.pow(10, a),
              n = Math.round(i.lng * r) / r,
              s = Math.round(i.lat * r) / r,
              l = this._map.getBearing(),
              c = this._map.getPitch();

          var h = "";

          if (h += e ? "/".concat(n, "/").concat(s, "/").concat(o) : "".concat(o, "/").concat(s, "/").concat(n), (l || c) && (h += "/".concat(Math.round(10 * l) / 10)), c && (h += "/".concat(Math.round(c))), this._hashName) {
            var _e330 = this._hashName;

            var _i267 = !1;

            var _o112 = t.window.location.hash.slice(1).split("&").map(function (t) {
              var o = t.split("=")[0];
              return o === _e330 ? (_i267 = !0, "".concat(o, "=").concat(h)) : t;
            }).filter(function (t) {
              return t;
            });

            return _i267 || _o112.push("".concat(_e330, "=").concat(h)), "#".concat(_o112.join("&"));
          }

          return "#".concat(h);
        }
      }, {
        key: "_getCurrentHash",
        value: function _getCurrentHash() {
          var _this108 = this;

          var e = t.window.location.hash.replace("#", "");

          if (this._hashName) {
            var _t386;

            return e.split("&").map(function (t) {
              return t.split("=");
            }).forEach(function (e) {
              e[0] === _this108._hashName && (_t386 = e);
            }), (_t386 && _t386[1] || "").split("/");
          }

          return e.split("/");
        }
      }, {
        key: "_onHashChange",
        value: function _onHashChange() {
          var t = this._getCurrentHash();

          if (t.length >= 3 && !t.some(function (t) {
            return isNaN(t);
          })) {
            var _e331 = this._map.dragRotate.isEnabled() && this._map.touchZoomRotate.isEnabled() ? +(t[3] || 0) : this._map.getBearing();

            return this._map.jumpTo({
              center: [+t[2], +t[1]],
              zoom: +t[0],
              bearing: _e331,
              pitch: +(t[4] || 0)
            }), !0;
          }

          return !1;
        }
      }, {
        key: "_updateHashUnthrottled",
        value: function _updateHashUnthrottled() {
          var e = t.window.location.href.replace(/(#.+)?$/, this.getHashString());
          t.window.history.replaceState(t.window.history.state, null, e);
        }
      }]);

      return oo;
    }();

    var ao = {
      linearity: .3,
      easing: t.bezier(0, 0, .3, 1)
    },
        ro = t.extend({
      deceleration: 2500,
      maxSpeed: 1400
    }, ao),
        no = t.extend({
      deceleration: 20,
      maxSpeed: 1400
    }, ao),
        so = t.extend({
      deceleration: 1e3,
      maxSpeed: 360
    }, ao),
        lo = t.extend({
      deceleration: 1e3,
      maxSpeed: 90
    }, ao);

    var co = /*#__PURE__*/function () {
      function co(t) {
        _classCallCheck(this, co);

        this._map = t, this.clear();
      }

      _createClass(co, [{
        key: "clear",
        value: function clear() {
          this._inertiaBuffer = [];
        }
      }, {
        key: "record",
        value: function record(e) {
          this._drainInertiaBuffer(), this._inertiaBuffer.push({
            time: t.browser.now(),
            settings: e
          });
        }
      }, {
        key: "_drainInertiaBuffer",
        value: function _drainInertiaBuffer() {
          var e = this._inertiaBuffer,
              i = t.browser.now();

          for (; e.length > 0 && i - e[0].time > 160;) {
            e.shift();
          }
        }
      }, {
        key: "_onMoveEnd",
        value: function _onMoveEnd(e) {
          if (this._drainInertiaBuffer(), this._inertiaBuffer.length < 2) return;
          var i = {
            zoom: 0,
            bearing: 0,
            pitch: 0,
            pan: new t.Point(0, 0),
            pinchAround: void 0,
            around: void 0
          };

          var _iterator221 = _createForOfIteratorHelper(this._inertiaBuffer),
              _step221;

          try {
            for (_iterator221.s(); !(_step221 = _iterator221.n()).done;) {
              var _ref176 = _step221.value;
              var _t390 = _ref176.settings;
              i.zoom += _t390.zoomDelta || 0, i.bearing += _t390.bearingDelta || 0, i.pitch += _t390.pitchDelta || 0, _t390.panDelta && i.pan._add(_t390.panDelta), _t390.around && (i.around = _t390.around), _t390.pinchAround && (i.pinchAround = _t390.pinchAround);
            }
          } catch (err) {
            _iterator221.e(err);
          } finally {
            _iterator221.f();
          }

          var o = this._inertiaBuffer[this._inertiaBuffer.length - 1].time - this._inertiaBuffer[0].time,
              a = {};

          if (i.pan.mag()) {
            var _r247 = uo(i.pan.mag(), o, t.extend({}, ro, e || {}));

            a.offset = i.pan.mult(_r247.amount / i.pan.mag()), a.center = this._map.transform.center, ho(a, _r247);
          }

          if (i.zoom) {
            var _t387 = uo(i.zoom, o, no);

            a.zoom = this._map.transform.zoom + _t387.amount, ho(a, _t387);
          }

          if (i.bearing) {
            var _e332 = uo(i.bearing, o, so);

            a.bearing = this._map.transform.bearing + t.clamp(_e332.amount, -179, 179), ho(a, _e332);
          }

          if (i.pitch) {
            var _t388 = uo(i.pitch, o, lo);

            a.pitch = this._map.transform.pitch + _t388.amount, ho(a, _t388);
          }

          if (a.zoom || a.bearing) {
            var _t389 = void 0 === i.pinchAround ? i.around : i.pinchAround;

            a.around = _t389 ? this._map.unproject(_t389) : this._map.getCenter();
          }

          return this.clear(), t.extend(a, {
            noMoveStart: !0
          });
        }
      }]);

      return co;
    }();

    function ho(t, e) {
      (!t.duration || t.duration < e.duration) && (t.duration = e.duration, t.easing = e.easing);
    }

    function uo(e, i, o) {
      var a = o.maxSpeed,
          r = o.linearity,
          n = o.deceleration,
          s = t.clamp(e * r / (i / 1e3), -a, a),
          l = Math.abs(s) / (n * r);
      return {
        easing: o.easing,
        duration: 1e3 * l,
        amount: s * (l / 2)
      };
    }

    var _o = /*#__PURE__*/function (_t$Event) {
      _inherits(_o, _t$Event);

      var _super113 = _createSuper(_o);

      _createClass(_o, [{
        key: "preventDefault",
        value: function preventDefault() {
          this._defaultPrevented = !0;
        }
      }, {
        key: "defaultPrevented",
        get: function get() {
          return this._defaultPrevented;
        }
      }]);

      function _o(e, i, o) {
        var _this109;

        var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

        _classCallCheck(this, _o);

        var n = a.mousePos(i.getCanvasContainer(), o),
            s = i.unproject(n);
        _this109 = _super113.call(this, e, t.extend({
          point: n,
          lngLat: s,
          originalEvent: o
        }, r)), _this109._defaultPrevented = !1, _this109.target = i;
        return _this109;
      }

      return _o;
    }(t.Event);

    var mo = /*#__PURE__*/function (_t$Event2) {
      _inherits(mo, _t$Event2);

      var _super114 = _createSuper(mo);

      _createClass(mo, [{
        key: "preventDefault",
        value: function preventDefault() {
          this._defaultPrevented = !0;
        }
      }, {
        key: "defaultPrevented",
        get: function get() {
          return this._defaultPrevented;
        }
      }]);

      function mo(e, i, o) {
        var _this110;

        _classCallCheck(this, mo);

        var r = "touchend" === e ? o.changedTouches : o.touches,
            n = a.touchPos(i.getCanvasContainer(), r),
            s = n.map(function (t) {
          return i.unproject(t);
        }),
            l = n.reduce(function (t, e, i, o) {
          return t.add(e.div(o.length));
        }, new t.Point(0, 0));
        _this110 = _super114.call(this, e, {
          points: n,
          point: l,
          lngLats: s,
          lngLat: i.unproject(l),
          originalEvent: o
        }), _this110._defaultPrevented = !1;
        return _this110;
      }

      return mo;
    }(t.Event);

    var po = /*#__PURE__*/function (_t$Event3) {
      _inherits(po, _t$Event3);

      var _super115 = _createSuper(po);

      _createClass(po, [{
        key: "preventDefault",
        value: function preventDefault() {
          this._defaultPrevented = !0;
        }
      }, {
        key: "defaultPrevented",
        get: function get() {
          return this._defaultPrevented;
        }
      }]);

      function po(t, e, i) {
        var _this111;

        _classCallCheck(this, po);

        _this111 = _super115.call(this, t, {
          originalEvent: i
        }), _this111._defaultPrevented = !1;
        return _this111;
      }

      return po;
    }(t.Event);

    var fo = /*#__PURE__*/function () {
      function fo(t, e) {
        _classCallCheck(this, fo);

        this._map = t, this._clickTolerance = e.clickTolerance;
      }

      _createClass(fo, [{
        key: "reset",
        value: function reset() {
          delete this._mousedownPos;
        }
      }, {
        key: "wheel",
        value: function wheel(t) {
          return this._firePreventable(new po(t.type, this._map, t));
        }
      }, {
        key: "mousedown",
        value: function mousedown(t, e) {
          return this._mousedownPos = e, this._firePreventable(new _o(t.type, this._map, t));
        }
      }, {
        key: "mouseup",
        value: function mouseup(t) {
          this._map.fire(new _o(t.type, this._map, t));
        }
      }, {
        key: "click",
        value: function click(t, e) {
          this._mousedownPos && this._mousedownPos.dist(e) >= this._clickTolerance || this._map.fire(new _o(t.type, this._map, t));
        }
      }, {
        key: "dblclick",
        value: function dblclick(t) {
          return this._firePreventable(new _o(t.type, this._map, t));
        }
      }, {
        key: "mouseover",
        value: function mouseover(t) {
          this._map.fire(new _o(t.type, this._map, t));
        }
      }, {
        key: "mouseout",
        value: function mouseout(t) {
          this._map.fire(new _o(t.type, this._map, t));
        }
      }, {
        key: "touchstart",
        value: function touchstart(t) {
          return this._firePreventable(new mo(t.type, this._map, t));
        }
      }, {
        key: "touchmove",
        value: function touchmove(t) {
          this._map.fire(new mo(t.type, this._map, t));
        }
      }, {
        key: "touchend",
        value: function touchend(t) {
          this._map.fire(new mo(t.type, this._map, t));
        }
      }, {
        key: "touchcancel",
        value: function touchcancel(t) {
          this._map.fire(new mo(t.type, this._map, t));
        }
      }, {
        key: "_firePreventable",
        value: function _firePreventable(t) {
          if (this._map.fire(t), t.defaultPrevented) return {};
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return !0;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return !1;
        }
      }, {
        key: "enable",
        value: function enable() {}
      }, {
        key: "disable",
        value: function disable() {}
      }]);

      return fo;
    }();

    var go = /*#__PURE__*/function () {
      function go(t) {
        _classCallCheck(this, go);

        this._map = t;
      }

      _createClass(go, [{
        key: "reset",
        value: function reset() {
          this._delayContextMenu = !1, delete this._contextMenuEvent;
        }
      }, {
        key: "mousemove",
        value: function mousemove(t) {
          this._map.fire(new _o(t.type, this._map, t));
        }
      }, {
        key: "mousedown",
        value: function mousedown() {
          this._delayContextMenu = !0;
        }
      }, {
        key: "mouseup",
        value: function mouseup() {
          this._delayContextMenu = !1, this._contextMenuEvent && (this._map.fire(new _o("contextmenu", this._map, this._contextMenuEvent)), delete this._contextMenuEvent);
        }
      }, {
        key: "contextmenu",
        value: function contextmenu(t) {
          this._delayContextMenu ? this._contextMenuEvent = t : this._map.fire(new _o(t.type, this._map, t)), this._map.listens("contextmenu") && t.preventDefault();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return !0;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return !1;
        }
      }, {
        key: "enable",
        value: function enable() {}
      }, {
        key: "disable",
        value: function disable() {}
      }]);

      return go;
    }();

    var vo = /*#__PURE__*/function () {
      function vo(t, e) {
        _classCallCheck(this, vo);

        this._map = t, this._el = t.getCanvasContainer(), this._container = t.getContainer(), this._clickTolerance = e.clickTolerance || 1;
      }

      _createClass(vo, [{
        key: "isEnabled",
        value: function isEnabled() {
          return !!this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return !!this._active;
        }
      }, {
        key: "enable",
        value: function enable() {
          this.isEnabled() || (this._enabled = !0);
        }
      }, {
        key: "disable",
        value: function disable() {
          this.isEnabled() && (this._enabled = !1);
        }
      }, {
        key: "mousedown",
        value: function mousedown(t, e) {
          this.isEnabled() && t.shiftKey && 0 === t.button && (a.disableDrag(), this._startPos = this._lastPos = e, this._active = !0);
        }
      }, {
        key: "mousemoveWindow",
        value: function mousemoveWindow(t, e) {
          if (!this._active) return;
          var i = e;
          if (this._lastPos.equals(i) || !this._box && i.dist(this._startPos) < this._clickTolerance) return;
          var o = this._startPos;
          this._lastPos = i, this._box || (this._box = a.create("div", "mapboxgl-boxzoom", this._container), this._container.classList.add("mapboxgl-crosshair"), this._fireEvent("boxzoomstart", t));
          var r = Math.min(o.x, i.x),
              n = Math.max(o.x, i.x),
              s = Math.min(o.y, i.y),
              l = Math.max(o.y, i.y);
          a.setTransform(this._box, "translate(".concat(r, "px,").concat(s, "px)")), this._box.style.width = "".concat(n - r, "px"), this._box.style.height = "".concat(l - s, "px");
        }
      }, {
        key: "mouseupWindow",
        value: function mouseupWindow(e, i) {
          var _this112 = this;

          if (!this._active) return;
          if (0 !== e.button) return;
          var o = this._startPos,
              r = i;
          if (this.reset(), a.suppressClick(), o.x !== r.x || o.y !== r.y) return this._map.fire(new t.Event("boxzoomend", {
            originalEvent: e
          })), {
            cameraAnimation: function cameraAnimation(t) {
              return t.fitScreenCoordinates(o, r, _this112._map.getBearing(), {
                linear: !1
              });
            }
          };

          this._fireEvent("boxzoomcancel", e);
        }
      }, {
        key: "keydown",
        value: function keydown(t) {
          this._active && 27 === t.keyCode && (this.reset(), this._fireEvent("boxzoomcancel", t));
        }
      }, {
        key: "reset",
        value: function reset() {
          this._active = !1, this._container.classList.remove("mapboxgl-crosshair"), this._box && (a.remove(this._box), this._box = null), a.enableDrag(), delete this._startPos, delete this._lastPos;
        }
      }, {
        key: "_fireEvent",
        value: function _fireEvent(e, i) {
          return this._map.fire(new t.Event(e, {
            originalEvent: i
          }));
        }
      }]);

      return vo;
    }();

    function xo(t, e) {
      var i = {};

      for (var _o113 = 0; _o113 < t.length; _o113++) {
        i[t[_o113].identifier] = e[_o113];
      }

      return i;
    }

    var yo = /*#__PURE__*/function () {
      function yo(t) {
        _classCallCheck(this, yo);

        this.reset(), this.numTouches = t.numTouches;
      }

      _createClass(yo, [{
        key: "reset",
        value: function reset() {
          delete this.centroid, delete this.startTime, delete this.touches, this.aborted = !1;
        }
      }, {
        key: "touchstart",
        value: function touchstart(e, i, o) {
          (this.centroid || o.length > this.numTouches) && (this.aborted = !0), this.aborted || (void 0 === this.startTime && (this.startTime = e.timeStamp), o.length === this.numTouches && (this.centroid = function (e) {
            var i = new t.Point(0, 0);

            var _iterator222 = _createForOfIteratorHelper(e),
                _step222;

            try {
              for (_iterator222.s(); !(_step222 = _iterator222.n()).done;) {
                var _t391 = _step222.value;

                i._add(_t391);
              }
            } catch (err) {
              _iterator222.e(err);
            } finally {
              _iterator222.f();
            }

            return i.div(e.length);
          }(i), this.touches = xo(o, i)));
        }
      }, {
        key: "touchmove",
        value: function touchmove(t, e, i) {
          if (this.aborted || !this.centroid) return;
          var o = xo(i, e);

          for (var _t392 in this.touches) {
            var _e333 = this.touches[_t392],
                _i268 = o[_t392];
            (!_i268 || _i268.dist(_e333) > 30) && (this.aborted = !0);
          }
        }
      }, {
        key: "touchend",
        value: function touchend(t, e, i) {
          if ((!this.centroid || t.timeStamp - this.startTime > 500) && (this.aborted = !0), 0 === i.length) {
            var _t393 = !this.aborted && this.centroid;

            if (this.reset(), _t393) return _t393;
          }
        }
      }]);

      return yo;
    }();

    var bo = /*#__PURE__*/function () {
      function bo(t) {
        _classCallCheck(this, bo);

        this.singleTap = new yo(t), this.numTaps = t.numTaps, this.reset();
      }

      _createClass(bo, [{
        key: "reset",
        value: function reset() {
          this.lastTime = 1 / 0, delete this.lastTap, this.count = 0, this.singleTap.reset();
        }
      }, {
        key: "touchstart",
        value: function touchstart(t, e, i) {
          this.singleTap.touchstart(t, e, i);
        }
      }, {
        key: "touchmove",
        value: function touchmove(t, e, i) {
          this.singleTap.touchmove(t, e, i);
        }
      }, {
        key: "touchend",
        value: function touchend(t, e, i) {
          var o = this.singleTap.touchend(t, e, i);

          if (o) {
            var _e334 = t.timeStamp - this.lastTime < 500,
                _i269 = !this.lastTap || this.lastTap.dist(o) < 30;

            if (_e334 && _i269 || this.reset(), this.count++, this.lastTime = t.timeStamp, this.lastTap = o, this.count === this.numTaps) return this.reset(), o;
          }
        }
      }]);

      return bo;
    }();

    var wo = /*#__PURE__*/function () {
      function wo() {
        _classCallCheck(this, wo);

        this._zoomIn = new bo({
          numTouches: 1,
          numTaps: 2
        }), this._zoomOut = new bo({
          numTouches: 2,
          numTaps: 1
        }), this.reset();
      }

      _createClass(wo, [{
        key: "reset",
        value: function reset() {
          this._active = !1, this._zoomIn.reset(), this._zoomOut.reset();
        }
      }, {
        key: "touchstart",
        value: function touchstart(t, e, i) {
          this._zoomIn.touchstart(t, e, i), this._zoomOut.touchstart(t, e, i);
        }
      }, {
        key: "touchmove",
        value: function touchmove(t, e, i) {
          this._zoomIn.touchmove(t, e, i), this._zoomOut.touchmove(t, e, i);
        }
      }, {
        key: "touchend",
        value: function touchend(t, e, i) {
          var _this113 = this;

          var o = this._zoomIn.touchend(t, e, i),
              a = this._zoomOut.touchend(t, e, i);

          return o ? (this._active = !0, t.preventDefault(), setTimeout(function () {
            return _this113.reset();
          }, 0), {
            cameraAnimation: function cameraAnimation(e) {
              return e.easeTo({
                duration: 300,
                zoom: e.getZoom() + 1,
                around: e.unproject(o)
              }, {
                originalEvent: t
              });
            }
          }) : a ? (this._active = !0, t.preventDefault(), setTimeout(function () {
            return _this113.reset();
          }, 0), {
            cameraAnimation: function cameraAnimation(e) {
              return e.easeTo({
                duration: 300,
                zoom: e.getZoom() - 1,
                around: e.unproject(a)
              }, {
                originalEvent: t
              });
            }
          }) : void 0;
        }
      }, {
        key: "touchcancel",
        value: function touchcancel() {
          this.reset();
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return wo;
    }();

    var To = {
      0: 1,
      2: 2
    };

    var Eo = /*#__PURE__*/function () {
      function Eo(t) {
        _classCallCheck(this, Eo);

        this.reset(), this._clickTolerance = t.clickTolerance || 1;
      }

      _createClass(Eo, [{
        key: "reset",
        value: function reset() {
          this._active = !1, this._moved = !1, delete this._lastPoint, delete this._eventButton;
        }
      }, {
        key: "_correctButton",
        value: function _correctButton(t, e) {
          return !1;
        }
      }, {
        key: "_move",
        value: function _move(t, e) {
          return {};
        }
      }, {
        key: "mousedown",
        value: function mousedown(t, e) {
          if (this._lastPoint) return;
          var i = a.mouseButton(t);
          this._correctButton(t, i) && (this._lastPoint = e, this._eventButton = i);
        }
      }, {
        key: "mousemoveWindow",
        value: function mousemoveWindow(t, e) {
          var i = this._lastPoint;
          if (i) if (t.preventDefault(), function (t, e) {
            var i = To[e];
            return void 0 === t.buttons || (t.buttons & i) !== i;
          }(t, this._eventButton)) this.reset();else if (this._moved || !(e.dist(i) < this._clickTolerance)) return this._moved = !0, this._lastPoint = e, this._move(i, e);
        }
      }, {
        key: "mouseupWindow",
        value: function mouseupWindow(t) {
          this._lastPoint && a.mouseButton(t) === this._eventButton && (this._moved && a.suppressClick(), this.reset());
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return Eo;
    }();

    var Co = /*#__PURE__*/function (_Eo) {
      _inherits(Co, _Eo);

      var _super116 = _createSuper(Co);

      function Co() {
        _classCallCheck(this, Co);

        return _super116.apply(this, arguments);
      }

      _createClass(Co, [{
        key: "mousedown",
        value: function mousedown(t, e) {
          _get(_getPrototypeOf(Co.prototype), "mousedown", this).call(this, t, e), this._lastPoint && (this._active = !0);
        }
      }, {
        key: "_correctButton",
        value: function _correctButton(t, e) {
          return 0 === e && !t.ctrlKey;
        }
      }, {
        key: "_move",
        value: function _move(t, e) {
          return {
            around: e,
            panDelta: e.sub(t)
          };
        }
      }]);

      return Co;
    }(Eo);

    var So = /*#__PURE__*/function (_Eo2) {
      _inherits(So, _Eo2);

      var _super117 = _createSuper(So);

      function So() {
        _classCallCheck(this, So);

        return _super117.apply(this, arguments);
      }

      _createClass(So, [{
        key: "_correctButton",
        value: function _correctButton(t, e) {
          return 0 === e && t.ctrlKey || 2 === e;
        }
      }, {
        key: "_move",
        value: function _move(t, e) {
          var i = .8 * (e.x - t.x);
          if (i) return this._active = !0, {
            bearingDelta: i
          };
        }
      }, {
        key: "contextmenu",
        value: function contextmenu(t) {
          t.preventDefault();
        }
      }]);

      return So;
    }(Eo);

    var Io = /*#__PURE__*/function (_Eo3) {
      _inherits(Io, _Eo3);

      var _super118 = _createSuper(Io);

      function Io() {
        _classCallCheck(this, Io);

        return _super118.apply(this, arguments);
      }

      _createClass(Io, [{
        key: "_correctButton",
        value: function _correctButton(t, e) {
          return 0 === e && t.ctrlKey || 2 === e;
        }
      }, {
        key: "_move",
        value: function _move(t, e) {
          var i = -.5 * (e.y - t.y);
          if (i) return this._active = !0, {
            pitchDelta: i
          };
        }
      }, {
        key: "contextmenu",
        value: function contextmenu(t) {
          t.preventDefault();
        }
      }]);

      return Io;
    }(Eo);

    var Po = /*#__PURE__*/function () {
      function Po(t) {
        _classCallCheck(this, Po);

        this._minTouches = 1, this._clickTolerance = t.clickTolerance || 1, this.reset();
      }

      _createClass(Po, [{
        key: "reset",
        value: function reset() {
          this._active = !1, this._touches = {}, this._sum = new t.Point(0, 0);
        }
      }, {
        key: "touchstart",
        value: function touchstart(t, e, i) {
          return this._calculateTransform(t, e, i);
        }
      }, {
        key: "touchmove",
        value: function touchmove(t, e, i) {
          if (this._active && !(i.length < this._minTouches)) return t.preventDefault(), this._calculateTransform(t, e, i);
        }
      }, {
        key: "touchend",
        value: function touchend(t, e, i) {
          this._calculateTransform(t, e, i), this._active && i.length < this._minTouches && this.reset();
        }
      }, {
        key: "touchcancel",
        value: function touchcancel() {
          this.reset();
        }
      }, {
        key: "_calculateTransform",
        value: function _calculateTransform(e, i, o) {
          o.length > 0 && (this._active = !0);
          var a = xo(o, i),
              r = new t.Point(0, 0),
              n = new t.Point(0, 0);
          var s = 0;

          for (var _t394 in a) {
            var _e335 = a[_t394],
                _i270 = this._touches[_t394];
            _i270 && (r._add(_e335), n._add(_e335.sub(_i270)), s++, a[_t394] = _e335);
          }

          if (this._touches = a, s < this._minTouches || !n.mag()) return;
          var l = n.div(s);
          return this._sum._add(l), this._sum.mag() < this._clickTolerance ? void 0 : {
            around: r.div(s),
            panDelta: l
          };
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return Po;
    }();

    var Mo = /*#__PURE__*/function () {
      function Mo() {
        _classCallCheck(this, Mo);

        this.reset();
      }

      _createClass(Mo, [{
        key: "reset",
        value: function reset() {
          this._active = !1, delete this._firstTwoTouches;
        }
      }, {
        key: "_start",
        value: function _start(t) {}
      }, {
        key: "_move",
        value: function _move(t, e, i) {
          return {};
        }
      }, {
        key: "touchstart",
        value: function touchstart(t, e, i) {
          this._firstTwoTouches || i.length < 2 || (this._firstTwoTouches = [i[0].identifier, i[1].identifier], this._start([e[0], e[1]]));
        }
      }, {
        key: "touchmove",
        value: function touchmove(t, e, i) {
          if (!this._firstTwoTouches) return;
          t.preventDefault();

          var _this$_firstTwoTouche = _slicedToArray(this._firstTwoTouches, 2),
              o = _this$_firstTwoTouche[0],
              a = _this$_firstTwoTouche[1],
              r = zo(i, e, o),
              n = zo(i, e, a);

          if (!r || !n) return;
          var s = this._aroundCenter ? null : r.add(n).div(2);
          return this._move([r, n], s, t);
        }
      }, {
        key: "touchend",
        value: function touchend(t, e, i) {
          if (!this._firstTwoTouches) return;

          var _this$_firstTwoTouche2 = _slicedToArray(this._firstTwoTouches, 2),
              o = _this$_firstTwoTouche2[0],
              r = _this$_firstTwoTouche2[1],
              n = zo(i, e, o),
              s = zo(i, e, r);

          n && s || (this._active && a.suppressClick(), this.reset());
        }
      }, {
        key: "touchcancel",
        value: function touchcancel() {
          this.reset();
        }
      }, {
        key: "enable",
        value: function enable(t) {
          this._enabled = !0, this._aroundCenter = !!t && "center" === t.around;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return Mo;
    }();

    function zo(t, e, i) {
      for (var _o114 = 0; _o114 < t.length; _o114++) {
        if (t[_o114].identifier === i) return e[_o114];
      }
    }

    function Ao(t, e) {
      return Math.log(t / e) / Math.LN2;
    }

    var Do = /*#__PURE__*/function (_Mo) {
      _inherits(Do, _Mo);

      var _super119 = _createSuper(Do);

      function Do() {
        _classCallCheck(this, Do);

        return _super119.apply(this, arguments);
      }

      _createClass(Do, [{
        key: "reset",
        value: function reset() {
          _get(_getPrototypeOf(Do.prototype), "reset", this).call(this), delete this._distance, delete this._startDistance;
        }
      }, {
        key: "_start",
        value: function _start(t) {
          this._startDistance = this._distance = t[0].dist(t[1]);
        }
      }, {
        key: "_move",
        value: function _move(t, e) {
          var i = this._distance;
          if (this._distance = t[0].dist(t[1]), this._active || !(Math.abs(Ao(this._distance, this._startDistance)) < .1)) return this._active = !0, {
            zoomDelta: Ao(this._distance, i),
            pinchAround: e
          };
        }
      }]);

      return Do;
    }(Mo);

    function Lo(t, e) {
      return 180 * t.angleWith(e) / Math.PI;
    }

    var Ro = /*#__PURE__*/function (_Mo2) {
      _inherits(Ro, _Mo2);

      var _super120 = _createSuper(Ro);

      function Ro() {
        _classCallCheck(this, Ro);

        return _super120.apply(this, arguments);
      }

      _createClass(Ro, [{
        key: "reset",
        value: function reset() {
          _get(_getPrototypeOf(Ro.prototype), "reset", this).call(this), delete this._minDiameter, delete this._startVector, delete this._vector;
        }
      }, {
        key: "_start",
        value: function _start(t) {
          this._startVector = this._vector = t[0].sub(t[1]), this._minDiameter = t[0].dist(t[1]);
        }
      }, {
        key: "_move",
        value: function _move(t, e) {
          var i = this._vector;
          if (this._vector = t[0].sub(t[1]), this._active || !this._isBelowThreshold(this._vector)) return this._active = !0, {
            bearingDelta: Lo(this._vector, i),
            pinchAround: e
          };
        }
      }, {
        key: "_isBelowThreshold",
        value: function _isBelowThreshold(t) {
          this._minDiameter = Math.min(this._minDiameter, t.mag());
          var e = 25 / (Math.PI * this._minDiameter) * 360,
              i = Lo(t, this._startVector);
          return Math.abs(i) < e;
        }
      }]);

      return Ro;
    }(Mo);

    function ko(t) {
      return Math.abs(t.y) > Math.abs(t.x);
    }

    var Bo = /*#__PURE__*/function (_Mo3) {
      _inherits(Bo, _Mo3);

      var _super121 = _createSuper(Bo);

      function Bo() {
        _classCallCheck(this, Bo);

        return _super121.apply(this, arguments);
      }

      _createClass(Bo, [{
        key: "reset",
        value: function reset() {
          _get(_getPrototypeOf(Bo.prototype), "reset", this).call(this), this._valid = void 0, delete this._firstMove, delete this._lastPoints;
        }
      }, {
        key: "_start",
        value: function _start(t) {
          this._lastPoints = t, ko(t[0].sub(t[1])) && (this._valid = !1);
        }
      }, {
        key: "_move",
        value: function _move(t, e, i) {
          var o = t[0].sub(this._lastPoints[0]),
              a = t[1].sub(this._lastPoints[1]);
          if (this._valid = this.gestureBeginsVertically(o, a, i.timeStamp), this._valid) return this._lastPoints = t, this._active = !0, {
            pitchDelta: (o.y + a.y) / 2 * -.5
          };
        }
      }, {
        key: "gestureBeginsVertically",
        value: function gestureBeginsVertically(t, e, i) {
          if (void 0 !== this._valid) return this._valid;
          var o = t.mag() >= 2,
              a = e.mag() >= 2;
          if (!o && !a) return;
          if (!o || !a) return void 0 === this._firstMove && (this._firstMove = i), i - this._firstMove < 100 && void 0;
          var r = t.y > 0 == e.y > 0;
          return ko(t) && ko(e) && r;
        }
      }]);

      return Bo;
    }(Mo);

    var Oo = {
      panStep: 100,
      bearingStep: 15,
      pitchStep: 10
    };

    var Fo = /*#__PURE__*/function () {
      function Fo() {
        _classCallCheck(this, Fo);

        var t = Oo;
        this._panStep = t.panStep, this._bearingStep = t.bearingStep, this._pitchStep = t.pitchStep, this._rotationDisabled = !1;
      }

      _createClass(Fo, [{
        key: "reset",
        value: function reset() {
          this._active = !1;
        }
      }, {
        key: "keydown",
        value: function keydown(t) {
          var _this114 = this;

          if (t.altKey || t.ctrlKey || t.metaKey) return;
          var e = 0,
              i = 0,
              o = 0,
              a = 0,
              r = 0;

          switch (t.keyCode) {
            case 61:
            case 107:
            case 171:
            case 187:
              e = 1;
              break;

            case 189:
            case 109:
            case 173:
              e = -1;
              break;

            case 37:
              t.shiftKey ? i = -1 : (t.preventDefault(), a = -1);
              break;

            case 39:
              t.shiftKey ? i = 1 : (t.preventDefault(), a = 1);
              break;

            case 38:
              t.shiftKey ? o = 1 : (t.preventDefault(), r = -1);
              break;

            case 40:
              t.shiftKey ? o = -1 : (t.preventDefault(), r = 1);
              break;

            default:
              return;
          }

          return this._rotationDisabled && (i = 0, o = 0), {
            cameraAnimation: function cameraAnimation(n) {
              var s = n.getZoom();
              n.easeTo({
                duration: 300,
                easeId: "keyboardHandler",
                easing: Uo,
                zoom: e ? Math.round(s) + e * (t.shiftKey ? 2 : 1) : s,
                bearing: n.getBearing() + i * _this114._bearingStep,
                pitch: n.getPitch() + o * _this114._pitchStep,
                offset: [-a * _this114._panStep, -r * _this114._panStep],
                center: n.getCenter()
              }, {
                originalEvent: t
              });
            }
          };
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }, {
        key: "disableRotation",
        value: function disableRotation() {
          this._rotationDisabled = !0;
        }
      }, {
        key: "enableRotation",
        value: function enableRotation() {
          this._rotationDisabled = !1;
        }
      }]);

      return Fo;
    }();

    function Uo(t) {
      return t * (2 - t);
    }

    var No = /*#__PURE__*/function () {
      function No(e, i) {
        _classCallCheck(this, No);

        this._map = e, this._el = e.getCanvasContainer(), this._handler = i, this._delta = 0, this._defaultZoomRate = .01, this._wheelZoomRate = 1 / 450, t.bindAll(["_onTimeout"], this);
      }

      _createClass(No, [{
        key: "setZoomRate",
        value: function setZoomRate(t) {
          this._defaultZoomRate = t;
        }
      }, {
        key: "setWheelZoomRate",
        value: function setWheelZoomRate(t) {
          this._wheelZoomRate = t;
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return !!this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return !!this._active || void 0 !== this._finishTimeout;
        }
      }, {
        key: "isZooming",
        value: function isZooming() {
          return !!this._zooming;
        }
      }, {
        key: "enable",
        value: function enable(t) {
          this.isEnabled() || (this._enabled = !0, this._aroundCenter = t && "center" === t.around);
        }
      }, {
        key: "disable",
        value: function disable() {
          this.isEnabled() && (this._enabled = !1);
        }
      }, {
        key: "wheel",
        value: function wheel(e) {
          if (!this.isEnabled()) return;
          var i = e.deltaMode === t.window.WheelEvent.DOM_DELTA_LINE ? 40 * e.deltaY : e.deltaY;
          var o = t.browser.now(),
              a = o - (this._lastWheelEventTime || 0);
          this._lastWheelEventTime = o, 0 !== i && i % 4.000244140625 == 0 ? this._type = "wheel" : 0 !== i && Math.abs(i) < 4 ? this._type = "trackpad" : a > 400 ? (this._type = null, this._lastValue = i, this._timeout = setTimeout(this._onTimeout, 40, e)) : this._type || (this._type = Math.abs(a * i) < 200 ? "trackpad" : "wheel", this._timeout && (clearTimeout(this._timeout), this._timeout = null, i += this._lastValue)), e.shiftKey && i && (i /= 4), this._type && (this._lastWheelEvent = e, this._delta -= i, this._active || this._start(e)), e.preventDefault();
        }
      }, {
        key: "_onTimeout",
        value: function _onTimeout(t) {
          this._type = "wheel", this._delta -= this._lastValue, this._active || this._start(t);
        }
      }, {
        key: "_start",
        value: function _start(t) {
          if (!this._delta) return;
          this._frameId && (this._frameId = null), this._active = !0, this.isZooming() || (this._zooming = !0), this._finishTimeout && (clearTimeout(this._finishTimeout), delete this._finishTimeout);
          var e = a.mousePos(this._el, t);
          this._aroundPoint = this._aroundCenter ? this._map.transform.centerPoint : e, this._aroundCoord = this._map.transform.pointCoordinate3D(this._aroundPoint), this._targetZoom = void 0, this._frameId || (this._frameId = !0, this._handler._triggerRenderFrame());
        }
      }, {
        key: "renderFrame",
        value: function renderFrame() {
          var _this115 = this;

          if (!this._frameId) return;
          if (this._frameId = null, !this.isActive()) return;

          var e = this._map.transform,
              i = function i() {
            return e._terrainEnabled() ? e.computeZoomRelativeTo(_this115._aroundCoord) : e.zoom;
          };

          if (0 !== this._delta) {
            var _t395 = "wheel" === this._type && Math.abs(this._delta) > 4.000244140625 ? this._wheelZoomRate : this._defaultZoomRate;

            var _o115 = 2 / (1 + Math.exp(-Math.abs(this._delta * _t395)));

            this._delta < 0 && 0 !== _o115 && (_o115 = 1 / _o115);

            var _a150 = i(),
                _r248 = Math.pow(2, _a150),
                _n155 = "number" == typeof this._targetZoom ? e.zoomScale(this._targetZoom) : _r248;

            this._targetZoom = Math.min(e.maxZoom, Math.max(e.minZoom, e.scaleZoom(_n155 * _o115))), "wheel" === this._type && (this._startZoom = i(), this._easing = this._smoothOutEasing(200)), this._delta = 0;
          }

          var o = "number" == typeof this._targetZoom ? this._targetZoom : i(),
              a = this._startZoom,
              r = this._easing;
          var n,
              s = !1;

          if ("wheel" === this._type && a && r) {
            var _e336 = Math.min((t.browser.now() - this._lastWheelEventTime) / 200, 1),
                _i271 = r(_e336);

            n = t.number(a, o, _i271), _e336 < 1 ? this._frameId || (this._frameId = !0) : s = !0;
          } else n = o, s = !0;

          return this._active = !0, s && (this._active = !1, this._finishTimeout = setTimeout(function () {
            _this115._zooming = !1, _this115._handler._triggerRenderFrame(), delete _this115._targetZoom, delete _this115._finishTimeout;
          }, 200)), {
            noInertia: !0,
            needsRenderFrame: !s,
            zoomDelta: n - i(),
            around: this._aroundPoint,
            aroundCoord: this._aroundCoord,
            originalEvent: this._lastWheelEvent
          };
        }
      }, {
        key: "_smoothOutEasing",
        value: function _smoothOutEasing(e) {
          var i = t.ease;

          if (this._prevEase) {
            var _e337 = this._prevEase,
                _o116 = (t.browser.now() - _e337.start) / _e337.duration,
                _a151 = _e337.easing(_o116 + .01) - _e337.easing(_o116),
                _r249 = .27 / Math.sqrt(_a151 * _a151 + 1e-4) * .01,
                _n156 = Math.sqrt(.0729 - _r249 * _r249);

            i = t.bezier(_r249, _n156, .25, 1);
          }

          return this._prevEase = {
            start: t.browser.now(),
            duration: e,
            easing: i
          }, i;
        }
      }, {
        key: "reset",
        value: function reset() {
          this._active = !1;
        }
      }]);

      return No;
    }();

    var Zo = /*#__PURE__*/function () {
      function Zo(t, e) {
        _classCallCheck(this, Zo);

        this._clickZoom = t, this._tapZoom = e;
      }

      _createClass(Zo, [{
        key: "enable",
        value: function enable() {
          this._clickZoom.enable(), this._tapZoom.enable();
        }
      }, {
        key: "disable",
        value: function disable() {
          this._clickZoom.disable(), this._tapZoom.disable();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._clickZoom.isEnabled() && this._tapZoom.isEnabled();
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._clickZoom.isActive() || this._tapZoom.isActive();
        }
      }]);

      return Zo;
    }();

    var Go = /*#__PURE__*/function () {
      function Go() {
        _classCallCheck(this, Go);

        this.reset();
      }

      _createClass(Go, [{
        key: "reset",
        value: function reset() {
          this._active = !1;
        }
      }, {
        key: "dblclick",
        value: function dblclick(t, e) {
          return t.preventDefault(), {
            cameraAnimation: function cameraAnimation(i) {
              i.easeTo({
                duration: 300,
                zoom: i.getZoom() + (t.shiftKey ? -1 : 1),
                around: i.unproject(e)
              }, {
                originalEvent: t
              });
            }
          };
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return Go;
    }();

    var qo = /*#__PURE__*/function () {
      function qo() {
        _classCallCheck(this, qo);

        this._tap = new bo({
          numTouches: 1,
          numTaps: 1
        }), this.reset();
      }

      _createClass(qo, [{
        key: "reset",
        value: function reset() {
          this._active = !1, delete this._swipePoint, delete this._swipeTouch, delete this._tapTime, this._tap.reset();
        }
      }, {
        key: "touchstart",
        value: function touchstart(t, e, i) {
          this._swipePoint || (this._tapTime && t.timeStamp - this._tapTime > 500 && this.reset(), this._tapTime ? i.length > 0 && (this._swipePoint = e[0], this._swipeTouch = i[0].identifier) : this._tap.touchstart(t, e, i));
        }
      }, {
        key: "touchmove",
        value: function touchmove(t, e, i) {
          if (this._tapTime) {
            if (this._swipePoint) {
              if (i[0].identifier !== this._swipeTouch) return;

              var _o117 = e[0],
                  _a152 = _o117.y - this._swipePoint.y;

              return this._swipePoint = _o117, t.preventDefault(), this._active = !0, {
                zoomDelta: _a152 / 128
              };
            }
          } else this._tap.touchmove(t, e, i);
        }
      }, {
        key: "touchend",
        value: function touchend(t, e, i) {
          this._tapTime ? this._swipePoint && 0 === i.length && this.reset() : this._tap.touchend(t, e, i) && (this._tapTime = t.timeStamp);
        }
      }, {
        key: "touchcancel",
        value: function touchcancel() {
          this.reset();
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return qo;
    }();

    var Vo = /*#__PURE__*/function () {
      function Vo(t, e, i) {
        _classCallCheck(this, Vo);

        this._el = t, this._mousePan = e, this._touchPan = i;
      }

      _createClass(Vo, [{
        key: "enable",
        value: function enable(t) {
          this._inertiaOptions = t || {}, this._mousePan.enable(), this._touchPan.enable(), this._el.classList.add("mapboxgl-touch-drag-pan");
        }
      }, {
        key: "disable",
        value: function disable() {
          this._mousePan.disable(), this._touchPan.disable(), this._el.classList.remove("mapboxgl-touch-drag-pan");
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._mousePan.isEnabled() && this._touchPan.isEnabled();
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._mousePan.isActive() || this._touchPan.isActive();
        }
      }]);

      return Vo;
    }();

    var $o = /*#__PURE__*/function () {
      function $o(t, e, i) {
        _classCallCheck(this, $o);

        this._pitchWithRotate = t.pitchWithRotate, this._mouseRotate = e, this._mousePitch = i;
      }

      _createClass($o, [{
        key: "enable",
        value: function enable() {
          this._mouseRotate.enable(), this._pitchWithRotate && this._mousePitch.enable();
        }
      }, {
        key: "disable",
        value: function disable() {
          this._mouseRotate.disable(), this._mousePitch.disable();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._mouseRotate.isEnabled() && (!this._pitchWithRotate || this._mousePitch.isEnabled());
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._mouseRotate.isActive() || this._mousePitch.isActive();
        }
      }]);

      return $o;
    }();

    var jo = /*#__PURE__*/function () {
      function jo(t, e, i, o) {
        _classCallCheck(this, jo);

        this._el = t, this._touchZoom = e, this._touchRotate = i, this._tapDragZoom = o, this._rotationDisabled = !1, this._enabled = !0;
      }

      _createClass(jo, [{
        key: "enable",
        value: function enable(t) {
          this._touchZoom.enable(t), this._rotationDisabled || this._touchRotate.enable(t), this._tapDragZoom.enable(), this._el.classList.add("mapboxgl-touch-zoom-rotate");
        }
      }, {
        key: "disable",
        value: function disable() {
          this._touchZoom.disable(), this._touchRotate.disable(), this._tapDragZoom.disable(), this._el.classList.remove("mapboxgl-touch-zoom-rotate");
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._touchZoom.isEnabled() && (this._rotationDisabled || this._touchRotate.isEnabled()) && this._tapDragZoom.isEnabled();
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._touchZoom.isActive() || this._touchRotate.isActive() || this._tapDragZoom.isActive();
        }
      }, {
        key: "disableRotation",
        value: function disableRotation() {
          this._rotationDisabled = !0, this._touchRotate.disable();
        }
      }, {
        key: "enableRotation",
        value: function enableRotation() {
          this._rotationDisabled = !1, this._touchZoom.isEnabled() && this._touchRotate.enable();
        }
      }]);

      return jo;
    }();

    var Wo = function Wo(t) {
      return t.zoom || t.drag || t.pitch || t.rotate;
    };

    var Xo = /*#__PURE__*/function (_t$Event4) {
      _inherits(Xo, _t$Event4);

      var _super122 = _createSuper(Xo);

      function Xo() {
        _classCallCheck(this, Xo);

        return _super122.apply(this, arguments);
      }

      return Xo;
    }(t.Event);

    var Ho = /*#__PURE__*/function () {
      function Ho() {
        _classCallCheck(this, Ho);

        this.constants = [1, 1, .01], this.radius = 0;
      }

      _createClass(Ho, [{
        key: "setup",
        value: function setup(e, i) {
          var o = t.sub([], i, e);
          this.radius = t.length(o[2] < 0 ? t.div([], o, this.constants) : [o[0], o[1], 0]);
        }
      }, {
        key: "projectRay",
        value: function projectRay(e) {
          t.div(e, e, this.constants), t.normalize(e, e), t.mul$1(e, e, this.constants);
          var i = t.scale$2([], e, this.radius);

          if (i[2] > 0) {
            var _e338 = t.scale$2([], [0, 0, 1], t.dot(i, [0, 0, 1])),
                _o118 = t.scale$2([], t.normalize([], [i[0], i[1], 0]), this.radius),
                _a153 = t.add([], i, t.scale$2([], t.sub([], t.add([], _o118, _e338), i), 2));

            i[0] = _a153[0], i[1] = _a153[1];
          }

          return i;
        }
      }]);

      return Ho;
    }();

    function Ko(t) {
      return t.panDelta && t.panDelta.mag() || t.zoomDelta || t.bearingDelta || t.pitchDelta;
    }

    var Yo = /*#__PURE__*/function () {
      function Yo(e, i) {
        _classCallCheck(this, Yo);

        this._map = e, this._el = this._map.getCanvasContainer(), this._handlers = [], this._handlersById = {}, this._changes = [], this._inertia = new co(e), this._bearingSnap = i.bearingSnap, this._previousActiveHandlers = {}, this._trackingEllipsoid = new Ho(), this._dragOrigin = null, this._eventsInProgress = {}, this._addDefaultHandlers(i), t.bindAll(["handleEvent", "handleWindowEvent"], this);
        var o = this._el;
        this._listeners = [[o, "touchstart", {
          passive: !0
        }], [o, "touchmove", {
          passive: !1
        }], [o, "touchend", void 0], [o, "touchcancel", void 0], [o, "mousedown", void 0], [o, "mousemove", void 0], [o, "mouseup", void 0], [t.window.document, "mousemove", {
          capture: !0
        }], [t.window.document, "mouseup", void 0], [o, "mouseover", void 0], [o, "mouseout", void 0], [o, "dblclick", void 0], [o, "click", void 0], [o, "keydown", {
          capture: !1
        }], [o, "keyup", void 0], [o, "wheel", {
          passive: !1
        }], [o, "contextmenu", void 0], [t.window, "blur", void 0]];

        var _iterator223 = _createForOfIteratorHelper(this._listeners),
            _step223;

        try {
          for (_iterator223.s(); !(_step223 = _iterator223.n()).done;) {
            var _ref179 = _step223.value;

            var _ref178 = _slicedToArray(_ref179, 3);

            var _e339 = _ref178[0];
            var _i272 = _ref178[1];
            var _o119 = _ref178[2];
            a.addEventListener(_e339, _i272, _e339 === t.window.document ? this.handleWindowEvent : this.handleEvent, _o119);
          }
        } catch (err) {
          _iterator223.e(err);
        } finally {
          _iterator223.f();
        }
      }

      _createClass(Yo, [{
        key: "destroy",
        value: function destroy() {
          var _iterator224 = _createForOfIteratorHelper(this._listeners),
              _step224;

          try {
            for (_iterator224.s(); !(_step224 = _iterator224.n()).done;) {
              var _ref182 = _step224.value;

              var _ref181 = _slicedToArray(_ref182, 3);

              var _e340 = _ref181[0];
              var _i273 = _ref181[1];
              var _o120 = _ref181[2];
              a.removeEventListener(_e340, _i273, _e340 === t.window.document ? this.handleWindowEvent : this.handleEvent, _o120);
            }
          } catch (err) {
            _iterator224.e(err);
          } finally {
            _iterator224.f();
          }
        }
      }, {
        key: "_addDefaultHandlers",
        value: function _addDefaultHandlers(t) {
          var e = this._map,
              i = e.getCanvasContainer();

          this._add("mapEvent", new fo(e, t));

          var o = e.boxZoom = new vo(e, t);

          this._add("boxZoom", o);

          var a = new wo(),
              r = new Go();
          e.doubleClickZoom = new Zo(r, a), this._add("tapZoom", a), this._add("clickZoom", r);
          var n = new qo();

          this._add("tapDragZoom", n);

          var s = e.touchPitch = new Bo();

          this._add("touchPitch", s);

          var l = new So(t),
              c = new Io(t);
          e.dragRotate = new $o(t, l, c), this._add("mouseRotate", l, ["mousePitch"]), this._add("mousePitch", c, ["mouseRotate"]);
          var h = new Co(t),
              u = new Po(t);
          e.dragPan = new Vo(i, h, u), this._add("mousePan", h), this._add("touchPan", u, ["touchZoom", "touchRotate"]);

          var d = new Ro(),
              _ = new Do();

          e.touchZoomRotate = new jo(i, _, d, n), this._add("touchRotate", d, ["touchPan", "touchZoom"]), this._add("touchZoom", _, ["touchPan", "touchRotate"]), this._add("blockableMapEvent", new go(e));
          var m = e.scrollZoom = new No(e, this);

          this._add("scrollZoom", m, ["mousePan"]);

          var p = e.keyboard = new Fo();

          this._add("keyboard", p);

          for (var _i274 = 0, _arr4 = ["boxZoom", "doubleClickZoom", "tapDragZoom", "touchPitch", "dragRotate", "dragPan", "touchZoomRotate", "scrollZoom", "keyboard"]; _i274 < _arr4.length; _i274++) {
            var _i275 = _arr4[_i274];
            t.interactive && t[_i275] && e[_i275].enable(t[_i275]);
          }
        }
      }, {
        key: "_add",
        value: function _add(t, e, i) {
          this._handlers.push({
            handlerName: t,
            handler: e,
            allowed: i
          }), this._handlersById[t] = e;
        }
      }, {
        key: "stop",
        value: function stop(t) {
          if (!this._updatingCamera) {
            var _iterator225 = _createForOfIteratorHelper(this._handlers),
                _step225;

            try {
              for (_iterator225.s(); !(_step225 = _iterator225.n()).done;) {
                var _ref184 = _step225.value;
                var _t396 = _ref184.handler;

                _t396.reset();
              }
            } catch (err) {
              _iterator225.e(err);
            } finally {
              _iterator225.f();
            }

            this._inertia.clear(), this._fireEvents({}, {}, t), this._changes = [];
          }
        }
      }, {
        key: "isActive",
        value: function isActive() {
          var _iterator226 = _createForOfIteratorHelper(this._handlers),
              _step226;

          try {
            for (_iterator226.s(); !(_step226 = _iterator226.n()).done;) {
              var _ref186 = _step226.value;
              var _t397 = _ref186.handler;
              if (_t397.isActive()) return !0;
            }
          } catch (err) {
            _iterator226.e(err);
          } finally {
            _iterator226.f();
          }

          return !1;
        }
      }, {
        key: "isZooming",
        value: function isZooming() {
          return !!this._eventsInProgress.zoom || this._map.scrollZoom.isZooming();
        }
      }, {
        key: "isRotating",
        value: function isRotating() {
          return !!this._eventsInProgress.rotate;
        }
      }, {
        key: "isMoving",
        value: function isMoving() {
          return Boolean(Wo(this._eventsInProgress)) || this.isZooming();
        }
      }, {
        key: "_blockedByActive",
        value: function _blockedByActive(t, e, i) {
          for (var _o121 in t) {
            if (_o121 !== i && (!e || e.indexOf(_o121) < 0)) return !0;
          }

          return !1;
        }
      }, {
        key: "handleWindowEvent",
        value: function handleWindowEvent(t) {
          this.handleEvent(t, "".concat(t.type, "Window"));
        }
      }, {
        key: "_getMapTouches",
        value: function _getMapTouches(t) {
          var e = [];

          var _iterator227 = _createForOfIteratorHelper(t),
              _step227;

          try {
            for (_iterator227.s(); !(_step227 = _iterator227.n()).done;) {
              var _i276 = _step227.value;
              this._el.contains(_i276.target) && e.push(_i276);
            }
          } catch (err) {
            _iterator227.e(err);
          } finally {
            _iterator227.f();
          }

          return e;
        }
      }, {
        key: "handleEvent",
        value: function handleEvent(t, e) {
          if ("blur" === t.type) return void this.stop(!0);
          this._updatingCamera = !0;
          var i = "renderFrame" === t.type ? void 0 : t,
              o = {
            needsRenderFrame: !1
          },
              r = {},
              n = {},
              s = t.touches ? this._getMapTouches(t.touches) : void 0,
              l = s ? a.touchPos(this._el, s) : a.mousePos(this._el, t);

          var _iterator228 = _createForOfIteratorHelper(this._handlers),
              _step228;

          try {
            for (_iterator228.s(); !(_step228 = _iterator228.n()).done;) {
              var _ref188 = _step228.value;
              var _a154 = _ref188.handlerName;
              var _c40 = _ref188.handler;
              var _h30 = _ref188.allowed;
              if (!_c40.isEnabled()) continue;

              var _u44 = void 0;

              this._blockedByActive(n, _h30, _a154) ? _c40.reset() : _c40[e || t.type] && (_u44 = _c40[e || t.type](t, l, s), this.mergeHandlerResult(o, r, _u44, _a154, i), _u44 && _u44.needsRenderFrame && this._triggerRenderFrame()), (_u44 || _c40.isActive()) && (n[_a154] = _c40);
            }
          } catch (err) {
            _iterator228.e(err);
          } finally {
            _iterator228.f();
          }

          var c = {};

          for (var _t398 in this._previousActiveHandlers) {
            n[_t398] || (c[_t398] = i);
          }

          this._previousActiveHandlers = n, (Object.keys(c).length || Ko(o)) && (this._changes.push([o, r, c]), this._triggerRenderFrame()), (Object.keys(n).length || Ko(o)) && this._map._stop(!0), this._updatingCamera = !1;
          var h = o.cameraAnimation;
          h && (this._inertia.clear(), this._fireEvents({}, {}, !0), this._changes = [], h(this._map));
        }
      }, {
        key: "mergeHandlerResult",
        value: function mergeHandlerResult(e, i, o, a, r) {
          if (!o) return;
          t.extend(e, o);
          var n = {
            handlerName: a,
            originalEvent: o.originalEvent || r
          };
          void 0 !== o.zoomDelta && (i.zoom = n), void 0 !== o.panDelta && (i.drag = n), void 0 !== o.pitchDelta && (i.pitch = n), void 0 !== o.bearingDelta && (i.rotate = n);
        }
      }, {
        key: "_applyChanges",
        value: function _applyChanges() {
          var e = {},
              i = {},
              o = {};

          var _iterator229 = _createForOfIteratorHelper(this._changes),
              _step229;

          try {
            for (_iterator229.s(); !(_step229 = _iterator229.n()).done;) {
              var _ref191 = _step229.value;

              var _ref190 = _slicedToArray(_ref191, 3);

              var _a155 = _ref190[0];
              var _r250 = _ref190[1];
              var _n157 = _ref190[2];
              _a155.panDelta && (e.panDelta = (e.panDelta || new t.Point(0, 0))._add(_a155.panDelta)), _a155.zoomDelta && (e.zoomDelta = (e.zoomDelta || 0) + _a155.zoomDelta), _a155.bearingDelta && (e.bearingDelta = (e.bearingDelta || 0) + _a155.bearingDelta), _a155.pitchDelta && (e.pitchDelta = (e.pitchDelta || 0) + _a155.pitchDelta), void 0 !== _a155.around && (e.around = _a155.around), void 0 !== _a155.aroundCoord && (e.aroundCoord = _a155.aroundCoord), void 0 !== _a155.pinchAround && (e.pinchAround = _a155.pinchAround), _a155.noInertia && (e.noInertia = _a155.noInertia), t.extend(i, _r250), t.extend(o, _n157);
            }
          } catch (err) {
            _iterator229.e(err);
          } finally {
            _iterator229.f();
          }

          this._updateMapTransform(e, i, o), this._changes = [];
        }
      }, {
        key: "_updateMapTransform",
        value: function _updateMapTransform(e, i, o) {
          var _this116 = this;

          var a = this._map,
              r = a.transform,
              n = function n(t) {
            return [t.x, t.y, t.z];
          };

          if (function (t) {
            var e = _this116._eventsInProgress.drag;
            return e && !_this116._handlersById[e.handlerName].isActive();
          }() && !Ko(e)) {
            var _t399 = r.zoom;
            r.cameraElevationReference = "sea", r.recenterOnTerrain(), r.cameraElevationReference = "ground", _t399 !== r.zoom && this._map._update(!0);
          }

          if (!Ko(e)) return this._fireEvents(i, o, !0);
          var s = e.panDelta,
              l = e.zoomDelta,
              c = e.bearingDelta,
              h = e.pitchDelta,
              u = e.around,
              d = e.aroundCoord,
              _ = e.pinchAround;
          void 0 !== _ && (u = _), function (t) {
            return i.drag && !_this116._eventsInProgress.drag;
          }() && u && (this._dragOrigin = n(r.pointCoordinate3D(u)), this._trackingEllipsoid.setup(r._camera.position, this._dragOrigin)), r.cameraElevationReference = "sea", a._stop(!0), u = u || a.transform.centerPoint, c && (r.bearing += c), h && (r.pitch += h), r._updateCameraState();
          var m = [0, 0, 0];

          if (s) {
            var _t400 = r.screenPointToMercatorRay(u),
                _e341 = r.screenPointToMercatorRay(u.sub(s)),
                _i277 = this._trackingEllipsoid.projectRay(_t400.dir),
                _o122 = this._trackingEllipsoid.projectRay(_e341.dir);

            m[0] = _o122[0] - _i277[0], m[1] = _o122[1] - _i277[1];
          }

          var p = r.zoom,
              f = [0, 0, 0];

          if (l) {
            var _e342 = n(d || r.pointCoordinate3D(u)),
                _i278 = {
              dir: t.normalize([], t.sub([], _e342, r._camera.position))
            },
                _o123 = r.screenPointToMercatorRay(r.centerPoint);

            if (_i278.dir[2] < 0) {
              var _a156 = t.altitudeFromMercatorZ(_e342[2], _e342[1]),
                  _s124 = r.rayIntersectionCoordinate(r.pointRayIntersection(r.centerPoint, _a156)),
                  _c41 = r.zoomDeltaToMovement(n(_s124), l) * (_o123.dir[2] / _i278.dir[2]);

              t.scale$2(f, _i278.dir, _c41);
            } else if (r._terrainEnabled()) {
              var _o124 = r.zoomDeltaToMovement(_e342, l);

              t.scale$2(f, _i278.dir, _o124);
            }
          }

          var g = t.add(m, m, f);
          r._translateCameraConstrained(g), l && Math.abs(r.zoom - p) > 1e-4 && r.recenterOnTerrain(), r.cameraElevationReference = "ground", this._map._update(), e.noInertia || this._inertia.record(e), this._fireEvents(i, o, !0);
        }
      }, {
        key: "_fireEvents",
        value: function _fireEvents(e, i, o) {
          var _this117 = this;

          var a = Wo(this._eventsInProgress),
              r = Wo(e),
              n = {};

          for (var _t401 in e) {
            var _i279 = e[_t401].originalEvent;
            this._eventsInProgress[_t401] || (n["".concat(_t401, "start")] = _i279), this._eventsInProgress[_t401] = e[_t401];
          }

          !a && r && this._fireEvent("movestart", r.originalEvent);

          for (var _t402 in n) {
            this._fireEvent(_t402, n[_t402]);
          }

          r && this._fireEvent("move", r.originalEvent);

          for (var _t403 in e) {
            var _i280 = e[_t403].originalEvent;

            this._fireEvent(_t403, _i280);
          }

          var s = {};
          var l;

          for (var _t404 in this._eventsInProgress) {
            var _this$_eventsInProgre = this._eventsInProgress[_t404],
                _e343 = _this$_eventsInProgre.handlerName,
                _o125 = _this$_eventsInProgre.originalEvent;
            this._handlersById[_e343].isActive() || (delete this._eventsInProgress[_t404], l = i[_e343] || _o125, s["".concat(_t404, "end")] = l);
          }

          for (var _t405 in s) {
            this._fireEvent(_t405, s[_t405]);
          }

          var c = Wo(this._eventsInProgress);

          if (o && (a || r) && !c) {
            this._updatingCamera = !0;

            var _e344 = this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),
                _i281 = function _i281(t) {
              return 0 !== t && -_this117._bearingSnap < t && t < _this117._bearingSnap;
            };

            _e344 ? (_i281(_e344.bearing || this._map.getBearing()) && (_e344.bearing = 0), this._map.easeTo(_e344, {
              originalEvent: l
            })) : (this._map.fire(new t.Event("moveend", {
              originalEvent: l
            })), _i281(this._map.getBearing()) && this._map.resetNorth()), this._updatingCamera = !1;
          }
        }
      }, {
        key: "_fireEvent",
        value: function _fireEvent(e, i) {
          this._map.fire(new t.Event(e, i ? {
            originalEvent: i
          } : {}));
        }
      }, {
        key: "_requestFrame",
        value: function _requestFrame() {
          var _this118 = this;

          return this._map.triggerRepaint(), this._map._renderTaskQueue.add(function (t) {
            delete _this118._frameId, _this118.handleEvent(new Xo("renderFrame", {
              timeStamp: t
            })), _this118._applyChanges();
          });
        }
      }, {
        key: "_triggerRenderFrame",
        value: function _triggerRenderFrame() {
          void 0 === this._frameId && (this._frameId = this._requestFrame());
        }
      }]);

      return Yo;
    }();

    var Jo = /*#__PURE__*/function (_t$Evented9) {
      _inherits(Jo, _t$Evented9);

      var _super123 = _createSuper(Jo);

      function Jo(e, i) {
        var _this119;

        _classCallCheck(this, Jo);

        _this119 = _super123.call(this), _this119._moving = !1, _this119._zooming = !1, _this119.transform = e, _this119._bearingSnap = i.bearingSnap, t.bindAll(["_renderFrameCallback"], _assertThisInitialized(_this119));
        return _this119;
      }

      _createClass(Jo, [{
        key: "getCenter",
        value: function getCenter() {
          return new t.LngLat(this.transform.center.lng, this.transform.center.lat);
        }
      }, {
        key: "setCenter",
        value: function setCenter(t, e) {
          return this.jumpTo({
            center: t
          }, e);
        }
      }, {
        key: "panBy",
        value: function panBy(e, i, o) {
          return e = t.Point.convert(e).mult(-1), this.panTo(this.transform.center, t.extend({
            offset: e
          }, i), o);
        }
      }, {
        key: "panTo",
        value: function panTo(e, i, o) {
          return this.easeTo(t.extend({
            center: e
          }, i), o);
        }
      }, {
        key: "getZoom",
        value: function getZoom() {
          return this.transform.zoom;
        }
      }, {
        key: "setZoom",
        value: function setZoom(t, e) {
          return this.jumpTo({
            zoom: t
          }, e), this;
        }
      }, {
        key: "zoomTo",
        value: function zoomTo(e, i, o) {
          return this.easeTo(t.extend({
            zoom: e
          }, i), o);
        }
      }, {
        key: "zoomIn",
        value: function zoomIn(t, e) {
          return this.zoomTo(this.getZoom() + 1, t, e), this;
        }
      }, {
        key: "zoomOut",
        value: function zoomOut(t, e) {
          return this.zoomTo(this.getZoom() - 1, t, e), this;
        }
      }, {
        key: "getBearing",
        value: function getBearing() {
          return this.transform.bearing;
        }
      }, {
        key: "setBearing",
        value: function setBearing(t, e) {
          return this.jumpTo({
            bearing: t
          }, e), this;
        }
      }, {
        key: "getPadding",
        value: function getPadding() {
          return this.transform.padding;
        }
      }, {
        key: "setPadding",
        value: function setPadding(t, e) {
          return this.jumpTo({
            padding: t
          }, e), this;
        }
      }, {
        key: "rotateTo",
        value: function rotateTo(e, i, o) {
          return this.easeTo(t.extend({
            bearing: e
          }, i), o);
        }
      }, {
        key: "resetNorth",
        value: function resetNorth(e, i) {
          return this.rotateTo(0, t.extend({
            duration: 1e3
          }, e), i), this;
        }
      }, {
        key: "resetNorthPitch",
        value: function resetNorthPitch(e, i) {
          return this.easeTo(t.extend({
            bearing: 0,
            pitch: 0,
            duration: 1e3
          }, e), i), this;
        }
      }, {
        key: "snapToNorth",
        value: function snapToNorth(t, e) {
          return Math.abs(this.getBearing()) < this._bearingSnap ? this.resetNorth(t, e) : this;
        }
      }, {
        key: "getPitch",
        value: function getPitch() {
          return this.transform.pitch;
        }
      }, {
        key: "setPitch",
        value: function setPitch(t, e) {
          return this.jumpTo({
            pitch: t
          }, e), this;
        }
      }, {
        key: "cameraForBounds",
        value: function cameraForBounds(e, i) {
          e = t.LngLatBounds.convert(e);
          var o = i && i.bearing || 0;
          return this._cameraForBoxAndBearing(e.getNorthWest(), e.getSouthEast(), o, i);
        }
      }, {
        key: "_extendCameraOptions",
        value: function _extendCameraOptions(e) {
          var i = {
            top: 0,
            bottom: 0,
            right: 0,
            left: 0
          };

          if ("number" == typeof (e = t.extend({
            padding: i,
            offset: [0, 0],
            maxZoom: this.transform.maxZoom
          }, e)).padding) {
            var _t406 = e.padding;
            e.padding = {
              top: _t406,
              bottom: _t406,
              right: _t406,
              left: _t406
            };
          }

          return e.padding = t.extend(i, e.padding), e;
        }
      }, {
        key: "_cameraForBoxAndBearing",
        value: function _cameraForBoxAndBearing(e, i, o, a) {
          var r = this._extendCameraOptions(a),
              n = this.transform,
              s = n.padding,
              l = n.project(t.LngLat.convert(e)),
              c = n.project(t.LngLat.convert(i)),
              h = l.rotate(-t.degToRad(o)),
              u = c.rotate(-t.degToRad(o)),
              d = new t.Point(Math.max(h.x, u.x), Math.max(h.y, u.y)),
              _ = new t.Point(Math.min(h.x, u.x), Math.min(h.y, u.y)),
              m = d.sub(_),
              p = (n.width - (s.left + s.right + r.padding.left + r.padding.right)) / m.x,
              f = (n.height - (s.top + s.bottom + r.padding.top + r.padding.bottom)) / m.y;

          if (f < 0 || p < 0) return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");
          var g = Math.min(n.scaleZoom(n.scale * Math.min(p, f)), r.maxZoom),
              v = "number" == typeof r.offset.x ? new t.Point(r.offset.x, r.offset.y) : t.Point.convert(r.offset),
              x = new t.Point((r.padding.left - r.padding.right) / 2, (r.padding.top - r.padding.bottom) / 2).rotate(o * Math.PI / 180),
              y = v.add(x).mult(n.scale / n.zoomScale(g));
          return {
            center: n.unproject(l.add(c).div(2).sub(y)),
            zoom: g,
            bearing: o
          };
        }
      }, {
        key: "_cameraForBox",
        value: function _cameraForBox(e, i, o, a, r) {
          var n = this._extendCameraOptions(r);

          o = o || 0, a = a || 0, e = t.LngLat.convert(e), i = t.LngLat.convert(i);
          var s = this.transform.clone();
          s.padding = n.padding;
          var l = this.getFreeCameraOptions(),
              c = new t.LngLat(.5 * (e.lng + i.lng), .5 * (e.lat + i.lat)),
              h = .5 * (o + a);
          if (s._camera.position[2] < t.mercatorZfromAltitude(h, c.lat)) return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");
          l.lookAtPoint(c), s.setFreeCameraOptions(l);

          var u = t.MercatorCoordinate.fromLngLat(e),
              d = t.MercatorCoordinate.fromLngLat(i),
              _ = s.pointRayIntersection(s.centerPoint, h),
              m = [(p = s.rayIntersectionCoordinate(_)).x, p.y, p.z];

          var p;
          var f = s.screenPointToMercatorRay(s.centerPoint);
          var g,
              v = 0;

          do {
            var _e345 = Math.floor(s.zoom),
                _i282 = 1 << _e345,
                _r251 = Math.min(_i282 * u.x, _i282 * d.x),
                _n158 = Math.min(_i282 * u.y, _i282 * d.y),
                _l56 = Math.max(_i282 * u.x, _i282 * d.x),
                _c42 = Math.max(_i282 * u.y, _i282 * d.y),
                _h31 = new t.Aabb([_r251, _n158, o], [_l56, _c42, a]),
                _15 = t.Frustum.fromInvProjectionMatrix(s.invProjMatrix, s.worldSize, _e345);

            if (2 !== _h31.intersects(_15)) {
              g && (s._camera.position = t.scaleAndAdd([], s._camera.position, f.dir, -g), s._updateStateFromCamera());
              break;
            }

            var _p22 = t.sub([], s._camera.position, m);

            g = .5 * t.length(_p22), s._camera.position = t.scaleAndAdd([], s._camera.position, f.dir, g);

            try {
              s._updateStateFromCamera();
            } catch (e) {
              return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");
            }
          } while (++v < 10);

          return {
            center: s.center,
            zoom: s.zoom,
            bearing: s.bearing,
            pitch: s.pitch
          };
        }
      }, {
        key: "fitBounds",
        value: function fitBounds(t, e, i) {
          return this._fitInternal(this.cameraForBounds(t, e), e, i);
        }
      }, {
        key: "_raycastElevationBox",
        value: function _raycastElevationBox(e, i) {
          var o = this.transform.elevation;
          if (!o) return;
          var a = new t.Point(e.x, i.y),
              r = new t.Point(i.x, e.y),
              n = o.pointCoordinate(e);
          if (!n) return;
          var s = o.pointCoordinate(i);
          if (!s) return;
          var l = o.pointCoordinate(a);
          if (!l) return;
          var c = o.pointCoordinate(r);
          if (!c) return;

          var h = new t.MercatorCoordinate(n[0], n[1]).toLngLat(),
              u = new t.MercatorCoordinate(s[0], s[1]).toLngLat(),
              d = new t.MercatorCoordinate(l[0], l[1]).toLngLat(),
              _ = new t.MercatorCoordinate(c[0], c[1]).toLngLat(),
              m = Math.min(h.lng, Math.min(u.lng, Math.min(d.lng, _.lng))),
              p = Math.min(h.lat, Math.min(u.lat, Math.min(d.lat, _.lat))),
              f = Math.max(h.lng, Math.max(u.lng, Math.max(d.lng, _.lng))),
              g = Math.max(h.lat, Math.max(u.lat, Math.max(d.lat, _.lat))),
              v = Math.min(n[3], Math.min(s[3], Math.min(l[3], c[3]))),
              x = Math.max(n[3], Math.max(s[3], Math.max(l[3], c[3])));

          return {
            minLngLat: new t.LngLat(m, p),
            maxLngLat: new t.LngLat(f, g),
            minAltitude: v,
            maxAltitude: x
          };
        }
      }, {
        key: "fitScreenCoordinates",
        value: function fitScreenCoordinates(e, i, o, a, r) {
          var n, s, l, c;

          var h = t.Point.convert(e),
              u = t.Point.convert(i),
              d = this._raycastElevationBox(h, u);

          if (d) n = d.minLngLat, s = d.maxLngLat, l = d.minAltitude, c = d.maxAltitude;else {
            if (this.transform.isHorizonVisibleForPoints(h, u)) return this;
            n = this.transform.pointLocation(h), s = this.transform.pointLocation(u);
          }
          return this._fitInternal(0 === this.transform.pitch ? this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)), this.transform.pointLocation(t.Point.convert(i)), o, a) : this._cameraForBox(n, s, l, c, a), a, r);
        }
      }, {
        key: "_fitInternal",
        value: function _fitInternal(e, i, o) {
          return e ? (delete (i = t.extend(e, i)).padding, i.linear ? this.easeTo(i, o) : this.flyTo(i, o)) : this;
        }
      }, {
        key: "jumpTo",
        value: function jumpTo(e, i) {
          this.stop();
          var o = this.transform;
          var a = !1,
              r = !1,
              n = !1;
          return "zoom" in e && o.zoom !== +e.zoom && (a = !0, o.zoom = +e.zoom), void 0 !== e.center && (o.center = t.LngLat.convert(e.center)), "bearing" in e && o.bearing !== +e.bearing && (r = !0, o.bearing = +e.bearing), "pitch" in e && o.pitch !== +e.pitch && (n = !0, o.pitch = +e.pitch), null == e.padding || o.isPaddingEqual(e.padding) || (o.padding = e.padding), this.fire(new t.Event("movestart", i)).fire(new t.Event("move", i)), a && this.fire(new t.Event("zoomstart", i)).fire(new t.Event("zoom", i)).fire(new t.Event("zoomend", i)), r && this.fire(new t.Event("rotatestart", i)).fire(new t.Event("rotate", i)).fire(new t.Event("rotateend", i)), n && this.fire(new t.Event("pitchstart", i)).fire(new t.Event("pitch", i)).fire(new t.Event("pitchend", i)), this.fire(new t.Event("moveend", i));
        }
      }, {
        key: "getFreeCameraOptions",
        value: function getFreeCameraOptions() {
          return this.transform.getFreeCameraOptions();
        }
      }, {
        key: "setFreeCameraOptions",
        value: function setFreeCameraOptions(e, i) {
          this.stop();
          var o = this.transform,
              a = o.zoom,
              r = o.pitch,
              n = o.bearing;
          o.setFreeCameraOptions(e);
          var s = a !== o.zoom,
              l = r !== o.pitch,
              c = n !== o.bearing;
          return this.fire(new t.Event("movestart", i)).fire(new t.Event("move", i)), s && this.fire(new t.Event("zoomstart", i)).fire(new t.Event("zoom", i)).fire(new t.Event("zoomend", i)), c && this.fire(new t.Event("rotatestart", i)).fire(new t.Event("rotate", i)).fire(new t.Event("rotateend", i)), l && this.fire(new t.Event("pitchstart", i)).fire(new t.Event("pitch", i)).fire(new t.Event("pitchend", i)), this.fire(new t.Event("moveend", i)), this;
        }
      }, {
        key: "easeTo",
        value: function easeTo(e, i) {
          var _this120 = this;

          this._stop(!1, e.easeId), (!1 === (e = t.extend({
            offset: [0, 0],
            duration: 500,
            easing: t.ease
          }, e)).animate || !e.essential && t.browser.prefersReducedMotion) && (e.duration = 0);
          var o = this.transform,
              a = this.getZoom(),
              r = this.getBearing(),
              n = this.getPitch(),
              s = this.getPadding(),
              l = "zoom" in e ? +e.zoom : a,
              c = "bearing" in e ? this._normalizeBearing(e.bearing, r) : r,
              h = "pitch" in e ? +e.pitch : n,
              u = "padding" in e ? e.padding : o.padding,
              d = t.Point.convert(e.offset);

          var _ = o.centerPoint.add(d);

          var m = o.pointLocation(_),
              p = t.LngLat.convert(e.center || m);

          this._normalizeCenter(p);

          var f = o.project(m),
              g = o.project(p).sub(f),
              v = o.zoomScale(l - a);
          var x, y;
          e.around && (x = t.LngLat.convert(e.around), y = o.locationPoint(x));
          var b = {
            moving: this._moving,
            zooming: this._zooming,
            rotating: this._rotating,
            pitching: this._pitching
          };
          return this._zooming = this._zooming || l !== a, this._rotating = this._rotating || r !== c, this._pitching = this._pitching || h !== n, this._padding = !o.isPaddingEqual(u), this._easeId = e.easeId, this._prepareEase(i, e.noMoveStart, b), this._ease(function (e) {
            if (_this120._zooming && (o.zoom = t.number(a, l, e)), _this120._rotating && (o.bearing = t.number(r, c, e)), _this120._pitching && (o.pitch = t.number(n, h, e)), _this120._padding && (o.interpolatePadding(s, u, e), _ = o.centerPoint.add(d)), x) o.setLocationAtPoint(x, y);else {
              var _t407 = o.zoomScale(o.zoom - a),
                  _i283 = l > a ? Math.min(2, v) : Math.max(.5, v),
                  _r252 = Math.pow(_i283, 1 - e),
                  _n159 = o.unproject(f.add(g.mult(e * _r252)).mult(_t407));

              o.setLocationAtPoint(o.renderWorldCopies ? _n159.wrap() : _n159, _);
            }

            _this120._fireMoveEvents(i);
          }, function (t) {
            o.recenterOnTerrain(), _this120._afterEase(i, t);
          }, e), this;
        }
      }, {
        key: "_prepareEase",
        value: function _prepareEase(e, i) {
          var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          this._moving = !0, this.transform.cameraElevationReference = "sea", i || o.moving || this.fire(new t.Event("movestart", e)), this._zooming && !o.zooming && this.fire(new t.Event("zoomstart", e)), this._rotating && !o.rotating && this.fire(new t.Event("rotatestart", e)), this._pitching && !o.pitching && this.fire(new t.Event("pitchstart", e));
        }
      }, {
        key: "_fireMoveEvents",
        value: function _fireMoveEvents(e) {
          this.fire(new t.Event("move", e)), this._zooming && this.fire(new t.Event("zoom", e)), this._rotating && this.fire(new t.Event("rotate", e)), this._pitching && this.fire(new t.Event("pitch", e));
        }
      }, {
        key: "_afterEase",
        value: function _afterEase(e, i) {
          if (this._easeId && i && this._easeId === i) return;
          delete this._easeId, this.transform.cameraElevationReference = "ground";
          var o = this._zooming,
              a = this._rotating,
              r = this._pitching;
          this._moving = !1, this._zooming = !1, this._rotating = !1, this._pitching = !1, this._padding = !1, o && this.fire(new t.Event("zoomend", e)), a && this.fire(new t.Event("rotateend", e)), r && this.fire(new t.Event("pitchend", e)), this.fire(new t.Event("moveend", e));
        }
      }, {
        key: "flyTo",
        value: function flyTo(e, i) {
          var _this121 = this;

          if (!e.essential && t.browser.prefersReducedMotion) {
            var _o126 = t.pick(e, ["center", "zoom", "bearing", "pitch", "around"]);

            return this.jumpTo(_o126, i);
          }

          this.stop(), e = t.extend({
            offset: [0, 0],
            speed: 1.2,
            curve: 1.42,
            easing: t.ease
          }, e);

          var o = this.transform,
              a = this.getZoom(),
              r = this.getBearing(),
              n = this.getPitch(),
              s = this.getPadding(),
              l = "zoom" in e ? t.clamp(+e.zoom, o.minZoom, o.maxZoom) : a,
              c = "bearing" in e ? this._normalizeBearing(e.bearing, r) : r,
              h = "pitch" in e ? +e.pitch : n,
              u = "padding" in e ? e.padding : o.padding,
              d = o.zoomScale(l - a),
              _ = t.Point.convert(e.offset);

          var m = o.centerPoint.add(_);
          var p = o.pointLocation(m),
              f = t.LngLat.convert(e.center || p);

          this._normalizeCenter(f);

          var g = o.project(p),
              v = o.project(f).sub(g);
          var x = e.curve;
          var y = Math.max(o.width, o.height),
              b = y / d,
              w = v.mag();

          if ("minZoom" in e) {
            var _i284 = t.clamp(Math.min(e.minZoom, a, l), o.minZoom, o.maxZoom),
                _r253 = y / o.zoomScale(_i284 - a);

            x = Math.sqrt(_r253 / w * 2);
          }

          var T = x * x;

          function E(t) {
            var e = (b * b - y * y + (t ? -1 : 1) * T * T * w * w) / (2 * (t ? b : y) * T * w);
            return Math.log(Math.sqrt(e * e + 1) - e);
          }

          function C(t) {
            return (Math.exp(t) - Math.exp(-t)) / 2;
          }

          function S(t) {
            return (Math.exp(t) + Math.exp(-t)) / 2;
          }

          var I = E(0);

          var P = function P(t) {
            return S(I) / S(I + x * t);
          },
              M = function M(t) {
            return y * ((S(I) * (C(e = I + x * t) / S(e)) - C(I)) / T) / w;
            var e;
          },
              z = (E(1) - I) / x;

          if (Math.abs(w) < 1e-6 || !isFinite(z)) {
            if (Math.abs(y - b) < 1e-6) return this.easeTo(e, i);

            var _t408 = b < y ? -1 : 1;

            z = Math.abs(Math.log(b / y)) / x, M = function M() {
              return 0;
            }, P = function P(e) {
              return Math.exp(_t408 * x * e);
            };
          }

          return e.duration = "duration" in e ? +e.duration : 1e3 * z / ("screenSpeed" in e ? +e.screenSpeed / x : +e.speed), e.maxDuration && e.duration > e.maxDuration && (e.duration = 0), this._zooming = !0, this._rotating = r !== c, this._pitching = h !== n, this._padding = !o.isPaddingEqual(u), this._prepareEase(i, !1), this._ease(function (e) {
            var d = e * z,
                p = 1 / P(d);
            o.zoom = 1 === e ? l : a + o.scaleZoom(p), _this121._rotating && (o.bearing = t.number(r, c, e)), _this121._pitching && (o.pitch = t.number(n, h, e)), _this121._padding && (o.interpolatePadding(s, u, e), m = o.centerPoint.add(_));
            var x = 1 === e ? f : o.unproject(g.add(v.mult(M(d))).mult(p));
            o.setLocationAtPoint(o.renderWorldCopies ? x.wrap() : x, m), o._updateCenterElevation(), _this121._fireMoveEvents(i);
          }, function () {
            return _this121._afterEase(i);
          }, e), this;
        }
      }, {
        key: "isEasing",
        value: function isEasing() {
          return !!this._easeFrameId;
        }
      }, {
        key: "stop",
        value: function stop() {
          return this._stop();
        }
      }, {
        key: "_stop",
        value: function _stop(t, e) {
          if (this._easeFrameId && (this._cancelRenderFrame(this._easeFrameId), delete this._easeFrameId, delete this._onEaseFrame), this._onEaseEnd) {
            var _t409 = this._onEaseEnd;
            delete this._onEaseEnd, _t409.call(this, e);
          }

          if (!t) {
            var _t410 = this.handlers;
            _t410 && _t410.stop(!1);
          }

          return this;
        }
      }, {
        key: "_ease",
        value: function _ease(e, i, o) {
          !1 === o.animate || 0 === o.duration ? (e(1), i()) : (this._easeStart = t.browser.now(), this._easeOptions = o, this._onEaseFrame = e, this._onEaseEnd = i, this._easeFrameId = this._requestRenderFrame(this._renderFrameCallback));
        }
      }, {
        key: "_renderFrameCallback",
        value: function _renderFrameCallback() {
          var e = Math.min((t.browser.now() - this._easeStart) / this._easeOptions.duration, 1);
          this._onEaseFrame(this._easeOptions.easing(e)), e < 1 ? this._easeFrameId = this._requestRenderFrame(this._renderFrameCallback) : this.stop();
        }
      }, {
        key: "_normalizeBearing",
        value: function _normalizeBearing(e, i) {
          e = t.wrap(e, -180, 180);
          var o = Math.abs(e - i);
          return Math.abs(e - 360 - i) < o && (e -= 360), Math.abs(e + 360 - i) < o && (e += 360), e;
        }
      }, {
        key: "_normalizeCenter",
        value: function _normalizeCenter(t) {
          var e = this.transform;
          if (!e.renderWorldCopies || e.lngRange) return;
          var i = t.lng - e.center.lng;
          t.lng += i > 180 ? -360 : i < -180 ? 360 : 0;
        }
      }]);

      return Jo;
    }(t.Evented);

    var Qo = /*#__PURE__*/function () {
      function Qo() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

        _classCallCheck(this, Qo);

        this.options = e, t.bindAll(["_toggleAttribution", "_updateEditLink", "_updateData", "_updateCompact"], this);
      }

      _createClass(Qo, [{
        key: "getDefaultPosition",
        value: function getDefaultPosition() {
          return "bottom-right";
        }
      }, {
        key: "onAdd",
        value: function onAdd(t) {
          var e = this.options && this.options.compact;
          return this._map = t, this._container = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-attrib"), this._compactButton = a.create("button", "mapboxgl-ctrl-attrib-button", this._container), this._compactButton.addEventListener("click", this._toggleAttribution), this._setElementTitle(this._compactButton, "ToggleAttribution"), this._innerContainer = a.create("div", "mapboxgl-ctrl-attrib-inner", this._container), this._innerContainer.setAttribute("role", "list"), e && this._container.classList.add("mapboxgl-compact"), this._updateAttributions(), this._updateEditLink(), this._map.on("styledata", this._updateData), this._map.on("sourcedata", this._updateData), this._map.on("moveend", this._updateEditLink), void 0 === e && (this._map.on("resize", this._updateCompact), this._updateCompact()), this._container;
        }
      }, {
        key: "onRemove",
        value: function onRemove() {
          a.remove(this._container), this._map.off("styledata", this._updateData), this._map.off("sourcedata", this._updateData), this._map.off("moveend", this._updateEditLink), this._map.off("resize", this._updateCompact), this._map = void 0, this._attribHTML = void 0;
        }
      }, {
        key: "_setElementTitle",
        value: function _setElementTitle(t, e) {
          var i = this._map._getUIString("AttributionControl.".concat(e));

          t.title = i, t.setAttribute("aria-label", i);
        }
      }, {
        key: "_toggleAttribution",
        value: function _toggleAttribution() {
          this._container.classList.contains("mapboxgl-compact-show") ? (this._container.classList.remove("mapboxgl-compact-show"), this._compactButton.setAttribute("aria-pressed", "false")) : (this._container.classList.add("mapboxgl-compact-show"), this._compactButton.setAttribute("aria-pressed", "true"));
        }
      }, {
        key: "_updateEditLink",
        value: function _updateEditLink() {
          var e = this._editLink;
          e || (e = this._editLink = this._container.querySelector(".mapbox-improve-map"));
          var i = [{
            key: "owner",
            value: this.styleOwner
          }, {
            key: "id",
            value: this.styleId
          }, {
            key: "access_token",
            value: this._map._requestManager._customAccessToken || t.config.ACCESS_TOKEN
          }];

          if (e) {
            var _o127 = i.reduce(function (t, e, o) {
              return e.value && (t += "".concat(e.key, "=").concat(e.value).concat(o < i.length - 1 ? "&" : "")), t;
            }, "?");

            e.href = "".concat(t.config.FEEDBACK_URL, "/").concat(_o127).concat(this._map._hash ? this._map._hash.getHashString(!0) : ""), e.rel = "noopener nofollow", this._setElementTitle(e, "MapFeedback");
          }
        }
      }, {
        key: "_updateData",
        value: function _updateData(t) {
          !t || "metadata" !== t.sourceDataType && "visibility" !== t.sourceDataType && "style" !== t.dataType || (this._updateAttributions(), this._updateEditLink());
        }
      }, {
        key: "_updateAttributions",
        value: function _updateAttributions() {
          if (!this._map.style) return;
          var t = [];

          if (this.options.customAttribution && (Array.isArray(this.options.customAttribution) ? t = t.concat(this.options.customAttribution.map(function (t) {
            return "string" != typeof t ? "" : t;
          })) : "string" == typeof this.options.customAttribution && t.push(this.options.customAttribution)), this._map.style.stylesheet) {
            var _t411 = this._map.style.stylesheet;
            this.styleOwner = _t411.owner, this.styleId = _t411.id;
          }

          var e = this._map.style._sourceCaches;

          for (var _i285 in e) {
            var _o128 = e[_i285];

            if (_o128.used) {
              var _e346 = _o128.getSource();

              _e346.attribution && t.indexOf(_e346.attribution) < 0 && t.push(_e346.attribution);
            }
          }

          t.sort(function (t, e) {
            return t.length - e.length;
          }), t = t.filter(function (e, i) {
            for (var _o129 = i + 1; _o129 < t.length; _o129++) {
              if (t[_o129].indexOf(e) >= 0) return !1;
            }

            return !0;
          });
          var i = t.join(" | ");
          i !== this._attribHTML && (this._attribHTML = i, t.length ? (this._innerContainer.innerHTML = i, this._container.classList.remove("mapboxgl-attrib-empty")) : this._container.classList.add("mapboxgl-attrib-empty"), this._editLink = null);
        }
      }, {
        key: "_updateCompact",
        value: function _updateCompact() {
          this._map.getCanvasContainer().offsetWidth <= 640 ? this._container.classList.add("mapboxgl-compact") : this._container.classList.remove("mapboxgl-compact", "mapboxgl-compact-show");
        }
      }]);

      return Qo;
    }();

    var ta = /*#__PURE__*/function () {
      function ta() {
        _classCallCheck(this, ta);

        t.bindAll(["_updateLogo"], this), t.bindAll(["_updateCompact"], this);
      }

      _createClass(ta, [{
        key: "onAdd",
        value: function onAdd(t) {
          this._map = t, this._container = a.create("div", "mapboxgl-ctrl");
          var e = a.create("a", "mapboxgl-ctrl-logo");
          return e.target = "_blank", e.rel = "noopener nofollow", e.href = "https://www.mapbox.com/", e.setAttribute("aria-label", this._map._getUIString("LogoControl.Title")), e.setAttribute("rel", "noopener nofollow"), this._container.appendChild(e), this._container.style.display = "none", this._map.on("sourcedata", this._updateLogo), this._updateLogo(), this._map.on("resize", this._updateCompact), this._updateCompact(), this._container;
        }
      }, {
        key: "onRemove",
        value: function onRemove() {
          a.remove(this._container), this._map.off("sourcedata", this._updateLogo), this._map.off("resize", this._updateCompact);
        }
      }, {
        key: "getDefaultPosition",
        value: function getDefaultPosition() {
          return "bottom-left";
        }
      }, {
        key: "_updateLogo",
        value: function _updateLogo(t) {
          t && "metadata" !== t.sourceDataType || (this._container.style.display = this._logoRequired() ? "block" : "none");
        }
      }, {
        key: "_logoRequired",
        value: function _logoRequired() {
          if (!this._map.style) return;
          var t = this._map.style._sourceCaches;
          if (0 === Object.entries(t).length) return !0;

          for (var _e347 in t) {
            var _i286 = t[_e347].getSource();

            if (_i286.hasOwnProperty("mapbox_logo") && !_i286.mapbox_logo) return !1;
          }

          return !0;
        }
      }, {
        key: "_updateCompact",
        value: function _updateCompact() {
          var t = this._container.children;

          if (t.length) {
            var _e348 = t[0];
            this._map.getCanvasContainer().offsetWidth < 250 ? _e348.classList.add("mapboxgl-compact") : _e348.classList.remove("mapboxgl-compact");
          }
        }
      }]);

      return ta;
    }();

    var ea = /*#__PURE__*/function () {
      function ea() {
        _classCallCheck(this, ea);

        this._queue = [], this._id = 0, this._cleared = !1, this._currentlyRunning = !1;
      }

      _createClass(ea, [{
        key: "add",
        value: function add(t) {
          var e = ++this._id;
          return this._queue.push({
            callback: t,
            id: e,
            cancelled: !1
          }), e;
        }
      }, {
        key: "remove",
        value: function remove(t) {
          var e = this._currentlyRunning,
              i = e ? this._queue.concat(e) : this._queue;

          var _iterator230 = _createForOfIteratorHelper(i),
              _step230;

          try {
            for (_iterator230.s(); !(_step230 = _iterator230.n()).done;) {
              var _e349 = _step230.value;
              if (_e349.id === t) return void (_e349.cancelled = !0);
            }
          } catch (err) {
            _iterator230.e(err);
          } finally {
            _iterator230.f();
          }
        }
      }, {
        key: "run",
        value: function run() {
          var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
          var e = this._currentlyRunning = this._queue;
          this._queue = [];

          var _iterator231 = _createForOfIteratorHelper(e),
              _step231;

          try {
            for (_iterator231.s(); !(_step231 = _iterator231.n()).done;) {
              var _i287 = _step231.value;
              if (!_i287.cancelled && (_i287.callback(t), this._cleared)) break;
            }
          } catch (err) {
            _iterator231.e(err);
          } finally {
            _iterator231.f();
          }

          this._cleared = !1, this._currentlyRunning = !1;
        }
      }, {
        key: "clear",
        value: function clear() {
          this._currentlyRunning && (this._cleared = !0), this._queue = [];
        }
      }]);

      return ea;
    }();

    var ia = {
      "AttributionControl.ToggleAttribution": "Toggle attribution",
      "AttributionControl.MapFeedback": "Map feedback",
      "FullscreenControl.Enter": "Enter fullscreen",
      "FullscreenControl.Exit": "Exit fullscreen",
      "GeolocateControl.FindMyLocation": "Find my location",
      "GeolocateControl.LocationNotAvailable": "Location not available",
      "LogoControl.Title": "Mapbox logo",
      "NavigationControl.ResetBearing": "Reset bearing to north",
      "NavigationControl.ZoomIn": "Zoom in",
      "NavigationControl.ZoomOut": "Zoom out",
      "ScaleControl.Feet": "ft",
      "ScaleControl.Meters": "m",
      "ScaleControl.Kilometers": "km",
      "ScaleControl.Miles": "mi",
      "ScaleControl.NauticalMiles": "nm"
    },
        _t$window = t.window,
        oa = _t$window.HTMLImageElement,
        aa = _t$window.HTMLElement,
        ra = _t$window.ImageBitmap,
        na = {
      center: [0, 0],
      zoom: 0,
      bearing: 0,
      pitch: 0,
      minZoom: -2,
      maxZoom: 22,
      minPitch: 0,
      maxPitch: 85,
      interactive: !0,
      scrollZoom: !0,
      boxZoom: !0,
      dragRotate: !0,
      dragPan: !0,
      keyboard: !0,
      doubleClickZoom: !0,
      touchZoomRotate: !0,
      touchPitch: !0,
      bearingSnap: 7,
      clickTolerance: 3,
      pitchWithRotate: !0,
      hash: !1,
      attributionControl: !0,
      failIfMajorPerformanceCaveat: !1,
      preserveDrawingBuffer: !1,
      trackResize: !0,
      renderWorldCopies: !0,
      refreshExpiredTiles: !0,
      maxTileCacheSize: null,
      localIdeographFontFamily: "sans-serif",
      transformRequest: null,
      accessToken: null,
      fadeDuration: 300,
      crossSourceCollisions: !0
    };

    function sa(t) {
      t.parentNode && t.parentNode.removeChild(t);
    }

    var la = {
      showCompass: !0,
      showZoom: !0,
      visualizePitch: !1
    };

    var ca = /*#__PURE__*/function () {
      function ca(e, i) {
        var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;

        _classCallCheck(this, ca);

        this._clickTolerance = 10, this.element = i, this.mouseRotate = new So({
          clickTolerance: e.dragRotate._mouseRotate._clickTolerance
        }), this.map = e, o && (this.mousePitch = new Io({
          clickTolerance: e.dragRotate._mousePitch._clickTolerance
        })), t.bindAll(["mousedown", "mousemove", "mouseup", "touchstart", "touchmove", "touchend", "reset"], this), a.addEventListener(i, "mousedown", this.mousedown), a.addEventListener(i, "touchstart", this.touchstart, {
          passive: !1
        }), a.addEventListener(i, "touchmove", this.touchmove), a.addEventListener(i, "touchend", this.touchend), a.addEventListener(i, "touchcancel", this.reset);
      }

      _createClass(ca, [{
        key: "down",
        value: function down(t, e) {
          this.mouseRotate.mousedown(t, e), this.mousePitch && this.mousePitch.mousedown(t, e), a.disableDrag();
        }
      }, {
        key: "move",
        value: function move(t, e) {
          var i = this.map,
              o = this.mouseRotate.mousemoveWindow(t, e);

          if (o && o.bearingDelta && i.setBearing(i.getBearing() + o.bearingDelta), this.mousePitch) {
            var _o130 = this.mousePitch.mousemoveWindow(t, e);

            _o130 && _o130.pitchDelta && i.setPitch(i.getPitch() + _o130.pitchDelta);
          }
        }
      }, {
        key: "off",
        value: function off() {
          var t = this.element;
          a.removeEventListener(t, "mousedown", this.mousedown), a.removeEventListener(t, "touchstart", this.touchstart, {
            passive: !1
          }), a.removeEventListener(t, "touchmove", this.touchmove), a.removeEventListener(t, "touchend", this.touchend), a.removeEventListener(t, "touchcancel", this.reset), this.offTemp();
        }
      }, {
        key: "offTemp",
        value: function offTemp() {
          a.enableDrag(), a.removeEventListener(t.window, "mousemove", this.mousemove), a.removeEventListener(t.window, "mouseup", this.mouseup);
        }
      }, {
        key: "mousedown",
        value: function mousedown(e) {
          this.down(t.extend({}, e, {
            ctrlKey: !0,
            preventDefault: function preventDefault() {
              return e.preventDefault();
            }
          }), a.mousePos(this.element, e)), a.addEventListener(t.window, "mousemove", this.mousemove), a.addEventListener(t.window, "mouseup", this.mouseup);
        }
      }, {
        key: "mousemove",
        value: function mousemove(t) {
          this.move(t, a.mousePos(this.element, t));
        }
      }, {
        key: "mouseup",
        value: function mouseup(t) {
          this.mouseRotate.mouseupWindow(t), this.mousePitch && this.mousePitch.mouseupWindow(t), this.offTemp();
        }
      }, {
        key: "touchstart",
        value: function touchstart(t) {
          1 !== t.targetTouches.length ? this.reset() : (this._startPos = this._lastPos = a.touchPos(this.element, t.targetTouches)[0], this.down({
            type: "mousedown",
            button: 0,
            ctrlKey: !0,
            preventDefault: function preventDefault() {
              return t.preventDefault();
            }
          }, this._startPos));
        }
      }, {
        key: "touchmove",
        value: function touchmove(t) {
          1 !== t.targetTouches.length ? this.reset() : (this._lastPos = a.touchPos(this.element, t.targetTouches)[0], this.move({
            preventDefault: function preventDefault() {
              return t.preventDefault();
            }
          }, this._lastPos));
        }
      }, {
        key: "touchend",
        value: function touchend(t) {
          0 === t.targetTouches.length && this._startPos && this._lastPos && this._startPos.dist(this._lastPos) < this._clickTolerance && this.element.click(), this.reset();
        }
      }, {
        key: "reset",
        value: function reset() {
          this.mouseRotate.reset(), this.mousePitch && this.mousePitch.reset(), delete this._startPos, delete this._lastPos, this.offTemp();
        }
      }]);

      return ca;
    }();

    function ha(e, i, o) {
      if (e = new t.LngLat(e.lng, e.lat), i) {
        var _a157 = new t.LngLat(e.lng - 360, e.lat),
            _r254 = new t.LngLat(e.lng + 360, e.lat),
            _n160 = 360 * Math.ceil(Math.abs(e.lng - o.center.lng) / 360),
            _s125 = o.locationPoint(e).distSqr(i),
            _l57 = i.x < 0 || i.y < 0 || i.x > o.width || i.y > o.height;

        o.locationPoint(_a157).distSqr(i) < _s125 && (_l57 || Math.abs(_a157.lng - o.center.lng) < _n160) ? e = _a157 : o.locationPoint(_r254).distSqr(i) < _s125 && (_l57 || Math.abs(_r254.lng - o.center.lng) < _n160) && (e = _r254);
      }

      for (; Math.abs(e.lng - o.center.lng) > 180;) {
        var _t412 = o.locationPoint(e);

        if (_t412.x >= 0 && _t412.y >= 0 && _t412.x <= o.width && _t412.y <= o.height) break;
        e.lng > o.center.lng ? e.lng -= 360 : e.lng += 360;
      }

      return e;
    }

    var ua = {
      center: "translate(-50%,-50%)",
      top: "translate(-50%,0)",
      "top-left": "translate(0,0)",
      "top-right": "translate(-100%,0)",
      bottom: "translate(-50%,-100%)",
      "bottom-left": "translate(0,-100%)",
      "bottom-right": "translate(-100%,-100%)",
      left: "translate(0,-50%)",
      right: "translate(-100%,-50%)"
    };

    function da(t, e, i) {
      var o = t.classList;

      for (var _t413 in ua) {
        o.remove("mapboxgl-".concat(i, "-anchor-").concat(_t413));
      }

      o.add("mapboxgl-".concat(i, "-anchor-").concat(e));
    }

    var _a = /*#__PURE__*/function (_t$Evented10) {
      _inherits(_a, _t$Evented10);

      var _super124 = _createSuper(_a);

      function _a(e, i) {
        var _this122;

        _classCallCheck(this, _a);

        if (_this122 = _super124.call(this), (e instanceof t.window.HTMLElement || i) && (e = t.extend({
          element: e
        }, i)), t.bindAll(["_update", "_onMove", "_onUp", "_addDragHandler", "_onMapClick", "_onKeyPress"], _assertThisInitialized(_this122)), _this122._anchor = e && e.anchor || "center", _this122._color = e && e.color || "#3FB1CE", _this122._scale = e && e.scale || 1, _this122._draggable = e && e.draggable || !1, _this122._clickTolerance = e && e.clickTolerance || 0, _this122._isDragging = !1, _this122._state = "inactive", _this122._rotation = e && e.rotation || 0, _this122._rotationAlignment = e && e.rotationAlignment || "auto", _this122._pitchAlignment = e && e.pitchAlignment && "auto" !== e.pitchAlignment ? e.pitchAlignment : _this122._rotationAlignment, e && e.element) _this122._element = e.element, _this122._offset = t.Point.convert(e && e.offset || [0, 0]);else {
          _this122._defaultMarker = !0, _this122._element = a.create("div"), _this122._element.setAttribute("aria-label", "Map marker");

          var _i288 = a.createNS("http://www.w3.org/2000/svg", "svg"),
              _o131 = 41,
              _r255 = 27;

          _i288.setAttributeNS(null, "display", "block"), _i288.setAttributeNS(null, "height", "".concat(_o131, "px")), _i288.setAttributeNS(null, "width", "".concat(_r255, "px")), _i288.setAttributeNS(null, "viewBox", "0 0 ".concat(_r255, " ").concat(_o131));

          var _n161 = a.createNS("http://www.w3.org/2000/svg", "g");

          _n161.setAttributeNS(null, "stroke", "none"), _n161.setAttributeNS(null, "stroke-width", "1"), _n161.setAttributeNS(null, "fill", "none"), _n161.setAttributeNS(null, "fill-rule", "evenodd");

          var _s126 = a.createNS("http://www.w3.org/2000/svg", "g");

          _s126.setAttributeNS(null, "fill-rule", "nonzero");

          var _l58 = a.createNS("http://www.w3.org/2000/svg", "g");

          _l58.setAttributeNS(null, "transform", "translate(3.0, 29.0)"), _l58.setAttributeNS(null, "fill", "#000000");
          var _c43 = [{
            rx: "10.5",
            ry: "5.25002273"
          }, {
            rx: "10.5",
            ry: "5.25002273"
          }, {
            rx: "9.5",
            ry: "4.77275007"
          }, {
            rx: "8.5",
            ry: "4.29549936"
          }, {
            rx: "7.5",
            ry: "3.81822308"
          }, {
            rx: "6.5",
            ry: "3.34094679"
          }, {
            rx: "5.5",
            ry: "2.86367051"
          }, {
            rx: "4.5",
            ry: "2.38636864"
          }];

          for (var _i289 = 0, _c44 = _c43; _i289 < _c44.length; _i289++) {
            var _t414 = _c44[_i289];

            var _e350 = a.createNS("http://www.w3.org/2000/svg", "ellipse");

            _e350.setAttributeNS(null, "opacity", "0.04"), _e350.setAttributeNS(null, "cx", "10.5"), _e350.setAttributeNS(null, "cy", "5.80029008"), _e350.setAttributeNS(null, "rx", _t414.rx), _e350.setAttributeNS(null, "ry", _t414.ry), _l58.appendChild(_e350);
          }

          var _h32 = a.createNS("http://www.w3.org/2000/svg", "g");

          _h32.setAttributeNS(null, "fill", _this122._color);

          var _u45 = a.createNS("http://www.w3.org/2000/svg", "path");

          _u45.setAttributeNS(null, "d", "M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"), _h32.appendChild(_u45);

          var _d21 = a.createNS("http://www.w3.org/2000/svg", "g");

          _d21.setAttributeNS(null, "opacity", "0.25"), _d21.setAttributeNS(null, "fill", "#000000");

          var _16 = a.createNS("http://www.w3.org/2000/svg", "path");

          _16.setAttributeNS(null, "d", "M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"), _d21.appendChild(_16);

          var _m23 = a.createNS("http://www.w3.org/2000/svg", "g");

          _m23.setAttributeNS(null, "transform", "translate(6.0, 7.0)"), _m23.setAttributeNS(null, "fill", "#FFFFFF");

          var _p23 = a.createNS("http://www.w3.org/2000/svg", "g");

          _p23.setAttributeNS(null, "transform", "translate(8.0, 8.0)");

          var _f15 = a.createNS("http://www.w3.org/2000/svg", "circle");

          _f15.setAttributeNS(null, "fill", "#000000"), _f15.setAttributeNS(null, "opacity", "0.25"), _f15.setAttributeNS(null, "cx", "5.5"), _f15.setAttributeNS(null, "cy", "5.5"), _f15.setAttributeNS(null, "r", "5.4999962");

          var _g19 = a.createNS("http://www.w3.org/2000/svg", "circle");

          _g19.setAttributeNS(null, "fill", "#FFFFFF"), _g19.setAttributeNS(null, "cx", "5.5"), _g19.setAttributeNS(null, "cy", "5.5"), _g19.setAttributeNS(null, "r", "5.4999962"), _p23.appendChild(_f15), _p23.appendChild(_g19), _s126.appendChild(_l58), _s126.appendChild(_h32), _s126.appendChild(_d21), _s126.appendChild(_m23), _s126.appendChild(_p23), _i288.appendChild(_s126), _i288.setAttributeNS(null, "height", "".concat(_o131 * _this122._scale, "px")), _i288.setAttributeNS(null, "width", "".concat(_r255 * _this122._scale, "px")), _this122._element.appendChild(_i288), _this122._offset = t.Point.convert(e && e.offset || [0, -14]);
        }
        _this122._element.classList.add("mapboxgl-marker"), _this122._element.addEventListener("dragstart", function (t) {
          t.preventDefault();
        }), _this122._element.addEventListener("mousedown", function (t) {
          t.preventDefault();
        }), da(_this122._element, _this122._anchor, "marker"), _this122._popup = null;
        return _possibleConstructorReturn(_this122);
      }

      _createClass(_a, [{
        key: "addTo",
        value: function addTo(t) {
          return this.remove(), this._map = t, t.getCanvasContainer().appendChild(this._element), t.on("move", this._update), t.on("moveend", this._update), this.setDraggable(this._draggable), this._update(), this._map.on("click", this._onMapClick), this;
        }
      }, {
        key: "remove",
        value: function remove() {
          return this._map && (this._map.off("click", this._onMapClick), this._map.off("move", this._update), this._map.off("moveend", this._update), this._map.off("mousedown", this._addDragHandler), this._map.off("touchstart", this._addDragHandler), this._map.off("mouseup", this._onUp), this._map.off("touchend", this._onUp), this._map.off("mousemove", this._onMove), this._map.off("touchmove", this._onMove), delete this._map), a.remove(this._element), this._popup && this._popup.remove(), this;
        }
      }, {
        key: "getLngLat",
        value: function getLngLat() {
          return this._lngLat;
        }
      }, {
        key: "setLngLat",
        value: function setLngLat(e) {
          return this._lngLat = t.LngLat.convert(e), this._pos = null, this._popup && this._popup.setLngLat(this._lngLat), this._update(), this;
        }
      }, {
        key: "getElement",
        value: function getElement() {
          return this._element;
        }
      }, {
        key: "setPopup",
        value: function setPopup(t) {
          if (this._popup && (this._popup.remove(), this._popup = null, this._element.removeEventListener("keypress", this._onKeyPress), this._originalTabIndex || this._element.removeAttribute("tabindex")), t) {
            if (!("offset" in t.options)) {
              var _e351 = 38.1,
                  _i290 = 13.5,
                  _o132 = Math.sqrt(Math.pow(_i290, 2) / 2);

              t.options.offset = this._defaultMarker ? {
                top: [0, 0],
                "top-left": [0, 0],
                "top-right": [0, 0],
                bottom: [0, -_e351],
                "bottom-left": [_o132, -1 * (_e351 - _i290 + _o132)],
                "bottom-right": [-_o132, -1 * (_e351 - _i290 + _o132)],
                left: [_i290, -1 * (_e351 - _i290)],
                right: [-_i290, -1 * (_e351 - _i290)]
              } : this._offset;
            }

            this._popup = t, this._lngLat && this._popup.setLngLat(this._lngLat), this._originalTabIndex = this._element.getAttribute("tabindex"), this._originalTabIndex || this._element.setAttribute("tabindex", "0"), this._element.addEventListener("keypress", this._onKeyPress);
          }

          return this;
        }
      }, {
        key: "_onKeyPress",
        value: function _onKeyPress(t) {
          var e = t.code,
              i = t.charCode || t.keyCode;
          "Space" !== e && "Enter" !== e && 32 !== i && 13 !== i || this.togglePopup();
        }
      }, {
        key: "_onMapClick",
        value: function _onMapClick(t) {
          var e = t.originalEvent.target,
              i = this._element;
          this._popup && (e === i || i.contains(e)) && this.togglePopup();
        }
      }, {
        key: "getPopup",
        value: function getPopup() {
          return this._popup;
        }
      }, {
        key: "togglePopup",
        value: function togglePopup() {
          var t = this._popup;
          return t ? (t.isOpen() ? t.remove() : t.addTo(this._map), this) : this;
        }
      }, {
        key: "_updateOcclusion",
        value: function _updateOcclusion() {
          this._occlusionTimer || (this._occlusionTimer = setTimeout(this._onOcclusionTimer.bind(this), 60));
        }
      }, {
        key: "_onOcclusionTimer",
        value: function _onOcclusionTimer() {
          var t = this._map.transform,
              e = this._pos ? this._pos.sub(this._transformedOffset()) : null;

          if (e && e.x >= 0 && e.x < t.width && e.y >= 0 && e.y < t.height) {
            var _t415 = this._map.unproject(e),
                _i291 = this._map.getFreeCameraOptions();

            if (_i291.position) {
              var _e352 = _i291.position.toLngLat(),
                  _o133 = _e352.distanceTo(_t415),
                  _a158 = _e352.distanceTo(this._lngLat);

              this._element.classList.toggle("mapboxgl-marker-occluded", _o133 < .9 * _a158);
            }
          }

          this._occlusionTimer = null;
        }
      }, {
        key: "_update",
        value: function _update(t) {
          if (!this._map) return;
          this._map.transform.renderWorldCopies && (this._lngLat = ha(this._lngLat, this._pos, this._map.transform)), this._pos = this._map.project(this._lngLat)._add(this._transformedOffset()), this._map.transform.elevation && this._updateOcclusion();
          var e = "";
          "viewport" === this._rotationAlignment || "auto" === this._rotationAlignment ? e = "rotateZ(".concat(this._rotation, "deg)") : "map" === this._rotationAlignment && (e = "rotateZ(".concat(this._rotation - this._map.getBearing(), "deg)"));
          var i = "";
          "viewport" === this._pitchAlignment || "auto" === this._pitchAlignment ? i = "rotateX(0deg)" : "map" === this._pitchAlignment && (i = "rotateX(".concat(this._map.getPitch(), "deg)")), t && "moveend" !== t.type || (this._pos = this._pos.round()), a.setTransform(this._element, "".concat(ua[this._anchor], " translate(").concat(this._pos.x, "px, ").concat(this._pos.y, "px) ").concat(i, " ").concat(e));
        }
      }, {
        key: "_transformedOffset",
        value: function _transformedOffset() {
          if (!this._defaultMarker) return this._offset;

          var t = this._map.transform,
              e = this._offset.mult(this._scale);

          return "map" === this._rotationAlignment && e._rotate(t.angle), "map" === this._pitchAlignment && (e.y *= Math.cos(t._pitch)), e;
        }
      }, {
        key: "getOffset",
        value: function getOffset() {
          return this._offset;
        }
      }, {
        key: "setOffset",
        value: function setOffset(e) {
          return this._offset = t.Point.convert(e), this._update(), this;
        }
      }, {
        key: "_onMove",
        value: function _onMove(e) {
          if (!this._isDragging) {
            var _t416 = this._clickTolerance || this._map._clickTolerance;

            this._isDragging = e.point.dist(this._pointerdownPos) >= _t416;
          }

          this._isDragging && (this._pos = e.point.sub(this._positionDelta), this._lngLat = this._map.unproject(this._pos), this.setLngLat(this._lngLat), this._element.style.pointerEvents = "none", "pending" === this._state && (this._state = "active", this.fire(new t.Event("dragstart"))), this.fire(new t.Event("drag")));
        }
      }, {
        key: "_onUp",
        value: function _onUp() {
          this._element.style.pointerEvents = "auto", this._positionDelta = null, this._pointerdownPos = null, this._isDragging = !1, this._map.off("mousemove", this._onMove), this._map.off("touchmove", this._onMove), "active" === this._state && this.fire(new t.Event("dragend")), this._state = "inactive";
        }
      }, {
        key: "_addDragHandler",
        value: function _addDragHandler(t) {
          this._element.contains(t.originalEvent.target) && (t.preventDefault(), this._positionDelta = t.point.sub(this._pos).add(this._transformedOffset()), this._pointerdownPos = t.point, this._state = "pending", this._map.on("mousemove", this._onMove), this._map.on("touchmove", this._onMove), this._map.once("mouseup", this._onUp), this._map.once("touchend", this._onUp));
        }
      }, {
        key: "setDraggable",
        value: function setDraggable(t) {
          return this._draggable = !!t, this._map && (t ? (this._map.on("mousedown", this._addDragHandler), this._map.on("touchstart", this._addDragHandler)) : (this._map.off("mousedown", this._addDragHandler), this._map.off("touchstart", this._addDragHandler))), this;
        }
      }, {
        key: "isDraggable",
        value: function isDraggable() {
          return this._draggable;
        }
      }, {
        key: "setRotation",
        value: function setRotation(t) {
          return this._rotation = t || 0, this._update(), this;
        }
      }, {
        key: "getRotation",
        value: function getRotation() {
          return this._rotation;
        }
      }, {
        key: "setRotationAlignment",
        value: function setRotationAlignment(t) {
          return this._rotationAlignment = t || "auto", this._update(), this;
        }
      }, {
        key: "getRotationAlignment",
        value: function getRotationAlignment() {
          return this._rotationAlignment;
        }
      }, {
        key: "setPitchAlignment",
        value: function setPitchAlignment(t) {
          return this._pitchAlignment = t && "auto" !== t ? t : this._rotationAlignment, this._update(), this;
        }
      }, {
        key: "getPitchAlignment",
        value: function getPitchAlignment() {
          return this._pitchAlignment;
        }
      }]);

      return _a;
    }(t.Evented);

    var ma = {
      positionOptions: {
        enableHighAccuracy: !1,
        maximumAge: 0,
        timeout: 6e3
      },
      fitBoundsOptions: {
        maxZoom: 15
      },
      trackUserLocation: !1,
      showAccuracyCircle: !0,
      showUserLocation: !0
    };
    var pa,
        fa = 0,
        ga = !1;
    var va = {
      maxWidth: 100,
      unit: "metric"
    };

    function xa(t, e, i) {
      var o = i && i.maxWidth || 100,
          a = t._container.clientHeight / 2,
          r = t.unproject([0, a]),
          n = t.unproject([o, a]),
          s = r.distanceTo(n);

      if (i && "imperial" === i.unit) {
        var _i292 = 3.2808 * s;

        _i292 > 5280 ? ya(e, o, _i292 / 5280, t._getUIString("ScaleControl.Miles")) : ya(e, o, _i292, t._getUIString("ScaleControl.Feet"));
      } else i && "nautical" === i.unit ? ya(e, o, s / 1852, t._getUIString("ScaleControl.NauticalMiles")) : s >= 1e3 ? ya(e, o, s / 1e3, t._getUIString("ScaleControl.Kilometers")) : ya(e, o, s, t._getUIString("ScaleControl.Meters"));
    }

    function ya(t, e, i, o) {
      var a = function (t) {
        var e = Math.pow(10, "".concat(Math.floor(t)).length - 1);
        var i = t / e;
        return i = i >= 10 ? 10 : i >= 5 ? 5 : i >= 3 ? 3 : i >= 2 ? 2 : i >= 1 ? 1 : function (t) {
          var e = Math.pow(10, Math.ceil(-Math.log(t) / Math.LN10));
          return Math.round(t * e) / e;
        }(i), e * i;
      }(i);

      t.style.width = "".concat(e * (a / i), "px"), t.innerHTML = "".concat(a, "&nbsp;").concat(o);
    }

    var ba = {
      closeButton: !0,
      closeOnClick: !0,
      focusAfterOpen: !0,
      className: "",
      maxWidth: "240px"
    },
        wa = ["a[href]", "[tabindex]:not([tabindex='-1'])", "[contenteditable]:not([contenteditable='false'])", "button:not([disabled])", "input:not([disabled])", "select:not([disabled])", "textarea:not([disabled])"].join(", "),
        Ta = {
      version: t.version,
      supported: e,
      setRTLTextPlugin: t.setRTLTextPlugin,
      getRTLTextPluginStatus: t.getRTLTextPluginStatus,
      Map: /*#__PURE__*/function (_Jo) {
        _inherits(Map, _Jo);

        var _super125 = _createSuper(Map);

        function Map(e) {
          var _this123;

          _classCallCheck(this, Map);

          if (null != (e = t.extend({}, na, e)).minZoom && null != e.maxZoom && e.minZoom > e.maxZoom) throw new Error("maxZoom must be greater than or equal to minZoom");
          if (null != e.minPitch && null != e.maxPitch && e.minPitch > e.maxPitch) throw new Error("maxPitch must be greater than or equal to minPitch");
          if (null != e.minPitch && e.minPitch < 0) throw new Error("minPitch must be greater than or equal to 0");
          if (null != e.maxPitch && e.maxPitch > 85) throw new Error("maxPitch must be less than or equal to 85");

          if (_this123 = _super125.call(this, new io(e.minZoom, e.maxZoom, e.minPitch, e.maxPitch, e.renderWorldCopies), e), _this123._interactive = e.interactive, _this123._maxTileCacheSize = e.maxTileCacheSize, _this123._failIfMajorPerformanceCaveat = e.failIfMajorPerformanceCaveat, _this123._preserveDrawingBuffer = e.preserveDrawingBuffer, _this123._antialias = e.antialias, _this123._trackResize = e.trackResize, _this123._bearingSnap = e.bearingSnap, _this123._refreshExpiredTiles = e.refreshExpiredTiles, _this123._fadeDuration = e.fadeDuration, _this123._isInitialLoad = !0, _this123._crossSourceCollisions = e.crossSourceCollisions, _this123._crossFadingFactor = 1, _this123._collectResourceTiming = e.collectResourceTiming, _this123._renderTaskQueue = new ea(), _this123._controls = [], _this123._mapId = t.uniqueId(), _this123._locale = t.extend({}, ia, e.locale), _this123._clickTolerance = e.clickTolerance, _this123._requestManager = new t.RequestManager(e.transformRequest, e.accessToken), "string" == typeof e.container) {
            if (_this123._container = t.window.document.getElementById(e.container), !_this123._container) throw new Error("Container '".concat(e.container, "' not found."));
          } else {
            if (!(e.container instanceof aa)) throw new Error("Invalid type: 'container' must be a String or HTMLElement.");
            _this123._container = e.container;
          }

          if (e.maxBounds && _this123.setMaxBounds(e.maxBounds), t.bindAll(["_onWindowOnline", "_onWindowResize", "_onMapScroll", "_contextLost", "_contextRestored"], _assertThisInitialized(_this123)), _this123._setupContainer(), _this123._setupPainter(), void 0 === _this123.painter) throw new Error("Failed to initialize WebGL.");
          _this123.on("move", function () {
            return _this123._update(!1);
          }), _this123.on("moveend", function () {
            return _this123._update(!1);
          }), _this123.on("zoom", function () {
            return _this123._update(!0);
          }), void 0 !== t.window && (t.window.addEventListener("online", _this123._onWindowOnline, !1), t.window.addEventListener("resize", _this123._onWindowResize, !1), t.window.addEventListener("orientationchange", _this123._onWindowResize, !1)), _this123.handlers = new Yo(_assertThisInitialized(_this123), e), _this123._hash = e.hash && new oo("string" == typeof e.hash && e.hash || void 0).addTo(_assertThisInitialized(_this123)), _this123._hash && _this123._hash._onHashChange() || (_this123.jumpTo({
            center: e.center,
            zoom: e.zoom,
            bearing: e.bearing,
            pitch: e.pitch
          }), e.bounds && (_this123.resize(), _this123.fitBounds(e.bounds, t.extend({}, e.fitBoundsOptions, {
            duration: 0
          })))), _this123.resize(), _this123._localIdeographFontFamily = e.localIdeographFontFamily, e.style && _this123.setStyle(e.style, {
            localIdeographFontFamily: e.localIdeographFontFamily
          }), e.attributionControl && _this123.addControl(new Qo({
            customAttribution: e.customAttribution
          })), _this123._logoControl = new ta(), _this123.addControl(_this123._logoControl, e.logoPosition), _this123.on("style.load", function () {
            _this123.transform.unmodified && _this123.jumpTo(_this123.style.stylesheet);
          }), _this123.on("data", function (e) {
            _this123._update("style" === e.dataType), _this123.fire(new t.Event("".concat(e.dataType, "data"), e));
          }), _this123.on("dataloading", function (e) {
            _this123.fire(new t.Event("".concat(e.dataType, "dataloading"), e));
          });
          return _possibleConstructorReturn(_this123);
        }

        _createClass(Map, [{
          key: "_getMapId",
          value: function _getMapId() {
            return this._mapId;
          }
        }, {
          key: "addControl",
          value: function addControl(e, i) {
            if (void 0 === i && (i = e.getDefaultPosition ? e.getDefaultPosition() : "top-right"), !e || !e.onAdd) return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));
            var o = e.onAdd(this);

            this._controls.push(e);

            var a = this._controlPositions[i];
            return -1 !== i.indexOf("bottom") ? a.insertBefore(o, a.firstChild) : a.appendChild(o), this;
          }
        }, {
          key: "removeControl",
          value: function removeControl(e) {
            if (!e || !e.onRemove) return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));

            var i = this._controls.indexOf(e);

            return i > -1 && this._controls.splice(i, 1), e.onRemove(this), this;
          }
        }, {
          key: "hasControl",
          value: function hasControl(t) {
            return this._controls.indexOf(t) > -1;
          }
        }, {
          key: "resize",
          value: function resize(e) {
            var i = this._containerDimensions(),
                o = i[0],
                a = i[1];

            this._resizeCanvas(o, a), this.transform.resize(o, a), this.painter.resize(o, a);
            var r = !this._moving;
            return r && (this.stop(), this.fire(new t.Event("movestart", e)).fire(new t.Event("move", e))), this.fire(new t.Event("resize", e)), r && this.fire(new t.Event("moveend", e)), this;
          }
        }, {
          key: "getBounds",
          value: function getBounds() {
            return this.transform.getBounds();
          }
        }, {
          key: "getMaxBounds",
          value: function getMaxBounds() {
            return this.transform.getMaxBounds();
          }
        }, {
          key: "setMaxBounds",
          value: function setMaxBounds(e) {
            return this.transform.setMaxBounds(t.LngLatBounds.convert(e)), this._update();
          }
        }, {
          key: "setMinZoom",
          value: function setMinZoom(t) {
            if ((t = null == t ? -2 : t) >= -2 && t <= this.transform.maxZoom) return this.transform.minZoom = t, this._update(), this.getZoom() < t && this.setZoom(t), this;
            throw new Error("minZoom must be between -2 and the current maxZoom, inclusive");
          }
        }, {
          key: "getMinZoom",
          value: function getMinZoom() {
            return this.transform.minZoom;
          }
        }, {
          key: "setMaxZoom",
          value: function setMaxZoom(t) {
            if ((t = null == t ? 22 : t) >= this.transform.minZoom) return this.transform.maxZoom = t, this._update(), this.getZoom() > t && this.setZoom(t), this;
            throw new Error("maxZoom must be greater than the current minZoom");
          }
        }, {
          key: "getMaxZoom",
          value: function getMaxZoom() {
            return this.transform.maxZoom;
          }
        }, {
          key: "setMinPitch",
          value: function setMinPitch(t) {
            if ((t = null == t ? 0 : t) < 0) throw new Error("minPitch must be greater than or equal to 0");
            if (t >= 0 && t <= this.transform.maxPitch) return this.transform.minPitch = t, this._update(), this.getPitch() < t && this.setPitch(t), this;
            throw new Error("minPitch must be between 0 and the current maxPitch, inclusive");
          }
        }, {
          key: "getMinPitch",
          value: function getMinPitch() {
            return this.transform.minPitch;
          }
        }, {
          key: "setMaxPitch",
          value: function setMaxPitch(t) {
            if ((t = null == t ? 85 : t) > 85) throw new Error("maxPitch must be less than or equal to 85");
            if (t >= this.transform.minPitch) return this.transform.maxPitch = t, this._update(), this.getPitch() > t && this.setPitch(t), this;
            throw new Error("maxPitch must be greater than the current minPitch");
          }
        }, {
          key: "getMaxPitch",
          value: function getMaxPitch() {
            return this.transform.maxPitch;
          }
        }, {
          key: "getRenderWorldCopies",
          value: function getRenderWorldCopies() {
            return this.transform.renderWorldCopies;
          }
        }, {
          key: "setRenderWorldCopies",
          value: function setRenderWorldCopies(t) {
            return this.transform.renderWorldCopies = t, this._update();
          }
        }, {
          key: "project",
          value: function project(e) {
            return this.transform.locationPoint3D(t.LngLat.convert(e));
          }
        }, {
          key: "unproject",
          value: function unproject(e) {
            return this.transform.pointLocation3D(t.Point.convert(e));
          }
        }, {
          key: "isMoving",
          value: function isMoving() {
            return this._moving || this.handlers && this.handlers.isMoving();
          }
        }, {
          key: "isZooming",
          value: function isZooming() {
            return this._zooming || this.handlers && this.handlers.isZooming();
          }
        }, {
          key: "isRotating",
          value: function isRotating() {
            return this._rotating || this.handlers && this.handlers.isRotating();
          }
        }, {
          key: "_createDelegatedListener",
          value: function _createDelegatedListener(t, e, i) {
            var _this124 = this;

            if ("mouseenter" === t || "mouseover" === t) {
              var _o134 = !1;

              var _a159 = function _a159(a) {
                var r = _this124.getLayer(e) ? _this124.queryRenderedFeatures(a.point, {
                  layers: [e]
                }) : [];
                r.length ? _o134 || (_o134 = !0, i.call(_this124, new _o(t, _this124, a.originalEvent, {
                  features: r
                }))) : _o134 = !1;
              };

              return {
                layer: e,
                listener: i,
                delegates: {
                  mousemove: _a159,
                  mouseout: function mouseout() {
                    _o134 = !1;
                  }
                }
              };
            }

            if ("mouseleave" === t || "mouseout" === t) {
              var _o135 = !1;

              var _a160 = function _a160(a) {
                (_this124.getLayer(e) ? _this124.queryRenderedFeatures(a.point, {
                  layers: [e]
                }) : []).length ? _o135 = !0 : _o135 && (_o135 = !1, i.call(_this124, new _o(t, _this124, a.originalEvent)));
              },
                  _r256 = function _r256(e) {
                _o135 && (_o135 = !1, i.call(_this124, new _o(t, _this124, e.originalEvent)));
              };

              return {
                layer: e,
                listener: i,
                delegates: {
                  mousemove: _a160,
                  mouseout: _r256
                }
              };
            }

            {
              var _o136 = function _o136(t) {
                var o = _this124.getLayer(e) ? _this124.queryRenderedFeatures(t.point, {
                  layers: [e]
                }) : [];
                o.length && (t.features = o, i.call(_this124, t), delete t.features);
              };

              return {
                layer: e,
                listener: i,
                delegates: _defineProperty({}, t, _o136)
              };
            }
          }
        }, {
          key: "on",
          value: function on(t, e, i) {
            if (void 0 === i) return _get(_getPrototypeOf(Map.prototype), "on", this).call(this, t, e);

            var o = this._createDelegatedListener(t, e, i);

            this._delegatedListeners = this._delegatedListeners || {}, this._delegatedListeners[t] = this._delegatedListeners[t] || [], this._delegatedListeners[t].push(o);

            for (var _t417 in o.delegates) {
              this.on(_t417, o.delegates[_t417]);
            }

            return this;
          }
        }, {
          key: "once",
          value: function once(t, e, i) {
            if (void 0 === i) return _get(_getPrototypeOf(Map.prototype), "once", this).call(this, t, e);

            var o = this._createDelegatedListener(t, e, i);

            for (var _t418 in o.delegates) {
              this.once(_t418, o.delegates[_t418]);
            }

            return this;
          }
        }, {
          key: "off",
          value: function off(t, e, i) {
            var _this125 = this;

            return void 0 === i ? _get(_getPrototypeOf(Map.prototype), "off", this).call(this, t, e) : (this._delegatedListeners && this._delegatedListeners[t] && function (o) {
              var a = _this125._delegatedListeners[t];

              for (var _t419 = 0; _t419 < a.length; _t419++) {
                var _o137 = a[_t419];

                if (_o137.layer === e && _o137.listener === i) {
                  for (var _t420 in _o137.delegates) {
                    _this125.off(_t420, _o137.delegates[_t420]);
                  }

                  return a.splice(_t419, 1), _this125;
                }
              }
            }(), this);
          }
        }, {
          key: "queryRenderedFeatures",
          value: function queryRenderedFeatures(e, i) {
            return this.style ? (void 0 !== i || void 0 === e || e instanceof t.Point || Array.isArray(e) || (i = e, e = void 0), this.style.queryRenderedFeatures(e = e || [[0, 0], [this.transform.width, this.transform.height]], i = i || {}, this.transform)) : [];
          }
        }, {
          key: "querySourceFeatures",
          value: function querySourceFeatures(t, e) {
            return this.style.querySourceFeatures(t, e);
          }
        }, {
          key: "setStyle",
          value: function setStyle(e, i) {
            return !1 !== (i = t.extend({}, {
              localIdeographFontFamily: this._localIdeographFontFamily
            }, i)).diff && i.localIdeographFontFamily === this._localIdeographFontFamily && this.style && e ? (this._diffStyle(e, i), this) : (this._localIdeographFontFamily = i.localIdeographFontFamily, this._updateStyle(e, i));
          }
        }, {
          key: "_getUIString",
          value: function _getUIString(t) {
            var e = this._locale[t];
            if (null == e) throw new Error("Missing UI string '".concat(t, "'"));
            return e;
          }
        }, {
          key: "_updateStyle",
          value: function _updateStyle(t, e) {
            return this.style && (this.style.setEventedParent(null), this.style._remove(), delete this.style), t && (this.style = new Wt(this, e || {}), this.style.setEventedParent(this, {
              style: this.style
            }), "string" == typeof t ? this.style.loadURL(t) : this.style.loadJSON(t)), this._updateTerrain(), this;
          }
        }, {
          key: "_lazyInitEmptyStyle",
          value: function _lazyInitEmptyStyle() {
            this.style || (this.style = new Wt(this, {}), this.style.setEventedParent(this, {
              style: this.style
            }), this.style.loadEmpty());
          }
        }, {
          key: "_diffStyle",
          value: function _diffStyle(e, i) {
            var _this126 = this;

            if ("string" == typeof e) {
              var _o138 = this._requestManager.normalizeStyleURL(e),
                  _a161 = this._requestManager.transformRequest(_o138, t.ResourceType.Style);

              t.getJSON(_a161, function (e, o) {
                e ? _this126.fire(new t.ErrorEvent(e)) : o && _this126._updateDiff(o, i);
              });
            } else "object" == _typeof(e) && this._updateDiff(e, i);
          }
        }, {
          key: "_updateDiff",
          value: function _updateDiff(e, i) {
            try {
              this.style.setState(e) && this._update(!0);
            } catch (o) {
              t.warnOnce("Unable to perform style diff: ".concat(o.message || o.error || o, ".  Rebuilding the style from scratch.")), this._updateStyle(e, i);
            }
          }
        }, {
          key: "getStyle",
          value: function getStyle() {
            if (this.style) return this.style.serialize();
          }
        }, {
          key: "isStyleLoaded",
          value: function isStyleLoaded() {
            return this.style ? this.style.loaded() : t.warnOnce("There is no style added to the map.");
          }
        }, {
          key: "addSource",
          value: function addSource(t, e) {
            return this._lazyInitEmptyStyle(), this.style.addSource(t, e), this._update(!0);
          }
        }, {
          key: "isSourceLoaded",
          value: function isSourceLoaded(e) {
            var i = this.style && this.style._getSourceCaches(e);

            if (0 !== i.length) return i.every(function (t) {
              return t.loaded();
            });
            this.fire(new t.ErrorEvent(new Error("There is no source with ID '".concat(e, "'"))));
          }
        }, {
          key: "areTilesLoaded",
          value: function areTilesLoaded() {
            var t = this.style && this.style._sourceCaches;

            for (var _e353 in t) {
              var _i293 = t[_e353]._tiles;

              for (var _t421 in _i293) {
                var _e354 = _i293[_t421];
                if ("loaded" !== _e354.state && "errored" !== _e354.state) return !1;
              }
            }

            return !0;
          }
        }, {
          key: "addSourceType",
          value: function addSourceType(t, e, i) {
            return this._lazyInitEmptyStyle(), this.style.addSourceType(t, e, i);
          }
        }, {
          key: "removeSource",
          value: function removeSource(t) {
            return this.style.removeSource(t), this._updateTerrain(), this._update(!0);
          }
        }, {
          key: "getSource",
          value: function getSource(t) {
            return this.style.getSource(t);
          }
        }, {
          key: "addImage",
          value: function addImage(e, i) {
            var _ref192 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
                _ref192$pixelRatio = _ref192.pixelRatio,
                o = _ref192$pixelRatio === void 0 ? 1 : _ref192$pixelRatio,
                _ref192$sdf = _ref192.sdf,
                a = _ref192$sdf === void 0 ? !1 : _ref192$sdf,
                r = _ref192.stretchX,
                n = _ref192.stretchY,
                s = _ref192.content;

            if (this._lazyInitEmptyStyle(), i instanceof oa || ra && i instanceof ra) {
              var _t$browser$getImageDa = t.browser.getImageData(i),
                  _l59 = _t$browser$getImageDa.width,
                  _c45 = _t$browser$getImageDa.height,
                  _h33 = _t$browser$getImageDa.data;

              this.style.addImage(e, {
                data: new t.RGBAImage({
                  width: _l59,
                  height: _c45
                }, _h33),
                pixelRatio: o,
                stretchX: r,
                stretchY: n,
                content: s,
                sdf: a,
                version: 0
              });
            } else {
              if (void 0 === i.width || void 0 === i.height) return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));
              {
                var _l60 = i.width,
                    _c46 = i.height,
                    _h34 = i.data,
                    _u46 = i;
                this.style.addImage(e, {
                  data: new t.RGBAImage({
                    width: _l60,
                    height: _c46
                  }, new Uint8Array(_h34)),
                  pixelRatio: o,
                  stretchX: r,
                  stretchY: n,
                  content: s,
                  sdf: a,
                  version: 0,
                  userImage: _u46
                }), _u46.onAdd && _u46.onAdd(this, e);
              }
            }
          }
        }, {
          key: "updateImage",
          value: function updateImage(e, i) {
            var o = this.style.getImage(e);
            if (!o) return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));
            var a = i instanceof oa || ra && i instanceof ra ? t.browser.getImageData(i) : i,
                r = a.width,
                n = a.height,
                s = a.data;
            return void 0 === r || void 0 === n ? this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))) : r !== o.data.width || n !== o.data.height ? this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))) : (o.data.replace(s, !(i instanceof oa || ra && i instanceof ra)), void this.style.updateImage(e, o));
          }
        }, {
          key: "hasImage",
          value: function hasImage(e) {
            return e ? !!this.style.getImage(e) : (this.fire(new t.ErrorEvent(new Error("Missing required image id"))), !1);
          }
        }, {
          key: "removeImage",
          value: function removeImage(t) {
            this.style.removeImage(t);
          }
        }, {
          key: "loadImage",
          value: function loadImage(e, i) {
            t.getImage(this._requestManager.transformRequest(e, t.ResourceType.Image), i);
          }
        }, {
          key: "listImages",
          value: function listImages() {
            return this.style.listImages();
          }
        }, {
          key: "addLayer",
          value: function addLayer(t, e) {
            return this._lazyInitEmptyStyle(), this.style.addLayer(t, e), this._update(!0);
          }
        }, {
          key: "moveLayer",
          value: function moveLayer(t, e) {
            return this.style.moveLayer(t, e), this._update(!0);
          }
        }, {
          key: "removeLayer",
          value: function removeLayer(t) {
            return this.style.removeLayer(t), this._update(!0);
          }
        }, {
          key: "getLayer",
          value: function getLayer(t) {
            return this.style.getLayer(t);
          }
        }, {
          key: "setLayerZoomRange",
          value: function setLayerZoomRange(t, e, i) {
            return this.style.setLayerZoomRange(t, e, i), this._update(!0);
          }
        }, {
          key: "setFilter",
          value: function setFilter(t, e) {
            var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
            return this.style.setFilter(t, e, i), this._update(!0);
          }
        }, {
          key: "getFilter",
          value: function getFilter(t) {
            return this.style.getFilter(t);
          }
        }, {
          key: "setPaintProperty",
          value: function setPaintProperty(t, e, i) {
            var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
            return this.style.setPaintProperty(t, e, i, o), this._update(!0);
          }
        }, {
          key: "getPaintProperty",
          value: function getPaintProperty(t, e) {
            return this.style.getPaintProperty(t, e);
          }
        }, {
          key: "setLayoutProperty",
          value: function setLayoutProperty(t, e, i) {
            var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
            return this.style.setLayoutProperty(t, e, i, o), this._update(!0);
          }
        }, {
          key: "getLayoutProperty",
          value: function getLayoutProperty(t, e) {
            return this.style.getLayoutProperty(t, e);
          }
        }, {
          key: "setLight",
          value: function setLight(t) {
            var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
            return this._lazyInitEmptyStyle(), this.style.setLight(t, e), this._update(!0);
          }
        }, {
          key: "getLight",
          value: function getLight() {
            return this.style.getLight();
          }
        }, {
          key: "setTerrain",
          value: function setTerrain(t) {
            return this._lazyInitEmptyStyle(), this.style.setTerrain(t), this._update(!0);
          }
        }, {
          key: "setFeatureState",
          value: function setFeatureState(t, e) {
            return this.style.setFeatureState(t, e), this._update();
          }
        }, {
          key: "removeFeatureState",
          value: function removeFeatureState(t, e) {
            return this.style.removeFeatureState(t, e), this._update();
          }
        }, {
          key: "getFeatureState",
          value: function getFeatureState(t) {
            return this.style.getFeatureState(t);
          }
        }, {
          key: "getContainer",
          value: function getContainer() {
            return this._container;
          }
        }, {
          key: "getCanvasContainer",
          value: function getCanvasContainer() {
            return this._canvasContainer;
          }
        }, {
          key: "getCanvas",
          value: function getCanvas() {
            return this._canvas;
          }
        }, {
          key: "_containerDimensions",
          value: function _containerDimensions() {
            var t = 0,
                e = 0;
            return this._container && (t = this._container.clientWidth || 400, e = this._container.clientHeight || 300), [t, e];
          }
        }, {
          key: "_detectMissingCSS",
          value: function _detectMissingCSS() {
            "rgb(250, 128, 114)" !== t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color") && t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.");
          }
        }, {
          key: "_setupContainer",
          value: function _setupContainer() {
            var t = this._container;
            t.classList.add("mapboxgl-map"), (this._missingCSSCanary = a.create("div", "mapboxgl-canary", t)).style.visibility = "hidden", this._detectMissingCSS();
            var e = this._canvasContainer = a.create("div", "mapboxgl-canvas-container", t);
            this._interactive && e.classList.add("mapboxgl-interactive"), this._canvas = a.create("canvas", "mapboxgl-canvas", e), this._canvas.addEventListener("webglcontextlost", this._contextLost, !1), this._canvas.addEventListener("webglcontextrestored", this._contextRestored, !1), this._canvas.setAttribute("tabindex", "0"), this._canvas.setAttribute("aria-label", "Map"), this._canvas.setAttribute("role", "region");

            var i = this._containerDimensions();

            this._resizeCanvas(i[0], i[1]);

            var o = this._controlContainer = a.create("div", "mapboxgl-control-container", t),
                r = this._controlPositions = {};
            ["top-left", "top-right", "bottom-left", "bottom-right"].forEach(function (t) {
              r[t] = a.create("div", "mapboxgl-ctrl-".concat(t), o);
            }), this._container.addEventListener("scroll", this._onMapScroll, !1);
          }
        }, {
          key: "_resizeCanvas",
          value: function _resizeCanvas(e, i) {
            var o = t.browser.devicePixelRatio || 1;
            this._canvas.width = o * e, this._canvas.height = o * i, this._canvas.style.width = "".concat(e, "px"), this._canvas.style.height = "".concat(i, "px");
          }
        }, {
          key: "_setupPainter",
          value: function _setupPainter() {
            var _this127 = this;

            var i = t.extend({}, e.webGLContextAttributes, {
              failIfMajorPerformanceCaveat: this._failIfMajorPerformanceCaveat,
              preserveDrawingBuffer: this._preserveDrawingBuffer,
              antialias: this._antialias || !1
            }),
                o = this._canvas.getContext("webgl", i) || this._canvas.getContext("experimental-webgl", i);

            o ? (this.painter = new ji(o, this.transform), this.on("data", function (t) {
              "source" === t.dataType && _this127.painter.setTileLoadedFlag(!0);
            }), t.webpSupported.testSupport(o)) : this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")));
          }
        }, {
          key: "_contextLost",
          value: function _contextLost(e) {
            e.preventDefault(), this._frame && (this._frame.cancel(), this._frame = null), this.fire(new t.Event("webglcontextlost", {
              originalEvent: e
            }));
          }
        }, {
          key: "_contextRestored",
          value: function _contextRestored(e) {
            this._setupPainter(), this.resize(), this._update(), this.fire(new t.Event("webglcontextrestored", {
              originalEvent: e
            }));
          }
        }, {
          key: "_onMapScroll",
          value: function _onMapScroll(t) {
            if (t.target === this._container) return this._container.scrollTop = 0, this._container.scrollLeft = 0, !1;
          }
        }, {
          key: "loaded",
          value: function loaded() {
            return !this._styleDirty && !this._sourcesDirty && !!this.style && this.style.loaded();
          }
        }, {
          key: "_update",
          value: function _update(t) {
            return this.style ? (this._styleDirty = this._styleDirty || t, this._sourcesDirty = !0, this.triggerRepaint(), this) : this;
          }
        }, {
          key: "_requestRenderFrame",
          value: function _requestRenderFrame(t) {
            return this._update(), this._renderTaskQueue.add(t);
          }
        }, {
          key: "_cancelRenderFrame",
          value: function _cancelRenderFrame(t) {
            this._renderTaskQueue.remove(t);
          }
        }, {
          key: "_render",
          value: function _render(e) {
            var _this128 = this;

            var i,
                o = 0;
            var a = this.painter.context.extTimerQuery;
            if (this.listens("gpu-timing-frame") && (i = a.createQueryEXT(), a.beginQueryEXT(a.TIME_ELAPSED_EXT, i), o = t.browser.now()), this.painter.context.setDirty(), this.painter.setBaseState(), this._renderTaskQueue.run(e), this._removed) return;
            var r = !1;
            var n = this._isInitialLoad ? 0 : this._fadeDuration;

            if (this.style && this._styleDirty) {
              this._styleDirty = !1;

              var _e355 = this.transform.zoom,
                  _i294 = t.browser.now();

              this.style.zoomHistory.update(_e355, _i294);

              var _o139 = new t.EvaluationParameters(_e355, {
                now: _i294,
                fadeDuration: n,
                zoomHistory: this.style.zoomHistory,
                transition: this.style.getTransition()
              }),
                  _a162 = _o139.crossFadingFactor();

              1 === _a162 && _a162 === this._crossFadingFactor || (r = !0, this._crossFadingFactor = _a162), this.style.update(_o139);
            }

            if (this.style && this._sourcesDirty && (this._sourcesDirty = !1, this._updateTerrain(), this.style._updateSources(this.transform)), this._placementDirty = this.style && this.style._updatePlacement(this.painter.transform, this.showCollisionBoxes, n, this._crossSourceCollisions), this.painter.render(this.style, {
              showTileBoundaries: this.showTileBoundaries,
              showOverdrawInspector: this._showOverdrawInspector,
              showQueryGeometry: !!this._showQueryGeometry,
              rotating: this.isRotating(),
              zooming: this.isZooming(),
              moving: this.isMoving(),
              fadeDuration: n,
              isInitialLoad: this._isInitialLoad,
              showPadding: this.showPadding,
              gpuTiming: !!this.listens("gpu-timing-layer"),
              speedIndexTiming: this.speedIndexTiming
            }), this.fire(new t.Event("render")), this.loaded() && !this._loaded && (this._loaded = !0, this.fire(new t.Event("load"))), this.style && (this.style.hasTransitions() || r) && (this._styleDirty = !0), this.style && !this._placementDirty && this.style._releaseSymbolFadeTiles(), this.listens("gpu-timing-frame")) {
              var _e356 = t.browser.now() - o;

              a.endQueryEXT(a.TIME_ELAPSED_EXT, i), setTimeout(function () {
                var o = a.getQueryObjectEXT(i, a.QUERY_RESULT_EXT) / 1e6;
                a.deleteQueryEXT(i), _this128.fire(new t.Event("gpu-timing-frame", {
                  cpuTime: _e356,
                  gpuTime: o
                }));
              }, 50);
            }

            if (this.listens("gpu-timing-layer")) {
              var _e357 = this.painter.collectGpuTimers();

              setTimeout(function () {
                var i = _this128.painter.queryGpuTimers(_e357);

                _this128.fire(new t.Event("gpu-timing-layer", {
                  layerTimes: i
                }));
              }, 50);
            }

            var s = this._sourcesDirty || this._styleDirty || this._placementDirty;
            if (s || this._repaint) this.triggerRepaint();else if (this._triggerFrame(!1), !this.isMoving() && this.loaded() && (this.fire(new t.Event("idle")), this._isInitialLoad && this._authenticate(), this._isInitialLoad = !1, this.speedIndexTiming)) {
              var _e358 = this._calculateSpeedIndex();

              this.fire(new t.Event("speedindexcompleted", {
                speedIndex: _e358
              })), this.speedIndexTiming = !1;
            }
            return !this._loaded || this._fullyLoaded || s || (this._fullyLoaded = !0), this;
          }
        }, {
          key: "_authenticate",
          value: function _authenticate() {
            var _this129 = this;

            t.getMapSessionAPI(this._getMapId(), this._requestManager._skuToken, this._requestManager._customAccessToken, function (e) {
              if (e && (e.message === t.AUTH_ERR_MSG || 401 === e.status)) {
                console.error("Error: A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/"), t.browser.setErrorState();
                var _e359 = _this129.painter.context.gl;
                _this129._logoControl instanceof ta && _this129._logoControl._updateLogo(), _e359 && _e359.clear(_e359.DEPTH_BUFFER_BIT | _e359.COLOR_BUFFER_BIT | _e359.STENCIL_BUFFER_BIT);
              }
            }), t.postMapLoadEvent(this._getMapId(), this._requestManager._skuToken, this._requestManager._customAccessToken, function () {});
          }
        }, {
          key: "_updateTerrain",
          value: function _updateTerrain() {
            this.painter.updateTerrain(this.style, this.isMoving() || this.isRotating() || this.isZooming());
          }
        }, {
          key: "_calculateSpeedIndex",
          value: function _calculateSpeedIndex() {
            var t = this.painter.canvasCopy(),
                e = this.painter.getCanvasCopiesAndTimestamps();
            e.timeStamps.push(performance.now());
            var i = this.painter.context.gl,
                o = i.createFramebuffer();

            function a(t) {
              i.framebufferTexture2D(i.FRAMEBUFFER, i.COLOR_ATTACHMENT0, i.TEXTURE_2D, t, 0);
              var e = new Uint8Array(i.drawingBufferWidth * i.drawingBufferHeight * 4);
              return i.readPixels(0, 0, i.drawingBufferWidth, i.drawingBufferHeight, i.RGBA, i.UNSIGNED_BYTE, e), e;
            }

            return i.bindFramebuffer(i.FRAMEBUFFER, o), this._canvasPixelComparison(a(t), e.canvasCopies.map(a), e.timeStamps);
          }
        }, {
          key: "_canvasPixelComparison",
          value: function _canvasPixelComparison(t, e, i) {
            var o = i[1] - i[0];
            var a = t.length / 4;

            for (var _r257 = 0; _r257 < e.length; _r257++) {
              var _n162 = e[_r257];
              var _s127 = 0;

              for (var _e360 = 0; _e360 < _n162.length; _e360 += 4) {
                _n162[_e360] === t[_e360] && _n162[_e360 + 1] === t[_e360 + 1] && _n162[_e360 + 2] === t[_e360 + 2] && _n162[_e360 + 3] === t[_e360 + 3] && (_s127 += 1);
              }

              o += (i[_r257 + 2] - i[_r257 + 1]) * (1 - _s127 / a);
            }

            return o;
          }
        }, {
          key: "remove",
          value: function remove() {
            this._hash && this._hash.remove();

            var _iterator232 = _createForOfIteratorHelper(this._controls),
                _step232;

            try {
              for (_iterator232.s(); !(_step232 = _iterator232.n()).done;) {
                var _t422 = _step232.value;

                _t422.onRemove(this);
              }
            } catch (err) {
              _iterator232.e(err);
            } finally {
              _iterator232.f();
            }

            this._controls = [], this._frame && (this._frame.cancel(), this._frame = null), this._renderTaskQueue.clear(), this.painter.destroy(), this.handlers.destroy(), delete this.handlers, this.setStyle(null), void 0 !== t.window && (t.window.removeEventListener("resize", this._onWindowResize, !1), t.window.removeEventListener("orientationchange", this._onWindowResize, !1), t.window.removeEventListener("online", this._onWindowOnline, !1));
            var e = this.painter.context.gl.getExtension("WEBGL_lose_context");
            e && e.loseContext(), sa(this._canvasContainer), sa(this._controlContainer), sa(this._missingCSSCanary), this._container.classList.remove("mapboxgl-map"), this._removed = !0, this.fire(new t.Event("remove"));
          }
        }, {
          key: "triggerRepaint",
          value: function triggerRepaint() {
            this._triggerFrame(!0);
          }
        }, {
          key: "_triggerFrame",
          value: function _triggerFrame(e) {
            var _this130 = this;

            this._renderNextFrame = this._renderNextFrame || e, this.style && !this._frame && (this._frame = t.browser.frame(function (t) {
              var e = !!_this130._renderNextFrame;
              _this130._frame = null, _this130._renderNextFrame = null, e && _this130._render(t);
            }));
          }
        }, {
          key: "_onWindowOnline",
          value: function _onWindowOnline() {
            this._update();
          }
        }, {
          key: "_onWindowResize",
          value: function _onWindowResize(t) {
            this._trackResize && this.resize({
              originalEvent: t
            })._update();
          }
        }, {
          key: "_setCacheLimits",
          value: function _setCacheLimits(e, i) {
            t.setCacheLimits(e, i);
          }
        }, {
          key: "showTileBoundaries",
          get: function get() {
            return !!this._showTileBoundaries;
          },
          set: function set(t) {
            this._showTileBoundaries !== t && (this._showTileBoundaries = t, this._update());
          }
        }, {
          key: "speedIndexTiming",
          get: function get() {
            return !!this._speedIndexTiming;
          },
          set: function set(t) {
            this._speedIndexTiming !== t && (this._speedIndexTiming = t, this._update());
          }
        }, {
          key: "showPadding",
          get: function get() {
            return !!this._showPadding;
          },
          set: function set(t) {
            this._showPadding !== t && (this._showPadding = t, this._update());
          }
        }, {
          key: "showCollisionBoxes",
          get: function get() {
            return !!this._showCollisionBoxes;
          },
          set: function set(t) {
            this._showCollisionBoxes !== t && (this._showCollisionBoxes = t, t ? this.style._generateCollisionBoxes() : this._update());
          }
        }, {
          key: "showOverdrawInspector",
          get: function get() {
            return !!this._showOverdrawInspector;
          },
          set: function set(t) {
            this._showOverdrawInspector !== t && (this._showOverdrawInspector = t, this._update());
          }
        }, {
          key: "repaint",
          get: function get() {
            return !!this._repaint;
          },
          set: function set(t) {
            this._repaint !== t && (this._repaint = t, this.triggerRepaint());
          }
        }, {
          key: "vertices",
          get: function get() {
            return !!this._vertices;
          },
          set: function set(t) {
            this._vertices = t, this._update();
          }
        }, {
          key: "version",
          get: function get() {
            return t.version;
          }
        }]);

        return Map;
      }(Jo),
      NavigationControl: /*#__PURE__*/function () {
        function NavigationControl(e) {
          var _this131 = this;

          _classCallCheck(this, NavigationControl);

          this.options = t.extend({}, la, e), this._container = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-group"), this._container.addEventListener("contextmenu", function (t) {
            return t.preventDefault();
          }), this.options.showZoom && (t.bindAll(["_setButtonTitle", "_updateZoomButtons"], this), this._zoomInButton = this._createButton("mapboxgl-ctrl-zoom-in", function (t) {
            return _this131._map.zoomIn({}, {
              originalEvent: t
            });
          }), a.create("span", "mapboxgl-ctrl-icon", this._zoomInButton).setAttribute("aria-hidden", !0), this._zoomOutButton = this._createButton("mapboxgl-ctrl-zoom-out", function (t) {
            return _this131._map.zoomOut({}, {
              originalEvent: t
            });
          }), a.create("span", "mapboxgl-ctrl-icon", this._zoomOutButton).setAttribute("aria-hidden", !0)), this.options.showCompass && (t.bindAll(["_rotateCompassArrow"], this), this._compass = this._createButton("mapboxgl-ctrl-compass", function (t) {
            _this131.options.visualizePitch ? _this131._map.resetNorthPitch({}, {
              originalEvent: t
            }) : _this131._map.resetNorth({}, {
              originalEvent: t
            });
          }), this._compassIcon = a.create("span", "mapboxgl-ctrl-icon", this._compass), this._compassIcon.setAttribute("aria-hidden", !0));
        }

        _createClass(NavigationControl, [{
          key: "_updateZoomButtons",
          value: function _updateZoomButtons() {
            var t = this._map.getZoom(),
                e = t === this._map.getMaxZoom(),
                i = t === this._map.getMinZoom();

            this._zoomInButton.disabled = e, this._zoomOutButton.disabled = i, this._zoomInButton.setAttribute("aria-disabled", e.toString()), this._zoomOutButton.setAttribute("aria-disabled", i.toString());
          }
        }, {
          key: "_rotateCompassArrow",
          value: function _rotateCompassArrow() {
            var t = this.options.visualizePitch ? "scale(".concat(1 / Math.pow(Math.cos(this._map.transform.pitch * (Math.PI / 180)), .5), ") rotateX(").concat(this._map.transform.pitch, "deg) rotateZ(").concat(this._map.transform.angle * (180 / Math.PI), "deg)") : "rotate(".concat(this._map.transform.angle * (180 / Math.PI), "deg)");
            this._compassIcon.style.transform = t;
          }
        }, {
          key: "onAdd",
          value: function onAdd(t) {
            return this._map = t, this.options.showZoom && (this._setButtonTitle(this._zoomInButton, "ZoomIn"), this._setButtonTitle(this._zoomOutButton, "ZoomOut"), this._map.on("zoom", this._updateZoomButtons), this._updateZoomButtons()), this.options.showCompass && (this._setButtonTitle(this._compass, "ResetBearing"), this.options.visualizePitch && this._map.on("pitch", this._rotateCompassArrow), this._map.on("rotate", this._rotateCompassArrow), this._rotateCompassArrow(), this._handler = new ca(this._map, this._compass, this.options.visualizePitch)), this._container;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            a.remove(this._container), this.options.showZoom && this._map.off("zoom", this._updateZoomButtons), this.options.showCompass && (this.options.visualizePitch && this._map.off("pitch", this._rotateCompassArrow), this._map.off("rotate", this._rotateCompassArrow), this._handler.off(), delete this._handler), delete this._map;
          }
        }, {
          key: "_createButton",
          value: function _createButton(t, e) {
            var i = a.create("button", t, this._container);
            return i.type = "button", i.addEventListener("click", e), i;
          }
        }, {
          key: "_setButtonTitle",
          value: function _setButtonTitle(t, e) {
            var i = this._map._getUIString("NavigationControl.".concat(e));

            t.title = i, t.setAttribute("aria-label", i);
          }
        }]);

        return NavigationControl;
      }(),
      GeolocateControl: /*#__PURE__*/function (_t$Evented11) {
        _inherits(GeolocateControl, _t$Evented11);

        var _super126 = _createSuper(GeolocateControl);

        function GeolocateControl(e) {
          var _this132;

          _classCallCheck(this, GeolocateControl);

          _this132 = _super126.call(this), _this132.options = t.extend({}, ma, e), t.bindAll(["_onSuccess", "_onError", "_onZoom", "_finish", "_setupUI", "_updateCamera", "_updateMarker"], _assertThisInitialized(_this132));
          return _this132;
        }

        _createClass(GeolocateControl, [{
          key: "onAdd",
          value: function onAdd(e) {
            var i;
            return this._map = e, this._container = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-group"), i = this._setupUI, void 0 !== pa ? i(pa) : void 0 !== t.window.navigator.permissions ? t.window.navigator.permissions.query({
              name: "geolocation"
            }).then(function (t) {
              pa = "denied" !== t.state, i(pa);
            }) : (pa = !!t.window.navigator.geolocation, i(pa)), this._container;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            void 0 !== this._geolocationWatchID && (t.window.navigator.geolocation.clearWatch(this._geolocationWatchID), this._geolocationWatchID = void 0), this.options.showUserLocation && this._userLocationDotMarker && this._userLocationDotMarker.remove(), this.options.showAccuracyCircle && this._accuracyCircleMarker && this._accuracyCircleMarker.remove(), a.remove(this._container), this._map.off("zoom", this._onZoom), this._map = void 0, fa = 0, ga = !1;
          }
        }, {
          key: "_isOutOfMapMaxBounds",
          value: function _isOutOfMapMaxBounds(t) {
            var e = this._map.getMaxBounds(),
                i = t.coords;

            return e && (i.longitude < e.getWest() || i.longitude > e.getEast() || i.latitude < e.getSouth() || i.latitude > e.getNorth());
          }
        }, {
          key: "_setErrorState",
          value: function _setErrorState() {
            switch (this._watchState) {
              case "WAITING_ACTIVE":
                this._watchState = "ACTIVE_ERROR", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");
                break;

              case "ACTIVE_LOCK":
                this._watchState = "ACTIVE_ERROR", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");
                break;

              case "BACKGROUND":
                this._watchState = "BACKGROUND_ERROR", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");
            }
          }
        }, {
          key: "_onSuccess",
          value: function _onSuccess(e) {
            if (this._map) {
              if (this._isOutOfMapMaxBounds(e)) return this._setErrorState(), this.fire(new t.Event("outofmaxbounds", e)), this._updateMarker(), void this._finish();
              if (this.options.trackUserLocation) switch (this._lastKnownPosition = e, this._watchState) {
                case "WAITING_ACTIVE":
                case "ACTIVE_LOCK":
                case "ACTIVE_ERROR":
                  this._watchState = "ACTIVE_LOCK", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");
                  break;

                case "BACKGROUND":
                case "BACKGROUND_ERROR":
                  this._watchState = "BACKGROUND", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");
              }
              this.options.showUserLocation && "OFF" !== this._watchState && this._updateMarker(e), this.options.trackUserLocation && "ACTIVE_LOCK" !== this._watchState || this._updateCamera(e), this.options.showUserLocation && this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"), this.fire(new t.Event("geolocate", e)), this._finish();
            }
          }
        }, {
          key: "_updateCamera",
          value: function _updateCamera(e) {
            var i = new t.LngLat(e.coords.longitude, e.coords.latitude),
                o = e.coords.accuracy,
                a = this._map.getBearing(),
                r = t.extend({
              bearing: a
            }, this.options.fitBoundsOptions);

            this._map.fitBounds(i.toBounds(o), r, {
              geolocateSource: !0
            });
          }
        }, {
          key: "_updateMarker",
          value: function _updateMarker(e) {
            if (e) {
              var _i295 = new t.LngLat(e.coords.longitude, e.coords.latitude);

              this._accuracyCircleMarker.setLngLat(_i295).addTo(this._map), this._userLocationDotMarker.setLngLat(_i295).addTo(this._map), this._accuracy = e.coords.accuracy, this.options.showUserLocation && this.options.showAccuracyCircle && this._updateCircleRadius();
            } else this._userLocationDotMarker.remove(), this._accuracyCircleMarker.remove();
          }
        }, {
          key: "_updateCircleRadius",
          value: function _updateCircleRadius() {
            var t = this._map._container.clientHeight / 2,
                e = this._map.unproject([0, t]),
                i = this._map.unproject([1, t]),
                o = e.distanceTo(i),
                a = Math.ceil(2 * this._accuracy / o);

            this._circleElement.style.width = "".concat(a, "px"), this._circleElement.style.height = "".concat(a, "px");
          }
        }, {
          key: "_onZoom",
          value: function _onZoom() {
            this.options.showUserLocation && this.options.showAccuracyCircle && this._updateCircleRadius();
          }
        }, {
          key: "_onError",
          value: function _onError(e) {
            if (this._map) {
              if (this.options.trackUserLocation) if (1 === e.code) {
                this._watchState = "OFF", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"), this._geolocateButton.disabled = !0;

                var _t423 = this._map._getUIString("GeolocateControl.LocationNotAvailable");

                this._geolocateButton.title = _t423, this._geolocateButton.setAttribute("aria-label", _t423), void 0 !== this._geolocationWatchID && this._clearWatch();
              } else {
                if (3 === e.code && ga) return;

                this._setErrorState();
              }
              "OFF" !== this._watchState && this.options.showUserLocation && this._dotElement.classList.add("mapboxgl-user-location-dot-stale"), this.fire(new t.Event("error", e)), this._finish();
            }
          }
        }, {
          key: "_finish",
          value: function _finish() {
            this._timeoutId && clearTimeout(this._timeoutId), this._timeoutId = void 0;
          }
        }, {
          key: "_setupUI",
          value: function _setupUI(e) {
            var _this133 = this;

            if (this._container.addEventListener("contextmenu", function (t) {
              return t.preventDefault();
            }), this._geolocateButton = a.create("button", "mapboxgl-ctrl-geolocate", this._container), a.create("span", "mapboxgl-ctrl-icon", this._geolocateButton).setAttribute("aria-hidden", !0), this._geolocateButton.type = "button", !1 === e) {
              t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");

              var _e361 = this._map._getUIString("GeolocateControl.LocationNotAvailable");

              this._geolocateButton.disabled = !0, this._geolocateButton.title = _e361, this._geolocateButton.setAttribute("aria-label", _e361);
            } else {
              var _t424 = this._map._getUIString("GeolocateControl.FindMyLocation");

              this._geolocateButton.title = _t424, this._geolocateButton.setAttribute("aria-label", _t424);
            }

            this.options.trackUserLocation && (this._geolocateButton.setAttribute("aria-pressed", "false"), this._watchState = "OFF"), this.options.showUserLocation && (this._dotElement = a.create("div", "mapboxgl-user-location-dot"), this._userLocationDotMarker = new _a(this._dotElement), this._circleElement = a.create("div", "mapboxgl-user-location-accuracy-circle"), this._accuracyCircleMarker = new _a({
              element: this._circleElement,
              pitchAlignment: "map"
            }), this.options.trackUserLocation && (this._watchState = "OFF"), this._map.on("zoom", this._onZoom)), this._geolocateButton.addEventListener("click", this.trigger.bind(this)), this._setup = !0, this.options.trackUserLocation && this._map.on("movestart", function (e) {
              e.geolocateSource || "ACTIVE_LOCK" !== _this133._watchState || e.originalEvent && "resize" === e.originalEvent.type || (_this133._watchState = "BACKGROUND", _this133._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"), _this133._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), _this133.fire(new t.Event("trackuserlocationend")));
            });
          }
        }, {
          key: "trigger",
          value: function trigger() {
            if (!this._setup) return t.warnOnce("Geolocate control triggered before added to a map"), !1;

            if (this.options.trackUserLocation) {
              switch (this._watchState) {
                case "OFF":
                  this._watchState = "WAITING_ACTIVE", this.fire(new t.Event("trackuserlocationstart"));
                  break;

                case "WAITING_ACTIVE":
                case "ACTIVE_LOCK":
                case "ACTIVE_ERROR":
                case "BACKGROUND_ERROR":
                  fa--, ga = !1, this._watchState = "OFF", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"), this.fire(new t.Event("trackuserlocationend"));
                  break;

                case "BACKGROUND":
                  this._watchState = "ACTIVE_LOCK", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"), this._lastKnownPosition && this._updateCamera(this._lastKnownPosition), this.fire(new t.Event("trackuserlocationstart"));
              }

              switch (this._watchState) {
                case "WAITING_ACTIVE":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");
                  break;

                case "ACTIVE_LOCK":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");

                  break;

                case "ACTIVE_ERROR":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");
                  break;

                case "BACKGROUND":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");

                  break;

                case "BACKGROUND_ERROR":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error");
              }

              if ("OFF" === this._watchState && void 0 !== this._geolocationWatchID) this._clearWatch();else if (void 0 === this._geolocationWatchID) {
                var _e362;

                this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.setAttribute("aria-pressed", "true"), fa++, fa > 1 ? (_e362 = {
                  maximumAge: 6e5,
                  timeout: 0
                }, ga = !0) : (_e362 = this.options.positionOptions, ga = !1), this._geolocationWatchID = t.window.navigator.geolocation.watchPosition(this._onSuccess, this._onError, _e362);
              }
            } else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess, this._onError, this.options.positionOptions), this._timeoutId = setTimeout(this._finish, 1e4);

            return !0;
          }
        }, {
          key: "_clearWatch",
          value: function _clearWatch() {
            t.window.navigator.geolocation.clearWatch(this._geolocationWatchID), this._geolocationWatchID = void 0, this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.setAttribute("aria-pressed", "false"), this.options.showUserLocation && this._updateMarker(null);
          }
        }]);

        return GeolocateControl;
      }(t.Evented),
      AttributionControl: Qo,
      ScaleControl: /*#__PURE__*/function () {
        function ScaleControl(e) {
          _classCallCheck(this, ScaleControl);

          this.options = t.extend({}, va, e), t.bindAll(["_onMove", "setUnit"], this);
        }

        _createClass(ScaleControl, [{
          key: "getDefaultPosition",
          value: function getDefaultPosition() {
            return "bottom-left";
          }
        }, {
          key: "_onMove",
          value: function _onMove() {
            xa(this._map, this._container, this.options);
          }
        }, {
          key: "onAdd",
          value: function onAdd(t) {
            return this._map = t, this._container = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-scale", t.getContainer()), this._map.on("move", this._onMove), this._onMove(), this._container;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            a.remove(this._container), this._map.off("move", this._onMove), this._map = void 0;
          }
        }, {
          key: "setUnit",
          value: function setUnit(t) {
            this.options.unit = t, xa(this._map, this._container, this.options);
          }
        }]);

        return ScaleControl;
      }(),
      FullscreenControl: /*#__PURE__*/function () {
        function FullscreenControl(e) {
          _classCallCheck(this, FullscreenControl);

          this._fullscreen = !1, e && e.container && (e.container instanceof t.window.HTMLElement ? this._container = e.container : t.warnOnce("Full screen control 'container' must be a DOM element.")), t.bindAll(["_onClickFullscreen", "_changeIcon"], this), "onfullscreenchange" in t.window.document ? this._fullscreenchange = "fullscreenchange" : "onwebkitfullscreenchange" in t.window.document && (this._fullscreenchange = "webkitfullscreenchange");
        }

        _createClass(FullscreenControl, [{
          key: "onAdd",
          value: function onAdd(e) {
            return this._map = e, this._container || (this._container = this._map.getContainer()), this._controlContainer = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-group"), this._checkFullscreenSupport() ? this._setupUI() : (this._controlContainer.style.display = "none", t.warnOnce("This device does not support fullscreen mode.")), this._controlContainer;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            a.remove(this._controlContainer), this._map = null, t.window.document.removeEventListener(this._fullscreenchange, this._changeIcon);
          }
        }, {
          key: "_checkFullscreenSupport",
          value: function _checkFullscreenSupport() {
            return !(!t.window.document.fullscreenEnabled && !t.window.document.webkitFullscreenEnabled);
          }
        }, {
          key: "_setupUI",
          value: function _setupUI() {
            var e = this._fullscreenButton = a.create("button", "mapboxgl-ctrl-fullscreen", this._controlContainer);
            a.create("span", "mapboxgl-ctrl-icon", e).setAttribute("aria-hidden", !0), e.type = "button", this._updateTitle(), this._fullscreenButton.addEventListener("click", this._onClickFullscreen), t.window.document.addEventListener(this._fullscreenchange, this._changeIcon);
          }
        }, {
          key: "_updateTitle",
          value: function _updateTitle() {
            var t = this._getTitle();

            this._fullscreenButton.setAttribute("aria-label", t), this._fullscreenButton.title = t;
          }
        }, {
          key: "_getTitle",
          value: function _getTitle() {
            return this._map._getUIString(this._isFullscreen() ? "FullscreenControl.Exit" : "FullscreenControl.Enter");
          }
        }, {
          key: "_isFullscreen",
          value: function _isFullscreen() {
            return this._fullscreen;
          }
        }, {
          key: "_changeIcon",
          value: function _changeIcon() {
            (t.window.document.fullscreenElement || t.window.document.webkitFullscreenElement) === this._container !== this._fullscreen && (this._fullscreen = !this._fullscreen, this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"), this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"), this._updateTitle());
          }
        }, {
          key: "_onClickFullscreen",
          value: function _onClickFullscreen() {
            this._isFullscreen() ? t.window.document.exitFullscreen ? t.window.document.exitFullscreen() : t.window.document.webkitCancelFullScreen && t.window.document.webkitCancelFullScreen() : this._container.requestFullscreen ? this._container.requestFullscreen() : this._container.webkitRequestFullscreen && this._container.webkitRequestFullscreen();
          }
        }]);

        return FullscreenControl;
      }(),
      Popup: /*#__PURE__*/function (_t$Evented12) {
        _inherits(Popup, _t$Evented12);

        var _super127 = _createSuper(Popup);

        function Popup(e) {
          var _this134;

          _classCallCheck(this, Popup);

          _this134 = _super127.call(this), _this134.options = t.extend(Object.create(ba), e), t.bindAll(["_update", "_onClose", "remove", "_onMouseMove", "_onMouseUp", "_onDrag"], _assertThisInitialized(_this134));
          return _this134;
        }

        _createClass(Popup, [{
          key: "addTo",
          value: function addTo(e) {
            return this._map && this.remove(), this._map = e, this.options.closeOnClick && this._map.on("click", this._onClose), this.options.closeOnMove && this._map.on("move", this._onClose), this._map.on("remove", this.remove), this._update(), this._focusFirstElement(), this._trackPointer ? (this._map.on("mousemove", this._onMouseMove), this._map.on("mouseup", this._onMouseUp), this._container && this._container.classList.add("mapboxgl-popup-track-pointer"), this._map._canvasContainer.classList.add("mapboxgl-track-pointer")) : this._map.on("move", this._update), this.fire(new t.Event("open")), this;
          }
        }, {
          key: "isOpen",
          value: function isOpen() {
            return !!this._map;
          }
        }, {
          key: "remove",
          value: function remove() {
            return this._content && a.remove(this._content), this._container && (a.remove(this._container), delete this._container), this._map && (this._map.off("move", this._update), this._map.off("move", this._onClose), this._map.off("click", this._onClose), this._map.off("remove", this.remove), this._map.off("mousemove", this._onMouseMove), this._map.off("mouseup", this._onMouseUp), this._map.off("drag", this._onDrag), delete this._map), this.fire(new t.Event("close")), this;
          }
        }, {
          key: "getLngLat",
          value: function getLngLat() {
            return this._lngLat;
          }
        }, {
          key: "setLngLat",
          value: function setLngLat(e) {
            return this._lngLat = t.LngLat.convert(e), this._pos = null, this._trackPointer = !1, this._update(), this._map && (this._map.on("move", this._update), this._map.off("mousemove", this._onMouseMove), this._container && this._container.classList.remove("mapboxgl-popup-track-pointer"), this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")), this;
          }
        }, {
          key: "trackPointer",
          value: function trackPointer() {
            return this._trackPointer = !0, this._pos = null, this._update(), this._map && (this._map.off("move", this._update), this._map.on("mousemove", this._onMouseMove), this._map.on("drag", this._onDrag), this._container && this._container.classList.add("mapboxgl-popup-track-pointer"), this._map._canvasContainer.classList.add("mapboxgl-track-pointer")), this;
          }
        }, {
          key: "getElement",
          value: function getElement() {
            return this._container;
          }
        }, {
          key: "setText",
          value: function setText(e) {
            return this.setDOMContent(t.window.document.createTextNode(e));
          }
        }, {
          key: "setHTML",
          value: function setHTML(e) {
            var i = t.window.document.createDocumentFragment(),
                o = t.window.document.createElement("body");
            var a;

            for (o.innerHTML = e; a = o.firstChild, a;) {
              i.appendChild(a);
            }

            return this.setDOMContent(i);
          }
        }, {
          key: "getMaxWidth",
          value: function getMaxWidth() {
            return this._container && this._container.style.maxWidth;
          }
        }, {
          key: "setMaxWidth",
          value: function setMaxWidth(t) {
            return this.options.maxWidth = t, this._update(), this;
          }
        }, {
          key: "setDOMContent",
          value: function setDOMContent(t) {
            if (this._content) for (; this._content.hasChildNodes();) {
              this._content.firstChild && this._content.removeChild(this._content.firstChild);
            } else this._content = a.create("div", "mapboxgl-popup-content", this._container);
            return this._content.appendChild(t), this._createCloseButton(), this._update(), this._focusFirstElement(), this;
          }
        }, {
          key: "addClassName",
          value: function addClassName(t) {
            this._container && this._container.classList.add(t);
          }
        }, {
          key: "removeClassName",
          value: function removeClassName(t) {
            this._container && this._container.classList.remove(t);
          }
        }, {
          key: "setOffset",
          value: function setOffset(t) {
            return this.options.offset = t, this._update(), this;
          }
        }, {
          key: "toggleClassName",
          value: function toggleClassName(t) {
            if (this._container) return this._container.classList.toggle(t);
          }
        }, {
          key: "_createCloseButton",
          value: function _createCloseButton() {
            this.options.closeButton && (this._closeButton = a.create("button", "mapboxgl-popup-close-button", this._content), this._closeButton.type = "button", this._closeButton.setAttribute("aria-label", "Close popup"), this._closeButton.innerHTML = "&#215;", this._closeButton.addEventListener("click", this._onClose));
          }
        }, {
          key: "_onMouseUp",
          value: function _onMouseUp(t) {
            this._update(t.point);
          }
        }, {
          key: "_onMouseMove",
          value: function _onMouseMove(t) {
            this._update(t.point);
          }
        }, {
          key: "_onDrag",
          value: function _onDrag(t) {
            this._update(t.point);
          }
        }, {
          key: "_update",
          value: function _update(e) {
            var _this135 = this;

            if (!this._map || !this._lngLat && !this._trackPointer || !this._content) return;
            if (this._container || (this._container = a.create("div", "mapboxgl-popup", this._map.getContainer()), this._tip = a.create("div", "mapboxgl-popup-tip", this._container), this._container.appendChild(this._content), this.options.className && this.options.className.split(" ").forEach(function (t) {
              return _this135._container.classList.add(t);
            }), this._trackPointer && this._container.classList.add("mapboxgl-popup-track-pointer")), this.options.maxWidth && this._container.style.maxWidth !== this.options.maxWidth && (this._container.style.maxWidth = this.options.maxWidth), this._map.transform.renderWorldCopies && !this._trackPointer && (this._lngLat = ha(this._lngLat, this._pos, this._map.transform)), this._trackPointer && !e) return;
            var i = this._pos = this._trackPointer && e ? e : this._map.project(this._lngLat);
            var o = this.options.anchor;

            var r = function e(i) {
              if (i) {
                if ("number" == typeof i) {
                  var _e363 = Math.round(Math.sqrt(.5 * Math.pow(i, 2)));

                  return {
                    center: new t.Point(0, 0),
                    top: new t.Point(0, i),
                    "top-left": new t.Point(_e363, _e363),
                    "top-right": new t.Point(-_e363, _e363),
                    bottom: new t.Point(0, -i),
                    "bottom-left": new t.Point(_e363, -_e363),
                    "bottom-right": new t.Point(-_e363, -_e363),
                    left: new t.Point(i, 0),
                    right: new t.Point(-i, 0)
                  };
                }

                if (i instanceof t.Point || Array.isArray(i)) {
                  var _e364 = t.Point.convert(i);

                  return {
                    center: _e364,
                    top: _e364,
                    "top-left": _e364,
                    "top-right": _e364,
                    bottom: _e364,
                    "bottom-left": _e364,
                    "bottom-right": _e364,
                    left: _e364,
                    right: _e364
                  };
                }

                return {
                  center: t.Point.convert(i.center || [0, 0]),
                  top: t.Point.convert(i.top || [0, 0]),
                  "top-left": t.Point.convert(i["top-left"] || [0, 0]),
                  "top-right": t.Point.convert(i["top-right"] || [0, 0]),
                  bottom: t.Point.convert(i.bottom || [0, 0]),
                  "bottom-left": t.Point.convert(i["bottom-left"] || [0, 0]),
                  "bottom-right": t.Point.convert(i["bottom-right"] || [0, 0]),
                  left: t.Point.convert(i.left || [0, 0]),
                  right: t.Point.convert(i.right || [0, 0])
                };
              }

              return e(new t.Point(0, 0));
            }(this.options.offset);

            if (!o) {
              var _t425 = this._container.offsetWidth,
                  _e365 = this._container.offsetHeight;

              var _a163;

              _a163 = i.y + r.bottom.y < _e365 ? ["top"] : i.y > this._map.transform.height - _e365 ? ["bottom"] : [], i.x < _t425 / 2 ? _a163.push("left") : i.x > this._map.transform.width - _t425 / 2 && _a163.push("right"), o = 0 === _a163.length ? "bottom" : _a163.join("-");
            }

            var n = i.add(r[o]).round();
            a.setTransform(this._container, "".concat(ua[o], " translate(").concat(n.x, "px,").concat(n.y, "px)")), da(this._container, o, "popup");
          }
        }, {
          key: "_focusFirstElement",
          value: function _focusFirstElement() {
            if (!this.options.focusAfterOpen || !this._container) return;

            var t = this._container.querySelector(wa);

            t && t.focus();
          }
        }, {
          key: "_onClose",
          value: function _onClose() {
            this.remove();
          }
        }]);

        return Popup;
      }(t.Evented),
      Marker: _a,
      Style: Wt,
      LngLat: t.LngLat,
      LngLatBounds: t.LngLatBounds,
      Point: t.Point,
      MercatorCoordinate: t.MercatorCoordinate,
      FreeCameraOptions: to,
      Evented: t.Evented,
      config: t.config,
      prewarm: function prewarm() {
        q().acquire(N);
      },
      clearPrewarmedResources: function clearPrewarmedResources() {
        var t = G;
        t && (t.isPreloaded() && 1 === t.numActive() ? (t.release(N), G = null) : console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"));
      },

      get accessToken() {
        return t.config.ACCESS_TOKEN;
      },

      set accessToken(e) {
        t.config.ACCESS_TOKEN = e;
      },

      get baseApiUrl() {
        return t.config.API_URL;
      },

      set baseApiUrl(e) {
        t.config.API_URL = e;
      },

      get workerCount() {
        return Z.workerCount;
      },

      set workerCount(t) {
        Z.workerCount = t;
      },

      get maxParallelImageRequests() {
        return t.config.MAX_PARALLEL_IMAGE_REQUESTS;
      },

      set maxParallelImageRequests(e) {
        t.config.MAX_PARALLEL_IMAGE_REQUESTS = e;
      },

      clearStorage: function clearStorage(e) {
        t.clearTileCache(e);
      },
      workerUrl: "",
      workerClass: null,
      setNow: t.browser.setNow,
      restoreNow: t.browser.restoreNow
    };
    return Ta;
  }); //

  return mapboxgl;
});
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../process/browser.js */ "./node_modules/process/browser.js")))

/***/ }),

/***/ "./node_modules/process/browser.js":
/*!*****************************************!*\
  !*** ./node_modules/process/browser.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// shim for using process in browser
var process = module.exports = {}; // cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
  throw new Error('setTimeout has not been defined');
}

function defaultClearTimeout() {
  throw new Error('clearTimeout has not been defined');
}

(function () {
  try {
    if (typeof setTimeout === 'function') {
      cachedSetTimeout = setTimeout;
    } else {
      cachedSetTimeout = defaultSetTimout;
    }
  } catch (e) {
    cachedSetTimeout = defaultSetTimout;
  }

  try {
    if (typeof clearTimeout === 'function') {
      cachedClearTimeout = clearTimeout;
    } else {
      cachedClearTimeout = defaultClearTimeout;
    }
  } catch (e) {
    cachedClearTimeout = defaultClearTimeout;
  }
})();

function runTimeout(fun) {
  if (cachedSetTimeout === setTimeout) {
    //normal enviroments in sane situations
    return setTimeout(fun, 0);
  } // if setTimeout wasn't available but was latter defined


  if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
    cachedSetTimeout = setTimeout;
    return setTimeout(fun, 0);
  }

  try {
    // when when somebody has screwed with setTimeout but no I.E. maddness
    return cachedSetTimeout(fun, 0);
  } catch (e) {
    try {
      // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
      return cachedSetTimeout.call(null, fun, 0);
    } catch (e) {
      // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
      return cachedSetTimeout.call(this, fun, 0);
    }
  }
}

function runClearTimeout(marker) {
  if (cachedClearTimeout === clearTimeout) {
    //normal enviroments in sane situations
    return clearTimeout(marker);
  } // if clearTimeout wasn't available but was latter defined


  if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
    cachedClearTimeout = clearTimeout;
    return clearTimeout(marker);
  }

  try {
    // when when somebody has screwed with setTimeout but no I.E. maddness
    return cachedClearTimeout(marker);
  } catch (e) {
    try {
      // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
      return cachedClearTimeout.call(null, marker);
    } catch (e) {
      // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
      // Some versions of I.E. have different rules for clearTimeout vs setTimeout
      return cachedClearTimeout.call(this, marker);
    }
  }
}

var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
  if (!draining || !currentQueue) {
    return;
  }

  draining = false;

  if (currentQueue.length) {
    queue = currentQueue.concat(queue);
  } else {
    queueIndex = -1;
  }

  if (queue.length) {
    drainQueue();
  }
}

function drainQueue() {
  if (draining) {
    return;
  }

  var timeout = runTimeout(cleanUpNextTick);
  draining = true;
  var len = queue.length;

  while (len) {
    currentQueue = queue;
    queue = [];

    while (++queueIndex < len) {
      if (currentQueue) {
        currentQueue[queueIndex].run();
      }
    }

    queueIndex = -1;
    len = queue.length;
  }

  currentQueue = null;
  draining = false;
  runClearTimeout(timeout);
}

process.nextTick = function (fun) {
  var args = new Array(arguments.length - 1);

  if (arguments.length > 1) {
    for (var i = 1; i < arguments.length; i++) {
      args[i - 1] = arguments[i];
    }
  }

  queue.push(new Item(fun, args));

  if (queue.length === 1 && !draining) {
    runTimeout(drainQueue);
  }
}; // v8 likes predictible objects


function Item(fun, array) {
  this.fun = fun;
  this.array = array;
}

Item.prototype.run = function () {
  this.fun.apply(null, this.array);
};

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues

process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) {
  return [];
};

process.binding = function (name) {
  throw new Error('process.binding is not supported');
};

process.cwd = function () {
  return '/';
};

process.chdir = function (dir) {
  throw new Error('process.chdir is not supported');
};

process.umask = function () {
  return 0;
};

/***/ }),

/***/ "./node_modules/turbolinks/dist/turbolinks.js":
/*!****************************************************!*\
  !*** ./node_modules/turbolinks/dist/turbolinks.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(module) {var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

/*
Turbolinks 5.2.0
Copyright Â© 2018 Basecamp, LLC
 */
(function () {
  var t = this;
  (function () {
    (function () {
      this.Turbolinks = {
        supported: function () {
          return null != window.history.pushState && null != window.requestAnimationFrame && null != window.addEventListener;
        }(),
        visit: function visit(t, r) {
          return e.controller.visit(t, r);
        },
        clearCache: function clearCache() {
          return e.controller.clearCache();
        },
        setProgressBarDelay: function setProgressBarDelay(t) {
          return e.controller.setProgressBarDelay(t);
        }
      };
    }).call(this);
  }).call(t);
  var e = t.Turbolinks;
  (function () {
    (function () {
      var t,
          r,
          n,
          o = [].slice;
      e.copyObject = function (t) {
        var e, r, n;
        r = {};

        for (e in t) {
          n = t[e], r[e] = n;
        }

        return r;
      }, e.closest = function (e, r) {
        return t.call(e, r);
      }, t = function () {
        var t, e;
        return t = document.documentElement, null != (e = t.closest) ? e : function (t) {
          var e;

          for (e = this; e;) {
            if (e.nodeType === Node.ELEMENT_NODE && r.call(e, t)) return e;
            e = e.parentNode;
          }
        };
      }(), e.defer = function (t) {
        return setTimeout(t, 1);
      }, e.throttle = function (t) {
        var e;
        return e = null, function () {
          var r;
          return r = 1 <= arguments.length ? o.call(arguments, 0) : [], null != e ? e : e = requestAnimationFrame(function (n) {
            return function () {
              return e = null, t.apply(n, r);
            };
          }(this));
        };
      }, e.dispatch = function (t, e) {
        var r, o, i, s, a, u;
        return a = null != e ? e : {}, u = a.target, r = a.cancelable, o = a.data, i = document.createEvent("Events"), i.initEvent(t, !0, r === !0), i.data = null != o ? o : {}, i.cancelable && !n && (s = i.preventDefault, i.preventDefault = function () {
          return this.defaultPrevented || Object.defineProperty(this, "defaultPrevented", {
            get: function get() {
              return !0;
            }
          }), s.call(this);
        }), (null != u ? u : document).dispatchEvent(i), i;
      }, n = function () {
        var t;
        return t = document.createEvent("Events"), t.initEvent("test", !0, !0), t.preventDefault(), t.defaultPrevented;
      }(), e.match = function (t, e) {
        return r.call(t, e);
      }, r = function () {
        var t, e, r, n;
        return t = document.documentElement, null != (e = null != (r = null != (n = t.matchesSelector) ? n : t.webkitMatchesSelector) ? r : t.msMatchesSelector) ? e : t.mozMatchesSelector;
      }(), e.uuid = function () {
        var t, e, r;

        for (r = "", t = e = 1; 36 >= e; t = ++e) {
          r += 9 === t || 14 === t || 19 === t || 24 === t ? "-" : 15 === t ? "4" : 20 === t ? (Math.floor(4 * Math.random()) + 8).toString(16) : Math.floor(15 * Math.random()).toString(16);
        }

        return r;
      };
    }).call(this), function () {
      e.Location = function () {
        function t(t) {
          var e, r;
          null == t && (t = ""), r = document.createElement("a"), r.href = t.toString(), this.absoluteURL = r.href, e = r.hash.length, 2 > e ? this.requestURL = this.absoluteURL : (this.requestURL = this.absoluteURL.slice(0, -e), this.anchor = r.hash.slice(1));
        }

        var e, r, n, o;
        return t.wrap = function (t) {
          return t instanceof this ? t : new this(t);
        }, t.prototype.getOrigin = function () {
          return this.absoluteURL.split("/", 3).join("/");
        }, t.prototype.getPath = function () {
          var t, e;
          return null != (t = null != (e = this.requestURL.match(/\/\/[^\/]*(\/[^?;]*)/)) ? e[1] : void 0) ? t : "/";
        }, t.prototype.getPathComponents = function () {
          return this.getPath().split("/").slice(1);
        }, t.prototype.getLastPathComponent = function () {
          return this.getPathComponents().slice(-1)[0];
        }, t.prototype.getExtension = function () {
          var t, e;
          return null != (t = null != (e = this.getLastPathComponent().match(/\.[^.]*$/)) ? e[0] : void 0) ? t : "";
        }, t.prototype.isHTML = function () {
          return this.getExtension().match(/^(?:|\.(?:htm|html|xhtml))$/);
        }, t.prototype.isPrefixedBy = function (t) {
          var e;
          return e = r(t), this.isEqualTo(t) || o(this.absoluteURL, e);
        }, t.prototype.isEqualTo = function (t) {
          return this.absoluteURL === (null != t ? t.absoluteURL : void 0);
        }, t.prototype.toCacheKey = function () {
          return this.requestURL;
        }, t.prototype.toJSON = function () {
          return this.absoluteURL;
        }, t.prototype.toString = function () {
          return this.absoluteURL;
        }, t.prototype.valueOf = function () {
          return this.absoluteURL;
        }, r = function r(t) {
          return e(t.getOrigin() + t.getPath());
        }, e = function e(t) {
          return n(t, "/") ? t : t + "/";
        }, o = function o(t, e) {
          return t.slice(0, e.length) === e;
        }, n = function n(t, e) {
          return t.slice(-e.length) === e;
        }, t;
      }();
    }.call(this), function () {
      var t = function t(_t, e) {
        return function () {
          return _t.apply(e, arguments);
        };
      };

      e.HttpRequest = function () {
        function r(r, n, o) {
          this.delegate = r, this.requestCanceled = t(this.requestCanceled, this), this.requestTimedOut = t(this.requestTimedOut, this), this.requestFailed = t(this.requestFailed, this), this.requestLoaded = t(this.requestLoaded, this), this.requestProgressed = t(this.requestProgressed, this), this.url = e.Location.wrap(n).requestURL, this.referrer = e.Location.wrap(o).absoluteURL, this.createXHR();
        }

        return r.NETWORK_FAILURE = 0, r.TIMEOUT_FAILURE = -1, r.timeout = 60, r.prototype.send = function () {
          var t;
          return this.xhr && !this.sent ? (this.notifyApplicationBeforeRequestStart(), this.setProgress(0), this.xhr.send(), this.sent = !0, "function" == typeof (t = this.delegate).requestStarted ? t.requestStarted() : void 0) : void 0;
        }, r.prototype.cancel = function () {
          return this.xhr && this.sent ? this.xhr.abort() : void 0;
        }, r.prototype.requestProgressed = function (t) {
          return t.lengthComputable ? this.setProgress(t.loaded / t.total) : void 0;
        }, r.prototype.requestLoaded = function () {
          return this.endRequest(function (t) {
            return function () {
              var e;
              return 200 <= (e = t.xhr.status) && 300 > e ? t.delegate.requestCompletedWithResponse(t.xhr.responseText, t.xhr.getResponseHeader("Turbolinks-Location")) : (t.failed = !0, t.delegate.requestFailedWithStatusCode(t.xhr.status, t.xhr.responseText));
            };
          }(this));
        }, r.prototype.requestFailed = function () {
          return this.endRequest(function (t) {
            return function () {
              return t.failed = !0, t.delegate.requestFailedWithStatusCode(t.constructor.NETWORK_FAILURE);
            };
          }(this));
        }, r.prototype.requestTimedOut = function () {
          return this.endRequest(function (t) {
            return function () {
              return t.failed = !0, t.delegate.requestFailedWithStatusCode(t.constructor.TIMEOUT_FAILURE);
            };
          }(this));
        }, r.prototype.requestCanceled = function () {
          return this.endRequest();
        }, r.prototype.notifyApplicationBeforeRequestStart = function () {
          return e.dispatch("turbolinks:request-start", {
            data: {
              url: this.url,
              xhr: this.xhr
            }
          });
        }, r.prototype.notifyApplicationAfterRequestEnd = function () {
          return e.dispatch("turbolinks:request-end", {
            data: {
              url: this.url,
              xhr: this.xhr
            }
          });
        }, r.prototype.createXHR = function () {
          return this.xhr = new XMLHttpRequest(), this.xhr.open("GET", this.url, !0), this.xhr.timeout = 1e3 * this.constructor.timeout, this.xhr.setRequestHeader("Accept", "text/html, application/xhtml+xml"), this.xhr.setRequestHeader("Turbolinks-Referrer", this.referrer), this.xhr.onprogress = this.requestProgressed, this.xhr.onload = this.requestLoaded, this.xhr.onerror = this.requestFailed, this.xhr.ontimeout = this.requestTimedOut, this.xhr.onabort = this.requestCanceled;
        }, r.prototype.endRequest = function (t) {
          return this.xhr ? (this.notifyApplicationAfterRequestEnd(), null != t && t.call(this), this.destroy()) : void 0;
        }, r.prototype.setProgress = function (t) {
          var e;
          return this.progress = t, "function" == typeof (e = this.delegate).requestProgressed ? e.requestProgressed(this.progress) : void 0;
        }, r.prototype.destroy = function () {
          var t;
          return this.setProgress(1), "function" == typeof (t = this.delegate).requestFinished && t.requestFinished(), this.delegate = null, this.xhr = null;
        }, r;
      }();
    }.call(this), function () {
      var t = function t(_t2, e) {
        return function () {
          return _t2.apply(e, arguments);
        };
      };

      e.ProgressBar = function () {
        function e() {
          this.trickle = t(this.trickle, this), this.stylesheetElement = this.createStylesheetElement(), this.progressElement = this.createProgressElement();
        }

        var r;
        return r = 300, e.defaultCSS = ".turbolinks-progress-bar {\n  position: fixed;\n  display: block;\n  top: 0;\n  left: 0;\n  height: 3px;\n  background: #0076ff;\n  z-index: 9999;\n  transition: width " + r + "ms ease-out, opacity " + r / 2 + "ms " + r / 2 + "ms ease-in;\n  transform: translate3d(0, 0, 0);\n}", e.prototype.show = function () {
          return this.visible ? void 0 : (this.visible = !0, this.installStylesheetElement(), this.installProgressElement(), this.startTrickling());
        }, e.prototype.hide = function () {
          return this.visible && !this.hiding ? (this.hiding = !0, this.fadeProgressElement(function (t) {
            return function () {
              return t.uninstallProgressElement(), t.stopTrickling(), t.visible = !1, t.hiding = !1;
            };
          }(this))) : void 0;
        }, e.prototype.setValue = function (t) {
          return this.value = t, this.refresh();
        }, e.prototype.installStylesheetElement = function () {
          return document.head.insertBefore(this.stylesheetElement, document.head.firstChild);
        }, e.prototype.installProgressElement = function () {
          return this.progressElement.style.width = 0, this.progressElement.style.opacity = 1, document.documentElement.insertBefore(this.progressElement, document.body), this.refresh();
        }, e.prototype.fadeProgressElement = function (t) {
          return this.progressElement.style.opacity = 0, setTimeout(t, 1.5 * r);
        }, e.prototype.uninstallProgressElement = function () {
          return this.progressElement.parentNode ? document.documentElement.removeChild(this.progressElement) : void 0;
        }, e.prototype.startTrickling = function () {
          return null != this.trickleInterval ? this.trickleInterval : this.trickleInterval = setInterval(this.trickle, r);
        }, e.prototype.stopTrickling = function () {
          return clearInterval(this.trickleInterval), this.trickleInterval = null;
        }, e.prototype.trickle = function () {
          return this.setValue(this.value + Math.random() / 100);
        }, e.prototype.refresh = function () {
          return requestAnimationFrame(function (t) {
            return function () {
              return t.progressElement.style.width = 10 + 90 * t.value + "%";
            };
          }(this));
        }, e.prototype.createStylesheetElement = function () {
          var t;
          return t = document.createElement("style"), t.type = "text/css", t.textContent = this.constructor.defaultCSS, t;
        }, e.prototype.createProgressElement = function () {
          var t;
          return t = document.createElement("div"), t.className = "turbolinks-progress-bar", t;
        }, e;
      }();
    }.call(this), function () {
      var t = function t(_t3, e) {
        return function () {
          return _t3.apply(e, arguments);
        };
      };

      e.BrowserAdapter = function () {
        function r(r) {
          this.controller = r, this.showProgressBar = t(this.showProgressBar, this), this.progressBar = new e.ProgressBar();
        }

        var n, o, i;
        return i = e.HttpRequest, n = i.NETWORK_FAILURE, o = i.TIMEOUT_FAILURE, r.prototype.visitProposedToLocationWithAction = function (t, e) {
          return this.controller.startVisitToLocationWithAction(t, e);
        }, r.prototype.visitStarted = function (t) {
          return t.issueRequest(), t.changeHistory(), t.loadCachedSnapshot();
        }, r.prototype.visitRequestStarted = function (t) {
          return this.progressBar.setValue(0), t.hasCachedSnapshot() || "restore" !== t.action ? this.showProgressBarAfterDelay() : this.showProgressBar();
        }, r.prototype.visitRequestProgressed = function (t) {
          return this.progressBar.setValue(t.progress);
        }, r.prototype.visitRequestCompleted = function (t) {
          return t.loadResponse();
        }, r.prototype.visitRequestFailedWithStatusCode = function (t, e) {
          switch (e) {
            case n:
            case o:
              return this.reload();

            default:
              return t.loadResponse();
          }
        }, r.prototype.visitRequestFinished = function (t) {
          return this.hideProgressBar();
        }, r.prototype.visitCompleted = function (t) {
          return t.followRedirect();
        }, r.prototype.pageInvalidated = function () {
          return this.reload();
        }, r.prototype.showProgressBarAfterDelay = function () {
          return this.progressBarTimeout = setTimeout(this.showProgressBar, this.controller.progressBarDelay);
        }, r.prototype.showProgressBar = function () {
          return this.progressBar.show();
        }, r.prototype.hideProgressBar = function () {
          return this.progressBar.hide(), clearTimeout(this.progressBarTimeout);
        }, r.prototype.reload = function () {
          return window.location.reload();
        }, r;
      }();
    }.call(this), function () {
      var t = function t(_t4, e) {
        return function () {
          return _t4.apply(e, arguments);
        };
      };

      e.History = function () {
        function r(e) {
          this.delegate = e, this.onPageLoad = t(this.onPageLoad, this), this.onPopState = t(this.onPopState, this);
        }

        return r.prototype.start = function () {
          return this.started ? void 0 : (addEventListener("popstate", this.onPopState, !1), addEventListener("load", this.onPageLoad, !1), this.started = !0);
        }, r.prototype.stop = function () {
          return this.started ? (removeEventListener("popstate", this.onPopState, !1), removeEventListener("load", this.onPageLoad, !1), this.started = !1) : void 0;
        }, r.prototype.push = function (t, r) {
          return t = e.Location.wrap(t), this.update("push", t, r);
        }, r.prototype.replace = function (t, r) {
          return t = e.Location.wrap(t), this.update("replace", t, r);
        }, r.prototype.onPopState = function (t) {
          var r, n, o, i;
          return this.shouldHandlePopState() && (i = null != (n = t.state) ? n.turbolinks : void 0) ? (r = e.Location.wrap(window.location), o = i.restorationIdentifier, this.delegate.historyPoppedToLocationWithRestorationIdentifier(r, o)) : void 0;
        }, r.prototype.onPageLoad = function (t) {
          return e.defer(function (t) {
            return function () {
              return t.pageLoaded = !0;
            };
          }(this));
        }, r.prototype.shouldHandlePopState = function () {
          return this.pageIsLoaded();
        }, r.prototype.pageIsLoaded = function () {
          return this.pageLoaded || "complete" === document.readyState;
        }, r.prototype.update = function (t, e, r) {
          var n;
          return n = {
            turbolinks: {
              restorationIdentifier: r
            }
          }, history[t + "State"](n, null, e);
        }, r;
      }();
    }.call(this), function () {
      e.HeadDetails = function () {
        function t(t) {
          var e, r, n, s, a, u;

          for (this.elements = {}, n = 0, a = t.length; a > n; n++) {
            u = t[n], u.nodeType === Node.ELEMENT_NODE && (s = u.outerHTML, r = null != (e = this.elements)[s] ? e[s] : e[s] = {
              type: i(u),
              tracked: o(u),
              elements: []
            }, r.elements.push(u));
          }
        }

        var e, r, n, o, i;
        return t.fromHeadElement = function (t) {
          var e;
          return new this(null != (e = null != t ? t.childNodes : void 0) ? e : []);
        }, t.prototype.hasElementWithKey = function (t) {
          return t in this.elements;
        }, t.prototype.getTrackedElementSignature = function () {
          var t, e;
          return function () {
            var r, n;
            r = this.elements, n = [];

            for (t in r) {
              e = r[t].tracked, e && n.push(t);
            }

            return n;
          }.call(this).join("");
        }, t.prototype.getScriptElementsNotInDetails = function (t) {
          return this.getElementsMatchingTypeNotInDetails("script", t);
        }, t.prototype.getStylesheetElementsNotInDetails = function (t) {
          return this.getElementsMatchingTypeNotInDetails("stylesheet", t);
        }, t.prototype.getElementsMatchingTypeNotInDetails = function (t, e) {
          var r, n, o, i, s, a;
          o = this.elements, s = [];

          for (n in o) {
            i = o[n], a = i.type, r = i.elements, a !== t || e.hasElementWithKey(n) || s.push(r[0]);
          }

          return s;
        }, t.prototype.getProvisionalElements = function () {
          var t, e, r, n, o, i, s;
          r = [], n = this.elements;

          for (e in n) {
            o = n[e], s = o.type, i = o.tracked, t = o.elements, null != s || i ? t.length > 1 && r.push.apply(r, t.slice(1)) : r.push.apply(r, t);
          }

          return r;
        }, t.prototype.getMetaValue = function (t) {
          var e;
          return null != (e = this.findMetaElementByName(t)) ? e.getAttribute("content") : void 0;
        }, t.prototype.findMetaElementByName = function (t) {
          var r, n, o, i;
          r = void 0, i = this.elements;

          for (o in i) {
            n = i[o].elements, e(n[0], t) && (r = n[0]);
          }

          return r;
        }, i = function i(t) {
          return r(t) ? "script" : n(t) ? "stylesheet" : void 0;
        }, o = function o(t) {
          return "reload" === t.getAttribute("data-turbolinks-track");
        }, r = function r(t) {
          var e;
          return e = t.tagName.toLowerCase(), "script" === e;
        }, n = function n(t) {
          var e;
          return e = t.tagName.toLowerCase(), "style" === e || "link" === e && "stylesheet" === t.getAttribute("rel");
        }, e = function e(t, _e) {
          var r;
          return r = t.tagName.toLowerCase(), "meta" === r && t.getAttribute("name") === _e;
        }, t;
      }();
    }.call(this), function () {
      e.Snapshot = function () {
        function t(t, e) {
          this.headDetails = t, this.bodyElement = e;
        }

        return t.wrap = function (t) {
          return t instanceof this ? t : "string" == typeof t ? this.fromHTMLString(t) : this.fromHTMLElement(t);
        }, t.fromHTMLString = function (t) {
          var e;
          return e = document.createElement("html"), e.innerHTML = t, this.fromHTMLElement(e);
        }, t.fromHTMLElement = function (t) {
          var r, n, o, i;
          return o = t.querySelector("head"), r = null != (i = t.querySelector("body")) ? i : document.createElement("body"), n = e.HeadDetails.fromHeadElement(o), new this(n, r);
        }, t.prototype.clone = function () {
          return new this.constructor(this.headDetails, this.bodyElement.cloneNode(!0));
        }, t.prototype.getRootLocation = function () {
          var t, r;
          return r = null != (t = this.getSetting("root")) ? t : "/", new e.Location(r);
        }, t.prototype.getCacheControlValue = function () {
          return this.getSetting("cache-control");
        }, t.prototype.getElementForAnchor = function (t) {
          try {
            return this.bodyElement.querySelector("[id='" + t + "'], a[name='" + t + "']");
          } catch (e) {}
        }, t.prototype.getPermanentElements = function () {
          return this.bodyElement.querySelectorAll("[id][data-turbolinks-permanent]");
        }, t.prototype.getPermanentElementById = function (t) {
          return this.bodyElement.querySelector("#" + t + "[data-turbolinks-permanent]");
        }, t.prototype.getPermanentElementsPresentInSnapshot = function (t) {
          var e, r, n, o, i;

          for (o = this.getPermanentElements(), i = [], r = 0, n = o.length; n > r; r++) {
            e = o[r], t.getPermanentElementById(e.id) && i.push(e);
          }

          return i;
        }, t.prototype.findFirstAutofocusableElement = function () {
          return this.bodyElement.querySelector("[autofocus]");
        }, t.prototype.hasAnchor = function (t) {
          return null != this.getElementForAnchor(t);
        }, t.prototype.isPreviewable = function () {
          return "no-preview" !== this.getCacheControlValue();
        }, t.prototype.isCacheable = function () {
          return "no-cache" !== this.getCacheControlValue();
        }, t.prototype.isVisitable = function () {
          return "reload" !== this.getSetting("visit-control");
        }, t.prototype.getSetting = function (t) {
          return this.headDetails.getMetaValue("turbolinks-" + t);
        }, t;
      }();
    }.call(this), function () {
      var t = [].slice;

      e.Renderer = function () {
        function e() {}

        var r;
        return e.render = function () {
          var e, r, n, o;
          return n = arguments[0], r = arguments[1], e = 3 <= arguments.length ? t.call(arguments, 2) : [], o = function (t, e, r) {
            r.prototype = t.prototype;
            var n = new r(),
                o = t.apply(n, e);
            return Object(o) === o ? o : n;
          }(this, e, function () {}), o.delegate = n, o.render(r), o;
        }, e.prototype.renderView = function (t) {
          return this.delegate.viewWillRender(this.newBody), t(), this.delegate.viewRendered(this.newBody);
        }, e.prototype.invalidateView = function () {
          return this.delegate.viewInvalidated();
        }, e.prototype.createScriptElement = function (t) {
          var e;
          return "false" === t.getAttribute("data-turbolinks-eval") ? t : (e = document.createElement("script"), e.textContent = t.textContent, e.async = !1, r(e, t), e);
        }, r = function r(t, e) {
          var r, n, o, i, s, a, u;

          for (i = e.attributes, a = [], r = 0, n = i.length; n > r; r++) {
            s = i[r], o = s.name, u = s.value, a.push(t.setAttribute(o, u));
          }

          return a;
        }, e;
      }();
    }.call(this), function () {
      var t,
          r,
          n = function n(t, e) {
        function r() {
          this.constructor = t;
        }

        for (var n in e) {
          o.call(e, n) && (t[n] = e[n]);
        }

        return r.prototype = e.prototype, t.prototype = new r(), t.__super__ = e.prototype, t;
      },
          o = {}.hasOwnProperty;

      e.SnapshotRenderer = function (e) {
        function o(t, e, r) {
          this.currentSnapshot = t, this.newSnapshot = e, this.isPreview = r, this.currentHeadDetails = this.currentSnapshot.headDetails, this.newHeadDetails = this.newSnapshot.headDetails, this.currentBody = this.currentSnapshot.bodyElement, this.newBody = this.newSnapshot.bodyElement;
        }

        return n(o, e), o.prototype.render = function (t) {
          return this.shouldRender() ? (this.mergeHead(), this.renderView(function (e) {
            return function () {
              return e.replaceBody(), e.isPreview || e.focusFirstAutofocusableElement(), t();
            };
          }(this))) : this.invalidateView();
        }, o.prototype.mergeHead = function () {
          return this.copyNewHeadStylesheetElements(), this.copyNewHeadScriptElements(), this.removeCurrentHeadProvisionalElements(), this.copyNewHeadProvisionalElements();
        }, o.prototype.replaceBody = function () {
          var t;
          return t = this.relocateCurrentBodyPermanentElements(), this.activateNewBodyScriptElements(), this.assignNewBody(), this.replacePlaceholderElementsWithClonedPermanentElements(t);
        }, o.prototype.shouldRender = function () {
          return this.newSnapshot.isVisitable() && this.trackedElementsAreIdentical();
        }, o.prototype.trackedElementsAreIdentical = function () {
          return this.currentHeadDetails.getTrackedElementSignature() === this.newHeadDetails.getTrackedElementSignature();
        }, o.prototype.copyNewHeadStylesheetElements = function () {
          var t, e, r, n, o;

          for (n = this.getNewHeadStylesheetElements(), o = [], e = 0, r = n.length; r > e; e++) {
            t = n[e], o.push(document.head.appendChild(t));
          }

          return o;
        }, o.prototype.copyNewHeadScriptElements = function () {
          var t, e, r, n, o;

          for (n = this.getNewHeadScriptElements(), o = [], e = 0, r = n.length; r > e; e++) {
            t = n[e], o.push(document.head.appendChild(this.createScriptElement(t)));
          }

          return o;
        }, o.prototype.removeCurrentHeadProvisionalElements = function () {
          var t, e, r, n, o;

          for (n = this.getCurrentHeadProvisionalElements(), o = [], e = 0, r = n.length; r > e; e++) {
            t = n[e], o.push(document.head.removeChild(t));
          }

          return o;
        }, o.prototype.copyNewHeadProvisionalElements = function () {
          var t, e, r, n, o;

          for (n = this.getNewHeadProvisionalElements(), o = [], e = 0, r = n.length; r > e; e++) {
            t = n[e], o.push(document.head.appendChild(t));
          }

          return o;
        }, o.prototype.relocateCurrentBodyPermanentElements = function () {
          var e, n, o, i, s, a, u;

          for (a = this.getCurrentBodyPermanentElements(), u = [], e = 0, n = a.length; n > e; e++) {
            i = a[e], s = t(i), o = this.newSnapshot.getPermanentElementById(i.id), r(i, s.element), r(o, i), u.push(s);
          }

          return u;
        }, o.prototype.replacePlaceholderElementsWithClonedPermanentElements = function (t) {
          var e, n, o, i, s, a, u;

          for (u = [], o = 0, i = t.length; i > o; o++) {
            a = t[o], n = a.element, s = a.permanentElement, e = s.cloneNode(!0), u.push(r(n, e));
          }

          return u;
        }, o.prototype.activateNewBodyScriptElements = function () {
          var t, e, n, o, i, s;

          for (i = this.getNewBodyScriptElements(), s = [], e = 0, o = i.length; o > e; e++) {
            n = i[e], t = this.createScriptElement(n), s.push(r(n, t));
          }

          return s;
        }, o.prototype.assignNewBody = function () {
          return document.body = this.newBody;
        }, o.prototype.focusFirstAutofocusableElement = function () {
          var t;
          return null != (t = this.newSnapshot.findFirstAutofocusableElement()) ? t.focus() : void 0;
        }, o.prototype.getNewHeadStylesheetElements = function () {
          return this.newHeadDetails.getStylesheetElementsNotInDetails(this.currentHeadDetails);
        }, o.prototype.getNewHeadScriptElements = function () {
          return this.newHeadDetails.getScriptElementsNotInDetails(this.currentHeadDetails);
        }, o.prototype.getCurrentHeadProvisionalElements = function () {
          return this.currentHeadDetails.getProvisionalElements();
        }, o.prototype.getNewHeadProvisionalElements = function () {
          return this.newHeadDetails.getProvisionalElements();
        }, o.prototype.getCurrentBodyPermanentElements = function () {
          return this.currentSnapshot.getPermanentElementsPresentInSnapshot(this.newSnapshot);
        }, o.prototype.getNewBodyScriptElements = function () {
          return this.newBody.querySelectorAll("script");
        }, o;
      }(e.Renderer), t = function t(_t5) {
        var e;
        return e = document.createElement("meta"), e.setAttribute("name", "turbolinks-permanent-placeholder"), e.setAttribute("content", _t5.id), {
          element: e,
          permanentElement: _t5
        };
      }, r = function r(t, e) {
        var r;
        return (r = t.parentNode) ? r.replaceChild(e, t) : void 0;
      };
    }.call(this), function () {
      var t = function t(_t6, e) {
        function n() {
          this.constructor = _t6;
        }

        for (var o in e) {
          r.call(e, o) && (_t6[o] = e[o]);
        }

        return n.prototype = e.prototype, _t6.prototype = new n(), _t6.__super__ = e.prototype, _t6;
      },
          r = {}.hasOwnProperty;

      e.ErrorRenderer = function (e) {
        function r(t) {
          var e;
          e = document.createElement("html"), e.innerHTML = t, this.newHead = e.querySelector("head"), this.newBody = e.querySelector("body");
        }

        return t(r, e), r.prototype.render = function (t) {
          return this.renderView(function (e) {
            return function () {
              return e.replaceHeadAndBody(), e.activateBodyScriptElements(), t();
            };
          }(this));
        }, r.prototype.replaceHeadAndBody = function () {
          var t, e;
          return e = document.head, t = document.body, e.parentNode.replaceChild(this.newHead, e), t.parentNode.replaceChild(this.newBody, t);
        }, r.prototype.activateBodyScriptElements = function () {
          var t, e, r, n, o, i;

          for (n = this.getScriptElements(), i = [], e = 0, r = n.length; r > e; e++) {
            o = n[e], t = this.createScriptElement(o), i.push(o.parentNode.replaceChild(t, o));
          }

          return i;
        }, r.prototype.getScriptElements = function () {
          return document.documentElement.querySelectorAll("script");
        }, r;
      }(e.Renderer);
    }.call(this), function () {
      e.View = function () {
        function t(t) {
          this.delegate = t, this.htmlElement = document.documentElement;
        }

        return t.prototype.getRootLocation = function () {
          return this.getSnapshot().getRootLocation();
        }, t.prototype.getElementForAnchor = function (t) {
          return this.getSnapshot().getElementForAnchor(t);
        }, t.prototype.getSnapshot = function () {
          return e.Snapshot.fromHTMLElement(this.htmlElement);
        }, t.prototype.render = function (t, e) {
          var r, n, o;
          return o = t.snapshot, r = t.error, n = t.isPreview, this.markAsPreview(n), null != o ? this.renderSnapshot(o, n, e) : this.renderError(r, e);
        }, t.prototype.markAsPreview = function (t) {
          return t ? this.htmlElement.setAttribute("data-turbolinks-preview", "") : this.htmlElement.removeAttribute("data-turbolinks-preview");
        }, t.prototype.renderSnapshot = function (t, r, n) {
          return e.SnapshotRenderer.render(this.delegate, n, this.getSnapshot(), e.Snapshot.wrap(t), r);
        }, t.prototype.renderError = function (t, r) {
          return e.ErrorRenderer.render(this.delegate, r, t);
        }, t;
      }();
    }.call(this), function () {
      var t = function t(_t7, e) {
        return function () {
          return _t7.apply(e, arguments);
        };
      };

      e.ScrollManager = function () {
        function r(r) {
          this.delegate = r, this.onScroll = t(this.onScroll, this), this.onScroll = e.throttle(this.onScroll);
        }

        return r.prototype.start = function () {
          return this.started ? void 0 : (addEventListener("scroll", this.onScroll, !1), this.onScroll(), this.started = !0);
        }, r.prototype.stop = function () {
          return this.started ? (removeEventListener("scroll", this.onScroll, !1), this.started = !1) : void 0;
        }, r.prototype.scrollToElement = function (t) {
          return t.scrollIntoView();
        }, r.prototype.scrollToPosition = function (t) {
          var e, r;
          return e = t.x, r = t.y, window.scrollTo(e, r);
        }, r.prototype.onScroll = function (t) {
          return this.updatePosition({
            x: window.pageXOffset,
            y: window.pageYOffset
          });
        }, r.prototype.updatePosition = function (t) {
          var e;
          return this.position = t, null != (e = this.delegate) ? e.scrollPositionChanged(this.position) : void 0;
        }, r;
      }();
    }.call(this), function () {
      e.SnapshotCache = function () {
        function t(t) {
          this.size = t, this.keys = [], this.snapshots = {};
        }

        var r;
        return t.prototype.has = function (t) {
          var e;
          return e = r(t), e in this.snapshots;
        }, t.prototype.get = function (t) {
          var e;
          if (this.has(t)) return e = this.read(t), this.touch(t), e;
        }, t.prototype.put = function (t, e) {
          return this.write(t, e), this.touch(t), e;
        }, t.prototype.read = function (t) {
          var e;
          return e = r(t), this.snapshots[e];
        }, t.prototype.write = function (t, e) {
          var n;
          return n = r(t), this.snapshots[n] = e;
        }, t.prototype.touch = function (t) {
          var e, n;
          return n = r(t), e = this.keys.indexOf(n), e > -1 && this.keys.splice(e, 1), this.keys.unshift(n), this.trim();
        }, t.prototype.trim = function () {
          var t, e, r, n, o;

          for (n = this.keys.splice(this.size), o = [], t = 0, r = n.length; r > t; t++) {
            e = n[t], o.push(delete this.snapshots[e]);
          }

          return o;
        }, r = function r(t) {
          return e.Location.wrap(t).toCacheKey();
        }, t;
      }();
    }.call(this), function () {
      var t = function t(_t8, e) {
        return function () {
          return _t8.apply(e, arguments);
        };
      };

      e.Visit = function () {
        function r(r, n, o) {
          this.controller = r, this.action = o, this.performScroll = t(this.performScroll, this), this.identifier = e.uuid(), this.location = e.Location.wrap(n), this.adapter = this.controller.adapter, this.state = "initialized", this.timingMetrics = {};
        }

        var n;
        return r.prototype.start = function () {
          return "initialized" === this.state ? (this.recordTimingMetric("visitStart"), this.state = "started", this.adapter.visitStarted(this)) : void 0;
        }, r.prototype.cancel = function () {
          var t;
          return "started" === this.state ? (null != (t = this.request) && t.cancel(), this.cancelRender(), this.state = "canceled") : void 0;
        }, r.prototype.complete = function () {
          var t;
          return "started" === this.state ? (this.recordTimingMetric("visitEnd"), this.state = "completed", "function" == typeof (t = this.adapter).visitCompleted && t.visitCompleted(this), this.controller.visitCompleted(this)) : void 0;
        }, r.prototype.fail = function () {
          var t;
          return "started" === this.state ? (this.state = "failed", "function" == typeof (t = this.adapter).visitFailed ? t.visitFailed(this) : void 0) : void 0;
        }, r.prototype.changeHistory = function () {
          var t, e;
          return this.historyChanged ? void 0 : (t = this.location.isEqualTo(this.referrer) ? "replace" : this.action, e = n(t), this.controller[e](this.location, this.restorationIdentifier), this.historyChanged = !0);
        }, r.prototype.issueRequest = function () {
          return this.shouldIssueRequest() && null == this.request ? (this.progress = 0, this.request = new e.HttpRequest(this, this.location, this.referrer), this.request.send()) : void 0;
        }, r.prototype.getCachedSnapshot = function () {
          var t;
          return !(t = this.controller.getCachedSnapshotForLocation(this.location)) || null != this.location.anchor && !t.hasAnchor(this.location.anchor) || "restore" !== this.action && !t.isPreviewable() ? void 0 : t;
        }, r.prototype.hasCachedSnapshot = function () {
          return null != this.getCachedSnapshot();
        }, r.prototype.loadCachedSnapshot = function () {
          var t, e;
          return (e = this.getCachedSnapshot()) ? (t = this.shouldIssueRequest(), this.render(function () {
            var r;
            return this.cacheSnapshot(), this.controller.render({
              snapshot: e,
              isPreview: t
            }, this.performScroll), "function" == typeof (r = this.adapter).visitRendered && r.visitRendered(this), t ? void 0 : this.complete();
          })) : void 0;
        }, r.prototype.loadResponse = function () {
          return null != this.response ? this.render(function () {
            var t, e;
            return this.cacheSnapshot(), this.request.failed ? (this.controller.render({
              error: this.response
            }, this.performScroll), "function" == typeof (t = this.adapter).visitRendered && t.visitRendered(this), this.fail()) : (this.controller.render({
              snapshot: this.response
            }, this.performScroll), "function" == typeof (e = this.adapter).visitRendered && e.visitRendered(this), this.complete());
          }) : void 0;
        }, r.prototype.followRedirect = function () {
          return this.redirectedToLocation && !this.followedRedirect ? (this.location = this.redirectedToLocation, this.controller.replaceHistoryWithLocationAndRestorationIdentifier(this.redirectedToLocation, this.restorationIdentifier), this.followedRedirect = !0) : void 0;
        }, r.prototype.requestStarted = function () {
          var t;
          return this.recordTimingMetric("requestStart"), "function" == typeof (t = this.adapter).visitRequestStarted ? t.visitRequestStarted(this) : void 0;
        }, r.prototype.requestProgressed = function (t) {
          var e;
          return this.progress = t, "function" == typeof (e = this.adapter).visitRequestProgressed ? e.visitRequestProgressed(this) : void 0;
        }, r.prototype.requestCompletedWithResponse = function (t, r) {
          return this.response = t, null != r && (this.redirectedToLocation = e.Location.wrap(r)), this.adapter.visitRequestCompleted(this);
        }, r.prototype.requestFailedWithStatusCode = function (t, e) {
          return this.response = e, this.adapter.visitRequestFailedWithStatusCode(this, t);
        }, r.prototype.requestFinished = function () {
          var t;
          return this.recordTimingMetric("requestEnd"), "function" == typeof (t = this.adapter).visitRequestFinished ? t.visitRequestFinished(this) : void 0;
        }, r.prototype.performScroll = function () {
          return this.scrolled ? void 0 : ("restore" === this.action ? this.scrollToRestoredPosition() || this.scrollToTop() : this.scrollToAnchor() || this.scrollToTop(), this.scrolled = !0);
        }, r.prototype.scrollToRestoredPosition = function () {
          var t, e;
          return t = null != (e = this.restorationData) ? e.scrollPosition : void 0, null != t ? (this.controller.scrollToPosition(t), !0) : void 0;
        }, r.prototype.scrollToAnchor = function () {
          return null != this.location.anchor ? (this.controller.scrollToAnchor(this.location.anchor), !0) : void 0;
        }, r.prototype.scrollToTop = function () {
          return this.controller.scrollToPosition({
            x: 0,
            y: 0
          });
        }, r.prototype.recordTimingMetric = function (t) {
          var e;
          return null != (e = this.timingMetrics)[t] ? e[t] : e[t] = new Date().getTime();
        }, r.prototype.getTimingMetrics = function () {
          return e.copyObject(this.timingMetrics);
        }, n = function n(t) {
          switch (t) {
            case "replace":
              return "replaceHistoryWithLocationAndRestorationIdentifier";

            case "advance":
            case "restore":
              return "pushHistoryWithLocationAndRestorationIdentifier";
          }
        }, r.prototype.shouldIssueRequest = function () {
          return "restore" === this.action ? !this.hasCachedSnapshot() : !0;
        }, r.prototype.cacheSnapshot = function () {
          return this.snapshotCached ? void 0 : (this.controller.cacheSnapshot(), this.snapshotCached = !0);
        }, r.prototype.render = function (t) {
          return this.cancelRender(), this.frame = requestAnimationFrame(function (e) {
            return function () {
              return e.frame = null, t.call(e);
            };
          }(this));
        }, r.prototype.cancelRender = function () {
          return this.frame ? cancelAnimationFrame(this.frame) : void 0;
        }, r;
      }();
    }.call(this), function () {
      var t = function t(_t9, e) {
        return function () {
          return _t9.apply(e, arguments);
        };
      };

      e.Controller = function () {
        function r() {
          this.clickBubbled = t(this.clickBubbled, this), this.clickCaptured = t(this.clickCaptured, this), this.pageLoaded = t(this.pageLoaded, this), this.history = new e.History(this), this.view = new e.View(this), this.scrollManager = new e.ScrollManager(this), this.restorationData = {}, this.clearCache(), this.setProgressBarDelay(500);
        }

        return r.prototype.start = function () {
          return e.supported && !this.started ? (addEventListener("click", this.clickCaptured, !0), addEventListener("DOMContentLoaded", this.pageLoaded, !1), this.scrollManager.start(), this.startHistory(), this.started = !0, this.enabled = !0) : void 0;
        }, r.prototype.disable = function () {
          return this.enabled = !1;
        }, r.prototype.stop = function () {
          return this.started ? (removeEventListener("click", this.clickCaptured, !0), removeEventListener("DOMContentLoaded", this.pageLoaded, !1), this.scrollManager.stop(), this.stopHistory(), this.started = !1) : void 0;
        }, r.prototype.clearCache = function () {
          return this.cache = new e.SnapshotCache(10);
        }, r.prototype.visit = function (t, r) {
          var n, o;
          return null == r && (r = {}), t = e.Location.wrap(t), this.applicationAllowsVisitingLocation(t) ? this.locationIsVisitable(t) ? (n = null != (o = r.action) ? o : "advance", this.adapter.visitProposedToLocationWithAction(t, n)) : window.location = t : void 0;
        }, r.prototype.startVisitToLocationWithAction = function (t, r, n) {
          var o;
          return e.supported ? (o = this.getRestorationDataForIdentifier(n), this.startVisit(t, r, {
            restorationData: o
          })) : window.location = t;
        }, r.prototype.setProgressBarDelay = function (t) {
          return this.progressBarDelay = t;
        }, r.prototype.startHistory = function () {
          return this.location = e.Location.wrap(window.location), this.restorationIdentifier = e.uuid(), this.history.start(), this.history.replace(this.location, this.restorationIdentifier);
        }, r.prototype.stopHistory = function () {
          return this.history.stop();
        }, r.prototype.pushHistoryWithLocationAndRestorationIdentifier = function (t, r) {
          return this.restorationIdentifier = r, this.location = e.Location.wrap(t), this.history.push(this.location, this.restorationIdentifier);
        }, r.prototype.replaceHistoryWithLocationAndRestorationIdentifier = function (t, r) {
          return this.restorationIdentifier = r, this.location = e.Location.wrap(t), this.history.replace(this.location, this.restorationIdentifier);
        }, r.prototype.historyPoppedToLocationWithRestorationIdentifier = function (t, r) {
          var n;
          return this.restorationIdentifier = r, this.enabled ? (n = this.getRestorationDataForIdentifier(this.restorationIdentifier), this.startVisit(t, "restore", {
            restorationIdentifier: this.restorationIdentifier,
            restorationData: n,
            historyChanged: !0
          }), this.location = e.Location.wrap(t)) : this.adapter.pageInvalidated();
        }, r.prototype.getCachedSnapshotForLocation = function (t) {
          var e;
          return null != (e = this.cache.get(t)) ? e.clone() : void 0;
        }, r.prototype.shouldCacheSnapshot = function () {
          return this.view.getSnapshot().isCacheable();
        }, r.prototype.cacheSnapshot = function () {
          var t, r;
          return this.shouldCacheSnapshot() ? (this.notifyApplicationBeforeCachingSnapshot(), r = this.view.getSnapshot(), t = this.lastRenderedLocation, e.defer(function (e) {
            return function () {
              return e.cache.put(t, r.clone());
            };
          }(this))) : void 0;
        }, r.prototype.scrollToAnchor = function (t) {
          var e;
          return (e = this.view.getElementForAnchor(t)) ? this.scrollToElement(e) : this.scrollToPosition({
            x: 0,
            y: 0
          });
        }, r.prototype.scrollToElement = function (t) {
          return this.scrollManager.scrollToElement(t);
        }, r.prototype.scrollToPosition = function (t) {
          return this.scrollManager.scrollToPosition(t);
        }, r.prototype.scrollPositionChanged = function (t) {
          var e;
          return e = this.getCurrentRestorationData(), e.scrollPosition = t;
        }, r.prototype.render = function (t, e) {
          return this.view.render(t, e);
        }, r.prototype.viewInvalidated = function () {
          return this.adapter.pageInvalidated();
        }, r.prototype.viewWillRender = function (t) {
          return this.notifyApplicationBeforeRender(t);
        }, r.prototype.viewRendered = function () {
          return this.lastRenderedLocation = this.currentVisit.location, this.notifyApplicationAfterRender();
        }, r.prototype.pageLoaded = function () {
          return this.lastRenderedLocation = this.location, this.notifyApplicationAfterPageLoad();
        }, r.prototype.clickCaptured = function () {
          return removeEventListener("click", this.clickBubbled, !1), addEventListener("click", this.clickBubbled, !1);
        }, r.prototype.clickBubbled = function (t) {
          var e, r, n;
          return this.enabled && this.clickEventIsSignificant(t) && (r = this.getVisitableLinkForNode(t.target)) && (n = this.getVisitableLocationForLink(r)) && this.applicationAllowsFollowingLinkToLocation(r, n) ? (t.preventDefault(), e = this.getActionForLink(r), this.visit(n, {
            action: e
          })) : void 0;
        }, r.prototype.applicationAllowsFollowingLinkToLocation = function (t, e) {
          var r;
          return r = this.notifyApplicationAfterClickingLinkToLocation(t, e), !r.defaultPrevented;
        }, r.prototype.applicationAllowsVisitingLocation = function (t) {
          var e;
          return e = this.notifyApplicationBeforeVisitingLocation(t), !e.defaultPrevented;
        }, r.prototype.notifyApplicationAfterClickingLinkToLocation = function (t, r) {
          return e.dispatch("turbolinks:click", {
            target: t,
            data: {
              url: r.absoluteURL
            },
            cancelable: !0
          });
        }, r.prototype.notifyApplicationBeforeVisitingLocation = function (t) {
          return e.dispatch("turbolinks:before-visit", {
            data: {
              url: t.absoluteURL
            },
            cancelable: !0
          });
        }, r.prototype.notifyApplicationAfterVisitingLocation = function (t) {
          return e.dispatch("turbolinks:visit", {
            data: {
              url: t.absoluteURL
            }
          });
        }, r.prototype.notifyApplicationBeforeCachingSnapshot = function () {
          return e.dispatch("turbolinks:before-cache");
        }, r.prototype.notifyApplicationBeforeRender = function (t) {
          return e.dispatch("turbolinks:before-render", {
            data: {
              newBody: t
            }
          });
        }, r.prototype.notifyApplicationAfterRender = function () {
          return e.dispatch("turbolinks:render");
        }, r.prototype.notifyApplicationAfterPageLoad = function (t) {
          return null == t && (t = {}), e.dispatch("turbolinks:load", {
            data: {
              url: this.location.absoluteURL,
              timing: t
            }
          });
        }, r.prototype.startVisit = function (t, e, r) {
          var n;
          return null != (n = this.currentVisit) && n.cancel(), this.currentVisit = this.createVisit(t, e, r), this.currentVisit.start(), this.notifyApplicationAfterVisitingLocation(t);
        }, r.prototype.createVisit = function (t, r, n) {
          var o, i, s, a, u;
          return i = null != n ? n : {}, a = i.restorationIdentifier, s = i.restorationData, o = i.historyChanged, u = new e.Visit(this, t, r), u.restorationIdentifier = null != a ? a : e.uuid(), u.restorationData = e.copyObject(s), u.historyChanged = o, u.referrer = this.location, u;
        }, r.prototype.visitCompleted = function (t) {
          return this.notifyApplicationAfterPageLoad(t.getTimingMetrics());
        }, r.prototype.clickEventIsSignificant = function (t) {
          return !(t.defaultPrevented || t.target.isContentEditable || t.which > 1 || t.altKey || t.ctrlKey || t.metaKey || t.shiftKey);
        }, r.prototype.getVisitableLinkForNode = function (t) {
          return this.nodeIsVisitable(t) ? e.closest(t, "a[href]:not([target]):not([download])") : void 0;
        }, r.prototype.getVisitableLocationForLink = function (t) {
          var r;
          return r = new e.Location(t.getAttribute("href")), this.locationIsVisitable(r) ? r : void 0;
        }, r.prototype.getActionForLink = function (t) {
          var e;
          return null != (e = t.getAttribute("data-turbolinks-action")) ? e : "advance";
        }, r.prototype.nodeIsVisitable = function (t) {
          var r;
          return (r = e.closest(t, "[data-turbolinks]")) ? "false" !== r.getAttribute("data-turbolinks") : !0;
        }, r.prototype.locationIsVisitable = function (t) {
          return t.isPrefixedBy(this.view.getRootLocation()) && t.isHTML();
        }, r.prototype.getCurrentRestorationData = function () {
          return this.getRestorationDataForIdentifier(this.restorationIdentifier);
        }, r.prototype.getRestorationDataForIdentifier = function (t) {
          var e;
          return null != (e = this.restorationData)[t] ? e[t] : e[t] = {};
        }, r;
      }();
    }.call(this), function () {
      !function () {
        var t, e;
        if ((t = e = document.currentScript) && !e.hasAttribute("data-turbolinks-suppress-warning")) for (; t = t.parentNode;) {
          if (t === document.body) return console.warn("You are loading Turbolinks from a <script> element inside the <body> element. This is probably not what you meant to do!\n\nLoad your application\u2019s JavaScript bundle inside the <head> element instead. <script> elements in <body> are evaluated with each page change.\n\nFor more information, see: https://github.com/turbolinks/turbolinks#working-with-script-elements\n\n\u2014\u2014\nSuppress this warning by adding a `data-turbolinks-suppress-warning` attribute to: %s", e.outerHTML);
        }
      }();
    }.call(this), function () {
      var t, r, n;
      e.start = function () {
        return r() ? (null == e.controller && (e.controller = t()), e.controller.start()) : void 0;
      }, r = function r() {
        return null == window.Turbolinks && (window.Turbolinks = e), n();
      }, t = function t() {
        var t;
        return t = new e.Controller(), t.adapter = new e.BrowserAdapter(t), t;
      }, n = function n() {
        return window.Turbolinks === e;
      }, n() && e.start();
    }.call(this);
  }).call(this), "object" == ( false ? undefined : _typeof(module)) && module.exports ? module.exports = e :  true && !(__WEBPACK_AMD_DEFINE_FACTORY__ = (e),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
}).call(this);
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../webpack/buildin/module.js */ "./node_modules/webpack/buildin/module.js")(module)))

/***/ }),

/***/ "./node_modules/webpack/buildin/module.js":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function (module) {
  if (!module.webpackPolyfill) {
    module.deprecate = function () {};

    module.paths = []; // module.parent = undefined by default

    if (!module.children) module.children = [];
    Object.defineProperty(module, "loaded", {
      enumerable: true,
      get: function get() {
        return module.l;
      }
    });
    Object.defineProperty(module, "id", {
      enumerable: true,
      get: function get() {
        return module.i;
      }
    });
    module.webpackPolyfill = 1;
  }

  return module;
};

/***/ })

/******/ });
//# sourceMappingURL=application-d75d8760d0bcb2577c39.js.map